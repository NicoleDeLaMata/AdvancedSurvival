[
  {
    "objectID": "WrapupD2.html",
    "href": "WrapupD2.html",
    "title": "Wrap-up",
    "section": "",
    "text": "Today’s sessions focused on moving beyond binary outcomes and single-endpoint survival analysis. We explored:\n\nHow to handle competing events that prevent our primary event of interest?\nHow can we use flexible parametric approaches to improve standard modelling of competing risks?\nHow to model the entire journey of a person through multiple health states?",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD2.html#beyond-single-endpoint-survival-analysis",
    "href": "WrapupD2.html#beyond-single-endpoint-survival-analysis",
    "title": "Wrap-up",
    "section": "",
    "text": "Today’s sessions focused on moving beyond binary outcomes and single-endpoint survival analysis. We explored:\n\nHow to handle competing events that prevent our primary event of interest?\nHow can we use flexible parametric approaches to improve standard modelling of competing risks?\nHow to model the entire journey of a person through multiple health states?",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD2.html#competing-risks-diverging-paths",
    "href": "WrapupD2.html#competing-risks-diverging-paths",
    "title": "Wrap-up",
    "section": "2 1. Competing Risks: Diverging Paths",
    "text": "2 1. Competing Risks: Diverging Paths\nCompeting risk is any event that biologically or logically precludes the occurrence of the primary event of interest - observation is thus complete and the competing event is informative regarding the event of interest.\n\n2.1 Key Analytical Approaches\n\nCause-specific hazards: Used for etiological research to understand the biological risk of an event\nSub-distribution hazards (Fine-Gray model): Provides the “real-world” probability of an event\n\nCrucially, in the latter approach, individuals who experience a competing event remain in the risk set, preventing the overestimation bias typical of the Kaplan-Meier estimator in this context.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD2.html#flexible-parametric-approaches-to-competing-risks",
    "href": "WrapupD2.html#flexible-parametric-approaches-to-competing-risks",
    "title": "Wrap-up",
    "section": "3 2. Flexible parametric approaches to competing risks",
    "text": "3 2. Flexible parametric approaches to competing risks\n\nDifferent competing risks can have vastly different hazard shapes\nFlexible parametric approaches can be applied to the analysis of competing risks\nA flexible parametric model can be fit for each competing event separately\nEach competing risk can have its own complexity (different number of knots) and its own time-dependent effects, allowing for non-proportionality",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD2.html#multi-state-models-the-patient-journey",
    "href": "WrapupD2.html#multi-state-models-the-patient-journey",
    "title": "Wrap-up",
    "section": "4 3. Multi-state models: The patient journey",
    "text": "4 3. Multi-state models: The patient journey\nMulti-state models allow us to model complex disease pathways where individuals move through various intermediate states before reaching a terminal event. They can thus be considered an extension of competing risk models, allowing us to account also for semi-competing risks or intermediate events that may change the risk of the terminal event but do not preclude it.\nCore concepts:\n\nTransition Intensities: The instantaneous rates of moving between states (the “speedometer”)\nTransition Probabilities: The likelihood of being in a specific state at a future time (the “odometer”)\n\nPeople can also move back and forth between states (recurrent events).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "Wrap-up"
    ]
  },
  {
    "objectID": "Resources.html",
    "href": "Resources.html",
    "title": "Resources",
    "section": "",
    "text": "De La Mata, N. L., Khou, V., Hedley, J. A., Kelly, P. J., Morton, R. L., Wyburn, K., Webster, A. C. (2024). Journey to kidney transplantation: patient dynamics, suspensions, transplantation and deaths in the Australian kidney transplant waitlist. Nephrology Dialysis Transplantation, 39(7), 1138-1149. https://doi.org/10.1093/ndt/gfad253\nLe-Rademacher, J. G., Therneau, T. M., & Ou, F. S. (2022). The Utility of Multistate Models: A Flexible Framework for Time-to-Event Data. Current epidemiology reports, 9(3), 183–189. https://doi.org/10.1007/s40471-022-00291-y\nJackson, C. (2016). Flexsurv: a platform for parametric survival modeling in R. Journal of Statistical Software, 70(8), 1–33. https://doi.org/10.18637/jss.v070.i08\nJackson, C. H. (2025). Flexible parametric multi-state modelling with flexsurv. MRC Biostatistics Unit. Available from: https://cran.r-project.org/web/packages/flexsurv/vignettes/multistate.pdf\nTherneau, T., Crowson, C., & Atkinson, E. (2020). Multi-state models and competing risks. CRAN-R (https://cran. r-project. org/web/packages/survival/vignettes/compete. pdf).\nTherneau, T. M., & Ou, F.-S. (2024). Using multistate models with clinical trial data for a deeper understanding of complex disease processes. Clinical Trials, 21(5), 531–540. https://doi.org/10.1177/17407745241267862",
    "crumbs": [
      "Resources"
    ]
  },
  {
    "objectID": "Resources.html#recommended-readings",
    "href": "Resources.html#recommended-readings",
    "title": "Resources",
    "section": "",
    "text": "De La Mata, N. L., Khou, V., Hedley, J. A., Kelly, P. J., Morton, R. L., Wyburn, K., Webster, A. C. (2024). Journey to kidney transplantation: patient dynamics, suspensions, transplantation and deaths in the Australian kidney transplant waitlist. Nephrology Dialysis Transplantation, 39(7), 1138-1149. https://doi.org/10.1093/ndt/gfad253\nLe-Rademacher, J. G., Therneau, T. M., & Ou, F. S. (2022). The Utility of Multistate Models: A Flexible Framework for Time-to-Event Data. Current epidemiology reports, 9(3), 183–189. https://doi.org/10.1007/s40471-022-00291-y\nJackson, C. (2016). Flexsurv: a platform for parametric survival modeling in R. Journal of Statistical Software, 70(8), 1–33. https://doi.org/10.18637/jss.v070.i08\nJackson, C. H. (2025). Flexible parametric multi-state modelling with flexsurv. MRC Biostatistics Unit. Available from: https://cran.r-project.org/web/packages/flexsurv/vignettes/multistate.pdf\nTherneau, T., Crowson, C., & Atkinson, E. (2020). Multi-state models and competing risks. CRAN-R (https://cran. r-project. org/web/packages/survival/vignettes/compete. pdf).\nTherneau, T. M., & Ou, F.-S. (2024). Using multistate models with clinical trial data for a deeper understanding of complex disease processes. Clinical Trials, 21(5), 531–540. https://doi.org/10.1177/17407745241267862",
    "crumbs": [
      "Resources"
    ]
  },
  {
    "objectID": "Resources.html#recommended-textbooks",
    "href": "Resources.html#recommended-textbooks",
    "title": "Resources",
    "section": "2 Recommended textbooks",
    "text": "2 Recommended textbooks\nAndersen, P. K. (2023). Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values (H. Ravn, Ed.; First edition, Vol. 1). CRC Press. https://doi.org/10.1201/9780429029684\nBeyersmann, J., Allignol, A., & Schumacher, M. (2012). Competing Risks and Multistate Models with R (1st ed. 2012.). Springer New York. https://doi.org/10.1007/978-1-4614-2035-4\nKleinbaum, D. G., & Klein, M. (2012). Survival Analysis: A Self-Learning Text (3rd ed.). Springer.\nLegrand, C. (2021). Advanced survival models (First edition.). CRC Press. https://www.taylorfrancis.com/books/9780429054167\nPintilie, M. (2006). Competing Risks: A Practical Perspective. John Wiley & Sons.",
    "crumbs": [
      "Resources"
    ]
  },
  {
    "objectID": "Parametric.html",
    "href": "Parametric.html",
    "title": "3 Parametric survival models",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine a parametric survival model and explain the fundamental trade-off between parametric and non-parametric/semi-parametric models.\nUnderstand and evaluate the key advantages of parametric models\nDifferentiate between common survival distributions and identify when to use them\nCompare and contrast the two primary modelling frameworks: Proportional Hazards (PH) and Accelerated Failure Time (AFT)\nInterpret model parameters from R output (flexsurv and survival packages), including converting raw coefficients into meaningful measures like Hazard Ratios (HR), Time Ratios (TR), and Survival Odds Ratios (SOR).\nValidate model assumptions using graphical techniques\nExecute formal model selection procedures, applying Likelihood Ratio Test (LRT) and AIC/BIC, as appropriate, to identify the most parsimonious and well-fitting distribution.\nImplement advanced modelling techniques, such as fitting Generalised Gamma models to evaluate simpler nested distributions or allowing ancillary parameters to vary by treatment group.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#learning-objectives",
    "href": "Parametric.html#learning-objectives",
    "title": "3 Parametric survival models",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine a parametric survival model and explain the fundamental trade-off between parametric and non-parametric/semi-parametric models.\nUnderstand and evaluate the key advantages of parametric models\nDifferentiate between common survival distributions and identify when to use them\nCompare and contrast the two primary modelling frameworks: Proportional Hazards (PH) and Accelerated Failure Time (AFT)\nInterpret model parameters from R output (flexsurv and survival packages), including converting raw coefficients into meaningful measures like Hazard Ratios (HR), Time Ratios (TR), and Survival Odds Ratios (SOR).\nValidate model assumptions using graphical techniques\nExecute formal model selection procedures, applying Likelihood Ratio Test (LRT) and AIC/BIC, as appropriate, to identify the most parsimonious and well-fitting distribution.\nImplement advanced modelling techniques, such as fitting Generalised Gamma models to evaluate simpler nested distributions or allowing ancillary parameters to vary by treatment group.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#what-is-a-parametric-survival-model",
    "href": "Parametric.html#what-is-a-parametric-survival-model",
    "title": "3 Parametric survival models",
    "section": "2 What is a parametric survival model?",
    "text": "2 What is a parametric survival model?\nA parametric survival model is one in which the survival time, \\(T\\), is assumed to follow a specific, known probability distribution\n\\[T \\sim f(t | \\theta),\\]\nwhere \\(f\\) belongs to a known family (e.g., Exponential, Weibull).\nWhile the family of the distribution is assumed, the exact distribution remains unknown until the vector of parameters \\(\\theta\\) is defined.\nWe use observed data (including censored observations) to estimate these parameters — typically via maximum likelihood estimation (MLE) — to best fit the survival experience of the cohort.\n\n\n\n\n\n\nNote\n\n\n\nUnlike the Cox Proportional Hazards model (which is semi-parametric), parametric models require us to specify the shape of the underlying hazard. The hazard function \\(h(t)\\) and survival function \\(S(t)\\) are thus specified fully by a set of parameters.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#why-parametric-survival-models",
    "href": "Parametric.html#why-parametric-survival-models",
    "title": "3 Parametric survival models",
    "section": "3 Why parametric survival models?",
    "text": "3 Why parametric survival models?\nFlexibility vs. specification\nThe choice of a survival model often involves a trade-off between being “data-driven” (flexible) and “model-driven” (specified).\n\nNon-parametric methods (e.g., Kaplan-Meier): These make no assumptions about the distribution of survival times. While flexible, they result in “step functions” that are tied strictly to the observed event times.\nSemi-parametric methods (e.g., Cox proportional hazards model): The Cox model assumes proportional hazards but leaves the shape of the baseline hazard unspecified. This makes it widely applicable and robust, but it cannot provide a full picture of the hazard over time.\nParametric models: These assume a specific functional form (shape) for the baseline hazard. While this requires more justification, it offers several powerful advantages.\n\nKey advantages of parametric models\n\nCompleteness: Both the hazard function \\(h(t)\\) and the survival function \\(S(t)\\) are fully specified for all values of \\(t\\).\nSmoothness and continuity: Unlike non-parametric step functions (which only change at the exact moment of an observed event), parametric models provide smooth, continuous functions. This is often more consistent with biological theory, where the underlying risk (hazard) of a disease usually evolves continuously over time rather than in discrete jumps.\nExtrapolation: Perhaps the most significant advantage is the ability to predict survival beyond the last observed event.\nEfficiency: if the chosen distribution is a good fit for the data, parametric models provide more precise inferences (narrower confidence intervals) than semi-parametric models.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#common-distributions-in-parametric-survival-models",
    "href": "Parametric.html#common-distributions-in-parametric-survival-models",
    "title": "3 Parametric survival models",
    "section": "4 Common distributions in parametric survival models",
    "text": "4 Common distributions in parametric survival models\nDistributions commonly used for parametric survival models include:\n\nExponential: Assumes a constant hazard over time (e.g., a speedometer stuck at 100 km/h)\nWeibull: A monotonic hazard that can either increase or decrease over time (e.g., a car constantly accelerating or decelerating)\nLog-logistic/lognormal: Useful for unimodal non-monotic hazard that first increases and then decreases (e.g., recovery from surgery)\nGeneralized gamma: A flexible distribution that can accommodate various different hazard shapes (constant, increasing, decreasing, unimodal, bathtub)\nGompertz: Specifically useful for modeling human mortality where hazard increases exponentially with age\nPiecewise exponential: Acts as a bridge between parametric and Cox models. Uses a step-function approach to modelling flexible hazards by assuming a constant hazard with pre-defined time intervals",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#exponential-distribution",
    "href": "Parametric.html#exponential-distribution",
    "title": "3 Parametric survival models",
    "section": "5 Exponential distribution",
    "text": "5 Exponential distribution\nSuppose that the survival times of \\(n\\) individuals, \\(t_1,t_2,…,t_n\\) are assumed to have an exponential distribution, then\n\\[f(t) = \\lambda e^{-\\lambda t}\\]\n\\[S(t) = P( &gt; t) = \\int_t^{\\infty} f(u)du = \\int_t^{\\infty} \\lambda e^{-\\lambda u} = e^{-\\lambda t}\\]\n\\[h(t) = \\frac{f(t)}{S(t)} = \\lambda, \\text{a constant hazard rate}\\]",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#weibull-distribution",
    "href": "Parametric.html#weibull-distribution",
    "title": "3 Parametric survival models",
    "section": "6 Weibull distribution",
    "text": "6 Weibull distribution\nThe constant hazard rate assumption underlying exponentially distributed survival times can be unrealistic.\nThe Weibull distribution allows more flexibility in the shape of the hazard function:\n\\[h(t) = \\lambda \\gamma t^{\\gamma-1}\\] \\[S(t) = \\exp[-H(t)] = \\exp[-\\int_0^t h(u)du] = \\exp(-\\lambda t^\\gamma)\\]\n\\[f(t) = h(t)S(t) = \\lambda \\gamma t^{\\gamma-1} \\exp(-\\lambda t^\\gamma),\\] where \\(\\lambda\\) is the scale parameter and \\(\\gamma\\) is the shape parameter.\nThe Weibull simplifies to the exponential when \\(\\gamma = 1\\)\nThe scale parameter determines the stretch or spread of the distribution along the time axis, whereas the shape parameter determines if the hazard is increasing, decreasing, or constant. If you increase the scale parameter while keeping the shape constant, you are essentially stretching the survival time, meaning the event happens later on average. In terms of the speedometer analogy, if the shape is how the car accelerates, the scale is the gear the car is in, determining the overall range of speeds possible.\nWeibull hazard, survival and probability density functions for different values of the shape parameter while assuming scale parameter is 1 are shown below:\n\n\nShow R code\n# make sure you have installed the tidyverse package\n# install.packages(\"tidyverse\")\n# load the tidyverse package\nlibrary(tidyverse) # we are using tidyverse tools such as the pipe (%&gt;%) and dplyr\n\n# Weibull hazard, survival and probability density functions\n\n# assumes scale parameter is 1\n# four different values for the shape parameter: 0.1, 1, 2, 3\ndata_weibull &lt;- data.frame(expand.grid(Time = seq(0.01,2,0.01),\n                              Gamma = c(0.1, 1, 2, 3))) %&gt;%\n  mutate(Hazard = Gamma*Time^(Gamma - 1),\n         Survival = exp(-Time^Gamma),\n         PDF = Gamma*Time^(Gamma - 1)*exp(-Time^Gamma),\n         c = recode_factor(Gamma, `0.1` = \"gamma == 0.1\", \n                           `1` = \"gamma == 1.0\", \n                           `2` = \"gamma == 2\", \n                           `3` = \"gamma == 3\"))\n\n# Weibull hazard functions\nggplot(data_weibull, aes(x=Time, y=Hazard, group=c)) +\n  geom_line(aes(linetype=c, color=c), linewidth = 0.8) +\n  labs(color = '', linetype = '') +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# Weibull survival functions\nggplot(data_weibull, aes(x=Time, y=Survival, group=c)) +\n  geom_line(aes(linetype=c, color=c), linewidth = 0.8) +\n  labs(color = '', linetype = '') +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# Weibull probability density functions\nggplot(data_weibull, aes(x=Time, y=PDF, group=c)) +\n  geom_line(aes(linetype=c, color=c), linewidth = 0.8) +\n  labs(color = '', linetype = '', y=\"Probability Density Function\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nA unique property of the Weibull distribution is that regardless of the shape, the scale parameter represents the time point by which approximately 63.2% of the population is expected to have experienced the event. If the scale = 1, it means that at 1 unit of time (e.g., 1 year or 1 month, depending on your data), roughly 63% of your subjects will have had the event, as can be seen from the survival distribution above.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#fitting-a-parametric-survival-model",
    "href": "Parametric.html#fitting-a-parametric-survival-model",
    "title": "3 Parametric survival models",
    "section": "7 Fitting a parametric survival model",
    "text": "7 Fitting a parametric survival model\nParametric survival models are typically fitted to observed survival data using the method of maximum likelihood. We construct a likelihood function that represents the probability of observing our specific data given a set of parameters. Because the likelihood equations for survival data are often complex, in practice a numerical procedure - most commonly the Newton-Raphson algorithm - is used to find the values of parameters that maximise the likelihood function.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-the-gehan-leukaemia-data",
    "href": "Parametric.html#data-example-the-gehan-leukaemia-data",
    "title": "3 Parametric survival models",
    "section": "8 Data example: The Gehan leukaemia data",
    "text": "8 Data example: The Gehan leukaemia data\nTo demonstrate fitting parametric survival models, we will use a data example by Gehan (1965) (which originated from a randomised controlled trial by Freireich et al. 1963), in which\n\n42 children with acute leukaemia were enrolled in a randomised controlled trial, in which 21 patients received an experimental treatment (6-mercaptopurine or 6-MP) and the other 21 received a placebo\nParticipants had complete or partial remission status at randomisation, and were matched by remission status (one randomised to 6-MP and the other to placebo)\nThe participants were then followed until their leukaemia returned (relapse) or the end of study (administrative censoring)\n\nThe Gehan study data is included in the MASS package:\n\n\nShow R code\n# make sure you have installed the MASS package\n# install.packages(\"MASS\")\n# load the MASS package\nlibrary(MASS)\n\n# View gehan data for the leukaemia trial in MASS package gehan\nMASS::gehan\n\n\n   pair time cens   treat\n1     1    1    1 control\n2     1   10    1    6-MP\n3     2   22    1 control\n4     2    7    1    6-MP\n5     3    3    1 control\n6     3   32    0    6-MP\n7     4   12    1 control\n8     4   23    1    6-MP\n9     5    8    1 control\n10    5   22    1    6-MP\n11    6   17    1 control\n12    6    6    1    6-MP\n13    7    2    1 control\n14    7   16    1    6-MP\n15    8   11    1 control\n16    8   34    0    6-MP\n17    9    8    1 control\n18    9   32    0    6-MP\n19   10   12    1 control\n20   10   25    0    6-MP\n21   11    2    1 control\n22   11   11    0    6-MP\n23   12    5    1 control\n24   12   20    0    6-MP\n25   13    4    1 control\n26   13   19    0    6-MP\n27   14   15    1 control\n28   14    6    1    6-MP\n29   15    8    1 control\n30   15   17    0    6-MP\n31   16   23    1 control\n32   16   35    0    6-MP\n33   17    5    1 control\n34   17    6    1    6-MP\n35   18   11    1 control\n36   18   13    1    6-MP\n37   19    4    1 control\n38   19    9    0    6-MP\n39   20    1    1 control\n40   20    6    0    6-MP\n41   21    8    1 control\n42   21   10    0    6-MP\n\n\nWhen you load the dataset in R, you will see the following variables in the data:\n\npair: Label for matched pair (we will ignore this aspect in our examples)\ntime: The time (in weeks) in remission until the return of the disease (relapse)\ncens: The censoring indicator (0 = censoring, 1 = relapse)\ntreat: The treatment arm (control, 6-MP).",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#modelling-approaches",
    "href": "Parametric.html#modelling-approaches",
    "title": "3 Parametric survival models",
    "section": "9 Modelling approaches",
    "text": "9 Modelling approaches\nTo evaluate how covariates affect survival times, two following modelling approaches can be employed:\n1. Proportional hazards (PH) models\nA significant benefit of the direct mathematical link between the hazard function and the survival function is that any covariate effect modelled on the hazard scale translates intuitively to the survival scale. Consequently, regression models in survival analysis are typically specified at the level of the hazard.\nThe most common approach involves relative risk models, which assume that covariates have a multiplicative effect on the hazard. For an individual \\(i\\) (where \\(i = 1, \\dots, n\\)) with a set of \\(p\\) covariates \\(x_i = (x_{i1}, \\dots, x_{ip})\\), the proportional hazards (PH) model defines the hazard function as:\n\\[h_i(t) = h(t | x_i) = h_0(t) \\cdot \\psi(x_i),\\]\nwhere\n\n\\(h_0(t)\\) is the baseline hazard, a time-dependent function representing the risk for an individual with all covariate values set to zero. This baseline is common to all individuals in the study.\n\\(\\psi(x_i)\\) is the multiplier, a non-negative function of the covariates that scales the baseline hazard up or down.\n\nTo ensure the hazard remains positive, we typically use the exponential of a linear combination of the covariates (\\(x_i \\beta\\)). The resulting model is expressed as:\n\\[h_i(t) = h(t | x_i) = h_0(t) \\exp(x_i \\beta)\\] On the log-hazard scale this model writes down\n\\[\\log h_i(t) = \\log h(t | x_i) = \\log h_0(t) + x_i \\beta,\\] showing how the covariates shift the hazard proportionally, as the distance between the log-hazard curves remains constant over time.\nIn our data example, we would be interested to know “Does the treatment lower the risk of leukaemia relapse compared to the placebo?”\nThe results from proportional hazards models are typically reported as hazard ratios (HR). The main assumption of this model is the proportional hazards assumption, i.e., that the ratio of the hazards for two subjects with covariate values \\(x_i\\) and \\(x_j\\) is constant over time:\n\\[ \\frac{h(t|x_i)}{h(t|x_j)} = \\frac{\\exp(x_i\\beta)}{\\exp(x_j\\beta)}\\]\n2. Accelerated failure time (AFT) models\nWhile the proportional hazards (PH) model is the standard in survival analysis, the accelerated failure time (AFT) model serves as a powerful alternative. It is particularly useful when the proportional hazards assumption is violated or when the research question focuses on the timing of an event rather than the risk of its occurrence.\nBecause survival time \\(T\\) is a positive variable, the AFT model is naturally framed as a log-linear regression. This allows us to model the impact of covariates directly on the event time \\(T\\) using a log link function:\n\\[\\log(T_i) = \\mu + x_i\\alpha + \\sigma\\epsilon_i,\\]\nwhere\n\n\\(\\mu\\) and \\(\\sigma\\) represent the location and scale parameters, respectively\n\\(x_i\\alpha\\) is the linear predictor of your covariates\n\\(\\epsilon_i\\) is s the error term, typically assumed to follow a specific parametric distribution (such as Extreme Value, Normal, or Logistic)\n\nThe intuition behind the name accelerated failure time model is best understood through the survival function. For any individual \\(i\\), the AFT model assumes that covariates act directly on the time scale itself:\n\\[S_i(t) = S_0\\left( \\phi \\cdot t \\right),\\] where \\(S_0(.)\\) is the baseline survival function and \\(\\phi &gt;0\\) is an acceleration factor (AF).\nMore generally, one can write \\(\\phi = exp(-x_i\\alpha)\\):\n\\[S_i(t) = S_0\\left( \\exp(-x_i\\alpha) \\cdot t \\right)\\] In this framework, the covariates act as an accelerator factor \\((\\phi = \\exp(-x_i\\alpha))\\):\n\nAccelerating time, if \\(\\alpha &gt; 1\\), making the time pass ‘faster’ for that individual, so that they reach the event sooner than the baseline\nDecelerating time, if \\(\\alpha &lt; 1\\), making time ‘slow down’ and extending the survival period compared to the baseline\n\nIn AFT model, the covariates thus stretch out or shrink survival time. In our data example, we would be interested to know “How much longer can a patient expect to remain in remission on the treatment compared to the placebo?”\nIn our data example, we would be interested to know “Does the treatment lower the risk of leukaemia relapse compared to the placebo?”\nThe results from accelerated failure models are typically reported as time ratios (TR). The main assumption of the AFT model is that the effect of a covariate is to multiply the time scale, i.e., that the ratio of event times in two groups, i.e., exposed (E) and control (C)\n\\[ TR = \\frac{T_E}{T_C} \\] is constant over time.\nAFT models are usually fully parametric.\nIn the following we are going to show how to fit various fully parametric proportional hazards and accelerated failure time models in our example dataset.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-fitting-an-exponential-model",
    "href": "Parametric.html#data-example-fitting-an-exponential-model",
    "title": "3 Parametric survival models",
    "section": "10 Data example: Fitting an Exponential model",
    "text": "10 Data example: Fitting an Exponential model\nFor exponential model, applied to the data example, where \\(X\\) = group (1 = treatment, 0 = placebo):\n1. Proportional hazards (PH) model\n\\[h(t | X) = h_0(t) \\exp(X \\beta_1) = \\lambda \\exp(X \\beta_1) = \\exp(\\beta_0 + X \\beta_1) \\]\n2. Accelerated failure time (AFT) model\n\\[\\log(T) = \\mu + X\\alpha_1 + \\sigma\\epsilon,\\] where for exponential model, the scale parameter \\(\\sigma\\) is fixed at 1.\nExponential PH and AFT models are thus the same model, the only difference is in their parametrisation.\nFitting exponential proportional hazards (PH) model\nWe can fit the exponential PH model using flexsurvreg function from the flexsurv package, specifying dist=\"exp\":\n\n\nShow R code\n# make sure you have installed the flexsurv package\n# install.packages(\"flexsurv\")\n# load the flexsurv package\n# note that when you load the flexsurv package, it also automatically loads the \n# survival package, as it is built directly on top of the survival package's \n# infrastructure, and needs the Surv() function and the underlying survival object \n# logic to function\nlibrary(flexsurv) # for flexsurvreg for parametric models\nlibrary(MASS) # reloaded to be able to run this code block independently\n\n# read in the gehan data for the leukaemia trial in MASS package gehan\nleukdata &lt;- MASS::gehan\n\n# Setting control group as the reference group\nleukdata$treat &lt;- factor(leukdata$treat, levels = c(\"control\", \"6-MP\"))\n\n# EXPONENTIAL PH MODEL\n\n# Fitting an exponential PH model using flexsurv package\nexp_PH &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"exp\")\n# Summary shows results in terms of rate by default\n# gives rate for the reference group (placebo)\n# gives HR\nexp_PH\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"exp\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \nrate            NA     0.1154   0.0752   0.1770   0.0252       NA        NA\ntreat6-MP   0.5000    -1.5266  -2.3075  -0.7457   0.3984   0.2173    0.0995\n           U95%   \nrate            NA\ntreat6-MP   0.4744\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -108.524, df = 2\nAIC = 221.0481\n\n\nShow R code\n# This will calculate the actual hazard rate for each group\nsummary(exp_PH, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\ntreat=control \n   time       est        lcl       ucl\n1     1 0.1153846 0.07563433 0.1712061\n2     2 0.1153846 0.07563433 0.1712061\n3     3 0.1153846 0.07563433 0.1712061\n4     4 0.1153846 0.07563433 0.1712061\n5     5 0.1153846 0.07563433 0.1712061\n6     6 0.1153846 0.07563433 0.1712061\n7     7 0.1153846 0.07563433 0.1712061\n8     8 0.1153846 0.07563433 0.1712061\n9     9 0.1153846 0.07563433 0.1712061\n10   10 0.1153846 0.07563433 0.1712061\n11   11 0.1153846 0.07563433 0.1712061\n12   12 0.1153846 0.07563433 0.1712061\n13   13 0.1153846 0.07563433 0.1712061\n14   15 0.1153846 0.07563433 0.1712061\n15   16 0.1153846 0.07563433 0.1712061\n16   17 0.1153846 0.07563433 0.1712061\n17   19 0.1153846 0.07563433 0.1712061\n18   20 0.1153846 0.07563433 0.1712061\n19   22 0.1153846 0.07563433 0.1712061\n20   23 0.1153846 0.07563433 0.1712061\n21   25 0.1153846 0.07563433 0.1712061\n22   32 0.1153846 0.07563433 0.1712061\n23   34 0.1153846 0.07563433 0.1712061\n24   35 0.1153846 0.07563433 0.1712061\n\ntreat=6-MP \n   time        est        lcl        ucl\n1     1 0.02506964 0.01277963 0.04621725\n2     2 0.02506964 0.01277963 0.04621725\n3     3 0.02506964 0.01277963 0.04621725\n4     4 0.02506964 0.01277963 0.04621725\n5     5 0.02506964 0.01277963 0.04621725\n6     6 0.02506964 0.01277963 0.04621725\n7     7 0.02506964 0.01277963 0.04621725\n8     8 0.02506964 0.01277963 0.04621725\n9     9 0.02506964 0.01277963 0.04621725\n10   10 0.02506964 0.01277963 0.04621725\n11   11 0.02506964 0.01277963 0.04621725\n12   12 0.02506964 0.01277963 0.04621725\n13   13 0.02506964 0.01277963 0.04621725\n14   15 0.02506964 0.01277963 0.04621725\n15   16 0.02506964 0.01277963 0.04621725\n16   17 0.02506964 0.01277963 0.04621725\n17   19 0.02506964 0.01277963 0.04621725\n18   20 0.02506964 0.01277963 0.04621725\n19   22 0.02506964 0.01277963 0.04621725\n20   23 0.02506964 0.01277963 0.04621725\n21   25 0.02506964 0.01277963 0.04621725\n22   32 0.02506964 0.01277963 0.04621725\n23   34 0.02506964 0.01277963 0.04621725\n24   35 0.02506964 0.01277963 0.04621725\n\n\nThe output for the intercept is \\(\\exp(\\hat{\\beta_0})\\), giving the baseline hazard for the reference group (placebo) directly: \\(\\hat{\\lambda_0}=0.115\\). \\(\\hat{\\beta_1} = -1.527\\), on the other hand, is reported on the log-hazard scale, and the sign of the raw coefficient tells you the direction of the effect immediately (e.g., negative is a reduction in risk). However, the output also gives you the \\(\\exp(\\hat{\\beta_1})\\), which is the hazard ratio (HR) we are typically interested in:\n\\[HR = \\frac{\\exp(\\hat{\\beta_0}+\\hat{\\beta_1})}{\\exp(\\hat{\\beta_0})} = \\exp(\\hat{\\beta_1}) = \\exp(-1.527) = 0.217\\] We can also calculate the hazard for the treatment group \\(\\hat{\\lambda_1} = \\exp(\\hat{\\beta_0}+\\hat{\\beta_1}) = 0.115*0.217 = 0.025\\)\nAssuming the data follow exponential distribution, the treatment lowers the risk of leukaemia relapse by 78% compared to the placebo (HR = 0.217, 95% CI = 0.10, 0.474).\nFitting exponential accelerated failure time (AFT) model\nWe can fit the exponential accelerated failure time model using survreg function from the survival package, specifying dist=\"exponential\":\n\n\nShow R code\n# make sure you have installed the survival package\n# install.packages(\"survival\")\n# load the survival package\n# note that when you loaded the flexsurv package above, it also automatically \n# loaded the survival package, as it is built directly on top of the survival \n# package's infrastructure, and needs the Surv() function and the underlying \n# survival object logic to function\nlibrary(survival) # for survreg for parametric models\n\n# EXPONENTIAL AFT MODEL\n\n# Fitting an exponential AFT model using survreg package\nexp_AFT &lt;- survreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"exponential\")\nsummary(exp_AFT)\n\n\n\nCall:\nsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"exponential\")\n            Value Std. Error    z       p\n(Intercept) 2.159      0.218 9.90 &lt; 2e-16\ntreat6-MP   1.527      0.398 3.83 0.00013\n\nScale fixed at 1 \n\nExponential distribution\nLoglik(model)= -108.5   Loglik(intercept only)= -116.8\n    Chisq= 16.49 on 1 degrees of freedom, p= 4.9e-05 \nNumber of Newton-Raphson Iterations: 4 \nn= 42 \n\n\nShow R code\n# Extract coefficients\ncoeffs &lt;- coef(exp_AFT)\ncoeffs\n\n\n(Intercept)   treat6-MP \n   2.159484    1.526614 \n\n\nShow R code\n# Mean survival time in the control (placebo) group\nT_C &lt;- exp(coeffs[1])\nT_C\n\n\n(Intercept) \n   8.666667 \n\n\nShow R code\n# Mean survival time in the exposed (treatment) group\nT_E &lt;- exp(coeffs[1]+coeffs[2])\nT_E\n\n\n(Intercept) \n   39.88889 \n\n\nShow R code\n# Calculate Time Ratio (TR) for the treatment\ntime_ratio &lt;- exp(coeffs[2])\ntime_ratio\n\n\ntreat6-MP \n 4.602564 \n\n\nShow R code\n# Calculate 95% confidence intervals for the TR\nconf_intervals &lt;- exp(confint(exp_AFT)[2, ])\nconf_intervals\n\n\n    2.5 %    97.5 % \n 2.108012 10.049088 \n\n\nAs the AFT model is parameterised as a linear regression of log-survival time, the intercept (\\(\\mu\\)) represents the log of the mean survival time for the control (placebo) group, with mean survival time thus \\(T_C = \\exp(\\hat{\\mu}) = 8.7\\) weeks. The coefficient \\(\\hat{\\alpha_1} = 1.527\\) is also expressed on the log-time scale, and the sign of the raw coefficient tells you the direction of the effect immediately (e.g., positive means the treatment increases the time in remission). We can calculate the mean survival time for the exposed (treatment) group \\(T_E = \\exp(\\hat{\\mu}+\\hat{\\alpha_1}) = \\exp(2.159+1.527) = 39.9\\) weeks. We can also calculate the time ratio (TR) that we are typically interested in:\n\\[TR = \\frac{T_E}{T_C} = \\frac{\\exp(\\hat{\\mu}+\\hat{\\alpha_1})}{\\hat{\\exp(\\hat{\\mu})}} = \\exp(\\hat{\\alpha_1}) = \\exp(1.527) = 4.6\\] Thus, assuming the data follow exponential distribution, the treatment extends the time in remission 4.6 times (TR = 4.6, 95% CI = 2.1, 10.0).\nNote that for exponential model the coefficient \\(\\alpha_1\\) for the AFT model is the opposite to the coefficient \\(\\beta_1\\) in PH model: \\(\\beta_1 = - \\alpha_1\\). The hazard ratio for exponential PH model can thus also be obtained from the survreg output as \\(\\exp(-1.527) = 0.22\\).\nWe can also use the predict() function from the stats package (which is loaded by default) to compute for example median survival time . When a survreg object is used, a specific predict.survreg() function is called:\n\n\nShow R code\n# EXPONENTIAL AFT MODEL\n\n# Function predict can compute median survival time \n# Median survival time for placebo and treatment group\nmedian_times &lt;- predict(exp_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), \n                        type = \"quantile\", p = 0.5)\nmedian_times\n\n\n        1         2 \n 6.007276 27.648871 \n\n\nShow R code\n# predict() function does not work for flexsurv objects but we can use summary\nmedian_by_group &lt;- summary(exp_PH, type = \"quantile\", quantiles = 0.5)\n# stack the list elements into one table\ndo.call(rbind, median_by_group)\n\n\n              quantile       est       lcl       ucl\ntreat=control      0.5  6.007276  3.893135  9.297986\ntreat=6-MP         0.5 27.648871 14.355990 54.687991\n\n\nShow R code\n# similarly for mean\nmean_by_group &lt;- summary(exp_PH, type = \"mean\")\ndo.call(rbind, mean_by_group)\n\n\n                    est       lcl      ucl\ntreat=control  8.666667  5.804312 13.69279\ntreat=6-MP    39.888889 20.725716 76.59898\n\n\nShow R code\n# can also be used to obtain restricted mean survival time to chosen tau = t\n#summary(exp_PH, type = \"rmst\", t = 10)\n\n\nNote that the ratio of the median survival times \\(TR = \\frac{27.6}{6.0} = 4.6\\).",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-fitting-a-weibull-model",
    "href": "Parametric.html#data-example-fitting-a-weibull-model",
    "title": "3 Parametric survival models",
    "section": "11 Data example: Fitting a Weibull model",
    "text": "11 Data example: Fitting a Weibull model\nFor Weibull model, applied to the data example, where \\(X\\) = group (1 = treatment, 0 = placebo):\n1. Proportional hazards (PH) model\n\\[h(t | X) = h_0(t) \\exp(X \\beta_1) = \\lambda \\gamma t^{\\gamma-1} \\exp(X \\beta_1) = \\exp(\\beta_0 + X \\beta_1)\\gamma t^{\\gamma-1}, \\]\nwhere \\(h_0(t) = \\exp(\\beta_0)\\gamma t^{\\gamma-1}\\)\n2. Accelerated failure time (AFT) model\n\\[\\log(T) = \\mu + X\\alpha_1 + \\sigma\\epsilon,\\] The following relationships apply:\n\\(\\lambda = \\exp(\\frac{-\\mu}{\\sigma}), \\gamma = \\frac{1}{\\sigma}, \\beta_1 = \\frac{-\\alpha_1}{\\sigma}\\)\nFor further detail and proof see:\nCatherine Legrand. Advanced survival models. 2021.\nNote also that the Weibull distribution is mathematically unique in that it is the only distribution that satisfies both the proportional hazards (PH) and accelerated failure time (AFT) assumptions simultaneously.\nFitting Weibull proportional hazards (PH) model\nWe can fit the Weibull PH model using flexsurvreg function from the flexsurv package, specifying dist=\"weibullPH\":\n\n\nShow R code\n# WEIBULL PH MODEL\n\n# Fitting a Weibull PH model using flexsurv package\nwei_PH &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"weibullPH\")\n\n# gives estimate for shape parameter and scale parameter\n# gives HR\nwei_PH\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"weibullPH\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \nshape           NA     1.3658   1.0233   1.8228   0.2012       NA        NA\nscale           NA     0.0464   0.0155   0.1385   0.0259       NA        NA\ntreat6-MP   0.5000    -1.7309  -2.5405  -0.9212   0.4131   0.1771    0.0788\n           U95%   \nshape           NA\nscale           NA\ntreat6-MP   0.3980\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.5795, df = 3\nAIC = 219.159\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\nsummary(wei_PH, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\ntreat=control \n   time        est        lcl       ucl\n1     1 0.06335542 0.02896587 0.1482740\n2     2 0.08163713 0.04720033 0.1581785\n3     3 0.09468789 0.06049797 0.1641259\n4     4 0.10519418 0.06981734 0.1734936\n5     5 0.11413984 0.07694147 0.1813703\n6     6 0.12201084 0.08232592 0.1947539\n7     7 0.12908765 0.08620431 0.2094615\n8     8 0.13554880 0.08851323 0.2256332\n9     9 0.14151586 0.09128896 0.2474927\n10   10 0.14707581 0.09341675 0.2647655\n11   11 0.15229335 0.09504637 0.2864100\n12   12 0.15721804 0.09713373 0.3022444\n13   13 0.16188883 0.09785789 0.3142957\n14   15 0.17058780 0.10088346 0.3459331\n15   16 0.17466250 0.10215017 0.3646424\n16   17 0.17857871 0.10300762 0.3837658\n17   19 0.18599338 0.10442243 0.4148969\n18   20 0.18951572 0.10481474 0.4312832\n19   22 0.19623882 0.10644751 0.4632220\n20   23 0.19945546 0.10686611 0.4778181\n21   25 0.20563205 0.10744168 0.5050704\n22   32 0.22506277 0.10938770 0.6014698\n23   34 0.23010903 0.10977422 0.6263979\n24   35 0.23256172 0.10935084 0.6386798\n\ntreat=6-MP \n   time        est         lcl        ucl\n1     1 0.01122214 0.003491616 0.03682991\n2     2 0.01446038 0.005763104 0.03873474\n3     3 0.01677206 0.007450192 0.04018123\n4     4 0.01863304 0.008742910 0.04164122\n5     5 0.02021758 0.010023985 0.04333368\n6     6 0.02161177 0.010865688 0.04489062\n7     7 0.02286529 0.011974406 0.04622443\n8     8 0.02400975 0.012744798 0.04760341\n9     9 0.02506669 0.013640158 0.04926894\n10   10 0.02605153 0.014455278 0.05044640\n11   11 0.02697571 0.014903805 0.05236010\n12   12 0.02784802 0.015284642 0.05474684\n13   13 0.02867536 0.015707240 0.05696528\n14   15 0.03021621 0.016631869 0.05993230\n15   16 0.03093796 0.016956210 0.06185915\n16   17 0.03163164 0.017076900 0.06384246\n17   19 0.03294499 0.017426324 0.06844853\n18   20 0.03356891 0.017568077 0.07004709\n19   22 0.03475977 0.017821656 0.07361532\n20   23 0.03532953 0.017919608 0.07563711\n21   25 0.03642359 0.018168720 0.08038690\n22   32 0.03986535 0.018915943 0.09371726\n23   34 0.04075920 0.019138670 0.09827424\n24   35 0.04119364 0.019230892 0.10042881\n\n\nThe output gives estimates for the shape \\((\\hat{\\gamma})\\) and scale \\((\\hat{\\sigma})\\) parameters on the natural scale. The estimate for \\((\\hat{\\gamma})\\) is 1.366 suggesting an increase in the hazard as survival time increases (because \\(\\gamma&gt;1\\)). The 95% CI for \\(\\hat{\\gamma}\\) (1.023, 1.822) does not include 1, suggesting that the exponential model is not appropriate.\n\\(\\hat{\\beta_1} = -1.731\\), on the other hand, is reported on the log-hazard scale, and the sign of the raw coefficient tells you the direction of the effect immediately (e.g., negative is a reduction in risk). However, the output also gives you the \\(\\exp(\\hat{\\beta_1})\\), which is the hazard ratio (HR) we are typically interested in:\n\\[HR = \\frac {\\exp(\\hat{\\beta_0}+\\hat{\\beta_1}) \\hat{\\gamma}t^{\\hat{\\gamma}-1}} {\\exp(\\hat{\\beta_0}) \\hat{\\gamma}t^{\\hat{\\gamma}-1}} = \\exp(\\hat{\\beta_1}) = \\exp(-1.731) = 0.177\\]\nAssuming the data follow Weibull distribution, the treatment lowers the risk of leukaemia relapse by 82% compared to the placebo (HR = 0.177, 95% CI = 0.079, 0.398).\nFitting Weibull accelerated failure time (AFT) model\nWe can fit the Weibull accelerated failure time model using survreg function from the survival package, specifying dist=\"weibull\":\n\n\nShow R code\n# WEIBULL AFT MODEL\n\n# Fitting a Weibull model using survreg package\nwei_AFT_surv &lt;- survreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\nsummary(wei_AFT_surv)\n\n\n\nCall:\nsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"weibull\")\n             Value Std. Error     z       p\n(Intercept)  2.248      0.166 13.55 &lt; 2e-16\ntreat6-MP    1.267      0.311  4.08 4.5e-05\nLog(scale)  -0.312      0.147 -2.12   0.034\n\nScale= 0.732 \n\nWeibull distribution\nLoglik(model)= -106.6   Loglik(intercept only)= -116.4\n    Chisq= 19.65 on 1 degrees of freedom, p= 9.3e-06 \nNumber of Newton-Raphson Iterations: 5 \nn= 42 \n\n\nShow R code\n# Extract coefficients\ncoeffs &lt;- coef(wei_AFT_surv)\ncoeffs\n\n\n(Intercept)   treat6-MP \n   2.248352    1.267335 \n\n\nShow R code\n# Calculate Time Ratio (TR) for the treatment\ntime_ratio &lt;- exp(coeffs[\"treat6-MP\"])\ntime_ratio\n\n\ntreat6-MP \n 3.551374 \n\n\nShow R code\n# Calculate 95% confidence intervals for the TR\nconf_intervals &lt;- exp(confint(wei_AFT_surv)[\"treat6-MP\", ])\nconf_intervals\n\n\n   2.5 %   97.5 % \n1.931876 6.528503 \n\n\nShow R code\n# Function predict can compute median survival time \n# Median survival time for placebo and treatment group\nmedian_times &lt;- predict(wei_AFT_surv, newdata = data.frame(treat = c(\"control\", \"6-MP\")), \n                        type = \"quantile\", p = 0.5)\nmedian_times\n\n\n        1         2 \n 7.242697 25.721526 \n\n\nConsistent with the log-linear structure of the AFT model, the intercept/location \\((\\hat{\\mu} = 2.248)\\), coefficient \\((\\hat{\\alpha_1} = 1.267)\\), and scale \\((\\hat{\\sigma} = -0.312)\\) are all reported on the log-time scale, although the actual scale \\((\\exp(\\hat{\\sigma}) = 0.732\\)) is also given.\nFrom the output for scale, we see that it’s not equal to 1 (or log(Scale) equal to 0), with p-value 0.03. This gives us evidence that the Weibull model fits better than the exponential model (as \\(\\sigma \\ne 1)\\) as in exponential model).\nThe positive sign of the raw coefficient tells us that the treatment increases the time in remission. As before, we can calculate the time ratio (TR) that we are typically interested in:\n\\[TR = \\frac{T_E}{T_C} = \\exp(\\hat{\\alpha_1}) = \\exp(1.267) = 3.55\\] We can extract 95% confidence intervals for the TR as shown above, and conclude that - assuming the data follow Weibull distribution - the treatment extends the time in remission 3.55 times (TR = 3.55, 95% CI = 1.93, 6.53).\nAgain, we can also use the predict() function to compute for example median survival times in the two groups, and note that the ratio of the median survival times \\(TR = \\frac{25.7}{7.24} = 3.55\\).\nNote that we can also obtain the estimated values in the Weibull PH model parameterisation from the survreg output by following the equations shown before:\n\\(\\lambda = \\exp(\\frac{-\\mu}{\\sigma}), \\gamma = \\frac{1}{\\sigma}, \\beta_1 = \\frac{-\\alpha_1}{\\sigma}\\)\n\n\nShow R code\nlambda &lt;- exp( -wei_AFT_surv$coef[1] / wei_AFT_surv$scale )\nlambda\n\n\n(Intercept) \n 0.04638848 \n\n\nShow R code\ngamma &lt;- 1 / wei_AFT_surv$scale\ngamma\n\n\n[1] 1.365758\n\n\nShow R code\nbeta &lt;- -wei_AFT_surv$coef[2] / wei_AFT_surv$scale\nbeta\n\n\ntreat6-MP \n-1.730872 \n\n\nShow R code\nHR &lt;- exp(beta)\nHR\n\n\ntreat6-MP \n0.1771299 \n\n\nHowever, there is also a package parfm that does these transformations and allows you to fit the Weibull PH model:\n\n\nShow R code\n# make sure you have installed the parfm package\n# install.packages(\"parfm\")\n# load the parfm package\nlibrary(parfm) \n\n# WEIBULL PH MODEL\n\n# Fitting a Weibull model using survreg package\nwei_AFT_surv2 &lt;- parfm(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\", frailty = \"none\")\nwei_AFT_surv2\n\n\n\nFrailty distribution: none \nBaseline hazard distribution: Weibull \nLoglikelihood: -106.579 \n\n          ESTIMATE SE    p-val    \nrho        1.366   0.200          \nlambda     0.046   0.026          \ntreat6-MP -1.731   0.413 &lt;.001 ***\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nShow R code\nsummary(wei_AFT_surv2)\n\n\n    ESTIMATE              SE              p-val         \n Min.   :-1.73087   Min.   :0.02578   Min.   :2.79e-05  \n 1st Qu.:-0.84224   1st Qu.:0.11310   1st Qu.:2.79e-05  \n Median : 0.04639   Median :0.20043   Median :2.79e-05  \n Mean   :-0.10624   Mean   :0.21309   Mean   :2.79e-05  \n 3rd Qu.: 0.70607   3rd Qu.:0.30675   3rd Qu.:2.79e-05  \n Max.   : 1.36576   Max.   :0.41308   Max.   :2.79e-05  \n                                      NA's   :2         \n\n\nShow R code\nHR &lt;- exp(wei_AFT_surv2[c(3)])\nHR\n\n\n[1] 0.1771299\n\n\nShow R code\nHR_CI &lt;- ci.parfm(wei_AFT_surv2, level = 0.05)\nHR_CI\n\n\n            low    up\ntreat6-MP 0.079 0.398\n\n\nFinally, we can also fit the Weibull accelerated failure time model using flexsurvreg function from the flexsurv package, specifying dist=\"weibull\":\n\n\nShow R code\n# WEIBULL AFT MODEL\n\n# Fitting a Weibull AFT model using flexsurvreg package\nwei_AFT &lt;- flexsurvreg( Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\nwei_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"weibull\")\n\nEstimates: \n           data mean  est     L95%    U95%    se      exp(est)  L95%    U95%  \nshape          NA      1.366   1.023   1.823   0.201      NA        NA      NA\nscale          NA      9.472   6.842  13.114   1.572      NA        NA      NA\ntreat6-MP   0.500      1.267   0.658   1.876   0.311   3.551     1.932   6.529\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.5795, df = 3\nAIC = 219.159\n\n\nThe output for the shape parameter (\\(\\hat{\\gamma}\\)) is the same as in the Weibull PH model (reported on the natural scale). As mentioned before, a unique property of the Weibull distribution is that regardless of the shape, the scale parameter represents the time point by which approximately 63.2% of the population is expected to have experienced the event. In the AFT parameterisation of the Weibull model, the scale parameter in the output refers to this time point, i.e. to time \\(t\\) at which \\(S(t)≈0.368\\), which in this data example is 9.472 weeks for relapse in the reference (placebo) group.\nConsistent with the log-linear structure of the AFT model, the covariate effect \\(\\hat{\\alpha_1} = 1.267\\) is reported on the log-time scale. Similarly as shown above for the survreg output, we can calculate the time ratio (TR) that we are typically interested in:\n\\[TR = \\frac{T_E}{T_C} = \\exp(\\hat{\\alpha_1}) = \\exp(1.267) = 3.55\\] Note, however, that the flexsurvreg output also automatically provides the TR and its 95% confidence interval.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#model-validation",
    "href": "Parametric.html#model-validation",
    "title": "3 Parametric survival models",
    "section": "12 Model validation",
    "text": "12 Model validation\nBefore interpreting the coefficients or baseline parameters from a parametric survival model, we must verify that the chosen distribution is a reasonable approximation of the underlying data-generating process. Unlike semi-parametric models, parametric estimation relies heavily on the validity of the functional form and the behavior of the covariates.\nFirst, we must ensure the distributional form (e.g., Exponential or Weibull) matches the shape of the observed survival history. Second, we must verify the structural assumptions — specifically the proportional hazards (PH) or accelerated failure time (AFT) assumptions. We check this by ensuring that the effect of our covariates remains constant across the entire follow-up period.\n1. Visual comparison with non-parametric estimates\nThe simplest check is to plot the fitted parametric survival curve \\(\\hat{S}(t)\\) directly over the Kaplan-Meier (KM) curve, that is ‘data-driven’ and makes no functional form assumptions. If the smooth parametric curve deviates significantly from the KM steps, the model is likely misspecified.\nKM versus Exponential fit:\n\n\nShow R code\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\n\n# 2. Fit the parametric exponential survival model (predicted) by treatment group\nexp_AFT &lt;- survreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"exponential\")\n\n# 3. Visual suitability check: survival by treatment group\n\n# Plot the KM curves\nplot(km, col = c(\"red\", \"blue\"), conf.int = FALSE, \n     main = \"KM vs Exponential fit\", xlab = \"Weeks\", ylab = \"Survival Probability\")\nlegend(\"bottomleft\", legend = levels(leukdata$treat), col = c(\"red\", \"blue\"), lty = 1:2)\n\n# Add the Exponential theoretical curves\ntimes &lt;- seq(0, max(leukdata$time), length.out = 100)\n\n# Calculate S(t) for Group 1 (reference = placebo)\n# lambda = exp(-intercept)\nlambda_ref &lt;- exp(-coef(exp_AFT)[1])\nlines(times, exp(-lambda_ref * times), col = \"red\", lwd = 2, lty=2)\n\n# Calculate S(t) for Group 2 (treatment)\n# lambda = exp(-(intercept + coefficient)\nlambda_treat &lt;- exp(-(exp_AFT$coef[1] + exp_AFT$coef[2]))\nlines(times, exp(-lambda_treat * times), col = \"blue\", lwd = 2, lty = 2)\n\n\n\n\n\n\n\n\n\nKM versus Exponential and Weibull fit:\n\n\nShow R code\n# 1. Fit the Kaplan-Meier (observed) by treatment group\n# km &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\n\n# 2. Fit the parametric exponential survival model (predicted) by treatment group\n# exp_AFT &lt;- survreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"exponential\")\n\n# 3. Fit the parametric Weibull survival model (predicted) by treatment group\nwei_AFT_surv &lt;- survreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\n\n# 4. Visual suitability check: survival by treatment group\n\n# Plot the KM curves\nplot(km, col = c(\"red\", \"blue\"), conf.int = FALSE, \n     main = \"KM vs Exponential and Weibull fit\", xlab = \"Weeks\", ylab = \"Survival Probability\")\nlegend(\"bottomleft\", legend = levels(leukdata$treat), col = c(\"red\", \"blue\"), lty = 1:2)\n\n# Add the Exponential and Weibull theoretical curves\ntimes &lt;- seq(0, max(leukdata$time), length.out = 100)\n\n# Exponential\n# Calculate S(t) for Placebo (reference)\n# lambda = exp(-intercept)\nlambda_ref_exp &lt;- exp(-exp_AFT$coef[1])\nlines(times, exp(-lambda_ref_exp * times), col = \"red\", lwd = 2, lty=2)\n\n# Calculate S(t) for 6-MP\n# lambda = exp(-(intercept + coefficient_treatment)\nlambda_treat_exp &lt;- exp(-(exp_AFT$coef[1] + exp_AFT$coef[2]))\nlines(times, exp(-lambda_treat_exp * times), col = \"blue\", lwd = 2, lty = 2)\n\n# Weibull\n# we know S(t) for Weibull model is exp(-lambda*t^gamma)\n# Calculate S(t) for Placebo (reference)\n# lambda = exp(-intercept/scale)\nlambda_ref_wei &lt;- exp(-wei_AFT_surv$coef[1]/wei_AFT_surv$scale)\ngamma_wei &lt;- 1/wei_AFT_surv$scale\nlines(times, exp(-lambda_ref_wei * times^gamma_wei), col = \"red\", lwd = 2, lty=3)\n\n# Calculate S(t) for 6-MP\n# lambda = exp(-(intercept + coefficient_treatment)/scale\nlambda_treat_wei &lt;- exp(-(wei_AFT_surv$coef[1] + wei_AFT_surv$coef[2])/wei_AFT_surv$scale)\nlines(times, exp(-lambda_treat_wei * times^gamma_wei), col = \"blue\", lwd = 2, lty = 3)\n\n\n\n\n\n\n\n\n\nWe are essentially checking if the parametric curve can adequately capture the steps of the empirical Kaplan-Meier curve. However, the survival function is naturally curved and so visual inspection is not always a good check for model fit.\nWe could also plot the hazard functions:\n\n\nShow R code\nplot(exp_PH, type = \"hazard\", main = \"Exponential hazard fit\")\n\n\n\n\n\n\n\n\n\nShow R code\nplot(wei_PH, type = \"hazard\", main = \"Weibull hazard fit\")\n\n\n\n\n\n\n\n\n\n2. Linear transformation (graphical checks)\nAlternatively, we can exploit the mathematical properties of these distributions by transforming the survival function into a linear form. If the distribution fits, the transformed data should fall on a straight line.\nFor exponential model, the survival function is \\(S(t)=\\exp(-\\lambda t)\\) and \\(-\\log{S(t)}=-\\lambda t\\), and thus the cumulative hazard, \\(-\\log{S(t)}\\), is linearly related over time with \\(\\lambda\\).\nWe can thus check whether plotting the cumulative hazard against time gives a straight line starting at the origin:\n\n\nShow R code\n# make sure you have installed the survminer package\n# install.packages(\"survminer\")\n# load the survminer package\nlibrary(survminer) # for surv_summary() function\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(survival) # reloaded to be able to run this block independently\n\n# Fitting cumulative hazard against time\n\n# Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\ncum_data &lt;- km %&gt;% surv_summary(data = leukdata)\n\ncum_data &lt;- cum_data %&gt;%\n  mutate(ch = -log(surv))\n\n# using coefficients from this model:\n# exp_AFT &lt;- survreg( Surv(time,cens) ~ treat, data = leukdata, dist = \"exponential\")\nggplot(cum_data, aes(x = time, y = ch, color = treat)) +\n  geom_line() +\n  geom_point() +\n  # we know -logS(t) = lambda * t\n  # intercept: 0\n  # slope: lambda \n  geom_abline(aes(intercept = 0,\n                  slope = exp(-exp_AFT$coef[1])), linetype=2) +\n  geom_abline(aes(intercept = 0,\n                  slope = exp(-(exp_AFT$coef[1]+exp_AFT$coef[2]))), linetype=2) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nIf the hazard is constant, as the exponential model assumes, the plot should be a straight diagonal line. Both plots look reasonably straight suggesting that the exponential assumption is reasonable.\nWe can also use this plot to assess proportional hazards assumption in the exponential PH model: If the hazards are proportional, the lines will diverge at a constant rate. Proportionality is thus visualised as two straight lines that do not cross and stay the same distance apart. That appears to be true here.\nFor Weibull model, the survival function is \\(S(t)=\\exp(-\\lambda t^\\gamma)\\) and \\(\\log(-\\log{S(t)}) = \\log \\lambda + \\log t\\), and thus the log cumulative hazard, \\(\\log(-\\log{S(t)})\\), is linear with log of time.\nWe can thus check whether plotting the log cumulative hazard against log of time gives a straight line:\n\n\nShow R code\n# Fitting log cumulative hazard against time\n\n# Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\ncum_data &lt;- km %&gt;% surv_summary(data = leukdata) \n\ncum_data &lt;- cum_data %&gt;%\n  mutate(log_ch = log(-log(surv)))\n\n# using coefficients from this model:\n# wei_AFT_surv &lt;- survreg( Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\nggplot(cum_data, aes(x = log(time), y = log_ch, color = treat)) +\n  geom_line() +\n  geom_point() +\n  # we know log(-logS(t) = log(lambda)+gamma*log(t)\n  # intercept: log(lambda) = log * exp(-coef/scale)\n  # slope: gamma = 1/scale\n  geom_abline(aes(intercept = -wei_AFT_surv$coef[1]/wei_AFT_surv$scale,\n                  slope = 1/wei_AFT_surv$scale), linetype=2) +\n  geom_abline(aes(intercept = -(wei_AFT_surv$coef[1]+wei_AFT_surv$coef[2])/wei_AFT_surv$scale,\n                  slope = 1/wei_AFT_surv$scale), linetype=2) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nBoth plots look reasonably straight suggesting that the Weibull assumption is reasonable.\nWe can also use this plot to assess the proportional hazards assumption in the Weibull PH model: If the hazards are proportional, the lines will be parallel, i.e., have the same slope (\\(\\gamma\\)). Here, the lines appear parallel.\nNote also that for Weibull model, a constant vertical shift (multiplying the hazard) is mathematically indistinguishable from a constant horizontal shift (multiplying the survival time). That is, the Weibull distribution satisfies both the PH and AFT assumptions simultaneously. Thus, we can also conclude that the *accelerated failure time assumption** also holds.\nFrom the log-log plot, we can actually deduct the following things:\n\n1. Parallel straight lines: Weibull and PH (and AFT) assumptions hold\n2. Parallel straight lines with slope 1: Exponential model is a good fit\n3. Parallel but not straight lines: PH but not Weibull (could use the Cox model)\n4. Not parallel and not straight: Weibull is not a good fit, PH violated\n5. Not parallel but straight: Weibull is a good fit, but PH and AFT violated, indicates different \\(\\gamma\\) in the two groups\n\n3. Graphical check for accelerated failure time assumption\nThe accelerated failure time (AFT) model assumes that a covariate (e.g., treatment) multiplies survival time by a constant factor.\nWe can check whether there is a constant horizontal shift between survival curves plotted against log of time:\n\n\nShow R code\n# make sure you have installed the broom package\n# install.packages(\"broom\")\n# load the broom package\nlibrary(broom) # for tidy() function\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(flexsurv) # reloaded to be able to run this block independently\n\n# Plotting survival curves on log time scale to see the AFT model constant shift\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\n#summary(km)\n#names(km)\n\n# 2. Create a data frame for ggplot\nplot_data &lt;- broom::tidy(km)\n#plot_data\n# survival probability is now named estimate\n#names(plot_data)\n\n# 3. fit Exponential and Weibull\nexp_PH &lt;- flexsurvreg( Surv(time, cens) ~ treat, data = leukdata, dist = \"exp\")\nwei_AFT &lt;- flexsurvreg( Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\n\n# 4. Generate predicted survival probabilities for a range of times\n# This creates a smooth curve for the log-time axis\ntime_seq &lt;- seq(0.1, 35, length.out = 100)\npred_exp &lt;- summary(exp_PH, t = time_seq, tidy = TRUE)\npred_wei &lt;- summary(wei_AFT, t = time_seq, tidy = TRUE)\n\n# 5. Plot everything with a Log-transformed X-axis\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n   # Exponential fitted curves\n  geom_line(data = pred_exp, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  # Weibull fitted curves\n  geom_line(data = pred_wei, aes(x = time, y = est, color = treat), linetype = \"dotted\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Parametric fits on log time scale\",\n       subtitle = \"Dashed = Exponential, Dotted = Weibull\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nThe shift between survival curves does seem constant both for the exponential and weibull AFT model.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#model-selection",
    "href": "Parametric.html#model-selection",
    "title": "3 Parametric survival models",
    "section": "13 Model selection",
    "text": "13 Model selection\nExponential vs Weibull\n1. Likelihood Ratio Test (LRT)\nBecause the Exponential distribution is a special case of the Weibull distribution (where the shape parameter \\(\\gamma = 1\\)), we can use a formal Likelihood Ratio Test (LRT) to determine which model provides a better fit for the data.\nTo test whether a Weibull \\((\\lambda, \\gamma)\\) distribution gives a significantly better fit than an Exponential \\((\\lambda\\)) distribution, we test the following null hypothesis:\n\\[H_0: \\gamma = 1 \\quad \\text{(Exponential model)}\\] \\[H_1: \\gamma \\neq 1 \\quad \\text{(Weibull model)}\\] Under the null hypothesis \\(H_0\\), the likelihood ratio test statistic \\(W\\) follows a chi-squared distribution with 1 degree of freedom (\\(\\chi^2_1\\)):\n\\[W(\\hat{\\lambda}, 1) = 2 \\left[ \\log L(\\hat{\\lambda}, \\hat{\\gamma}) - \\log L(\\hat{\\lambda_0}, 1) \\right] \\sim \\chi_1^2,\\] where \\(\\hat{\\lambda}\\) and \\(\\hat{\\gamma}\\) are the maximum likelihood estimates (MLEs) for a Weibull model with unconstrained \\(\\hat{\\gamma}\\), and \\(\\hat{\\lambda}_0\\) is the MLE for a Weibull model with the constraint \\(\\gamma = 1\\) (i.e., MLE for the exponential model).\nThe Exponential and Weibull PH and AFT model outputs we ran before all provide the necessary log-likelihood values for carrying out the LRT. We can thus carry out the LRT for example in the following way:\n\n\nShow R code\n# Calculate manually\n\n# Using Survreg output above that provides the log-likehood values\n# The necessary values can be extracted in the following way:\n# the first value of loglik element gives the log-likelihood for the model with only an intercept\n# the second value gives the log-likelihood for the model with the covariates\nlogL_exp &lt;- exp_AFT$loglik[2]\nlogL_exp\n\n\n[1] -108.524\n\n\nShow R code\nlogL_wei &lt;- wei_AFT_surv$loglik[2]\nlogL_wei\n\n\n[1] -106.5795\n\n\nShow R code\n# Calculate the test statistic\nLRT_statistic &lt;- 2 * (logL_wei - logL_exp)\nLRT_statistic\n\n\n[1] 3.889116\n\n\nShow R code\n# Calculate the P-value\n# We use the Chi-squared distribution with 1 degree of freedom\np_value &lt;- pchisq(LRT_statistic, df = 1, lower.tail = FALSE)\np_value\n\n\n[1] 0.0486\n\n\nA significant p-value (\\(p &lt; 0.05\\)) indicates that allowing the shape parameter \\(\\gamma\\) to vary (Weibull model) significantly improves the model’s log-likelihood compared to fixing it at 1 (Exponential model). We would thus reject the null hypothesis at 5% significance level, and conclude that a general Weibull distribution is better than an exponential distribution in this case.\nWe could also use the anova() function from the stats package to compare two nested survreg objects:\n\n\nShow R code\n# Likelihood Ratio Test\nanova(exp_AFT, wei_AFT_surv)\n\n\n  Terms Resid. Df    -2*LL Test Df Deviance Pr(&gt;Chi)\n1 treat        40 217.0481      NA       NA       NA\n2 treat        39 213.1590    =  1 3.889116   0.0486\n\n\nWe could also use the lrtest() function from the lmtest() package to compare two nested flexsurvreg objects:\n\n\nShow R code\n# Make sure you have installed the lmtest package\n# install.packages(\"lmtest\")\n# Load the lmtest package\nlibrary(lmtest)\n\n# Likelihood Ratio Test\n\n# It is recommended to list the most complex model first\nlrtest(exp_PH, wei_PH)\n\n\nLikelihood ratio test\n\nModel 1: Surv(time, cens) ~ treat\nModel 2: Surv(time, cens) ~ treat\n  #Df  LogLik Df  Chisq Pr(&gt;Chisq)  \n1   2 -108.52                       \n2   3 -106.58  1 3.8891     0.0486 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nAlso note that while the Wald Test (the p-value for Log(scale) in survreg output is a quick shortcut, as demonstrated above, the LRT is generally considered more robust for model selection.\n2. Likelihood Ratio Test (LRT)\nWhile the Likelihood Ratio Test (LRT) is useful for comparing nested models (like Exponential vs. Weibull), the Akaike Information Criterion (AIC) provides a more general framework for model selection. AIC allows us to compare any set of models, even those that are not nested, by penalizing for the number of parameters used.\nWhile LRT asks: “Is the improvement in log-Likelihood large enough to be ‘real’?”, AIC asks: “Is the improvement in log-Likelihood large enough to justify the extra parameter we added?”\nThe AIC is defined as:\n\\[AIC = -2\\log(L) + 2p,\\]\nwhere \\(\\log(L)\\) is the log-likelihood of the model and \\(p\\) is the number of estimated parameters in the model.\nThe goal of AIC is to find the model that explains the most variation using the fewest possible parameters (the principle of parsimony). The \\(+2p\\) term penalises the model for adding extra parameters. This prevents overfitting. When comparing models, the one with the lower AIC value is considered the better fit.\nWhile the flexsurvreg outputs for the Exponential and Weibull PH and AFT models automatically print out AIC, survreg output only prints out the log-likelihood values. However, we can extract the log-likelihood values from the survreg output and manually calculate the AICs to compare the two models:\n\n\nShow R code\n# Calculate manually\n\n# Using Survreg output above that provides the log-likehood values\n# The necessary values can be extracted in the following way:\n# the first value of loglik element gives the log-likelihood for the model with only an intercept\n# the second value gives the log-likelihood for the model with the covariates\nlogL_exp &lt;- exp_AFT$loglik[2]\nlogL_exp\n\n\n[1] -108.524\n\n\nShow R code\nlogL_wei &lt;- wei_AFT_surv$loglik[2]\nlogL_wei\n\n\n[1] -106.5795\n\n\nShow R code\n# Calculate the AIC\nAIC_exp &lt;- -2 * (logL_exp) + 2*2\nAIC_exp\n\n\n[1] 221.0481\n\n\nShow R code\nAIC_wei &lt;- -2 * (logL_wei) + 2*3\nAIC_wei\n\n\n[1] 219.159\n\n\nShow R code\nDelta_AIC &lt;- AIC_exp - AIC_wei\nDelta_AIC\n\n\n[1] 1.889116\n\n\nWe can also use the AIC() function from the stats package:\n\n\nShow R code\n# Comparing AIC\nAIC(exp_PH, wei_PH)\n\n\n       df      AIC\nexp_PH  2 221.0481\nwei_PH  3 219.1590\n\n\nShow R code\naic_table &lt;- data.frame(\n  Model = c(\"Exponential\", \"Weibull\"),\n  AIC = c(AIC(exp_PH), AIC(wei_PH))\n)\n\n# Sort by AIC (lowest is best)\naic_table &lt;- aic_table[order(aic_table$AIC), ]\nprint(aic_table)\n\n\n        Model      AIC\n2     Weibull 219.1590\n1 Exponential 221.0481\n\n\nThe Weibull model has a lower AIC (\\(219.16 &lt; 221.05\\)), indicating that the improvement in log-likelihood gained by adding the shape parameter (\\(\\gamma\\)) is large enough to justify the extra complexity. Thus, the Weibull model is the preferred fit for these data.\nA ‘rule of thumb’ in biostatistics is that an AIC difference (\\(\\Delta AIC\\)) of more than 2 is generally considered a meaningful improvement. In this data example, \\(\\Delta AIC = 1.89\\), which is a borderline but justifiable reason to choose the Weibull model.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#log-logistic-distribution",
    "href": "Parametric.html#log-logistic-distribution",
    "title": "3 Parametric survival models",
    "section": "14 Log-logistic distribution",
    "text": "14 Log-logistic distribution\nWhile the Weibull distribution is versatile, it is limited by the fact that its hazard function is monotonic — it must always increase, always decrease, or remain constant.\nIn many clinical scenarios, the risk of an event increases initially (e.g., following a major surgery such as transplantation) and then decreases as the patient recovers. For these situations, the Log-logistic distribution offers the necessary flexibility.\n\nHazard function:\n\n\\[h(t) = \\frac {\\lambda \\gamma t^{\\gamma-1}} {1+\\lambda t^\\gamma}\\]\n\nSurvival function:\n\n\\[S(t) = \\frac {1} {1+\\lambda t^\\gamma}\\]\n\nProbability density function:\n\n\\[f(t) = \\frac {\\lambda \\gamma t^{\\gamma-1}} {(1+\\lambda t^\\gamma)^2}\\]\nIf \\(\\gamma \\le 1\\) hazard decreases over time and if \\(\\gamma &gt; 1\\) hazard first increases and then decreases over time:\n\n\nShow R code\n# Log-logistic hazard, survival and probability density functions\n# assumes scale parameter lambda is 1\n\ndata_loglogistic &lt;- data.frame(expand.grid(Time = seq(0.01, 3, 0.01),\n                                           Gamma = c(0.5, 1, 2, 5))) %&gt;%\n  mutate(\n    # Log-logistic Hazard\n    Hazard = (Gamma*Time^(Gamma - 1)) / (1 + Time^Gamma),\n\n    # Log-logistic Survival\n    Survival = 1 / (1 + Time^Gamma),\n    \n    # Log-logistic PDF\n    PDF = (Gamma*Time^(Gamma - 1)) / (1 + Time^Gamma)^2,\n    \n    c = recode_factor(Gamma, `0.5` = \"gamma == 0.5\", \n                      `1`   = \"gamma == 1.0\", \n                      `2`   = \"gamma == 2.0\", \n                      `5`   = \"gamma == 5.0\")\n  )\n\n# Plotting the hazard (the most interesting part of log-logistic)\nggplot(data_loglogistic, aes(x = Time, y = Hazard, color = c)) +\n  geom_line(aes(linetype = c), linewidth = 0.8) +\n  labs(title = \"Log-logistic Hazard Functions\",\n       subtitle = \"Notice the unimodal (up-then-down) shape when gamma &gt; 1\",\n       color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# Plotting the survival\nggplot(data_loglogistic, aes(x = Time, y = Survival, color = c)) +\n  geom_line(aes(linetype = c), linewidth = 0.8) +\n  labs(title = \"Log-logistic Survival Functions\",\n       color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# Plotting probability density functions\nggplot(data_loglogistic, aes(x = Time, y = PDF, color = c)) +\n  geom_line(aes(linetype = c), linewidth = 0.8) +\n  labs(title = \"Log-logistic Probability Density Functions\",\n       color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-fitting-a-log-logistic-model",
    "href": "Parametric.html#data-example-fitting-a-log-logistic-model",
    "title": "3 Parametric survival models",
    "section": "15 Data example: Fitting a log-logistic model",
    "text": "15 Data example: Fitting a log-logistic model\n1. Log-logistic accelerated failure time (AFT) model\nThe log-logistic distribution accommodates an AFT model but not a PH model.\nThis can be seen by deriving the hazard ratio for this model:\n\\[ HR = \\frac {\\lambda_1} {1+\\lambda_1 t^\\gamma} \\frac {1+\\lambda_0 t^\\gamma} {\\lambda_0}, \\] as the time variable \\(t\\) does not cancel out.\nAs the hazard function in log-logistic model has a complex (often unimodal) shape, the ratio of hazards between two groups typically changes as time progresses. The log-logistic model can be used when we suspect non-proportional hazards (e.g., when the treatment effect is very strong early on but fades later).\nFitting log-logistic AFT model\nWe can fit the log-logistic AFT model using flexsurvreg function from the flexsurv package, specifying dist=\"llogis\":\n\n\nShow R code\n# LOG-LOGISTIC AFT MODEL\n\n# Fitting log-logistic AFT model using flexsurvreg\nllog_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"llogis\")\n# gives estimate for shape parameter and scale parameter\n# gives alpha, TR and its 95% confidence interval\nllog_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"llogis\")\n\nEstimates: \n           data mean  est    L95%   U95%   se     exp(est)  L95%   U95% \nshape         NA      1.830  1.363  2.456  0.275     NA        NA     NA\nscale         NA      6.637  4.418  9.970  1.378     NA        NA     NA\ntreat6-MP  0.500      1.265  0.627  1.904  0.326  3.545     1.872  6.711\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -107.6614, df = 3\nAIC = 221.3228\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\nsummary(llog_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\ntreat=control \n   time        est        lcl        ucl\n1     1 0.05559348 0.01710429 0.12181596\n2     2 0.09168701 0.03945990 0.16125169\n3     3 0.11560823 0.05652333 0.19145226\n4     4 0.12973570 0.07097029 0.21131321\n5     5 0.13658720 0.08074732 0.21878217\n6     6 0.13843226 0.08368432 0.22160157\n7     7 0.13704689 0.08540003 0.21798510\n8     8 0.13370164 0.08461501 0.21380256\n9     9 0.12925486 0.08340716 0.20131671\n10   10 0.12426427 0.08184300 0.18926043\n11   11 0.11908127 0.07835245 0.17945021\n12   12 0.11392066 0.07493404 0.17072982\n13   13 0.10890879 0.07181310 0.16293036\n14   15 0.09957569 0.06610480 0.14657526\n15   16 0.09530154 0.06384999 0.13978512\n16   17 0.09129243 0.06154118 0.13272110\n17   19 0.08403094 0.05727156 0.12074770\n18   20 0.08075081 0.05517645 0.11544348\n19   22 0.07481425 0.05139265 0.10674939\n20   23 0.07212723 0.04965875 0.10260388\n21   25 0.06724484 0.04651627 0.09512522\n22   32 0.05413207 0.03808962 0.07525846\n23   34 0.05123425 0.03610421 0.07097718\n24   35 0.04989393 0.03518540 0.06907393\n\ntreat=6-MP \n   time         est         lcl        ucl\n1     1 0.005643366 0.001014487 0.02009116\n2     2 0.009951271 0.002602659 0.02718494\n3     3 0.013765985 0.004292289 0.03366425\n4     4 0.017207751 0.005932107 0.03999970\n5     5 0.020321906 0.007601904 0.04442905\n6     6 0.023131853 0.009052069 0.04935033\n7     7 0.025653632 0.010461474 0.05336424\n8     8 0.027901194 0.011889943 0.05696108\n9     9 0.029888446 0.013217420 0.06035663\n10   10 0.031629968 0.014500510 0.06441320\n11   11 0.033141120 0.015579707 0.06630824\n12   12 0.034437872 0.016624292 0.06800508\n13   13 0.035536527 0.017078561 0.06992289\n14   15 0.037204614 0.018225786 0.07089317\n15   16 0.037805703 0.018697303 0.07143751\n16   17 0.038271586 0.018993311 0.07105677\n17   19 0.038853148 0.020440149 0.07031863\n18   20 0.038994214 0.020667774 0.06956018\n19   22 0.039033113 0.021180538 0.06952122\n20   23 0.038950545 0.021432724 0.06877540\n21   25 0.038623595 0.022041138 0.06699623\n22   32 0.036426708 0.021455874 0.06082470\n23   34 0.035641995 0.021211027 0.05862058\n24   35 0.035238294 0.021034054 0.05791538\n\n\nWe can also fit the log-logistic AFT model using survreg function from the survival package, specifying dist=\"loglogistic\":\n\n\nShow R code\n# LOG-LOGISTIC AFT MODEL\n\n# fitting log-logistic AFT model using survreg\nllog_AFT_surv &lt;- survreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"loglogistic\")\nsummary(llog_AFT_surv)\n\n\n\nCall:\nsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"loglogistic\")\n             Value Std. Error     z       p\n(Intercept)  1.893      0.208  9.12 &lt; 2e-16\ntreat6-MP    1.265      0.326  3.89   1e-04\nLog(scale)  -0.604      0.150 -4.02 5.7e-05\n\nScale= 0.547 \n\nLog logistic distribution\nLoglik(model)= -107.7   Loglik(intercept only)= -115.4\n    Chisq= 15.38 on 1 degrees of freedom, p= 8.8e-05 \nNumber of Newton-Raphson Iterations: 4 \nn= 42 \n\n\nShow R code\n# Function predict can compute median survival time \n# Median survival time for placebo and treatment group\nmedian_times &lt;- predict(llog_AFT_surv, newdata = data.frame(treat = c(\"control\", \"6-MP\")), \n                        type = \"quantile\", p = 0.5)\nmedian_times\n\n\n        1         2 \n 6.637203 23.527124 \n\n\nThe shape parameter (\\(\\hat{\\gamma} = 1.83\\)) is reported on the natural scale in both outputs. As \\(\\gamma &gt; 1\\), the hazard is unimodal - it rises to a peak and then declines.\nThe log-logistic model output from flexsurvreg for the scale parameter (\\(\\hat{\\gamma} = 6.637\\)) gives the median survival time for the baseline group (placebo), i.e., 50% of the people in placebo group are expected to have experienced relapse by 6.6 weeks.\nConsistent with the log-linear structure of the AFT model, the covariate effect \\(\\hat{\\alpha_1} = 1.265\\) is reported on the log-time scale. The flexsurvreg output also automatically provides the time ratio (TR)\n\\(TR = \\exp(\\hat{\\alpha_1}) = \\exp(1.265) = 3.55\\) and its 95% confidence interval (1.87, 7.71).\nLog-logistic proportional odds (PO) model\nAs demonstrated above, the log-logistic model does not generally satisfy the proportional hazards assumption because the hazard ratio varies over time. However, it satisfies the proportional odds (PO) assumption and is thus a proportional odds model.\nA PO model is a model in which the survival odds is assumed to remain constant over time. In survival analysis, we can define odds similarly to how we do in logistic regression, as odds of an individual surviving beyond some time \\(t\\):\n\nSurvival Odds: \\(\\frac{S(t)}{1−S(t)}\\)\nFailure Odds: \\(\\frac{1-S(t)}{S(t)}\\)\n\nFor the log-logistic distribution, where \\(S(t) = \\frac {1} {1+\\lambda t^\\gamma}\\) and \\(1-S(t) = \\frac {\\lambda t^\\gamma} {1+\\lambda t^\\gamma}\\), the survival odds is defined as:\n\\[\\text{Odds}(t) =  \\frac {S(t)} {1−S(t)} = \\frac {1} {\\lambda t^\\gamma} \\] When we compare two groups (like treatment group 1 with \\(\\lambda_1\\) and placebo group 0 with \\(\\lambda_0\\)), the ratio of their survival odds looks like this:\n\\[\\text{SOR} = \\frac{\\lambda_0 t^\\gamma} {\\lambda_1 t^\\gamma} = \\frac{\\lambda_0} {\\lambda_1} = \\exp(-\\beta_1),\\] which is a constant as time \\(t\\) cancels out. This is why the proportional Odds assumption is satisfied for the log-logistic model.\nWe can estimate the SOR for our data example from the above output using the relationships \\(\\exp(-\\beta_1) = \\frac {\\alpha_1} {\\sigma} = \\alpha_1 \\gamma\\), where the latter equation can be used for the flexsurvreg output and the either equation for the survreg output. We can also obtain SOR by writing out the SOR formula and applying it to the extended model output on survival estimates:\n\n\nShow R code\n# calculating SOR\n\n# fitting log-logistic AFT model using flexsurvreg\n# llog_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"llogis\")\n\n# fitting log-logistic AFT model using survreg\n# llog_AFT_surv &lt;- survreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"loglogistic\")\n\n# Extract the estimated coefficients\n# 'res' contains the estimates in the 'est' column\nestimates1 &lt;- llog_AFT$res\n#estimates1\n\nestimates2 &lt;- coef(llog_AFT_surv)\n#estimates2\n\n# Get the natural shape (gamma) and the AFT alpha from flexsurvreg output\ngamma &lt;- estimates1[\"shape\", \"est\"] # flexsurvreg reports shape on natural scale\n#gamma\nalpha_aft &lt;- estimates1[\"treat6-MP\", \"est\"]\n#alpha_aft\n\n# Calculate the SOR\nSOR1 &lt;- exp(gamma * alpha_aft)\nSOR1\n\n\n[1] 10.12849\n\n\nShow R code\nSOR2 &lt;- exp(llog_AFT_surv$coef[2] / llog_AFT_surv$scale)\nSOR2\n\n\ntreat6-MP \n 10.12849 \n\n\nShow R code\n# This will calculate the survival probabilities for each group at different times\nsurv &lt;- summary(llog_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"survival\")\n\n# this will calculate SOR using survival probability at time 1\n# any time point can be used as SOR is a constant throughout the follow-up period\nSOR3 = ( surv[[2]]$est[1] / (1-surv[[2]]$est[1]) ) / ( surv[[1]]$est[1] / (1-surv[[1]]$est[1]) )\nSOR3\n\n\n[1] 10.12849\n\n\nThus, assuming that log-logistic model fits the data and the proportional odds assumption is met, it appears that at any given time point, the odds of still being in remission for the treatment group are 10 times higher than the odds for the control (placebo) group.\n\n15.1 Model validation\nAgain, before interpreting log-logistic model output, we must ensure the log-logistic distribution fits the data and that the accelerated failure time (AFT) assumption. and the proportional odds (PO) assumption are met.\nWe can carry out the same checks as before for Exponential and Weibull models:\n1. Visual comparison with non-parametric estimates\nFirst, we plot the fitted parametric survival curve \\(\\hat{S}(t)\\) directly over the Kaplan-Meier (KM) curve.\nPreviously, we created custom plots based on the survival functions for the exponential and Weibull models. However, we can also use the flexsurvreg survival probability predictions in the following way:\n\n\nShow R code\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\nkm_df &lt;- tidy(km)\n# survival probability is now named estimate\n#names(km_df)\n\n# 2. Get the 'predicted' data (Log-Logistic)\n# We generate predictions over a smooth sequence of time\ntime_seq &lt;- seq(0, max(leukdata$time), length.out = 100)\npred_llogis &lt;- summary(llog_AFT, t = time_seq, tidy = TRUE)\n#pred_llogis\n\n# 3. Create the Overlay Plot\nggplot() +\n  # Observed: Kaplan-Meier steps\n  geom_step(data = km_df, aes(x = time, y = estimate, color = strata), \n            linewidth = 0.8, alpha = 0.5) +\n  # Predicted: Log-Logistic smooth lines\n  geom_line(data = pred_llogis, aes(x = time, y = est, color = treat), \n            linewidth = 1.2) +\n  labs(title = \"Log-Logistic Model Fit: Predicted vs. Observed\",\n       subtitle = \"Smooth lines = Log-Logistic Model; Stepped lines = Kaplan-Meier\",\n       x = \"Time\", y = \"Survival Probability\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThe log-logistic distribution appears to provide a reasonable good fit to the data.\nWe could also plot the hazard functions:\n\n\nShow R code\nplot(llog_AFT, type = \"hazard\", main = \"Log-logistic hazard fit\")\n\n\n\n\n\n\n\n\n\n2. Linear transformation (graphical checks)\nSecond, we make comparisons with transformation of survival function, or in case the log-logistic model survival odds, into a linear form, and check whether the transformed data falls on a straight line.\nFor log-logistic model, the survival odds simplifies to\n\\[\\text{Odds}(t) =  \\frac {S(t)} {1−S(t)} = \\frac {1} {\\lambda t^\\gamma} = \\lambda t^{-\\gamma} \\] and thus log(survival odds) \\(= \\log \\lambda - \\gamma \\log t\\). Therefore, the log survival odds, \\(\\log{\\frac {S(t)} {1−S(t)}}\\), is a linear function of log of time, with intercept \\(\\log{\\lambda}\\) and slope \\(-\\gamma\\).\nWe can thus check whether plotting the log survival odds against the log of time gives a straight line of slope \\(-\\gamma\\):\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(survival) # reloaded to be able to run this block independently\n\n# Plotting survival odds against log of time\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\nkm_df &lt;- tidy(km)\n# survival probability is now named estimate\n#names(km_df)\n\n# 2. Extract data and calculate log-odds\n# Log-odds = log( S(t) / (1 - S(t)) )\nkm_data &lt;- km_df %&gt;%\n  mutate(log_time = log(time),\n      log_odds = log(estimate / (1-estimate))) %&gt;%\n  filter(is.finite(log_odds)) # Remove infinity values at S(t)=1 or 0\n\n# 3. Create the plot\nggplot(km_data, aes(x = log_time, y = log_odds, color = factor(strata))) +\n  geom_point() +\n  geom_line() +\n  geom_smooth(method = \"lm\", se = FALSE, linetype = \"dashed\") +\n  labs(title = \"Log-Logistic Diagnostic: Log-Odds Plot\",\n       subtitle = \"Linearity = Log-logistic distribution; Parallelism = Proportional Odds\",\n       x = \"log(Time)\", \n       y = \"log(S(t) / (1-S(t))\",\n       color = \"Group\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nBoth plots look reasonably straight suggesting that the log-logistic assumption is reasonable.\nWe can also use this plot to assess proportional odds (PO) assumption. If the odds are proportional, the two lines should be parallel as they appear to be.\n3. Graphical check for accelerated failure time assumption\nWe can evaluate whether the accelerated failure time (AFT) assumption for the log-logistic AFT model holds by checking whether there is a constant horizontal shift between survival curves plotted against log of time:\n\n\nShow R code\nlibrary(broom) # reloaded to be able to run this block independently\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(flexsurv) # reloaded to be able to run this block independently\n\n# Plotting survival curves on log time scale to see the AFT model constant shift\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\n#summary(km)\n#names(km)\n\n# 2. Create a data frame for ggplot\nplot_data &lt;-broom::tidy(km)\n#plot_data\n# survival probability is now named estimate\n#names(plot_data)\n\n# 3. Fit log-logistic model\nllog_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"llogis\")\n#exp_PH &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"exp\")\n#wei_AFT &lt;- flexsurvreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\n\n# 4. Generate predicted survival probabilities for a range of times\n# This creates a smooth curve for the log-time axis\ntime_seq &lt;- seq(0.1, 35, length.out = 100)\npred_llogis &lt;- summary(llog_AFT, t = time_seq, tidy = TRUE)\n#pred_exp &lt;- summary(exp_PH, t = time_seq, tidy = TRUE)\n#pred_wei &lt;- summary(wei_AFT, t = time_seq, tidy = TRUE)\n\n# 5. Plot everything with a Log-transformed X-axis\n\n# for log-logistic model only\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n  # Log-logistic fitted curves\n  geom_line(data = pred_llogis, aes(x = time, y = est, color = treat), linetype = \"dotdash\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Log-logistic AFT fit on log time scale\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# also including exponential and Weibull models\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n  # Weibull fitted curves\n  geom_line(data = pred_wei, aes(x = time, y = est, color = treat), linetype = \"dotted\", linewidth = 1) +\n  # Exponential fitted curves\n  geom_line(data = pred_exp, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  # Log-logistic fitted curves\n  geom_line(data = pred_llogis, aes(x = time, y = est, color = treat), linetype = \"dotdash\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Parametric fits on log time scale\",\n       subtitle = \"Dotted = Weibull, Dashed = Exponential, Dotdash = Log-logistic\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nThe shift between survival curves does seem constant for log-logistic model.\n\n\n15.2 Model selection\nWe can use AIC to compare the goodness-of-fit of exponential, Weibull and log-logistic models:\n\n\nShow R code\naic_table &lt;- data.frame(\n  Model = c(\"Exponential\", \"Weibull\", \"Log-Logistic\"),\n  AIC = c(AIC(exp_PH), AIC(wei_AFT), AIC(llog_AFT))\n)\n# Sort by AIC (lowest is best)\naic_table &lt;- aic_table[order(aic_table$AIC), ]\nprint(aic_table)\n\n\n         Model      AIC\n2      Weibull 219.1590\n1  Exponential 221.0481\n3 Log-Logistic 221.3228\n\n\nBased on AIC, Weibull model and even exponential model appear to fit the data better than the log-logistic model although the differences in the AIC values between models are very small.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#log-normal-distribution",
    "href": "Parametric.html#log-normal-distribution",
    "title": "3 Parametric survival models",
    "section": "16 Log-normal distribution",
    "text": "16 Log-normal distribution\nThe log-normal distribution is often used as an alternative to the log-logistic distribution because their hazard shapes are very similar. Both are flexible models within the accelerated failure time (AFT) framework.\nA random variable \\(T\\) follows a log-normal distribution with parameters \\(\\mu\\) (location) and \\(\\sigma\\) (scale) if its natural logarithm, \\(\\log(T)\\), follows a normal distribution with mean \\(\\mu\\) and variance \\(\\sigma^2\\):\n\\[\\log(T) \\sim N(\\mu, \\sigma^2)\\] The probability density function of \\(T\\) is derived from the standard normal density \\(\\phi(z)\\):\n\\[f(t) = \\frac{1}{t\\sigma} \\phi\\left( \\frac{\\log(t) - \\mu}{\\sigma} \\right) = \\frac{1}{t\\sigma\\sqrt{2\\pi}} \\exp\\left[ -\\frac{(\\log(t) - \\mu)^2}{2\\sigma^2} \\right]\\] Unlike the exponential, Weibull and log-logistic models, the survival and hazard functions for the log-normal distribution cannot be expressed in simple algebraic forms. Instead, they are expressed in terms of the standard normal cumulative distribution function, \\(\\Phi(z)\\):\n\\[S(t) = 1- \\Phi\\left( \\frac{\\log(t) - \\mu}{\\sigma} \\right) = \\int_t^\\infty \\frac{1}{x\\sigma\\sqrt{2\\pi}} \\exp\\left[ -\\frac{(\\log(x) - \\mu)^2}{2\\sigma^2} \\right]dx\\]\n\\[h(t) = \\frac{\\frac{1}{t\\sigma} \\phi\\left( \\frac{\\log(t) - \\mu}{\\sigma} \\right)} {1- \\Phi\\left( \\frac{\\log(t) - \\mu}{\\sigma} \\right)} = \\frac{\\frac{1}{t\\sigma\\sqrt{2\\pi}} \\exp\\left[ -\\frac{(\\log(t) - \\mu)^2}{2\\sigma^2} \\right]}{\\int_t^\\infty \\frac{1}{x\\sigma\\sqrt{2\\pi}} \\exp\\left[ -\\frac{(\\log(x) - \\mu)^2}{2\\sigma^2} \\right]dx}\\] Thus, hazard and survival functions can only be expressed in terms of integrals. Therefore, there is no closed-form solution for them. R software uses numerical approximation to calculate these values.\nLike the log-logistic hazard where \\(\\gamma &gt; 1\\), the log-normal hazard is unimodal - it increases to a peak and then decreases towards zero:\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this code block independently\n\n# Log-normal hazard, survival and probability density functions\n\n# assumes mu = 0 (log1), meaning mean is t = 1\n\n# Defining parameters: mu (meanlog) and sigma (sdlog)\n# We will vary sigma to show how it affects the \"peak\" of the hazard\ndata_lognormal &lt;- data.frame(expand.grid(Time = seq(0.01, 3, 0.01),\n                                         Sigma = c(0.2, 0.5, 0.8, 1.2))) %&gt;%\n  mutate(\n    # PDF: f(t)\n    PDF = dlnorm(Time, meanlog = 0, sdlog = Sigma),\n    \n    # Survival: S(t) = 1 - CDF\n    Survival = plnorm(Time, meanlog = 0, sdlog = Sigma, lower.tail = FALSE),\n    \n    # Hazard: h(t) = f(t) / S(t)\n    Hazard = PDF / Survival,\n    \n    # Formatting labels for the plot legend\n    s_label = recode_factor(Sigma, \n                            `0.2` = \"sigma == 0.2\", \n                            `0.5` = \"sigma == 0.5\", \n                            `0.8` = \"sigma == 0.8\", \n                            `1.2` = \"sigma == 1.2\")\n  )\n\n# 1. Plotting the Hazard Functions\nggplot(data_lognormal, aes(x = Time, y = Hazard, color = s_label)) +\n  geom_line(aes(linetype = s_label), linewidth = 0.8) +\n  labs(title = \"Log-Normal Hazard Functions\",\n       subtitle = \"The 'unimodal' shape: risk increases then eventually declines to zero\",\n       x = \"Time (t)\", y = \"Hazard h(t)\", color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# 2. Plotting the Survival Functions\nggplot(data_lognormal, aes(x = Time, y = Survival, color = s_label)) +\n  geom_line(aes(linetype = s_label), linewidth = 0.8) +\n  labs(title = \"Log-Normal Survival Functions\",\n       x = \"Time (t)\", y = \"Survival S(t)\", color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# 3. Plotting the Probability Density Functions (PDF)\nggplot(data_lognormal, aes(x = Time, y = PDF, color = s_label)) +\n  geom_line(aes(linetype = s_label), linewidth = 0.8) +\n  labs(title = \"Log-Normal Probability Density Functions\",\n       x = \"Time (t)\", y = \"Density f(t)\", color = \"\", linetype = \"\") +\n  scale_colour_discrete(labels = scales::parse_format()) +\n  scale_linetype_discrete(labels = scales::parse_format()) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nHowever, if the peak occurs very early (i.e., \\(\\sigma\\) is large), the hazard may appear to be strictly decreasing over the actual range of the observed data:\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this code block independently\n\n# Log-normal hazard for set of mu and sigma parameters, including large ones\n\nparams &lt;- data.frame(\n  mu =    c(0.1, 1, 2, 7),\n  sigma = c(0.5, 0.5, 3, 5)\n)\n\n# Generate data with a Logarithmic sequence of Time to capture the peak\ndata_plot &lt;- params %&gt;%\n  group_by(mu, sigma) %&gt;%\n  do(data.frame(Time = exp(seq(-5, 10, length.out = 1000)))) %&gt;% \n  mutate(\n    # PDF\n    PDF = dlnorm(Time, meanlog = mu, sdlog = sigma),\n    # Survival\n    Survival = plnorm(Time, meanlog = mu, sdlog = sigma, lower.tail = FALSE),\n    # Hazard: h(t) = f(t)/S(t)\n    Hazard = PDF / Survival,\n    Label = factor(paste0(\"mu=\", mu, \", sigma=\", sigma))\n  )\n\n# Plotting hazard functions\nggplot(data_plot, aes(x = Time, y = Hazard, color = Label)) +\n  geom_line(linewidth = 1) +\n  xlim(0, 10) + \n  labs(title = \"Log-normal Hazard Functions\",\n       x = \"Time (t)\", y = \"Hazard Rate h(t)\") +\n  theme_bw()",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-fitting-a-log-normal-model",
    "href": "Parametric.html#data-example-fitting-a-log-normal-model",
    "title": "3 Parametric survival models",
    "section": "17 Data example: Fitting a log-normal model",
    "text": "17 Data example: Fitting a log-normal model\nThe log-normal distribution accommodates an AFT model but not a PH model or a PO model. The covariates act as a multiplier on time, which matches the AFT assumption. However, When calculating the hazard ratio for a log-normal model, the \\(t\\) terms in the complex numerator and denominator do not cancel out. Consequently, the HR changes over time, violating PH assumption. Similarly, when calculating the survival odds ratio, the \\(t\\) terms also do not cancel out, violating the PO assumption.\nFitting log-normal AFT model\nWe can fit the log-normal AFT model using flexsurvreg function from the flexsurv package, specifying dist=\"lnorm\":\n\n\nShow R code\n# LOG-NORMAL AFT MODEL\n\n# Fitting Log-normal AFT model using flexsurvreg\nln_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"lnorm\")\nln_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"lnorm\")\n\nEstimates: \n           data mean  est    L95%   U95%   se     exp(est)  L95%   U95% \nmeanlog       NA      1.825  1.430  2.220  0.202     NA        NA     NA\nsdlog         NA      0.924  0.713  1.197  0.122     NA        NA     NA\ntreat6-MP  0.500      1.347  0.727  1.967  0.316  3.845     2.068  7.150\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.7046, df = 3\nAIC = 219.4092\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\nsummary(ln_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\ntreat=control \n   time        est        lcl       ucl\n1     1 0.06286960 0.01296286 0.1505392\n2     2 0.11455264 0.04806420 0.1891746\n3     3 0.13473593 0.07317743 0.2059116\n4     4 0.14127999 0.08538698 0.2135977\n5     5 0.14189127 0.08839291 0.2193438\n6     6 0.13981762 0.09000419 0.2147426\n7     7 0.13652813 0.08859080 0.2115024\n8     8 0.13272906 0.08571376 0.2058728\n9     9 0.12877421 0.08296294 0.2012260\n10   10 0.12484425 0.07989817 0.1955034\n11   11 0.12103074 0.07666553 0.1896869\n12   12 0.11737781 0.07443125 0.1855314\n13   13 0.11390380 0.07217273 0.1813110\n14   15 0.10750161 0.06719757 0.1732800\n15   16 0.10456241 0.06556452 0.1690566\n16   17 0.10178583 0.06390177 0.1651905\n17   19 0.09667960 0.06086799 0.1575549\n18   20 0.09432972 0.05917467 0.1541143\n19   22 0.08998931 0.05616880 0.1476594\n20   23 0.08798180 0.05513368 0.1446341\n21   25 0.08425439 0.05278817 0.1389509\n22   32 0.07361077 0.04610088 0.1223816\n23   34 0.07110571 0.04464812 0.1188697\n24   35 0.06992493 0.04396053 0.1169992\n\ntreat=6-MP \n   time         est          lcl        ucl\n1     1 0.001190464 2.144008e-05 0.01128757\n2     2 0.005924109 4.631242e-04 0.02368864\n3     3 0.011747470 1.754281e-03 0.03357572\n4     4 0.017129437 3.674298e-03 0.04031769\n5     5 0.021645266 5.918740e-03 0.04609770\n6     6 0.025287149 8.723714e-03 0.05070738\n7     7 0.028170679 1.119757e-02 0.05440917\n8     8 0.030431053 1.321153e-02 0.05702132\n9     9 0.032190277 1.496967e-02 0.05800038\n10   10 0.033549545 1.616983e-02 0.05931589\n11   11 0.034590017 1.730337e-02 0.06071802\n12   12 0.035375923 1.820430e-02 0.06143323\n13   13 0.035957906 1.893328e-02 0.06216558\n14   15 0.036661636 2.014988e-02 0.06285443\n15   16 0.036840201 2.053926e-02 0.06314265\n16   17 0.036931747 2.089471e-02 0.06428276\n17   19 0.036915381 2.135138e-02 0.06408743\n18   20 0.036831150 2.147665e-02 0.06360960\n19   22 0.036554275 2.155799e-02 0.06283364\n20   23 0.036374565 2.141731e-02 0.06261034\n21   25 0.035956904 2.121064e-02 0.06244219\n22   32 0.034187853 2.032770e-02 0.06015433\n23   34 0.033651817 2.002525e-02 0.05929729\n24   35 0.033383748 1.989617e-02 0.05873976\n\n\nThe parameters for a log-normal model in flexsurvreg are reported as follows:\n\nmeanlog (\\(\\hat{\\mu}\\)) is reported on the log-time scale. It represents the mean of the log-transformed survival times in the control (placebo) group.\nsdlog (\\(\\hat{\\sigma}\\)) is reported on the natural scale to represent the actual standard deviation (\\(\\sigma\\)) of survival times.\nThe coefficient (\\(\\hat{\\alpha_1}\\)) for the treatment covariate (treat6-MP) is\nreported on the log-time scale. As \\(\\hat{\\alpha_1}&gt;1\\), treatment increases the survival time. To get the TR, we must again exponentiate the coefficient: \\((\\exp(1.347) = 3.85)\\). The TR (exp(est) = 3.845) and its 95% confidence interval (2.068, 7.125) are automatically provided in the flexsurvreg output.\n\nWe can also fit the log-normal AFT model using survreg function from the survival package, specifying dist=\"lognormal\":\n\n\nShow R code\n# LOG-NORMAL AFT MODEL\n\n# Fitting Log-normal model using survreg\nln_AFT_surv &lt;- survreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"lognormal\")\nsummary(ln_AFT_surv)\n\n\n\nCall:\nsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"lognormal\")\n              Value Std. Error     z       p\n(Intercept)  1.8251     0.2016  9.05 &lt; 2e-16\ntreat6-MP    1.3468     0.3165  4.26 2.1e-05\nLog(scale)  -0.0792     0.1323 -0.60    0.55\n\nScale= 0.924 \n\nLog Normal distribution\nLoglik(model)= -106.7   Loglik(intercept only)= -115.4\n    Chisq= 17.38 on 1 degrees of freedom, p= 3.1e-05 \nNumber of Newton-Raphson Iterations: 4 \nn= 42 \n\n\nShow R code\n# Function predict can compute median survival time \n# Median survival time for placebo and treatment group\nmedian_times &lt;- predict(ln_AFT_surv, newdata = data.frame(treat = c(\"control\", \"6-MP\")), \n                        type = \"quantile\", p = 0.5)\nmedian_times\n\n\n        1         2 \n 6.203546 23.854377 \n\n\nThe survreg output is identical to the flexsurvreg output, with scale (\\(\\sigma\\)) parameter reported both on the log-time scale and natural scale.\n\n17.1 Model validation\nAgain, before interpreting log-normal model output, we must ensure the log-normal distribution fits the data and that the accelerated failure time (AFT) assumption. is met.\nWe can carry out similar checks as before for other models:\n1. Visual comparison with non-parametric estimates\nAs before, we can plot the fitted parametric survival curve \\(\\hat{S}(t)\\) directly over the Kaplan-Meier (KM) curve.\nFor a quick visual check, we can use plot(x) function. If x is a flexsurvreg object, R actually runs a function called plot.flexsurvreg(). It plots survival from a parametric model against non-parametric estimates, when you specify type = \"survival\":\n\n\nShow R code\n# Plot the Survival Function against the Kaplan-Meier data\nplot(ln_AFT, type = \"survival\", main = \"Log-Normal Survival Fit\")\n\n\n\n\n\n\n\n\n\nBy plotting log-normal and log-logistic models in the same figure, we can see that they provide very similar fit:\n\n\nShow R code\n# Plot both to see which fits the data points better\nplot(ln_AFT, type = \"survival\", ci = FALSE, col = \"blue\")\nlines(llog_AFT, type = \"survival\", ci = FALSE, col = \"red\")\nlegend(\"topright\", legend = c(\"Log-Normal\", \"Log-logistic\"), col = c(\"blue\", \"red\"), lty = 1)\n\n\n\n\n\n\n\n\n\nLog-normal model appears to provide a reasonably good fit to the data.\nWe could also plot the hazard functions:\n\n\nShow R code\nplot(ln_AFT, type = \"hazard\", main = \"Log-normal hazard fit\")\n\n\n\n\n\n\n\n\n\n2. Linear transformation (Graphical check)\nIf \\(T\\) follows a log-normal distribution, then \\(\\log(T)\\) must follow a normal distribution. The Z score (normal quantile) is \\(Z = \\frac{\\log{(t)}-\\mu} {\\sigma}\\), which can be rearranged as \\(Z = \\frac{1}{\\sigma} \\log{(t)} - \\frac{\\mu} {\\sigma}\\).\nWe can thus check whether plotting the standard normal quantiles, calculated as \\(\\Phi^{-1}[1-S(t)]\\), against \\(\\log(t)\\), gives a straight line, with intercept \\(-\\frac{\\mu} {\\sigma}\\) and slope \\(\\frac{1}{\\sigma}\\):\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(survival) # reloaded to be able to run this block independently\n\n# Plotting normal quantiles against log of time \n\n# Kaplan-Meier fitted before: km\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\n\n# 2. Create a data frame for filtering and label the groups\n# KM object often starts with a survival of 1 at time 0 and might end with a\n# survival of 0\n# gnorm(0) is -infinity and qnorm(1) is +infinity\n# lm() below fails when it hits infinite values\n# to fix this, we need to create a temporary data from, filter out those infinite\n# points, and then plot the results\ndf &lt;- data.frame(\n  x=log(km$time), y=qnorm(1 - km$surv),\n  # in survfit object, the information about the number of observations in each\n  # group is stored in a vector called km$strata\n  group = rep(names(km$strata), km$strata)\n)\n\n# 3. Remove the infinite values (where survival is 0 or 1)\ndf_clean &lt;- df[is.finite(df$y), ]\n\n# 4. Plot the cleaned data\nplot(df_clean$x, df_clean$y, \n     main = \"Log-Normal Q-Q Plot\",\n     xlab = \"log(Time)\", ylab = \"Normal Quantiles\"#,\n     #pch = 19,\n     #col =\"blue\"\n     )\n\n# 5. Extract and compare the slopes for each group\nfor(g in names(km$strata)){\n  group_data &lt;- subset(df_clean, group == g)\n  fit_lm &lt;- lm(y ~ x, data = group_data)\n  \n  coef(fit_lm)\n\n# 6. Add a regression line for each group\n\n  abline(fit_lm, col = ifelse(g == names(km$strata)[1], \"red\", \"blue\"))\n\n# 7. Calculate sigma (1/slope) \n  slope &lt;- coef(fit_lm)[\"x\"]\n  sigma_est &lt;- 1 / slope\n  print(paste(\"Group:\", g, \"| Estimated Sigma (1/slope):\", round(sigma_est, 4)))\n}\n\n\n[1] \"Group: treat=control | Estimated Sigma (1/slope): 1.0192\"\n[1] \"Group: treat=6-MP | Estimated Sigma (1/slope): 1.3838\"\n\n\nShow R code\n# 8. Add a legend\nlegend(\"topleft\", legend = names(km$strata), col = c(\"red\", \"blue\"), lty = 1, lwd = 2)\n\n\n\n\n\n\n\n\n\nThe plot of normal quantiles against \\(\\log(t)\\) appear to produce relatively straight lines in both groups.\nWe can also use this plot to assess accelerated failure time assumption. If the AFT assumption is true, the treatment only changes the timing (\\(\\mu\\)), not the spread or shape (\\(\\sigma\\)). Therefore, the slopes for both groups must be equal.\nParallel lines on the plot are the visual proof that \\(\\sigma\\) is constant across the groups. From the above plot it appears that the two lines are not exactly parallel. Above code also prints out the estimated \\(\\hat{\\sigma}\\) (1/slope) for both groups and they appear somewhat different, unlike the AFT model assumes. This implies that the treatment may be changing not only the timing but also the variance of the survival times. If this is the case, a single scale parameter \\(\\sigma\\) is insufficient.\nIn flexsurvreg, it is possible to allow ancillary parameters like \\(\\sigma\\) to depend on the treatment. You can do this using the anc argument. This tells R to estimate a separate \\(\\sigma\\) for each group:\n\n\nShow R code\n# Fitting Log-normal model using flexsurvreg, \n# modelling both location and scale by treatment\nln_non_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, anc = list(sdlog = ~treat), data = leukdata, dist = \"lnorm\")\nln_non_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, anc = list(sdlog = ~treat), \n    data = leukdata, dist = \"lnorm\")\n\nEstimates: \n                  data mean  est      L95%     U95%     se       exp(est)\nmeanlog                NA     1.8251   1.4388   2.2114   0.1971       NA \nsdlog                  NA     0.9032   0.6675   1.2222   0.1394       NA \ntreat6-MP          0.5000     1.3779   0.6970   2.0589   0.3474   3.9667 \nsdlog(treat6-MP)   0.5000     0.0803  -0.5056   0.6662   0.2989   1.0836 \n                  L95%     U95%   \nmeanlog                NA       NA\nsdlog                  NA       NA\ntreat6-MP          2.0076   7.8376\nsdlog(treat6-MP)   0.6031   1.9468\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.6677, df = 4\nAIC = 221.3355\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\n#summary(ln_non_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\nThe output is otherwise similar to the AFT model output, but gives separate \\(\\sigma\\) for control and treatment group, with the latter reported both on the log-time scale and natural scale (exp(est)). The two scale parameters for control group \\(\\hat{\\sigma_0} = 0.9032\\) and \\(\\hat{\\sigma_1} = 1.0836\\) do not appear very different and fit within each other’s 95% confidence intervals. However, we can carry out a formal LRT test to evaluate which model fits the data better.\n3. Graphical check for accelerated failure time assumption\nWe can also evaluate whether the accelerated failure time (AFT) assumption for the log-normal AFT model holds by checking whether there is a constant horizontal shift between survival curves plotted against log of time:\n\n\nShow R code\nlibrary(broom) # reloaded to be able to run this block independently\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(flexsurv) # reloaded to be able to run this block independently\n\n# Plotting survival curves on log time scale to see the AFT model constant shift\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\n#summary(km)\n#names(km)\n\n# 2. Create a data frame for ggplot\nplot_data &lt;-broom::tidy(km)\n#plot_data\n# survival probability is now named estimate\n#names(plot_data)\n\n# 3. Fit log-normal model (and other models for comparison)\n#exp_PH &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"exp\")\n#wei_AFT &lt;- flexsurvreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\n#llog_AFT &lt;- flexsurvreg( Surv(time, cens) ~ treat, data = leukdata, dist = \"llogis\")\nln_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"lnorm\")\n\n\n# 4. Generate predicted survival probabilities for a range of times\n# This creates a smooth curve for the log-time axis\ntime_seq &lt;- seq(0.1, 35, length.out = 100)\n#pred_exp &lt;- summary(exp_PH, t = time_seq, tidy = TRUE)\n#pred_wei &lt;- summary(wei_AFT, t = time_seq, tidy = TRUE)\n#pred_llogis &lt;- summary(llog_AFT, t = time_seq, tidy = TRUE)\npred_lnorm &lt;- summary(ln_AFT, t = time_seq, tidy = TRUE)\n\n# 5. Plot everything with a Log-transformed X-axis\n\n# for log-normal model only\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n  # Log-logistic fitted curves\n  geom_line(data = pred_lnorm, aes(x = time, y = est, color = treat), linetype = \"longdash\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Log-normal AFT fit on log time scale\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# also including exponential, Weibull, and log-logistic models\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n   # Exponential fitted curves\n  geom_line(data = pred_exp, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  # Weibull fitted curves\n  geom_line(data = pred_wei, aes(x = time, y = est, color = treat), linetype = \"dotted\", linewidth = 1) +\n  # Log-logistic fitted curves\n  geom_line(data = pred_llogis, aes(x = time, y = est, color = treat), linetype = \"dotdash\", linewidth = 1) +\n  # Log-normal fitted curves\n  geom_line(data = pred_lnorm, aes(x = time, y = est, color = treat), linetype = \"longdash\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Parametric fits on log time scale\",\n       subtitle = \"Dashed = Exponential, Dotted = Weibull, Dotdash = Log-logistic, Longdash = Log-normal\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nThe shift between survival curves seems constant for log-normal model.\n\n\n17.2 Model selection\nSince the AFT model with common scale parameter (constrained: \\(\\sigma_0 = \\sigma_1\\)) for treatment and control group is nested within the non-AFT model with separate scale parameters (unconstrained: \\(\\sigma_0 \\ne \\sigma_1\\)) for treatment and control groups, we can compare their fit using the likelihood ratio test:\n\n\nShow R code\n# 1. Fit the standard AFT model (common scale)\nln_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"lnorm\")\n\n# 2. Fit the extended non-AFT model (separate scales using 'anc')\nln_non_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, anc = list(sdlog = ~treat), data = leukdata, dist = \"lnorm\")\n\n# 3. Perform the Likelihood Ratio Test\n# Calculation: 2 * (LogLik(extended) - LogLik(standard))\nlrt_stat &lt;- 2 * (ln_non_AFT$loglik - ln_AFT$loglik)\np_val &lt;- 1 - pchisq(lrt_stat, df = 1)\n\n# 4. Display the results\ncat(\"LRT Statistic:\", round(lrt_stat, 4), \"\\n\")\n\n\nLRT Statistic: 0.0737 \n\n\nShow R code\ncat(\"P-value:\", round(p_val, 4), \"\\n\")\n\n\nP-value: 0.786 \n\n\nAs the p-value is not significant, it appears that the slopes on the plot and in the non-AFT model were not different enough to require a more flexible model. We conclude that the treatment apparently influences only the timing (location) and not the variability (scale) of the event, supporting the AFT assumption, and not requiring us to model the ancillary parameters.\nWe can use AIC to compare the goodness-of-fit of exponential, Weibull, log-logistic, and log-normal models, including the AFT and non-AFT log-normal models:\n\n\nShow R code\naic_table &lt;- data.frame(\n  Model = c(\"Exponential\", \"Weibull\", \"Log-Logistic\", \"Log-Normal AFT\", \"Log-Normal non-AFT\"),\n  AIC = c(AIC(exp_PH), AIC(wei_AFT), AIC(llog_AFT), AIC(ln_AFT), AIC(ln_non_AFT))\n)\n# Sort by AIC (lowest is best)\naic_table &lt;- aic_table[order(aic_table$AIC), ]\nprint(aic_table)\n\n\n               Model      AIC\n2            Weibull 219.1590\n4     Log-Normal AFT 219.4092\n1        Exponential 221.0481\n3       Log-Logistic 221.3228\n5 Log-Normal non-AFT 221.3355\n\n\nBased on AIC, the AFT log-normal model appears second best after the Weibull model and the non-AFT log-normal last, although the differences in the AIC values between models are again very small.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#gamma-distribution",
    "href": "Parametric.html#gamma-distribution",
    "title": "3 Parametric survival models",
    "section": "18 Gamma distribution",
    "text": "18 Gamma distribution\nThe shape of the gamma distribution is similar to that of the log-logistic or log-normal distributions, but they behave differently in their tails, as the tail of the gamma distribution decays more quickly.\nIf a random variable \\(T\\) follows a gamma distribution with parameters \\(\\lambda\\) and \\(k\\), then\nProbability density function:\n\\[f(t) = \\frac{\\lambda^k t^{k-1} e^{-\\lambda t}}{\\Gamma(k)},\\] where the Gamma function is \\(\\Gamma(k) = \\int_0^\\infty x^{k-1} e^{-x} dx\\).\nSurvival function:\n\\[S(t) = \\frac{\\Gamma(k, \\lambda t)}{\\Gamma(k)},\\]\nwhere \\(\\Gamma(k, \\lambda t) = \\int_{\\lambda t}^\\infty x^{k-1} e^{-x} dx\\) is the upper incomplete Gamma function.\nHazard function:\n\\[h(t) = \\frac{\\lambda^k t^{k-1} e^{-\\lambda t}}{\\Gamma(k,\\lambda t)},\\] Hazard and survival functions cannot usually be expressed in simple closed forms and must be evaluated using integrals or numerical methods.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#generalised-gamma-distribution",
    "href": "Parametric.html#generalised-gamma-distribution",
    "title": "3 Parametric survival models",
    "section": "19 Generalised gamma distribution",
    "text": "19 Generalised gamma distribution\nThe generalised gamma distributionThe generalised gamma distribution is a flexible three-parameter family (\\(\\lambda, k, p\\)) that generalizes several key distributions.\nIf a random variable \\(T\\) follows a generalised gamma distribution with parameters \\(\\lambda\\), \\(k\\), and \\(p\\) then\nProbability density function:\n\\[f(t) = \\frac{p \\lambda^k t^{p k - 1} e^{-(\\lambda t)^p}}{\\Gamma(k)}\\] Survival function:\n\\[S(t) = \\frac{\\Gamma(k, (\\lambda t))^p}{\\Gamma(k)},\\]\nwhere \\(\\Gamma(k, (\\lambda t)^p = \\int_{(\\lambda t)^p}^\\infty x^{k-1} e^{-x} dx\\).\nHazard function:\n\\[h(t) = \\frac{p \\lambda^k t^{p k - 1} e^{-(\\lambda t)^p}}{\\Gamma(k, (\\lambda t))^p}\\] The power of this distribution lies in its nesting. It includes the following as special cases:\n\nExponential: when \\(k=1\\) and \\(p=1\\)\nWeibull: when \\(k=1\\)\nLognormal: as \\(k \\to \\infty\\)\nStandard Gamma: when \\(p=1\\).",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "Parametric.html#data-example-fitting-gamma-and-generalised-gamma-models",
    "href": "Parametric.html#data-example-fitting-gamma-and-generalised-gamma-models",
    "title": "3 Parametric survival models",
    "section": "20 Data example: Fitting gamma and generalised gamma models",
    "text": "20 Data example: Fitting gamma and generalised gamma models\nBoth the gamma and generalised gamma distributions are AFT models by nature.\nUnder specific conditions, they can accommodate PH models:\n\nIf \\(k = 1\\), the gamma model simplifies to the exponential model, which is a PH model.\nIf \\(k = 1\\) and \\(p = 1\\), the generalised gamma simplifies to the exponential model.\nIf \\(k = 1\\), the generalised gamma simplifies to the Weibull model, which is also a PH model.\n\nThese models are often used as non-proportional hazards models, allowing hazard ratios to change over time when the PH assumptions of simpler models fail.\nWe can plot the hazard functions, survival functions and probability density functions, showing exponential, Weibull and gamma models as special cases of the generalised gamma distribution:\n\n\nShow R code\n# Plotting hazard, survival and probability density functions\n\n#library(flexsurv)\n#library(ggplot2)\n#library(tidyr)\n#library(dplyr)\n\n# 1. Define the parameter sets for comparison\n# f(x; lambda, k, p)\n# We will keep lambda (scale) constant at 1.0 for all\nt &lt;- seq(0.01, 5, length.out = 200)\n\n# using flexsurv notation for generalised gamma model\nmodels &lt;- data.frame(\n  label = c(\"Gen. Gamma (k=2, p=1.5)\", \"Gamma (p=1, k=2)\", \"Weibull (k=1, p=1.5)\", \"Exponential (k=1, p=1)\"),\n  # this is simplification that only works for Weibull and exponential\n  mu = 0,        # mu = log(1/lambda). If lambda=1, mu=0. \n  sigma = c(1/(1.5*sqrt(2)), 1/sqrt(2), 1/1.5, 1), # sigma = 1/(p*sqrt(k))\n  Q = c(1/sqrt(2), 1/sqrt(2), 1, 1)                # Q = 1/sqrt(k)\n)\n\n# 2. Generate the data for PDF, Survival, and Hazard\nplot_data &lt;- expand.grid(t = t, label = models$label) %&gt;%\n  left_join(models, by = \"label\") %&gt;%\n  mutate(\n    PDF = dgengamma(t, mu = mu, sigma = sigma, Q = Q),\n    Survival = pgengamma(t, mu = mu, sigma = sigma, Q = Q, lower.tail = FALSE),\n    Hazard = hgengamma(t, mu = mu, sigma = sigma, Q = Q)\n  )\n\n# 3. Create the plots\n# Function to generate uniform themed plots\nmake_plot &lt;- function(data, y_var, title) {\n  ggplot(data, aes(x = t, y = .data[[y_var]], color = label)) +\n    geom_line(linewidth = 1.2) +\n    labs(title = title, \n         x = \"Time\", \n         y = y_var, \n         color = \"Distribution Family\") +\n    theme_minimal(base_size = 12) + # Slightly larger text for readability\n    scale_color_brewer(palette = \"Set1\") #+\n    #theme(legend.position = \"bottom\") # Moves legend to bottom for better horizontal space\n}\n\np1 &lt;- make_plot(plot_data, \"Hazard\", \"Hazard Function (h(t))\")\np2 &lt;- make_plot(plot_data, \"Survival\", \"Survival Function (S(t))\")\np3 &lt;- make_plot(plot_data, \"PDF\", \"Probability Density Function (PDF)\")\n\n# Display plots\nprint(p1)\n\n\n\n\n\n\n\n\n\nShow R code\nprint(p2)\n\n\n\n\n\n\n\n\n\nShow R code\nprint(p3)\n\n\n\n\n\n\n\n\n\nFitting gamma AFT model\nWe can fit the gamma AFT model using flexsurvreg function from the flexsurv package, specifying dist=\"gamma\":\n\n\nShow R code\n# GAMMA AFT MODEL\n\n# Fitting gamma AFT model using flexsurvreg\ng_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gamma\")\ng_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"gamma\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \nshape           NA     1.6539   1.0506   2.6035   0.3829       NA        NA\nrate            NA     0.1908   0.1087   0.3350   0.0548       NA        NA\ntreat6-MP   0.5000    -1.2831  -1.8866  -0.6796   0.3079   0.2772    0.1516\n           U95%   \nshape           NA\nrate            NA\ntreat6-MP   0.5068\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.4417, df = 3\nAIC = 218.8834\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\n# summary(surv_g1, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n# This gives you the Time Ratio\n# untransformed coefficients\ng_AFT$coefficients\n\n\n     shape       rate  treat6-MP \n 0.5031215 -1.6562742 -1.2830901 \n\n\nShow R code\nexp(-g_AFT$coefficients[-c(1,2)])\n\n\ntreat6-MP \n 3.607771 \n\n\nThe parameters for a gamma model in flexsurvreg are as follows:\n\nshape (\\(\\hat{k}\\)): This determines the behavior of the hazard over time:\n\nIf shape &gt; 1: The hazard is increasing\nIf shape &lt; 1: The hazard is decreasing\nIf shape = 1: The hazard is constant (if the confidence interval for shape includes 1, model can likely be simplified to an exponential model)\n\nrate (\\(\\hat{\\lambda}\\)): This is a scale parameter that relates to how stretched out the distribution is over time. The relationship between the rate \\(\\lambda\\) and the location (\\(\\mu\\)) in the AFT model is inverse. By default, flexsurv uses a log-link: (\\(\\mu\\)) = \\(-log(\\lambda)\\). Thus, a higher rate means that events happen faster (smaller \\(\\mu\\)) and lower rate means that events happen slower (larger \\(\\mu\\)). rate is thus the baseline log-rate for someone with all covariates zero.\nThe coefficient (\\(\\hat{\\alpha_1}\\)): Because flexsurv models the rate parameter (\\(\\lambda\\)), the coefficients reported in the est column have a specific AFT meaning:\n\nPositive coefficient: Increases the rate of failure (shorter survival time)\nNegative coefficient: Decreases the rate of failure (longer survival time)\n\n\nTherefore, in gamma model output exp(est) refers to acceleration factor (AF) rather than time ratio (TR). We can obtain \\(TR = \\frac{1}{\\exp(\\hat{\\alpha_1})} = \\exp(-(-1.2831)) = 3.60\\).\nFitting generalised gamma AFT model\nWe can fit the generalised gamma AFT model using flexsurvreg function from the flexsurv package, specifying dist=\"gengamma\":\n\n\nShow R code\n# GENERALISED GAMMA AFT MODEL\n\n# Fitting generalised gamma AFT model using flexsurvreg\ngg_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gengamma\")\ngg_AFT\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"gengamma\")\n\nEstimates: \n           data mean  est     L95%    U95%    se      exp(est)  L95%    U95%  \nmu             NA      2.063   1.386   2.741   0.346      NA        NA      NA\nsigma          NA      0.830   0.540   1.278   0.183      NA        NA      NA\nQ              NA      0.551  -0.807   1.910   0.693      NA        NA      NA\ntreat6-MP   0.500      1.306   0.680   1.932   0.319   3.691     1.973   6.903\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.3895, df = 4\nAIC = 220.779\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\n# summary(gg_AFT, newdata = data.frame(treat = c(\"control\", \"6-MP\")), type = \"hazard\")\n\n\nThis generalised gamma model output from flexsurvreg uses the so called Prentice parameterisation that relates it to the AFT model:\n\nmu (\\(\\mu\\)): This is the location parameter, that determines the ‘center’ of the survival time on a log scale for the reference (placebo group). The treatment covariate further shifts this (\\(\\mu\\)).\nsigma (\\(\\sigma\\)): This is the scale parameter, that determines the spread or the variance of the log-survival times.\nQ: This is the shape parameter, that controls the skewness and tail behavior. In a way, it thus handles the departure from log-normality. You can use it to evaluate whether a simpler two-parameter model might be justified:\n\nQ = 1: Weibull (hazard changes monotonically, only up or only down)\nQ = 0: Log-Normal (hazard rises to a peak and then declines)\nQ &gt; 0: Standard gamma (hazard typically increases and then levels off)\nQ &lt; 0: Inverse gamma\n\n\nThe parameterisation used before in our gamma formulas is called Stacy parameterisation and you can transform the above output into Stacy parameters using the following formulas:\n\n\nShow R code\n# Transforming flexsurv 'gengamma' output into stacy parameters used in the formulas\n\nstacy_converter &lt;- function(model) {\n  # 1. Extract Prentice parameters from the model\n  # We use the 'res' table which contains natural scale estimates\n  mu    &lt;- model$res[\"mu\", \"est\"]\n  sigma &lt;- model$res[\"sigma\", \"est\"]\n  Q     &lt;- model$res[\"Q\", \"est\"]\n  \n  # 2. Apply the transformation math\n  k_stacy &lt;- 1 / (Q^2)\n  p_stacy &lt;- Q / sigma\n  lambda_stacy &lt;- exp(mu-(log(k_stacy)/p_stacy))\n  \n  # 3. Format into a nice table\n  results &lt;- data.frame(\n    Parameter = c(\"k (Shape)\", \"p (Power)\", \"lambda (Rate/Scale)\"),\n    Stacy_Estimate = c(k_stacy, p_stacy, lambda_stacy),\n    stringsAsFactors = FALSE\n  )\n  \n  return(results)\n}\n\n# Usage:\n stacy_params &lt;- stacy_converter(gg_AFT)\n print(stacy_params)\n\n\n            Parameter Stacy_Estimate\n1           k (Shape)      3.2889892\n2           p (Power)      0.6640113\n3 lambda (Rate/Scale)      1.3104385\n\n\nHowever, you can also obtain the Stacy parameters by fitting the generalised gamma AFT model using flexsurvreg function from the flexsurv package, specifying dist=\"gengamma.orig\":\n\n\nShow R code\n# GENERALISED GAMMA AFT MODEL\n\n# Fitting gamma model using flexsurvreg\ngg_AFT2 &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gengamma.orig\")\ngg_AFT2\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"gengamma.orig\")\n\nEstimates: \n           data mean  est       L95%      U95%      se        exp(est)\nshape            NA   6.66e-01  3.76e-02  1.18e+01  9.77e-01        NA\nscale            NA   1.33e+00  2.36e-06  7.51e+05  9.01e+00        NA\nk                NA   3.27e+00  2.13e-02  5.02e+02  8.39e+00        NA\ntreat6-MP  5.00e-01   1.31e+00  6.79e-01  1.93e+00  3.20e-01  3.69e+00\n           L95%      U95%    \nshape            NA        NA\nscale            NA        NA\nk                NA        NA\ntreat6-MP  1.97e+00  6.91e+00\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.3895, df = 4\nAIC = 220.779\n\n\nIn the Stacy version:\n\nshape \\((p)\\): A power parameter that affects the spread and skewness\nscale \\((\\lambda)\\): Directly relates to the time scale\nk \\((k)\\)): Affects the tail behavior and overall family of the distribution\n\nGamma or generalised gamma models cannot be fit using survreg.\n\n20.1 Model validation\nTo ensure the gamma distribution fits the data and the accelerated failure time (AFT) assumption. is met, we carry out similar checks as before for other models:\n1. Visual comparison with non-parametric estimates\nWe can plot the fitted parametric survival curve \\(\\hat{S}(t)\\) directly over the Kaplan-Meier (KM) curve.\nFor a quick visual check, we can use plot(x) function. If x is a flexsurvreg object, R actually runs a function called plot.flexsurvreg(). It plots survival from a parametric model against non-parametric estimates, when you specify type = \"survival\":\n\n\nShow R code\n# Plot the gamma survival function against the Kaplan-Meier data\nplot(g_AFT, type = \"survival\", main = \"Standard Gamma Survival Fit\")\n\n\n\n\n\n\n\n\n\nShow R code\n# Plot both the gamma and generalised gamma survival functions to see which fits \n# the data points better\nplot(gg_AFT, type = \"survival\", ci = FALSE, col = \"blue\", main = \"Model Comparison\")\nlines(g_AFT, type = \"survival\", ci = FALSE, col = \"red\")\n\n# Add a legend\nlegend(\"topright\", legend=c(\"Generalised Gamma\", \"Gamma\"), \n       col=c(\"blue\", \"red\"), lwd=2)\n\n\n\n\n\n\n\n\n\nShow R code\n# Plot additionally Weibul (best AIC so far) to see which fits the data points better\nplot(gg_AFT, type = \"survival\", ci = FALSE, col = \"blue\", main = \"Model Comparison\")\nlines(g_AFT, type = \"survival\", ci = FALSE, col = \"red\")\nlines(wei_AFT, type = \"survival\", ci = FALSE, col = \"green\")\n\n# 4. Add a legend\nlegend(\"topright\", legend=c(\"Generalised Gamma\", \"Gamma\", \"Weibull\"), \n       col=c(\"blue\", \"red\", \"green\"), lwd=2)\n\n\n\n\n\n\n\n\n\nWe could also plot the hazard functions:\n\n\nShow R code\nplot(g_AFT, type = \"hazard\", main = \"Gamma hazard fit\")\n\n\n\n\n\n\n\n\n\nShow R code\nplot(gg_AFT, type = \"hazard\", main = \"Generalised gamma hazard fit\")\n\n\n\n\n\n\n\n\n\n2. Linear transformation (Graphical check)\nIf \\(T\\) follows a gamma distribution with scale \\(\\lambda\\) and shape \\(k\\), then \\(\\frac{T}{\\lambda} \\sim Gamma(k, \\lambda = 1). The observed quantile of time\\)t_p =Q(p;k,1)$, where \\(t_p =\\lambda * Q(p;k,1)\\) is the theoretical quantile function for a standard gamma distribution\nWe can check whether plotting the observed survival times against theoretical gamma quantiles gives a straight line, with intercept 0 and slope :\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(survival) # reloaded to be able to run this block independently\n\n# Plotting observed quantiles against theoretical gamma quantiles \n\n# 1. Fit your gamma model\ng_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gamma\")\n\n# 2. Extract the common shape parameter (k)\nk_hat &lt;- g_AFT$res[\"shape\", \"est\"]\n#rate_hat &lt;- surv_g1$res[\"rate\", \"est\"]\n#a_hat &lt;- 1 / rate_hat\n\n# 3. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit(Surv(time, cens) ~ treat, data=leukdata)\n\n# 4. Create a data frame for filtering and label the groups\n# KM object often starts with a survival of 1\n# qgamma(1) is infinity\n# lm() below fails when it hits infinite values\n# to fix this, we need to create a temporary data from, filter out those infinite\n# points, and then plot the results\ndf &lt;- data.frame(\n  time_obs = km$time, theo_quantiles = qgamma(1 - km$surv, shape = k_hat, scale = 1),\n  # in survfit object, the information about the number of observations in each\n  # group is stored in a vector called km$strata\n  group = rep(names(km$strata), km$strata)\n)\n\n# 5. Remove the infinite values (where survival is 1)\ndf_clean &lt;- df[is.finite(df$theo_quantiles), ]\n\n# 6. Initialise the plot - created empty plot to add points in loop\nplot(df_clean$theo_quantiles, df_clean$time_obs, type = \"n\",\nxlim = c(0, max(df_clean$theo_quantiles)), \nylim = c(0, max(df_clean$time_obs)),\nxlab = \"Theoretical Quantiles (Standard Gamma, Scale=1)\",\nylab = \"Observed survival time\",\nmain = \"Gamma Q-Q Plot\",\nxaxs = \"i\", yaxs = \"i\")\n\n# 7. Extract slopes and add lines for each group\ngroup_names &lt;- names(km$strata)\ncols &lt;- c(\"blue\", \"red\")\n\nfor(i in 1:length(group_names)){\n  g &lt;- group_names[i]\n  group_data &lt;- subset(df_clean, group == g)\n  \n   # Plot points for this group\n  points(group_data$theo_quantiles, group_data$time_obs, col = cols[i], pch = 19)\n  \n  # Fit a regression line through origin (Time = scale * theoretical gamma quintile)\n  # The slope of this line is the group-specific scale (a)\n  # '-1' forces the intercept to be 0\n  fit_lm &lt;- lm(time_obs ~ theo_quantiles - 1, data = group_data)\n  \n  # Add the line\n  abline(fit_lm, col = cols[i], lwd = 2)\n\n# 7. Slope is the estimated scale a \n  scale_est &lt;- coef(fit_lm)[\"theo_quantiles\"]\n  print(paste(\"Group:\", g, \"| Estimated scale:\", round(scale_est, 4)))\n}\n\n\n[1] \"Group: treat=control | Estimated scale: 4.9925\"\n[1] \"Group: treat=6-MP | Estimated scale: 18.6808\"\n\n\nShow R code\n# 8. Add a legend\nlegend(\"topleft\", legend = group_names, col = cols, lty = 1, lwd = 2, pch = 19)\n\n\n\n\n\n\n\n\n\nThe plot of theoretical quantiles against observed survival times appear to produce relatively straight lines in both groups.\n3. Graphical check for accelerated failure time assumption\nWe can also evaluate whether the accelerated failure time (AFT) assumption for the gamma and generalised gamma AFT models hold by checking whether there is a constant horizontal shift between survival curves plotted against log of time:\n\n\nShow R code\nlibrary(broom) # reloaded to be able to run this block independently\nlibrary(tidyverse) # reloaded to be able to run this block independently\nlibrary(flexsurv) # reloaded to be able to run this block independently\n\n# Plotting survival curves on log time scale to see the AFT model constant shift\n\n# 1. Fit the Kaplan-Meier (observed) by treatment group\nkm &lt;- survfit( Surv(time, cens) ~ treat, data=leukdata)\n#summary(km)\n#names(km)\n\n# 2. Create a data frame for ggplot\nplot_data &lt;-broom::tidy(km)\n#plot_data\n# survival probability is now named estimate\n#names(plot_data)\n\n# 3. Fit log-normal model (and other models for comparison)\n#exp_PH &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"exp\")\n#wei_AFT &lt;- flexsurvreg(Surv(time,cens) ~ treat, data = leukdata, dist = \"weibull\")\n#llog_AFT &lt;- flexsurvreg( Surv(time, cens) ~ treat, data = leukdata, dist = \"llogis\")\n#ln_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"lnorm\")\ng_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gamma\")\ngg_AFT &lt;- flexsurvreg(Surv(time, cens) ~ treat, data = leukdata, dist = \"gengamma\")\n\n\n# 4. Generate predicted survival probabilities for a range of times\n# This creates a smooth curve for the log-time axis\ntime_seq &lt;- seq(0.1, 35, length.out = 100)\n#pred_exp &lt;- summary(exp_PH, t = time_seq, tidy = TRUE)\n#pred_wei &lt;- summary(wei_AFT, t = time_seq, tidy = TRUE)\n#pred_llogis &lt;- summary(llog_AFT, t = time_seq, tidy = TRUE)\n#pred_lnorm &lt;- summary(ln_AFT, t = time_seq, tidy = TRUE)\npred_g &lt;- summary(g_AFT, t = time_seq, tidy = TRUE)\npred_gg &lt;- summary(gg_AFT, t = time_seq, tidy = TRUE)\n\n# 5. Plot everything with a Log-transformed X-axis\n\n# for log-normal model only\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n  # Gamma fitted curves\n  geom_line(data = pred_g, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Gamma AFT fit on log time scale\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nShow R code\n# also including exponential, Weibull, and log-logistic models\nggplot() +\n  # Kaplan-Meier steps (the raw data)\n  geom_step(data = plot_data, aes(x = time, y = estimate, color = strata), linewidth = 0.8) +\n   # Exponential fitted curves\n  # geom_line(data = pred_exp, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  # Weibull fitted curves\n  # geom_line(data = pred_wei, aes(x = time, y = est, color = treat), linetype = \"dotted\", linewidth = 1) +\n  # Log-logistic fitted curves\n  # geom_line(data = pred_llogis, aes(x = time, y = est, color = treat), linetype = \"dotdash\", linewidth = 1) +\n  # Log-normal fitted curves\n  # geom_line(data = pred_lnorm, aes(x = time, y = est, color = treat), linetype = \"longdash\", linewidth = 1) +\n  # Gamma fitted curves\n  geom_line(data = pred_g, aes(x = time, y = est, color = treat), linetype = \"dashed\", linewidth = 1) +\n  # Generalised gamma fitted curves\n  geom_line(data = pred_gg, aes(x = time, y = est, color = treat), linetype = \"dotted\", linewidth = 1) +\n  scale_x_log10() + \n  labs(title = \"KM vs. Parametric fits on log time scale\",\n       subtitle = \"Dashed = Gamma, Dotted = Generalised Gamma\", #Dotdash = Log-logistic, Longdash = Log-normal\",\n       x = \"Log(Time)\", y = \"Survival Probability\") +\n  theme_bw()\n\n\n\n\n\n\n\n\n\nThe shift between survival curves seems constant for both models.\n\n\n20.2 Model selection\nIn research you often don’t know which distribution fits your data best. Because generalised gamma distribution contains all these other distributions as special cases, you can:\n\nFit a generalised gamma model\nCheck the confidence intervals for \\(k\\) and \\(p\\)\nIf p ≈ 1: You can simplify your model to a gamma model\nIf k ≈ 1: You can simplify your model to a Weibull model\nIf k ≈ 1, p ≈ 1: You can simplify your model to an exponential model\n\nBecause these other models are nested of with the generalised gamma model, we can carry out a formal Likelihood Ratio Test (LRT) between two models to determine which model provides a better fit for the data.\nTo test whether a generalised gamma \\((\\lambda, k, p\\) distribution gives a significantly better fit than a Weibull \\((\\lambda, p\\)) distribution, we test the following null hypothesis:\n\\[H_0: k = 1 \\quad \\text{(Weibull model)}\\] \\[H_1: k \\neq 1 \\quad \\text{(Generalised gamma model)}\\] Under the null hypothesis \\(H_0\\), the likelihood ratio test statistic \\(W\\) follows a chi-squared distribution with 1 degree of freedom (\\(\\chi^2_1\\)):\n\\[W(\\hat{\\lambda}, \\hat{p}, 1) = 2 \\left[ \\log L(\\hat{\\lambda}, \\hat{p}, \\hat{k}) - \\log L(\\hat{\\lambda_0}, \\hat{p_0}, 1) \\right] \\sim \\chi_1^2,\\] where \\(\\hat{\\lambda}\\), \\(\\hat{p}\\), \\(\\hat{k}\\) are the maximum likelihood estimates (MLEs) for a generalised gamma model with unconstrained \\(k\\), and \\(\\hat{\\lambda}_0\\), \\(\\hat{p}_0\\) are the MLEs for a generalised gamma model with the constraint \\(k = 1\\) (i.e., MLE for the Weibull model).\nThe Weibull and generalised gamma model outputs we ran before provide the necessary log-likelihood values for carrying out the LRT. We can thus carry out the LRT for example in the following way:\n\n\nShow R code\n# Calculate manually\n\n# Using flexsurvreg outputs that provide the log-likehood values\n# The necessary values can be extracted in the following way:\nlogL_wei &lt;- wei_AFT_surv$loglik\nlogL_wei\n\n\n[1] -116.4054 -106.5795\n\n\nShow R code\nlogL_gg &lt;- gg_AFT$loglik\nlogL_gg\n\n\n[1] -106.3895\n\n\nShow R code\n# Calculate the test statistic\nLRT_statistic &lt;- 2 * (logL_gg - logL_wei)\nLRT_statistic\n\n\n[1] 20.0318402  0.3800095\n\n\nShow R code\n# Calculate the P-value\n# We use the Chi-squared distribution with 1 degree of freedom\np_value &lt;- pchisq(LRT_statistic, df = 1, lower.tail = FALSE)\np_value\n\n\n[1] 7.616337e-06 5.375982e-01\n\n\nThe non-significant p-value (\\(p = 0.54\\)) indicates that allowing the parameter \\(k\\) to vary (generalised gamma model) does not significantly improve the model’s log-likelihood compared to fixing it at 1 (Weibull model). We would thus fail to reject the null hypothesis at 5% significance level, and conclude that Weibull distribution is better than generalised gamma distribution in this case.\nWe could also use the lrtest() function from the lmtest() package to compare two nested flexsurvreg objects:\n\n\nShow R code\n# Make sure you have installed the lmtest package\n# install.packages(\"lmtest\")\n# Load the lmtest package\nlibrary(lmtest)\n\n# Likelihood Ratio Test\n\n# It is recommended to list the most complex model first\nlrtest(gg_AFT, wei_AFT)\n\n\nLikelihood ratio test\n\nModel 1: Surv(time, cens) ~ treat\nModel 2: Surv(time, cens) ~ treat\n  #Df  LogLik Df Chisq Pr(&gt;Chisq)\n1   4 -106.39                    \n2   3 -106.58 -1  0.38     0.5376\n\n\nShow R code\nlrtest(gg_AFT, g_AFT)\n\n\nLikelihood ratio test\n\nModel 1: Surv(time, cens) ~ treat\nModel 2: Surv(time, cens) ~ treat\n  #Df  LogLik Df  Chisq Pr(&gt;Chisq)\n1   4 -106.39                     \n2   3 -106.44 -1 0.1044     0.7466\n\n\nAlso when comparing the fit of standard gamma model and generalised gamma model, we fail to reject the null hypothesis, and also conclude that standard gamma distribution is better than generalised gamma distribution in this case.\nWe can use AIC to compare the goodness-of-fit of Weibull and standard gamma models, as well as other models we have fit:\n\n\nShow R code\naic_table &lt;- data.frame(\n  Model = c(\"Exponential\", \"Weibull\", \"Log-Logistic\", \"Log-Normal\",\n            \"Gamma\", \"Generalised Gamma\"),\n  AIC = c(AIC(exp_PH), AIC(wei_AFT), AIC(llog_AFT), AIC(ln_AFT),\n          AIC(g_AFT), AIC(gg_AFT))\n)\n# Sort by AIC (lowest is best)\naic_table &lt;- aic_table[order(aic_table$AIC), ]\nprint(aic_table)\n\n\n              Model      AIC\n5             Gamma 218.8834\n2           Weibull 219.1590\n4        Log-Normal 219.4092\n6 Generalised Gamma 220.7790\n1       Exponential 221.0481\n3      Log-Logistic 221.3228\n\n\nBased on AIC, the standard gamma model actually comes on top before Weibull, although the differences in AICs are very small.\nWe could also use BIC:\n\\(BIC = -2\\log(L) + k \\cdot \\ln(n)\\)\nwhich uses a stricter penalty (whenever log(n) &gt; 2, which happens once n &gt; 7) and is less likely to ‘overfit’ by adding unnecessary parameters. This would only affect the ordering of models with different number of parameters (i.e., exponential and generalised gamm), not the models with the same number of parameters:\n\n\nShow R code\nbic_table &lt;- data.frame(\n  Model = c(\"Exponential\", \"Weibull\", \"Log-Logistic\", \"Log-Normal\",\n            \"Gamma\", \"Generalised Gamma\"),\n  BIC = c(BIC(exp_PH), BIC(wei_AFT), BIC(llog_AFT), BIC(ln_AFT),\n          BIC(g_AFT), BIC(gg_AFT))\n)\n# Sort by BIC (lowest is best)\nbic_table &lt;- bic_table[order(bic_table$BIC), ]\nprint(bic_table)\n\n\n              Model      BIC\n5             Gamma 224.0964\n2           Weibull 224.3720\n1       Exponential 224.5234\n4        Log-Normal 224.6223\n3      Log-Logistic 226.5358\n6 Generalised Gamma 227.7297",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "3 Parametric survival models"
    ]
  },
  {
    "objectID": "OverviewD1.html",
    "href": "OverviewD1.html",
    "title": "Day 1",
    "section": "",
    "text": "Welcome to Day 1 of the Advanced Survival Concepts and Analysis short course for 2026.\nIn today’s topics we will learn about:\n- Cox model when PH assumption is violated\n- Joint modelling with survival data\n- Parametric survival modelling\n- Flexible parametric survival modelling (first lecture)\nWe will cover the theorectical concepts and practical applications. You will also have take-home exercises to practise the concepts on data in your own time and at your own pace.\nWe have additional optional reading for non-linear Cox models.",
    "crumbs": [
      "Day 1: Joint & parametric modelling"
    ]
  },
  {
    "objectID": "OverviewD1.html#todays-topics",
    "href": "OverviewD1.html#todays-topics",
    "title": "Day 1",
    "section": "",
    "text": "Welcome to Day 1 of the Advanced Survival Concepts and Analysis short course for 2026.\nIn today’s topics we will learn about:\n- Cox model when PH assumption is violated\n- Joint modelling with survival data\n- Parametric survival modelling\n- Flexible parametric survival modelling (first lecture)\nWe will cover the theorectical concepts and practical applications. You will also have take-home exercises to practise the concepts on data in your own time and at your own pace.\nWe have additional optional reading for non-linear Cox models.",
    "crumbs": [
      "Day 1: Joint & parametric modelling"
    ]
  },
  {
    "objectID": "OverviewD1.html#assumed-knowledge",
    "href": "OverviewD1.html#assumed-knowledge",
    "title": "Day 1",
    "section": "2 Assumed knowledge",
    "text": "2 Assumed knowledge\nWe assume a working basic knowledge of survival analysis in our short course.\nThis includes a basic understanding of:\n\nWhat makes survival data different from standard binary outcomes\nCensoring in survival analysis\nKaplan-Meier survival estimator\nCox proportional hazards modelling",
    "crumbs": [
      "Day 1: Joint & parametric modelling"
    ]
  },
  {
    "objectID": "OverviewD1.html#by-the-end-of-today",
    "href": "OverviewD1.html#by-the-end-of-today",
    "title": "Day 1",
    "section": "3 By the end of today",
    "text": "3 By the end of today\nHave a read of Day 1 wrap-up. We would expect you to have a working understanding of:\n\nRecognising when proportional hazards (PH) assumption is violated and different strategies to handle non-PH.\nWhen joint modelling would be appropriate and the two components of joint modelling\nConcepts of parametric survival modelling and selection of appropriate survival distribution\nHow flexible parametric survival models differ and how to appropriately fit these models",
    "crumbs": [
      "Day 1: Joint & parametric modelling"
    ]
  },
  {
    "objectID": "Multistate.html",
    "href": "Multistate.html",
    "title": "3 Multi-state modelling",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand the concepts of multi-state survival analysis\nConstruct a state-space that reflects a multi-state model\nUnderstand marginal and conditional multi-state parameters\nProduce Nelson-Aalen estimates for cumulative hazards\nProduce Aalen-Johansen estimates for probability in state\nRestructure data in preparation for multi-state model analysis\nApply Cox proportional hazards and flexible parametric models to estimate covariate effects on transitions",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#learning-objectives",
    "href": "Multistate.html#learning-objectives",
    "title": "3 Multi-state modelling",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand the concepts of multi-state survival analysis\nConstruct a state-space that reflects a multi-state model\nUnderstand marginal and conditional multi-state parameters\nProduce Nelson-Aalen estimates for cumulative hazards\nProduce Aalen-Johansen estimates for probability in state\nRestructure data in preparation for multi-state model analysis\nApply Cox proportional hazards and flexible parametric models to estimate covariate effects on transitions",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#basic-concepts-of-multi-state-modelling",
    "href": "Multistate.html#basic-concepts-of-multi-state-modelling",
    "title": "3 Multi-state modelling",
    "section": "2 Basic concepts of multi-state modelling",
    "text": "2 Basic concepts of multi-state modelling\nMulti-state modelling considers that patients are followed up over continuous time period, but are observed to transition to different states over the follow-up period.\nThere are different states where a subject can occupy and possible transitions between these states, represented with arrows. In the simplest form, the two state survival model, is how most survival analysis to all-cause death work. The individuals are in an alive state and then we observe their deaths, if they occur.\n\nMulti-state models can be considered an extension of competing risks model, and are often considered in analogous terms. In competing risks models, we have an initial state and several mutually exclusive absorbing states.\n\nIn multi-state models, we have intermediate states that are neither initial or absorbing.\n\nThese can also sometimes allow for recurrent events.\n\n\n\n\n\n\n\nTipPublished study examples\n\n\n\nWe refer to two published study examples that use a multi-state hazards modelling approach: Therneau, TM et al (2024) and De La Mata NL (2024).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#definitions-of-multi-state-approach",
    "href": "Multistate.html#definitions-of-multi-state-approach",
    "title": "3 Multi-state modelling",
    "section": "3 Definitions of multi-state approach",
    "text": "3 Definitions of multi-state approach\nDefining states:\n\nAbsorbing states: Subjects will never leave state h once entered (e.g. death).\nTransient states: Subjects can move from state h to state j once entered (e.g. diseased or illness), either once or multiple times.\n\nTransition times:\nWe consider where we can assume we have exact observed transition times, not where events have happened during some interval.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#how-can-we-model-multi-state-data",
    "href": "Multistate.html#how-can-we-model-multi-state-data",
    "title": "3 Multi-state modelling",
    "section": "4 How can we model multi-state data?",
    "text": "4 How can we model multi-state data?\nNon-parametric approaches:\n\nNelson-Aalen estimator for cumulative hazard\nAalen-Johansen estimator for state occupation probability\n\nModelling ‘cause-specific’ hazards:\n\nCox proportional ‘cause-specific’ hazards model\nFlexible parametric ‘cause-specific’ hazards model\n\n\n\n\n\n\n\nWarningAbout Markov multi-state modelling\n\n\n\nWe won’t explicitly cover content on Markov multi-state modelling approach, but we will briefly outline instances where they differ.\nIn general, Markov models are useful in multi-state modelling when exact transition times aren’t known. The Markov assumption is “future states depend solely on the current state, not on sequence of events that preceded it”, i.e. it is memoryless.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#nelson-aalen-estimator",
    "href": "Multistate.html#nelson-aalen-estimator",
    "title": "3 Multi-state modelling",
    "section": "5 Nelson-Aalen estimator",
    "text": "5 Nelson-Aalen estimator\nThis is a non-parametric approach to estimate cumulative transition hazard, the total cumulative risk of state h at time t.\nIf we observe \\(l \\rightarrow j\\) transitions at \\(t\\) (i.e. \\(\\Delta N_{lj} (t)&gt;0\\)), we estimate this conditional transition probability as the ratio of the number \\(\\Delta N_{lj} (t)\\) of \\(l \\rightarrow j\\) transitions divided by the the number \\(Y_l (t)\\) at risk just prior to transition time \\(t\\). Summing over these increments yields the Nelson-Aalen estimators:\n\\[\n\\hat{A}_{lj} (t) = \\sum_{s \\leq t} \\frac {\\Delta N_{lj} (s)} {Y_l (s)}, l \\neq j\n\\]",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#aalen-johansen-estimator",
    "href": "Multistate.html#aalen-johansen-estimator",
    "title": "3 Multi-state modelling",
    "section": "6 Aalen-Johansen estimator",
    "text": "6 Aalen-Johansen estimator\nThis is a non-parametric approach to estimate state occupation probability, the probability (risk) of being in state \\(h\\) at time \\(t\\). It is a matrix version of the Kaplan-Meier estimator.\nFor each unique time where an event occurs, form the transition matrix \\(T(t)\\) with elements or rates \\(\\lambda\\_{ij} (t)\\) = the fraction of subjects who transition from state \\(i\\) to \\(j\\) at time \\(t\\), among those in state \\(i\\) just prior to time \\(t\\). Then:\n\\[\np(t) = p(0) \\prod_{s \\leq t} T(s)\n\\]\nWhere \\(p(0)\\) is the initial distribution of subjects.\n\n\n\n\n\n\nNote\n\n\n\nThe area under the curve for the Aalen-Johansen estimator produces the mean sojourn time in state.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#transition-intensities",
    "href": "Multistate.html#transition-intensities",
    "title": "3 Multi-state modelling",
    "section": "7 Transition intensities",
    "text": "7 Transition intensities\nThese describe the instantaneous risks of transitions betweeen the states (akin to hazard).\nConsider \\(l \\rightarrow j\\) transition hazard, where \\(\\beta_{lj}\\) is a \\(1 \\times p\\) vector of regression coefficients, \\(Z_{i}\\) is a \\(p \\times 1\\) vector of covariates for individual \\(i\\), and \\(\\alpha_{lj;0}(t)\\) is an unspecified, non-negative baseline hazard function.\n\\[\n\\alpha_{lj;i}(t; Z_{i}) = \\alpha_{lj;0}(t) \\cdot exp(\\beta_{lj}\\cdot Z_{i}), l,j\\in \\{ 0,1,2,...,J\\}, l \\neq j, i=1,...n\n\\]\n\n\n\n\n\n\nNoteImportant note\n\n\n\n\nDepends on time t since time origin and on baseline (i.e. time fixed covariates)\nHazard does not necessary depend on time at which entering current state (i.e. it does not consider the time spent in prior state)\nAssumes common baseline hazard for each transition, regardless of how many times they entered this state before",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#marginal-parameters",
    "href": "Multistate.html#marginal-parameters",
    "title": "3 Multi-state modelling",
    "section": "8 Marginal parameters",
    "text": "8 Marginal parameters\nWe have provided here definitions of marginal parameters relevant to multi-state modelling that may be of interest.\nMarginal parameters express: You place yourself at time \\(0\\) and ask questions about aspects of the multi-state process \\(V(\\cdot)\\) at a later time point \\(t\\) (without consideration of what may happen between \\(0\\) and \\(t\\)).\n\nState occupation probability: The probability (risk) of being in state \\(h\\) at time \\(t\\).\nRestricted mean: The expected time spent in state \\(h\\) being time \\(t\\).\nDistribution of time \\(T_h\\) to (first) entry into state \\(h\\) (relevant if everyone starts at time \\(0\\) in the same state \\(0\\)).\nExpected number of events before time t: relevant for recurrent events process \\(N(\\cdot)\\), counting the number of events over time.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#conditional-parameters",
    "href": "Multistate.html#conditional-parameters",
    "title": "3 Multi-state modelling",
    "section": "9 Conditional parameters",
    "text": "9 Conditional parameters\nWe have provided here definitions of conditional parameters relevant to multi-state modelling that may be of interest.\nConditional parameters for multi-state process \\(V(\\cdot)\\) quantify, at time \\(t\\), the future development of the process conditionally on the past of the process before time \\(t\\).\n\nTransition intensities: \\(\\alpha_{lj}(t)\\) gives the probability per time unit of moving to state \\(j\\) right after time \\(t\\) given that you are in state \\(l\\) at \\(t\\) and may consider the past up to \\(t\\).\nTransition probabilities: \\(P_{lj}(s,t)\\) gives the probability of being in state \\(j\\) at time \\(t\\), given that you were in state \\(l\\) at an earlier time point \\(s\\) and given the past history of \\(V(\\cdot)\\) up to that earlier time point (also defined if \\(l\\) and \\(j\\) are the same state).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#model-considerations",
    "href": "Multistate.html#model-considerations",
    "title": "3 Multi-state modelling",
    "section": "10 Model considerations",
    "text": "10 Model considerations\nThere are general considerations when constructing the multi-state model.\n\nClinically relevant model versus availability of data to reflect these.\nToo few data for transitions may cause convergence issues.\nMeasure of time: origin or study entry, or age or calendar year.\n\n\n\nClock forward versus clock reset. What this means for interpretation of your model?",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#worked-example-colon-cancer",
    "href": "Multistate.html#worked-example-colon-cancer",
    "title": "3 Multi-state modelling",
    "section": "11 Worked example: Colon cancer",
    "text": "11 Worked example: Colon cancer\n\n11.1 Data set up\nLet’s start with loading the packages and data\n\n\nShow R code\n#Load packages\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(survival)\nlibrary(mstate)\nlibrary(flexsurv)\nlibrary(mvna)\n\n#Load colon cancer data\ncolon &lt;- survival::colon\n\n\nBelow is the list of variables.\nid: id\nstudy: 1 for all patients\nrx: Treatment - Obs(ervation), Lev(amisole), Lev(amisole)+5-FU\nsex: 1=male\nage: in years\nobstruct: obstruction of colon by tumour\nperfor: perforation of colon\nadhere: adherence to nearby organs\nnodes: number of lymph nodes with detectable cancer\ntime: days until event or censoring status: censoring status\ndiffer: differentiation of tumour (1=well, 2=moderate, 3=poor)\nextent: Extent of local spread (1=submucosa, 2=muscle, 3=serosa, 4=contiguous structures)\nsurg: time from surgery to registration (0=short, 1=long)\nnode4: more than 4 positive lymph nodes\netype: event type: 1=recurrence, 2=death\nWe will have a quick look at how the data is set up.\n\n\nShow R code\n#View first ten rows of data\nprint(colon[1:10,])\n\n\n   id study      rx sex age obstruct perfor adhere nodes status differ extent\n1   1     1 Lev+5FU   1  43        0      0      0     5      1      2      3\n2   1     1 Lev+5FU   1  43        0      0      0     5      1      2      3\n3   2     1 Lev+5FU   1  63        0      0      0     1      0      2      3\n4   2     1 Lev+5FU   1  63        0      0      0     1      0      2      3\n5   3     1     Obs   0  71        0      0      1     7      1      2      2\n6   3     1     Obs   0  71        0      0      1     7      1      2      2\n7   4     1 Lev+5FU   0  66        1      0      0     6      1      2      3\n8   4     1 Lev+5FU   0  66        1      0      0     6      1      2      3\n9   5     1     Obs   1  69        0      0      0    22      1      2      3\n10  5     1     Obs   1  69        0      0      0    22      1      2      3\n   surg node4 time etype\n1     0     1 1521     2\n2     0     1  968     1\n3     0     0 3087     2\n4     0     0 3087     1\n5     0     1  963     2\n6     0     1  542     1\n7     1     1  293     2\n8     1     1  245     1\n9     1     1  659     2\n10    1     1  523     1\n\n\nMostly importantly, we see that id defines each individual, time is given in days and etype defines the states of interest.\nCreate state space figure\nSome initial data checks should be performed to ensure the times are expected and align with our proposed state space, defined below\n\n\nShow R code\n#State space figure\nstates &lt;- c(\"Disease-free\\n(929)\", \"Recurrence\", \"Death\")\nsmat &lt;- matrix(0, 3, 3, dimnames=list(from=states, to=states))\nsmat[1, 2:3] &lt;- 1; smat[2, 3] &lt;- 1\nsmat\n\n\n                     to\nfrom                  Disease-free\\n(929) Recurrence Death\n  Disease-free\\n(929)                   0          1     1\n  Recurrence                            0          0     1\n  Death                                 0          0     0\n\n\nShow R code\n#smat is a matrix with a 1 for any valid transition, 0 otherwise\n#| fig-width: 2\n#| fig-height: 3\nstatefig(1:2, smat)\n\n# Add numbers to arrows manually\ntext(x = 0.5, y = 0.68, labels = \"468\")\ntext(x = 0.5, y = 0.3, labels = \"38\")\ntext(x = 0.8, y = 0.5, labels = \"414\")\n\n\n\n\n\n\n\n\n\nCheck for tied times\nWe will now check that there are not times are not tied and, if so, fix the times tied so recurrence occur prior to death.\n\n\nShow R code\n#Divide the data into the two states\nc1 &lt;- subset(colon, etype== 1) # recurrence\nc2 &lt;- subset(colon, etype== 2) # death\n\n#Check for tied times\ntied.id &lt;- (c1$time == c2$time & c1$status==1 & c2$status==1)\ntable(tied.id)\n\n\ntied.id\nFALSE  TRUE \n  924     5 \n\n\nShow R code\n# There are 5 subjects with recurrence coded on the same day as death.\n# Make them recur one day earlier than their death (avoid 0 length intervals)\nc1$time[tied.id] &lt;- c1$time[tied.id] -1\n\n\n\n\n\n\n\n\nTipHint\n\n\n\nOther important data checks for time include checking preceding and proceeding states (e.g. death is always the state with the maximum time), deciding order of events when tied times, and censoring event times.\n\n\nCreate a dataset that consecutive times, running from time1 to time2, and state variable indicating which event occured.\n\n\nShow R code\n# Create the counting process dataset\ncdata &lt;- tmerge(subset(c2, ,-c(study, time, status, etype)),\nc2, id=id, death= event(time, status),\noptions=list(tstart=\"time1\", tstop=\"time2\"))\ncdata &lt;- tmerge(cdata, c1, id= id, recur= event(time, status),\ntd.recur = tdc(time))\n\n#Check transitions\ntable(cdata$recur, cdata$death)\n\n\n   \n      0   1\n  0 475 452\n  1 468   0\n\n\nShow R code\n# The table above verifies no tied event times\n# Make the state variable\ncdata$state &lt;- with(cdata, factor(recur+ 2*death, 0:2,\nc(\"censor\", \"recur\", \"death\")))\n\n\nWe then proceed with re-adjusting the variables included to prepare for modelling, including the time variable from days to years.\n\n\nShow R code\n# Create some simple variables\ncdata$age10 &lt;- cdata$age/10 # age in decades\ncdata$male &lt;- 1*(cdata$sex ==1) # 0/1: male\ncdata$trt &lt;- 1*(cdata$rx == \"Lev+5FU\")\n# a 0/1 treatment variable, 1=Lev+5FU, 0= Observation or Lev\n# Output in years gives simpler plots\ncdata$time1 &lt;- cdata$time1/365.25\ncdata$time2 &lt;- cdata$time2/365.25\n\n\nWe can check the time1, time2 and state variables are working as we expected.\n\n\nShow R code\n# Check for consistency\ncheck &lt;-survcheck(Surv(time1, time2, state) ~ 1, cdata, id=id)\ncheck\n\n\nCall:\nsurvcheck(formula = Surv(time1, time2, state) ~ 1, data = cdata, \n    id = id)\n\nUnique identifiers       Observations        Transitions \n               929               1395                920 \n\nTransitions table:\n       to\nfrom    recur death (censored)\n  (s0)    468    38        423\n  recur     0   414         52\n  death     0     0          0\n\nNumber of subjects with 0, 1, ... transitions to each state:\n       count\nstate     0   1   2\n  recur 461 468   0\n  death 477 452   0\n  (any) 423  92 414\n\n\n\n\n11.2 Nelson-Aalen estimates\nNow our data is ready to produce some estimates. Let’s start with Nelson-Aalen.\n\n\nShow R code\n# Matrix of logical giving the possible transitions\ntra &lt;- matrix(ncol=3,nrow=3,FALSE)\ntra[1, 2:3] &lt;- TRUE\ntra[2, 3] &lt;- TRUE\n\n#Select & prepare relevant data\ncdata_na &lt;- cdata %&gt;% select(id, time1, time2, state) %&gt;% \n  group_by(id) %&gt;% \n  mutate(seq=row_number()) %&gt;%  ungroup() %&gt;% \n  mutate(\n  from = factor(case_when(\n    time1 == 0 ~ \"entry\",\n    seq == 2 ~ \"recur\"), levels = c(\"entry\", \"recur\")),\n  to = factor(case_when(\n    state==\"recur\" ~ \"recur\",\n    state==\"death\" ~ \"death\",\n    state==\"censor\" ~ \"cens\"\n  ), levels = c(\"recur\", \"death\", \"cens\")\n), time = time2) %&gt;% \n  select(-seq, -state, -time1, -time2)\n\n#Nelson-Aalen estimates\nna &lt;- mvna(cdata_na, c(\"entry\", \"recur\", \"death\"), tra, \"cens\")\nna\n\n\nTransition entry -&gt; recur \n   na var.aalen var.greenwood time\n 0.00         0             0 0.00\n 0.36         0             0 1.36\n 0.60         0             0 3.24\n 0.71         0             0 6.05\n 0.72         0             0 7.12\n 0.73         0             0 9.10\n\nTransition entry -&gt; death \n   na var.aalen var.greenwood time\n 0.00         0             0 0.00\n 0.01         0             0 1.36\n 0.03         0             0 3.24\n 0.06         0             0 6.05\n 0.08         0             0 7.12\n 0.11         0             0 9.10\n\nTransition recur -&gt; death \n   na var.aalen var.greenwood time\n 0.00      0.00          0.00 0.02\n 1.35      0.06          0.05 1.36\n 2.59      0.07          0.06 3.19\n 3.84      0.09          0.08 6.03\n 4.10      0.10          0.09 7.09\n 4.64      0.22          0.18 8.74\n\n\nShow R code\n#Graph settings\nmycolor &lt;- c(\"#440154FF\",\"#32648EFF\",\"#21908CFF\",\"#5DC863FF\",\"#DCE318FF\",\"#FFFFFF\")\nopar &lt;- par(no.readonly = TRUE)\n\n#Cumulative hazard - days since enrolment\n#| fig-width: 2\n#| fig-height: 3\nplot(na, lwd=2, col=mycolor[c(2,4, 1)],\nxlab=\"Days since enrolment\", ylab=\"Cumulative hazard\")\n\n\n\n\n\n\n\n\n\nShow R code\n#Convert time to years\ncdata_na$time &lt;- cdata_na$time/365.25\n\n#Nelson-Aalen estimates\nna &lt;- mvna(cdata_na, c(\"entry\", \"recur\", \"death\"), tra, \"cens\")\nna\n\n\nTransition entry -&gt; recur \n   na var.aalen var.greenwood time\n 0.00         0             0 0.00\n 0.36         0             0 0.00\n 0.60         0             0 0.01\n 0.71         0             0 0.02\n 0.72         0             0 0.02\n 0.73         0             0 0.02\n\nTransition entry -&gt; death \n   na var.aalen var.greenwood time\n 0.00         0             0 0.00\n 0.01         0             0 0.00\n 0.03         0             0 0.01\n 0.06         0             0 0.02\n 0.08         0             0 0.02\n 0.11         0             0 0.02\n\nTransition recur -&gt; death \n   na var.aalen var.greenwood time\n 0.00      0.00          0.00 0.00\n 1.35      0.06          0.05 0.00\n 2.59      0.07          0.06 0.01\n 3.84      0.09          0.08 0.02\n 4.10      0.10          0.09 0.02\n 4.64      0.22          0.18 0.02\n\n\nShow R code\n#Cumulative hazard - days since enrolment\n#| fig-width: 2\n#| fig-height: 3\nplot(na, lwd=2, col=mycolor[c(2,4, 1)],\nxlab=\"Years since enrolment\", ylab=\"Cumulative hazard\")\n\n\n\n\n\n\n\n\n\nThe cumulative hazard rapidly increases for the transition from recurrence to death, at a much greater rate than from entry to death, and consistently increasing over time. For the transition from entry to recurrence, we see an initial increase which subsequently plateaus.\n\n\n11.3 Aalen-Johansen estimates\nLet’s move on to produce Aalen-Johansen estimates.\n\n\nShow R code\n#Aalen-Johansen estimates\naj0 &lt;- survfit(Surv(time1, time2, state) ~1, data=cdata, id=id) # overall\naj0\n\n\nCall: survfit(formula = Surv(time1, time2, state) ~ 1, data = cdata, \n    id = id)\n\n         n nevent     rmean se(rmean)*\n(s0)  1395      0 4.9873049 0.12778638\nrecur 1395    468 0.8335835 0.05280062\ndeath 1395    452 3.2934169 0.11519825\n   *restricted mean time in state (max time = 9.114305 )\n\n\nShow R code\naj1 &lt;- survfit(Surv(time1, time2, state) ~ trt, data=cdata, id=id) # by arm\naj1\n\n\nCall: survfit(formula = Surv(time1, time2, state) ~ trt, data = cdata, \n    id = id)\n\n               n nevent     rmean se(rmean)*\ntrt=0, (s0)  972      0 4.5660978 0.15531180\ntrt=1, (s0)  423      0 5.8438504 0.21605777\ntrt=0, recur 972    349 0.9779533 0.06823020\ntrt=1, recur 423    119 0.5424381 0.07543991\ntrt=0, death 972    329 3.5702541 0.14090922\ntrt=1, death 423    123 2.7280167 0.19469518\n   *restricted mean time in state (max time = 9.114305 )\n\n\nShow R code\n#Graph settings\nmycolor &lt;- c(\"#440154FF\",\"#32648EFF\",\"#21908CFF\",\"#5DC863FF\",\"#DCE318FF\",\"#FFFFFF\")\nopar &lt;- par(no.readonly = TRUE)\n\n#Probability in state graphs - overall\n#| fig-width: 2\n#| fig-height: 3\nplot(aj0, noplot=NULL, lwd=2, col=mycolor[c(2,4, 1)],\nxlab=\"Years since enrollment\", ylab=\"Probability in state\")\n# the noplot=NULL option results in s(0) line being plotted\nlegend(4, 1, c(\"Alive w/o recurrence\", \"Recurrence\", \"Death\"), lwd=2,\ncol=mycolor[c(2, 4, 1)], bty='n')\n\n\n\n\n\n\n\n\n\nShow R code\n#Probability in state graphs - by treatment\n#| fig-width: 2\n#| fig-height: 3\nplot(aj1, noplot=NULL, lwd=2, lty=1:2, col=mycolor[c(2,2,4,4,1,1)],\nxlab=\"Years since enrollment\", ylab=\"Probability in state\")\nlegend(4.5, 1, c(\"Alive, control\", \"Alive, 5FU+Lev\",  \"Recurrence, Control\", \"Recurrence, 5FU+Lev\",\n\"Death, Control\", \"Death, 5FU+Lev\"),\nlwd=2, lty=1:2, col=mycolor[c(2,2,4,4,1,1)], bty='n')\n\n\n\n\n\n\n\n\n\nThe estimated probability in state conincides with patterns we saw in the cumulative hazard. Probability for death increases over time, resulting in lower probability of being alive without recurrence. Further, we see the probability of recurrence peaks in the first two years (where the cumulative hazard rapidly increases), before reducing over time.\nProducing the expected time in state also can call upon these output from survfit(). We can also add more covariates to see how the expected mean time changes.\n\n\nShow R code\n#Expected time in state\nprint(aj1, rmean= 8, digits=2) #print sojourn time restricted to 8 years\n\n\nCall: survfit(formula = Surv(time1, time2, state) ~ trt, data = cdata, \n    id = id)\n\n               n nevent rmean se(rmean)*\ntrt=0, (s0)  972      0  4.15      0.133\ntrt=1, (s0)  423      0  5.24      0.186\ntrt=0, recur 972    349  0.93      0.059\ntrt=1, recur 423    119  0.52      0.066\ntrt=0, death 972    329  2.92      0.118\ntrt=1, death 423    123  2.24      0.165\n   *restricted mean time in state (max time = 8 )\n\n\nShow R code\n#Adjusted AJ for expected times\naj2 &lt;- survfit(Surv(time1, time2, state) ~ trt+male, data=cdata, id=id) # by arm\naj2\n\n\nCall: survfit(formula = Surv(time1, time2, state) ~ trt + male, data = cdata, \n    id = id)\n\n                       n nevent     rmean se(rmean)*\ntrt=0, male=0, (s0)  436      0 4.7028792 0.23348248\ntrt=0, male=1, (s0)  536      0 4.4235985 0.20062003\ntrt=1, male=0, (s0)  237      0 5.3133965 0.30250975\ntrt=1, male=1, (s0)  186      0 6.4438228 0.30058240\ntrt=0, male=0, recur 436    155 1.0909907 0.10914506\ntrt=0, male=1, recur 536    194 0.9180868 0.08140726\ntrt=1, male=0, recur 237     74 0.6748420 0.11564951\ntrt=1, male=1, recur 186     45 0.3881854 0.07285675\ntrt=0, male=0, death 436    140 3.3204354 0.20731102\ntrt=0, male=1, death 536    189 3.7726200 0.18362128\ntrt=1, male=0, death 237     75 3.1260668 0.27477660\ntrt=1, male=1, death 186     48 2.2822971 0.26726999\n   *restricted mean time in state (max time = 9.114305 )\n\n\nShow R code\n#Print expected times\nprint(aj2, rmean= 8, digits=2) #print sojourn time restricted to 8 years\n\n\nCall: survfit(formula = Surv(time1, time2, state) ~ trt + male, data = cdata, \n    id = id)\n\n                       n nevent rmean se(rmean)*\ntrt=0, male=0, (s0)  436      0  4.24      0.202\ntrt=0, male=1, (s0)  536      0  4.07      0.177\ntrt=1, male=0, (s0)  237      0  4.76      0.263\ntrt=1, male=1, (s0)  186      0  5.79      0.256\ntrt=0, male=0, recur 436    155  1.01      0.095\ntrt=0, male=1, recur 536    194  0.87      0.074\ntrt=1, male=0, recur 237     74  0.63      0.102\ntrt=1, male=1, recur 186     45  0.39      0.073\ntrt=0, male=0, death 436    140  2.75      0.176\ntrt=0, male=1, death 536    189  3.06      0.160\ntrt=1, male=0, death 237     75  2.61      0.236\ntrt=1, male=1, death 186     48  1.82      0.223\n   *restricted mean time in state (max time = 8 )\n\n\nWe see that rmean adds up to 8 for each stratum created. However, it can becomes problematic to calculate expected mean times in state using Aalen-Johansen if you’d like to adjust for many other factors. The covariates function as stratum, and so begin to split the data and events quite rapidly. We also don’t have the functionality to create a new dataframe to predict upon when using Aalen-Johansen (we will see how we can do this using Cox or flexible parametric).\n\n\n11.4 Cox proportional ‘cause specific’ hazards model\nNow, let’s fit a multistate hazards model (i.e. Cox proportional hazards).\n\n\nShow R code\n# fit the model\ncfit &lt;- coxph(Surv(time1, time2, state) ~ trt +age10 + male + extent + node4,\ndata=cdata, id=id)\nprint(cfit, digits=2)\n\n\nCall:\ncoxph(formula = Surv(time1, time2, state) ~ trt + age10 + male + \n    extent + node4, data = cdata, id = id)\n\n        \n1:2        coef exp(coef) se(coef) robust se    z      p\n  trt    -0.507     0.602    0.106     0.108 -4.7  3e-06\n  age10  -0.032     0.969    0.039     0.042 -0.8    0.5\n  male   -0.089     0.915    0.093     0.095 -0.9    0.3\n  extent  0.532     1.703    0.113     0.122  4.4  1e-05\n  node4   0.835     2.305    0.096     0.100  8.4 &lt;2e-16\n\n        \n1:3      coef exp(coef) se(coef) robust se   z     p\n  trt    0.02      1.02     0.34      0.34 0.1   1.0\n  age10  0.88      2.40     0.20      0.19 4.6 4e-06\n  male   0.45      1.57     0.34      0.34 1.3   0.2\n  extent 0.47      1.60     0.39      0.51 0.9   0.4\n  node4  0.64      1.90     0.38      0.39 1.6   0.1\n\n        \n2:3       coef exp(coef) se(coef) robust se   z     p\n  trt    0.288     1.334    0.114     0.119 2.4  0.02\n  age10  0.105     1.111    0.040     0.044 2.4  0.02\n  male   0.196     1.216    0.101     0.094 2.1  0.04\n  extent 0.084     1.088    0.106     0.112 0.8  0.45\n  node4  0.434     1.544    0.104     0.101 4.3 2e-05\n\n States:  1= (s0), 2= recur, 3= death \n\nLikelihood ratio test=189  on 15 df, p=&lt;2e-16\nn= 1395, unique id= 929, number of events= 920 \n\n\nShow R code\nsummary(cfit)\n\n\nCall:\ncoxph(formula = Surv(time1, time2, state) ~ trt + age10 + male + \n    extent + node4, data = cdata, id = id)\n\n  n= 1395, number of events= 920 \n\n               coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)    \ntrt_1:2    -0.50732   0.60211  0.10645   0.10788 -4.703 2.57e-06 ***\nage10_1:2  -0.03171   0.96879  0.03902   0.04199 -0.755   0.4502    \nmale_1:2   -0.08858   0.91523  0.09271   0.09454 -0.937   0.3488    \nextent_1:2  0.53249   1.70316  0.11332   0.12223  4.356 1.32e-05 ***\nnode4_1:2   0.83503   2.30489  0.09614   0.09975  8.371  &lt; 2e-16 ***\ntrt_1:3     0.02025   1.02046  0.33595   0.33520  0.060   0.9518    \nage10_1:3   0.87475   2.39829  0.19574   0.19049  4.592 4.39e-06 ***\nmale_1:3    0.45226   1.57186  0.33650   0.34432  1.313   0.1890    \nextent_1:3  0.46911   1.59858  0.38750   0.50819  0.923   0.3559    \nnode4_1:3   0.64311   1.90238  0.37459   0.39068  1.646   0.0997 .  \ntrt_2:3     0.28841   1.33431  0.11431   0.11860  2.432   0.0150 *  \nage10_2:3   0.10482   1.11051  0.03995   0.04354  2.407   0.0161 *  \nmale_2:3    0.19550   1.21592  0.10079   0.09393  2.081   0.0374 *  \nextent_2:3  0.08431   1.08797  0.10604   0.11154  0.756   0.4497    \nnode4_2:3   0.43444   1.54409  0.10423   0.10092  4.305 1.67e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\ntrt_1:2       0.6021     1.6608    0.4874    0.7439\nage10_1:2     0.9688     1.0322    0.8922    1.0519\nmale_1:2      0.9152     1.0926    0.7604    1.1015\nextent_1:2    1.7032     0.5871    1.3403    2.1642\nnode4_1:2     2.3049     0.4339    1.8956    2.8026\ntrt_1:3       1.0205     0.9799    0.5290    1.9684\nage10_1:3     2.3983     0.4170    1.6510    3.4837\nmale_1:3      1.5719     0.6362    0.8004    3.0867\nextent_1:3    1.5986     0.6256    0.5904    4.3282\nnode4_1:3     1.9024     0.5257    0.8846    4.0911\ntrt_2:3       1.3343     0.7495    1.0575    1.6835\nage10_2:3     1.1105     0.9005    1.0197    1.2094\nmale_2:3      1.2159     0.8224    1.0115    1.4617\nextent_2:3    1.0880     0.9191    0.8743    1.3538\nnode4_2:3     1.5441     0.6476    1.2670    1.8818\n\nConcordance= 0.647  (se = 0.011 )\nLikelihood ratio test= 188.5  on 15 df,   p=&lt;2e-16\nWald test            = 173.9  on 15 df,   p=&lt;2e-16\nScore (logrank) test = 191.6  on 15 df,   p=&lt;2e-16,   Robust = 154.6  p=&lt;2e-16\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\n\nThe multivariate model allows us to assess the covariate effects on the transitions. For example, the treatment effect from transition 1 (Disease-free) to 2 (Recurrence) has HR estimate of 0.60 (95%CI: 0.49, 0.74) and for transition 2 (Recurrence) to 3 (Death) has HR estimate of 1.33 (95%CI: 1.06, 1.68).\nWe can create a forest plot of the HR estimates and their 95%CI.\n\n\nShow R code\n# get the HR, and lower and upper limit\ntemp &lt;- summary(cfit)$conf.int[ , c(1,3,4)]\n\n# generate the forest plot\npar(mar=c(5,7, 1, 1)) # more room for y axis labels\nyy &lt;- c(outer(5:1, c(12, 0, 6), \"+\"))\n\n#| fig-width: 2\n#| fig-height: 3\nplot(c(.5,4), range(yy), log='x', type=\"n\", xlab=\"Hazard ratio\", ylab=\"\", yaxt= 'n')\naxis(2, at=yy, label=rep(c(\"Lev+5FU\", \"Age\", \"Male\", \"Extent\", \"&gt;4 Nodes\") ,3), las=2)\npoints(temp[,1], yy, pch=19)\nsegments(temp[,2], yy, temp[,3], yy, lwd=1.5)\nabline(h=c(6,12), lwd=2, lty=2, col=mycolor[5])\nabline(v=1, lty=3)\ntext(c(2.5, 2.5, 3), c(16, 10, 5), c(\"Disease-free:Recurrence\", \"Recurrence:Death\",\n\"Disease-free:Death\"))\n\n\n\n\n\n\n\n\n\nWe can run similar checks on the Cox proportional hazards model, such as the proportionality test below.\n\n\nShow R code\n#Proportional hazards test\nph_test &lt;- cox.zph(cfit)\nph_test\n\n\n             chisq df      p\ntrt_1:2     0.0225  1 0.8806\nage10_1:2   0.2132  1 0.6443\nmale_1:2    3.2844  1 0.0699\nextent_1:2  0.4149  1 0.5195\nnode4_1:2  10.3456  1 0.0013\ntrt_1:3     0.3828  1 0.5361\nage10_1:3   0.8400  1 0.3594\nmale_1:3    0.0126  1 0.9106\nextent_1:3  0.1140  1 0.7356\nnode4_1:3   1.5076  1 0.2195\ntrt_2:3     2.6383  1 0.1043\nage10_2:3   1.4179  1 0.2337\nmale_2:3    0.1326  1 0.7157\nextent_2:3  2.5355  1 0.1113\nnode4_2:3   0.2728  1 0.6015\nGLOBAL     24.0919 15 0.0635\n\n\nWe can use this model to produce predicted probability in state and expected time in state. For this example, we have simplified the model to replicate the barplot in the paper. However, you can create your own combinations for the covariates.\n\n\nShow R code\n#Simplified model\ncfit2 &lt;- coxph(Surv(time1, time2, state) ~ trt + extent + node4, data=cdata, id=id)\n\n#Create dummy data\ndummy &lt;- expand.grid(trt=0:1, extent=1:4, node4= 0:1) # 16 combinations\n\n# Predicted probability in state from the MSH model\ncsurv2 &lt;- survfit(cfit2, newdata=dummy) # 16 predicted curves\n\n\nThe resulting csurv2 does produce probability in state from the Cox model, but this is only until the max time in the original patient dataset (cdata) and against the 16 combinations.\n\n\nShow R code\n# calculate the sojourn time and assemble it into a matrix\ntemp &lt;- summary(csurv2, rmean=8)$table[,\"rmean\"]\nsojourn &lt;- matrix(temp, 16, 3,\ndimnames=list(NULL, c(\"disease-free\", \"recurrence\", \"death\")))\nsdata &lt;- cbind(dummy, round(sojourn,2)) # add this to the dummy data frame\nsdata\n\n\n   trt extent node4 disease-free recurrence death\n1    0      1     0         6.57       0.49  0.94\n2    1      1     0         7.04       0.25  0.70\n3    0      2     0         5.75       0.70  1.55\n4    1      2     0         6.47       0.37  1.16\n5    0      3     0         4.62       0.94  2.44\n6    1      3     0         5.61       0.52  1.86\n7    0      4     0         3.26       1.16  3.58\n8    1      4     0         4.46       0.69  2.86\n9    0      1     1         5.17       0.70  2.13\n10   1      1     1         6.05       0.37  1.57\n11   0      2     1         3.89       0.89  3.22\n12   1      2     1         5.03       0.51  2.46\n13   0      3     1         2.50       1.00  4.49\n14   1      3     1         3.73       0.63  3.64\n15   0      4     1         1.36       0.99  5.64\n16   1      4     1         2.36       0.69  4.94\n\n\nWe can see for each combination of covariates in our dummy data, we have the predicted expected time in state, which adds up to 8 years across the three states. The below summarises the expected time in state into a bar plot.\n\n\nShow R code\n# plot the sojourn\nrownames(sojourn) &lt;- paste(\nrep(rep(c(\"T1\", \"T2\", \"T2\", \"T4\"), each=2),2), rep(c(\"/&lt;=4 nodes\",\"/&gt; 4 nodes\"), each=8),\nrep(c(\"/Control\", \"/Lev+5FU\"), 8))\n\n# put the controls together\nxx &lt;- rev(c(1,3,5,7,2,4,6,8))\nxx &lt;- c(xx+8, xx)\npar(mar=c(2, 11, 0.5, 0.5))\n\n#| fig-width: 2\n#| fig-height: 3\nbarplot(t(sojourn[xx,]), horiz=TRUE, col=mycolor[c(5, 1, 6)],\nlas=1)\nabline(h=c(4.9, 9.7,14.5), lwd=2, col=mycolor[3])\n\n\n\n\n\n\n\n\n\n\n\n11.5 mstate package\nWe can also use the mstate package and to produce similar non-parametric estimates (i.e. cumulative hazard and probability in state) and subsequent functionality with flexsurv and coxph.\nFirst we will create the transition matrix, which assigns a consecutive number to each of the transitions and list the element where the transition exists in each row of the matrix. This functions differently to the above, which was mostly aesthetic and to understand the data layout.\nLet’s say instead we had our dataset in a wide format, one line per individual and separate variables for time to each state and status to each state. We can reshape our c1 and c2 datasets to create this hypothetical dataset.\n\n\nShow R code\n#Wide dataset for colon\ncdata_wide &lt;- c1 %&gt;% rename(time_recur = time,\n                            status_recur = status) %&gt;% \n  select(id, time_recur, status_recur) %&gt;% \n      left_join(c2, by=\"id\") %&gt;% select(-etype) %&gt;% \n  rename(time_death = time, status_death = status)\n\n#Print data\nprint(cdata_wide[1:10,])\n\n\n   id time_recur status_recur study      rx sex age obstruct perfor adhere\n1   1        968            1     1 Lev+5FU   1  43        0      0      0\n2   2       3087            0     1 Lev+5FU   1  63        0      0      0\n3   3        542            1     1     Obs   0  71        0      0      1\n4   4        245            1     1 Lev+5FU   0  66        1      0      0\n5   5        523            1     1     Obs   1  69        0      0      0\n6   6        904            1     1 Lev+5FU   0  57        0      0      0\n7   7        229            1     1     Lev   1  77        0      0      0\n8   8       3192            0     1     Obs   1  54        0      0      0\n9   9       3173            0     1     Lev   1  46        0      0      1\n10 10       3308            0     1 Lev+5FU   0  68        0      0      0\n   nodes status_death differ extent surg node4 time_death\n1      5            1      2      3    0     1       1521\n2      1            0      2      3    0     0       3087\n3      7            1      2      2    0     1        963\n4      6            1      2      3    1     1        293\n5     22            1      2      3    1     1        659\n6      9            1      2      3    0     1       1767\n7      5            1      2      3    1     1        420\n8      1            0      2      3    0     0       3192\n9      2            0      2      3    0     0       3173\n10     1            0      2      3    1     0       3308\n\n\nWe could use msprep in the mstate package to help reshape our data into long format for a multi state analysis. We first define the transition matrix and then run the msprep.\n\n\nShow R code\n#Transition matrix\ntmat &lt;- transMat(x = list(c(2,3), c(3), c()), names=c(\"Alive\", \"Recurrence\", \"Death\"))\n\n#Check time_death and time_recur are not equal\ncdata_wide %&gt;% filter(time_recur&gt;=time_death & status_recur==1) %&gt;% print()\n\n\n   id time_recur status_recur study  rx sex age obstruct perfor adhere nodes\n1 239       2695            1     1 Obs   1  76        0      0      0     1\n2 602       1918            1     1 Lev   0  69        0      0      1    19\n  status_death differ extent surg node4 time_death\n1            0      2      3    0     0       2695\n2            0      2      3    0     1       1918\n\n\nShow R code\n#Adjust by one day so recur occurs one day earlier\ncdata_wide &lt;- cdata_wide %&gt;% \n  mutate(time_recur = case_when(\n    id %in% c(239, 602) ~ time_recur-1,\n    TRUE ~ time_recur\n  ))\n\n#Reshape using msprep\ncdata_long &lt;- msprep(data=cdata_wide, trans=tmat, time=c(NA, \"time_recur\", \"time_death\"), status=c(NA, \"status_recur\", \"status_death\"), keep=c(\"rx\", \"sex\", \"age\", \"obstruct\", \"perfor\", \"adhere\", \"nodes\", \"differ\", \"extent\", \"surg\", \"node4\"))\n\n\nLet’s now fit Cox model without any covariates, so we define a baseline hazards for each transition and then use msfit() to produce the cumulative hazards. You’ll see this equates to the Nelson-Aalen estimates of cumulative hazard produced above.\n\n\nShow R code\n#Convert time to years since enrolment\ncdata_long$Tstart &lt;- cdata_long$Tstart/365.25\ncdata_long$Tstop &lt;- cdata_long$Tstop/365.25\ncdata_long$age10 &lt;- cdata_long$age/10 # age in decades\ncdata_long$male &lt;- 1*(cdata_long$sex ==1) # 0/1: male\ncdata_long$trt &lt;- 1*(cdata_long$rx == \"Lev+5FU\")\n\n#Fit Cox model with separate baseline hazards for each transition\ncfit_mstate &lt;- coxph(Surv(Tstart, Tstop, status) ~ strata(trans),\ndata=cdata_long, id=id)\nprint(cfit_mstate, digits=2)\n\n\nCall:  coxph(formula = Surv(Tstart, Tstop, status) ~ strata(trans), \n    data = cdata_long, id = id)\n\nNull model\n  log likelihood= -5233.511 \n  n= 2326 \n\n\nShow R code\nsummary(cfit_mstate)\n\n\nCall:  coxph(formula = Surv(Tstart, Tstop, status) ~ strata(trans), \n    data = cdata_long, id = id)\n\nNull model\n  log likelihood= -5233.511 \n  n= 2326 \n\n\nShow R code\n#Cumulative hazards\nmsfit_mstate &lt;- msfit(cfit_mstate, trans=tmat)\n\n#Graph settings\nmycolor &lt;- c(\"#440154FF\",\"#32648EFF\",\"#21908CFF\",\"#5DC863FF\",\"#DCE318FF\",\"#FFFFFF\")\n\n#Plot of cumulative hazards\n#| fig-width: 2\n#| fig-height: 3\nplot(msfit_mstate, lwd=2, col=mycolor[c(2,4, 1)],\nxlab=\"Years since enrolment\", ylab=\"Cumulative hazard\")\n\n\n\n\n\n\n\n\n\nSimilarly, we can apply the probtrans() function to produce the transition probabilities. You’ll see this equates to the Aalen-Johansen estimates of probability in state produced.\n\n\nShow R code\n#Probabilities in state\npr0 &lt;- probtrans(msfit_mstate, predt = 0)\n\n#From entry to other states\npr0_from1 &lt;- pr0[[1]]\n\n#Plot of probabilities in state\n#| fig-width: 2\n#| fig-height: 3\nmatplot(pr0_from1$time, pr0_from1[, grep(\"^pstate\", names(pr0_from1))], type = \"l\", lwd=2, lty = 1, xlab = \"Years from enrolment\", ylab = \"Probability in state\", col=mycolor[c(2,4, 1)])\nlegend(4,1,\n       legend = c(\"Alive w/o recurrence\", \"Recurrence\", \"Death\"),\n       col = mycolor[c(2, 4, 1)],\n       lty = 1, lwd=2)\n\n\n\n\n\n\n\n\n\nNow, the above has fitted the transitions using the strata() option and specifying the trans produced in the msprep. Fitting trans in a stratum means the covariate effects are assumed to be common amongst the transitions. This may or may not reflect the reality or what you’d like to produce findings on. We will now describe how we can fit transition-specific covariates.\n\n\nShow R code\n#Expand covariates to fit transition-specific covariates\ncovs &lt;- c(\"trt\", \"age10\", \"male\", \"extent\", \"node4\")\ncdata_long_exp &lt;- expand.covs(cdata_long, covs, longnames=FALSE)\n\n#Fit cox model with transition specific covariates\ncfit_tspec_strata &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + trt.3 + age10.1 + age10.2 + age10.3 + male.1 + male.2 + male.3 + extent.1 + extent.2 + extent.3 + node4.1 + node4.2 + node4.3 + strata(trans),\ndata=cdata_long_exp, id=id)\nsummary(cfit_tspec_strata)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + \n    trt.3 + age10.1 + age10.2 + age10.3 + male.1 + male.2 + male.3 + \n    extent.1 + extent.2 + extent.3 + node4.1 + node4.2 + node4.3 + \n    strata(trans), data = cdata_long_exp, id = id)\n\n  n= 2326, number of events= 920 \n\n             coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)    \ntrt.1    -0.50755   0.60197  0.10645   0.10792 -4.703 2.57e-06 ***\ntrt.2     0.02025   1.02046  0.33595   0.33520  0.060   0.9518    \ntrt.3     0.28848   1.33440  0.11431   0.11873  2.430   0.0151 *  \nage10.1  -0.03166   0.96883  0.03902   0.04202 -0.754   0.4511    \nage10.2   0.87475   2.39829  0.19574   0.19049  4.592 4.39e-06 ***\nage10.3   0.10489   1.11059  0.03995   0.04358  2.407   0.0161 *  \nmale.1   -0.08880   0.91503  0.09270   0.09459 -0.939   0.3478    \nmale.2    0.45226   1.57186  0.33650   0.34432  1.313   0.1890    \nmale.3    0.19556   1.21599  0.10079   0.09401  2.080   0.0375 *  \nextent.1  0.53260   1.70336  0.11332   0.12229  4.355 1.33e-05 ***\nextent.2  0.46911   1.59858  0.38750   0.50819  0.923   0.3559    \nextent.3  0.08427   1.08793  0.10602   0.11158  0.755   0.4501    \nnode4.1   0.83555   2.30607  0.09614   0.09983  8.370  &lt; 2e-16 ***\nnode4.2   0.64311   1.90238  0.37459   0.39068  1.646   0.0997 .  \nnode4.3   0.43511   1.54513  0.10423   0.10102  4.307 1.65e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntrt.1       0.6020     1.6612    0.4872    0.7438\ntrt.2       1.0205     0.9799    0.5290    1.9684\ntrt.3       1.3344     0.7494    1.0574    1.6840\nage10.1     0.9688     1.0322    0.8922    1.0520\nage10.2     2.3983     0.4170    1.6510    3.4837\nage10.3     1.1106     0.9004    1.0197    1.2096\nmale.1      0.9150     1.0929    0.7602    1.1014\nmale.2      1.5719     0.6362    0.8004    3.0867\nmale.3      1.2160     0.8224    1.0114    1.4620\nextent.1    1.7034     0.5871    1.3403    2.1647\nextent.2    1.5986     0.6256    0.5904    4.3282\nextent.3    1.0879     0.9192    0.8742    1.3539\nnode4.1     2.3061     0.4336    1.8963    2.8044\nnode4.2     1.9024     0.5257    0.8846    4.0911\nnode4.3     1.5451     0.6472    1.2676    1.8835\n\nConcordance= 0.647  (se = 0.011 )\nLikelihood ratio test= 188.7  on 15 df,   p=&lt;2e-16\nWald test            = 173.8  on 15 df,   p=&lt;2e-16\nScore (logrank) test = 191.8  on 15 df,   p=&lt;2e-16,   Robust = 154.5  p=&lt;2e-16\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\n\nThese coefficient estimates are nearly exactly the same as produced by the coxph() above when state was specified in the Surv() function.\nFrom the output, we can produce the cumulative hazard against covariate patterns. In this case, we focus on the treatment effect and plot these.\n\n\nShow R code\n#Newdata to predict on - ref levels\nnewdata_tspec0 &lt;- data.frame(\n  trans=1:3,\n  strata=1:3,\n  trt.1 = c(0,0,0),\n  age10.1=c(4,4,4),\n  male.1=c(0,0,0),\n  extent.1 = c(0,0,0),\n  node4.1 = c(0,0,0),\n  trt.2 = c(0,0,0),\n  age10.2=c(4,4,4),\n  male.2=c(0,0,0),\n  extent.2 = c(0,0,0),\n  node4.2 = c(0,0,0),\n  trt.3 = c(0,0,0),\n  age10.3=c(4,4,4),\n  male.3=c(0,0,0),\n  extent.3 = c(0,0,0),\n  node4.3 = c(0,0,0))  \n  \n#Cumulative hazards - ref levels\nmsfit_tspec_trt0 &lt;- msfit(cfit_tspec_strata, trans=tmat, newdata=newdata_tspec0)\n\n#Newdata to predict on - trt effect\nnewdata_tspec1 &lt;- data.frame(\n  trans=1:3,\n  strata=1:3,\n  trt.1 = c(1,0,0),\n  age10.1=c(4,4,4),\n  male.1=c(0,0,0),\n  extent.1 = c(0,0,0),\n  node4.1 = c(0,0,0),\n  trt.2 = c(0,1,0),\n  age10.2=c(4,4,4),\n  male.2=c(0,0,0),\n  extent.2 = c(0,0,0),\n  node4.2 = c(0,0,0),\n  trt.3 = c(0,0,1),\n  age10.3=c(4,4,4),\n  male.3=c(0,0,0),\n  extent.3 = c(0,0,0),\n  node4.3 = c(0,0,0))  \n  \n#Cumulative hazards - ref levels\nmsfit_tspec_trt1 &lt;- msfit(cfit_tspec_strata, trans=tmat, newdata=newdata_tspec1)\n\n#Store data into one\ndf1 &lt;- msfit_tspec_trt0$Haz %&gt;% mutate(model = \"Control\")\ndf2 &lt;- msfit_tspec_trt1$Haz %&gt;% mutate(model = \"Treatment\")\n\ndf_all &lt;- bind_rows(df1, df2)\ndf_all &lt;- df_all %&gt;% \n  mutate(trans2 = case_when(\n    trans==1 ~ \"Alive to recur\",\n    trans==2 ~ \"Alive to death\",\n    trans==3 ~ \"Recur to death\"\n  ))\n\n#Graph settings\nmycolor &lt;- c(\"#440154FF\",\"#32648EFF\",\"#21908CFF\",\"#5DC863FF\",\"#DCE318FF\",\"#FFFFFF\")\n\n#Plot of cumulative hazards\n#| fig-width: 2\n#| fig-height: 3\nggplot(df_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_line(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nIn theory, we can also produce the probability in state from the msfit object. However, we see this is problematic in our scenario as we are warned about negatives. Checking the output, we do see negative values have occurred in the probability in state - which is not expected. This has occurred from incorrectly derived cumulative hazard, so is very problematic and may have arisen from too many parameters with too few events.\nOnce we simplify the model, we produce probability estimates without issue.\n\n\nShow R code\n#Probabilities in state\npr_trt0 &lt;- probtrans(msfit_tspec_trt0, predt = 0, variance=FALSE)\npr_trt1 &lt;- probtrans(msfit_tspec_trt1, predt = 0, variance=FALSE)\n\n#Check output for from entry to recur\npr_trt0[[1]]\n\n\n          time      pstate1       pstate2      pstate3\n1   0.00000000 1.0000000000  0.000000e+00 0.000000e+00\n2   0.02190281 0.9894768279  1.052317e-02 0.000000e+00\n3   0.02464066 0.9790553913  2.094461e-02 0.000000e+00\n4   0.05201916 0.9687307817  3.126922e-02 0.000000e+00\n5   0.05475702 0.9585059272  4.149407e-02 0.000000e+00\n6   0.06297057 0.9584806089  4.149407e-02 2.531830e-05\n7   0.06570842 0.9584552853  4.149407e-02 5.064188e-05\n8   0.07665982 0.9483152502  5.163411e-02 5.064188e-05\n9   0.09308693 0.9483152502 -7.145553e-02 1.231403e-01\n10  0.09582478 0.9382739210 -6.141420e-02 1.231403e-01\n11  0.09856263 0.9283192415 -5.145952e-02 1.231403e-01\n12  0.10403833 0.9184605359 -4.160081e-02 1.231403e-01\n13  0.10951403 0.9086841797 -3.182446e-02 1.231403e-01\n14  0.11772758 0.8989986108 -2.213889e-02 1.231403e-01\n15  0.12320329 0.8893733500 -1.253781e-02 1.231645e-01\n16  0.13415469 0.8798491065 -3.013571e-03 1.231645e-01\n17  0.14236824 0.8798491065  7.795106e-05 1.200729e-01\n18  0.15331964 0.8798253478  7.795106e-05 1.200967e-01\n19  0.16153320 0.8703816771  9.521622e-03 1.200967e-01\n20  0.16974675 0.8516494695  2.825383e-02 1.200967e-01\n21  0.17248460 0.8424729903  3.743031e-02 1.200967e-01\n22  0.18617385 0.8333838115  4.651949e-02 1.200967e-01\n23  0.19712526 0.8153753788  6.452792e-02 1.200967e-01\n24  0.21081451 0.7976921589  8.221114e-02 1.200967e-01\n25  0.21355236 0.7890127210  9.089058e-02 1.200967e-01\n26  0.21629021 0.7804166981  4.605319e-02 1.735301e-01\n27  0.21902806 0.7548024961  7.166739e-02 1.735301e-01\n28  0.23271732 0.7382027705  8.826711e-02 1.735301e-01\n29  0.23545517 0.7219016890  1.045682e-01 1.735301e-01\n30  0.24093087 0.7139175725  1.125523e-01 1.735301e-01\n31  0.24914442 0.6980789614  1.283909e-01 1.735301e-01\n32  0.25462012 0.6980789614  7.979756e-02 2.221235e-01\n33  0.25735797 0.6903138421  8.756268e-02 2.221235e-01\n34  0.26830938 0.6671858185  1.106907e-01 2.221235e-01\n35  0.27104723 0.6522211917  1.256553e-01 2.221235e-01\n36  0.27378508 0.6448976311  1.329789e-01 2.221235e-01\n37  0.27652293 0.6303649602  1.475116e-01 2.221235e-01\n38  0.27926078 0.6232352720  1.546413e-01 2.221235e-01\n39  0.28199863 0.6161796613  1.616969e-01 2.221235e-01\n40  0.28747433 0.6091961879  1.686803e-01 2.221235e-01\n41  0.29021218 0.6022770854  1.755994e-01 2.221235e-01\n42  0.29568789 0.5954198561  1.824567e-01 2.221235e-01\n43  0.29842574 0.5886155174  1.892610e-01 2.221235e-01\n44  0.30390144 0.5818825702  1.959940e-01 2.221235e-01\n45  0.30937714 0.5618572964  1.652551e-01 2.728876e-01\n46  0.31759069 0.5424256940  1.846867e-01 2.728876e-01\n47  0.32306639 0.5361567548  1.909557e-01 2.728876e-01\n48  0.32580424 0.5299492156  1.971632e-01 2.728876e-01\n49  0.33127995 0.5176468752  2.094656e-01 2.728876e-01\n50  0.33401780 0.5116233800  1.695565e-01 3.188201e-01\n51  0.34223135 0.5116233800  1.325075e-01 3.558691e-01\n52  0.34770705 0.5056557211  1.087760e-01 3.855683e-01\n53  0.35318275 0.5056557211  8.441453e-02 4.099297e-01\n54  0.35865845 0.4997518436  9.031841e-02 4.099297e-01\n55  0.36139630 0.4939103887  9.615987e-02 4.099297e-01\n56  0.36413415 0.4939103887  7.471310e-02 4.313765e-01\n57  0.36687201 0.4881278818  8.049560e-02 4.313765e-01\n58  0.37234771 0.4824044746  8.621901e-02 4.313765e-01\n59  0.37782341 0.4824044746  6.749646e-02 4.500991e-01\n60  0.38056126 0.4767352472  7.316569e-02 4.500991e-01\n61  0.38603696 0.4711215747  6.252940e-02 4.663490e-01\n62  0.39151266 0.4655683122  6.808266e-02 4.663490e-01\n63  0.39425051 0.4655683122  5.288705e-02 4.815446e-01\n64  0.39698836 0.4600744243  4.621750e-02 4.937081e-01\n65  0.39972621 0.4491796594  5.711226e-02 4.937081e-01\n66  0.40246407 0.4438485875  6.244334e-02 4.937081e-01\n67  0.41067762 0.4438485875  4.882905e-02 5.073224e-01\n68  0.42162902 0.4332831710  5.939447e-02 5.073224e-01\n69  0.42984257 0.4177628949  7.491474e-02 5.073224e-01\n70  0.43805613 0.4127585764  7.991906e-02 5.073224e-01\n71  0.44079398 0.4028492332  8.982841e-02 5.073224e-01\n72  0.44900753 0.4028492332  7.225174e-02 5.248990e-01\n73  0.45174538 0.3883103796  7.245521e-02 5.392344e-01\n74  0.45448323 0.3836302407  6.314570e-02 5.532241e-01\n75  0.45722108 0.3789993435  6.777659e-02 5.532241e-01\n76  0.45995893 0.3744192992  7.235664e-02 5.532241e-01\n77  0.46269678 0.3698924369  7.688350e-02 5.532241e-01\n78  0.46817248 0.3698924369  4.808091e-02 5.820267e-01\n79  0.47364819 0.3564473257  6.152602e-02 5.820267e-01\n80  0.47638604 0.3434218034  7.455154e-02 5.820267e-01\n81  0.47912389 0.3392236852  7.874966e-02 5.820267e-01\n82  0.48186174 0.3309041489  8.706919e-02 5.820267e-01\n83  0.49007529 0.3268400511  9.113329e-02 5.820267e-01\n84  0.49555099 0.3228219611  9.515138e-02 5.820267e-01\n85  0.50102669 0.3148738733  1.030995e-01 5.820267e-01\n86  0.50650240 0.2914452841  1.265281e-01 5.820267e-01\n87  0.50924025 0.2914452841  1.075285e-01 6.010263e-01\n88  0.51197810 0.2914452841  9.105313e-02 6.175016e-01\n89  0.51471595 0.2878041075  9.469431e-02 6.175016e-01\n90  0.51745380 0.2805895323  1.019089e-01 6.175016e-01\n91  0.52292950 0.2735423347  9.364171e-02 6.328160e-01\n92  0.53661875 0.2701017062  9.708233e-02 6.328160e-01\n93  0.54209446 0.2667007118  1.004833e-01 6.328160e-01\n94  0.54483231 0.2633373079  1.038467e-01 6.328160e-01\n95  0.55030801 0.2600138507  9.223588e-02 6.477503e-01\n96  0.55578371 0.2567265078  9.552323e-02 6.477503e-01\n97  0.55852156 0.2534772288  9.877251e-02 6.477503e-01\n98  0.56125941 0.2502604207  1.019893e-01 6.477503e-01\n99  0.56399726 0.2502604207  8.774516e-02 6.619944e-01\n100 0.56947296 0.2439000159  8.170398e-02 6.743960e-01\n101 0.58863792 0.2376860716  7.648371e-02 6.858302e-01\n102 0.59137577 0.2346520598  7.951772e-02 6.858302e-01\n103 0.59685147 0.2256309331  7.765699e-02 6.967121e-01\n104 0.59958932 0.2227238289  7.025836e-02 7.070178e-01\n105 0.60506502 0.2198464204  7.313576e-02 7.070178e-01\n106 0.60780287 0.2198464204  6.362756e-02 7.165260e-01\n107 0.61054073 0.2169984143  6.647556e-02 7.165260e-01\n108 0.61327858 0.2141852417  6.928873e-02 7.165260e-01\n109 0.61875428 0.2141852417  6.031709e-02 7.254977e-01\n110 0.62149213 0.2114052486  6.309709e-02 7.254977e-01\n111 0.62422998 0.2086583020  6.584403e-02 7.254977e-01\n112 0.62696783 0.2032228441  7.127949e-02 7.254977e-01\n113 0.62970568 0.1898744618  8.462787e-02 7.254977e-01\n114 0.63518138 0.1898744618  7.463558e-02 7.354900e-01\n115 0.64339493 0.1873627869  7.714726e-02 7.354900e-01\n116 0.64887064 0.1798910012  8.461904e-02 7.354900e-01\n117 0.65160849 0.1774909953  7.733070e-02 7.451783e-01\n118 0.65982204 0.1774909953  6.846548e-02 7.540435e-01\n119 0.66255989 0.1751203330  6.290913e-02 7.619705e-01\n120 0.66529774 0.1727796216  6.524984e-02 7.619705e-01\n121 0.67077344 0.1681453547  6.988411e-02 7.619705e-01\n122 0.67351129 0.1658826646  7.214680e-02 7.619705e-01\n123 0.67898700 0.1636439389  7.438553e-02 7.619705e-01\n124 0.68446270 0.1614339503  7.659552e-02 7.619705e-01\n125 0.68720055 0.1614339503  6.819975e-02 7.703663e-01\n126 0.68993840 0.1592512656  7.038244e-02 7.703663e-01\n127 0.69267625 0.1570946346  6.481717e-02 7.780882e-01\n128 0.69815195 0.1549614832  6.695033e-02 7.780882e-01\n129 0.70088980 0.1507419729  7.116984e-02 7.780882e-01\n130 0.70362765 0.1486851581  6.565037e-02 7.856645e-01\n131 0.70636550 0.1466472539  6.768827e-02 7.856645e-01\n132 0.70910335 0.1466472539  5.340965e-02 7.999431e-01\n133 0.71184120 0.1426134600  5.744345e-02 7.999431e-01\n134 0.71457906 0.1406474041  5.940950e-02 7.999431e-01\n135 0.71731691 0.1387051748  6.135173e-02 7.999431e-01\n136 0.72005476 0.1348675902  6.518932e-02 7.999431e-01\n137 0.72279261 0.1329986719  6.040717e-02 8.065942e-01\n138 0.73648186 0.1329986719  5.424596e-02 8.127554e-01\n139 0.74195756 0.1293035425  5.236824e-02 8.183282e-01\n140 0.74743326 0.1275006921  5.417109e-02 8.183282e-01\n141 0.75017112 0.1257201167  5.047681e-02 8.238031e-01\n142 0.75290897 0.1257201167  4.536307e-02 8.289168e-01\n143 0.75564682 0.1221971800  4.426124e-02 8.335416e-01\n144 0.76386037 0.1170432128  4.492630e-02 8.380305e-01\n145 0.76659822 0.1153918657  4.657765e-02 8.380305e-01\n146 0.77481177 0.1153918657  3.723819e-02 8.473699e-01\n147 0.78028747 0.1137618899  3.886816e-02 8.473699e-01\n148 0.78302533 0.1089252201  4.370483e-02 8.473699e-01\n149 0.79123888 0.1089252201  3.941054e-02 8.516642e-01\n150 0.79397673 0.1058170796  4.251868e-02 8.516642e-01\n151 0.79671458 0.1043044548  4.403131e-02 8.516642e-01\n152 0.80219028 0.1043044548  3.976443e-02 8.559311e-01\n153 0.80492813 0.1013158442  4.275304e-02 8.559311e-01\n154 0.81040383 0.0984008243  4.566806e-02 8.559311e-01\n155 0.82135524 0.0969812553  4.708763e-02 8.559311e-01\n156 0.82683094 0.0969812553  4.265835e-02 8.603604e-01\n157 0.82956879 0.0955754467  4.406416e-02 8.603604e-01\n158 0.83230664 0.0941890119  4.130919e-02 8.645018e-01\n159 0.84325804 0.0928186475  4.267956e-02 8.645018e-01\n160 0.85147159 0.0928186475  3.870051e-02 8.684808e-01\n161 0.85694730 0.0914666133  3.641791e-02 8.721155e-01\n162 0.85968515 0.0914666133  2.953414e-02 8.789992e-01\n163 0.86242300 0.0887910428  3.220971e-02 8.789992e-01\n164 0.86516085 0.0887910428  2.916695e-02 8.820420e-01\n165 0.88158795 0.0861846616  2.899913e-02 8.848162e-01\n166 0.88432580 0.0861846616  2.627233e-02 8.875430e-01\n167 0.88706366 0.0861846616  2.378210e-02 8.900332e-01\n168 0.88980151 0.0849160129  2.505074e-02 8.900332e-01\n169 0.89253936 0.0849130100  2.505074e-02 8.900362e-01\n170 0.89801506 0.0836604388  2.630332e-02 8.900362e-01\n171 0.90075291 0.0824253337  2.753842e-02 8.900362e-01\n172 0.90349076 0.0799881382  2.997562e-02 8.900362e-01\n173 0.90622861 0.0799881382  2.720204e-02 8.928098e-01\n174 0.91170431 0.0788033553  2.838682e-02 8.928098e-01\n175 0.91444216 0.0776323279  2.955785e-02 8.928098e-01\n176 0.91718001 0.0764749888  3.071519e-02 8.928098e-01\n177 0.91991786 0.0741904364  3.299974e-02 8.928098e-01\n178 0.92265572 0.0708543552  3.633582e-02 8.928098e-01\n179 0.93086927 0.0708518093  3.633582e-02 8.928124e-01\n180 0.93360712 0.0697841840  3.740345e-02 8.928124e-01\n181 0.93634497 0.0697841840  3.411230e-02 8.961035e-01\n182 0.93908282 0.0697841840  3.108834e-02 8.991275e-01\n183 0.94182067 0.0687296991  3.214283e-02 8.991275e-01\n184 0.95277207 0.0666437766  3.422875e-02 8.991275e-01\n185 0.95550992 0.0656291488  3.225255e-02 9.021183e-01\n186 0.96372348 0.0636237978  3.425790e-02 9.021183e-01\n187 0.96919918 0.0626502505  3.523144e-02 9.021183e-01\n188 0.97193703 0.0626479595  3.219662e-02 9.051554e-01\n189 0.97467488 0.0607256290  3.132441e-02 9.079500e-01\n190 0.98562628 0.0588581103  3.319193e-02 9.079500e-01\n191 0.99110198 0.0579511948  3.126794e-02 9.107809e-01\n192 0.99383984 0.0579511948  2.860314e-02 9.134457e-01\n193 0.99931554 0.0570550260  2.704490e-02 9.159001e-01\n194 1.00205339 0.0561708400  2.561396e-02 9.182152e-01\n195 1.01026694 0.0552983767  2.648642e-02 9.182152e-01\n196 1.01300479 0.0544375801  2.734722e-02 9.182152e-01\n197 1.01848049 0.0535874493  2.588805e-02 9.205245e-01\n198 1.02395619 0.0527456349  2.672986e-02 9.205245e-01\n199 1.02943190 0.0527456349  2.448705e-02 9.227673e-01\n200 1.03490760 0.0519141791  2.531851e-02 9.227673e-01\n201 1.03764545 0.0510933133  2.613937e-02 9.227673e-01\n202 1.04038330 0.0494730278  2.775966e-02 9.227673e-01\n203 1.04312115 0.0494730278  2.547086e-02 9.250561e-01\n204 1.04585900 0.0486872622  2.414512e-02 9.271676e-01\n205 1.05133470 0.0479129160  2.090146e-02 9.311856e-01\n206 1.05681040 0.0463823874  2.243199e-02 9.311856e-01\n207 1.06502396 0.0456397525  2.132784e-02 9.330324e-01\n208 1.06776181 0.0456397525  1.957467e-02 9.347856e-01\n209 1.07323751 0.0449080776  2.030635e-02 9.347856e-01\n210 1.07597536 0.0441875329  2.102689e-02 9.347856e-01\n211 1.08966461 0.0434771137  2.173731e-02 9.347856e-01\n212 1.09514031 0.0434771137  1.998351e-02 9.365394e-01\n213 1.09787817 0.0427757868  2.068484e-02 9.365394e-01\n214 1.10061602 0.0420848119  1.970069e-02 9.382145e-01\n215 1.10882957 0.0414039523  2.038155e-02 9.382145e-01\n216 1.11156742 0.0407335021  1.940624e-02 9.398603e-01\n217 1.11704312 0.0400730235  2.006672e-02 9.398603e-01\n218 1.11978097 0.0400730235  1.846092e-02 9.414661e-01\n219 1.12525667 0.0394210710  1.762527e-02 9.429537e-01\n220 1.13073238 0.0387787683  1.541826e-02 9.458030e-01\n221 1.13620808 0.0375116054  1.668542e-02 9.458030e-01\n222 1.14168378 0.0375116054  1.534245e-02 9.471459e-01\n223 1.14989733 0.0375116054  1.410075e-02 9.483876e-01\n224 1.15263518 0.0375101498  1.410075e-02 9.483891e-01\n225 1.15537303 0.0368931579  1.356511e-02 9.495417e-01\n226 1.17180014 0.0368931579  1.245834e-02 9.506485e-01\n227 1.17453799 0.0362858075  1.306569e-02 9.506485e-01\n228 1.17727584 0.0362858075  1.092617e-02 9.527880e-01\n229 1.18001369 0.0356864045  1.152557e-02 9.527880e-01\n230 1.18548939 0.0350963340  1.116448e-02 9.537392e-01\n231 1.18822724 0.0345152046  1.174560e-02 9.537392e-01\n232 1.19096509 0.0339425297  1.231828e-02 9.537392e-01\n233 1.19644079 0.0333775333  1.188352e-02 9.547389e-01\n234 1.19917864 0.0328205493  1.050816e-02 9.566713e-01\n235 1.20191650 0.0322707626  1.020205e-02 9.575272e-01\n236 1.20465435 0.0317282415  1.074457e-02 9.575272e-01\n237 1.20739220 0.0317282415  9.874668e-03 9.583971e-01\n238 1.21286790 0.0311940159  9.602261e-03 9.592037e-01\n239 1.21560575 0.0311940159  8.820761e-03 9.599852e-01\n240 1.22655715 0.0306676833  8.623976e-03 9.607083e-01\n241 1.22929500 0.0301497720  9.141887e-03 9.607083e-01\n242 1.24024641 0.0296401878  9.651471e-03 9.607083e-01\n243 1.24298426 0.0291369488  9.379333e-03 9.614837e-01\n244 1.25393566 0.0281433137  1.037297e-02 9.614837e-01\n245 1.25667351 0.0281433137  9.546532e-03 9.623102e-01\n246 1.25941136 0.0281433137  8.780046e-03 9.630766e-01\n247 1.26214921 0.0276620792  9.261281e-03 9.630766e-01\n248 1.26488706 0.0276620792  8.515768e-03 9.638222e-01\n249 1.27036277 0.0276620792  7.825607e-03 9.645123e-01\n250 1.27310062 0.0271883003  7.022451e-03 9.657892e-01\n251 1.27583847 0.0262549259  7.955825e-03 9.657892e-01\n252 1.28405202 0.0262549259  7.315318e-03 9.664298e-01\n253 1.29226557 0.0262549259  6.723651e-03 9.670214e-01\n254 1.29774127 0.0258032401  6.627906e-03 9.675689e-01\n255 1.30047912 0.0258032401  6.087807e-03 9.681090e-01\n256 1.30321697 0.0253582040  6.532843e-03 9.681090e-01\n257 1.31416838 0.0249197503  6.971297e-03 9.681090e-01\n258 1.31964408 0.0244877010  7.403346e-03 9.681090e-01\n259 1.32511978 0.0244877010  6.804038e-03 9.687083e-01\n260 1.32785763 0.0240611646  7.229590e-03 9.687092e-01\n261 1.33059548 0.0240601897  7.229590e-03 9.687102e-01\n262 1.33880903 0.0236397049  7.650075e-03 9.687102e-01\n263 1.34154689 0.0232262232  7.446563e-03 9.693272e-01\n264 1.34428474 0.0224097349  8.263052e-03 9.693272e-01\n265 1.34976044 0.0220145515  8.658235e-03 9.693272e-01\n266 1.35523614 0.0216257768  9.047010e-03 9.693272e-01\n267 1.35797399 0.0212432945  9.429492e-03 9.693272e-01\n268 1.36071184 0.0208669826  9.805804e-03 9.693272e-01\n269 1.36344969 0.0204969998  9.412931e-03 9.700901e-01\n270 1.36618754 0.0201330397  7.561110e-03 9.723059e-01\n271 1.37713895 0.0201330397  6.963631e-03 9.729033e-01\n272 1.37987680 0.0197750128  7.321658e-03 9.729033e-01\n273 1.38261465 0.0194227258  7.673945e-03 9.729033e-01\n274 1.38535250 0.0194227258  7.070164e-03 9.735071e-01\n275 1.39630390 0.0190754325  6.857913e-03 9.740667e-01\n276 1.39904175 0.0187340536  7.199292e-03 9.740667e-01\n277 1.40177960 0.0187340536  6.631522e-03 9.746344e-01\n278 1.40451745 0.0183981901  6.967386e-03 9.746344e-01\n279 1.42915811 0.0183981901  6.415682e-03 9.751861e-01\n280 1.43189596 0.0180678339  6.746038e-03 9.751861e-01\n281 1.43737166 0.0177423048  7.071567e-03 9.751861e-01\n282 1.44010951 0.0174221480  7.391724e-03 9.751861e-01\n283 1.44284736 0.0171074592  7.706413e-03 9.751861e-01\n284 1.44558522 0.0171074592  7.107392e-03 9.757851e-01\n285 1.44832307 0.0171074592  6.552208e-03 9.763403e-01\n286 1.45653662 0.0164880298  7.171637e-03 9.763403e-01\n287 1.46201232 0.0161888557  7.470811e-03 9.763403e-01\n288 1.46748802 0.0158946640  7.765003e-03 9.763403e-01\n289 1.47022587 0.0158946640  7.166639e-03 9.769387e-01\n290 1.47843943 0.0156055280  7.455775e-03 9.769387e-01\n291 1.48391513 0.0153211671  7.740136e-03 9.769387e-01\n292 1.48665298 0.0147613237  8.299979e-03 9.769387e-01\n293 1.49486653 0.0147613237  7.671326e-03 9.775674e-01\n294 1.49760438 0.0144912600  7.941389e-03 9.775674e-01\n295 1.50034223 0.0142250755  8.207574e-03 9.775674e-01\n296 1.50581793 0.0142250755  7.588735e-03 9.781862e-01\n297 1.51403149 0.0142250755  7.012599e-03 9.787623e-01\n298 1.51676934 0.0137011877  7.536487e-03 9.787623e-01\n299 1.51950719 0.0134482349  7.789440e-03 9.787623e-01\n300 1.53045859 0.0134482349  7.203962e-03 9.793478e-01\n301 1.53319644 0.0131995357  7.452661e-03 9.793478e-01\n302 1.53593429 0.0129550215  7.697176e-03 9.793478e-01\n303 1.54140999 0.0129550215  6.544268e-03 9.805007e-01\n304 1.54688569 0.0127141091  6.785181e-03 9.805007e-01\n305 1.55783710 0.0127141091  6.277990e-03 9.810079e-01\n306 1.56057495 0.0127141091  5.804286e-03 9.814816e-01\n307 1.56878850 0.0122391021  5.837163e-03 9.819237e-01\n308 1.57700205 0.0122391021  4.945839e-03 9.828151e-01\n309 1.57973990 0.0120098322  5.175109e-03 9.828151e-01\n310 1.58247775 0.0115585922  5.229278e-03 9.832121e-01\n311 1.58795346 0.0115585922  4.428550e-03 9.840129e-01\n312 1.59069131 0.0113406092  4.646533e-03 9.840129e-01\n313 1.59342916 0.0113406092  4.289228e-03 9.843702e-01\n314 1.59616701 0.0111258457  4.172594e-03 9.847016e-01\n315 1.60711841 0.0111258457  3.848688e-03 9.850255e-01\n316 1.61259411 0.0111258457  3.547481e-03 9.853267e-01\n317 1.61806982 0.0109148057  3.479626e-03 9.856056e-01\n318 1.62080767 0.0109148057  3.206927e-03 9.858783e-01\n319 1.62354552 0.0102921478  3.829585e-03 9.858783e-01\n320 1.62628337 0.0100958458  3.728326e-03 9.861758e-01\n321 1.62902122 0.0100958458  3.439061e-03 9.864651e-01\n322 1.63997262 0.0099026499  3.631819e-03 9.864655e-01\n323 1.64544832 0.0099026499  3.349892e-03 9.867475e-01\n324 1.64818617 0.0097127285  3.014810e-03 9.872725e-01\n325 1.65092402 0.0097127285  2.777854e-03 9.875094e-01\n326 1.65366188 0.0095262461  2.964336e-03 9.875094e-01\n327 1.66461328 0.0093432198  2.913348e-03 9.877434e-01\n328 1.66735113 0.0093432198  2.683887e-03 9.879729e-01\n329 1.67556468 0.0093432198  2.471281e-03 9.881855e-01\n330 1.67830253 0.0091630104  2.651490e-03 9.881855e-01\n331 1.68104038 0.0091630104  2.442514e-03 9.883945e-01\n332 1.68377823 0.0089856134  2.619911e-03 9.883945e-01\n333 1.68651608 0.0088109298  2.587817e-03 9.886013e-01\n334 1.68925394 0.0086394606  2.759286e-03 9.886013e-01\n335 1.70294319 0.0084709345  2.712049e-03 9.888170e-01\n336 1.71115674 0.0083055391  2.877445e-03 9.888170e-01\n337 1.71937029 0.0083051705  2.877445e-03 9.888174e-01\n338 1.72210815 0.0083051705  2.654009e-03 9.890408e-01\n339 1.73032170 0.0081421397  2.817040e-03 9.890408e-01\n340 1.74127310 0.0079820267  2.977153e-03 9.890408e-01\n341 1.74674880 0.0078248908  3.134289e-03 9.890408e-01\n342 1.75496235 0.0078248908  2.893139e-03 9.892820e-01\n343 1.75770021 0.0078248908  2.443673e-03 9.897314e-01\n344 1.76043806 0.0078248908  2.059367e-03 9.901157e-01\n345 1.77138946 0.0078248908  1.895880e-03 9.902792e-01\n346 1.77686516 0.0076705864  2.050184e-03 9.902792e-01\n347 1.78781656 0.0075191571  2.201613e-03 9.902792e-01\n348 1.79055441 0.0073701133  2.350657e-03 9.902792e-01\n349 1.79876797 0.0072237697  2.497001e-03 9.902792e-01\n350 1.80424367 0.0070801805  2.445624e-03 9.904742e-01\n351 1.81519507 0.0067976319  2.536358e-03 9.906660e-01\n352 1.81793292 0.0067976319  2.339784e-03 9.908626e-01\n353 1.82067077 0.0067973227  2.339784e-03 9.908629e-01\n354 1.82340862 0.0067973227  2.156980e-03 9.910457e-01\n355 1.82888433 0.0066607999  2.293502e-03 9.910457e-01\n356 1.83162218 0.0066607999  2.114118e-03 9.912251e-01\n357 1.83436003 0.0066607999  1.947733e-03 9.913915e-01\n358 1.83983573 0.0065267819  2.081751e-03 9.913915e-01\n359 1.84257358 0.0065267819  1.918709e-03 9.915545e-01\n360 1.84531143 0.0065267819  1.767396e-03 9.917058e-01\n361 1.84804928 0.0063949606  1.758772e-03 9.918463e-01\n362 1.85626283 0.0063949606  1.619721e-03 9.919853e-01\n363 1.86173854 0.0062652971  1.749384e-03 9.919853e-01\n364 1.86995209 0.0061380316  1.876650e-03 9.919853e-01\n365 1.87268994 0.0061380316  1.729219e-03 9.921327e-01\n366 1.87542779 0.0061380316  1.592456e-03 9.922695e-01\n367 1.87816564 0.0060132166  1.717271e-03 9.922695e-01\n368 1.88090349 0.0060132166  1.581394e-03 9.924054e-01\n369 1.89459274 0.0060132166  1.202275e-03 9.927845e-01\n370 1.89733060 0.0060132166  1.105105e-03 9.928817e-01\n371 1.90554415 0.0060132166  1.015153e-03 9.929716e-01\n372 1.90828200 0.0058907262  1.137643e-03 9.929716e-01\n373 1.91649555 0.0056493101  1.379059e-03 9.929716e-01\n374 1.91923340 0.0055329589  1.495410e-03 9.929716e-01\n375 1.92197125 0.0053042477  1.724122e-03 9.929716e-01\n376 1.93292266 0.0053042477  1.588115e-03 9.931076e-01\n377 1.93839836 0.0053042477  1.461925e-03 9.932338e-01\n378 1.94113621 0.0053042477  1.227725e-03 9.934680e-01\n379 1.94661191 0.0051943100  1.337662e-03 9.934680e-01\n380 1.94934976 0.0050865261  1.338098e-03 9.935754e-01\n381 1.96030116 0.0050865261  1.230717e-03 9.936828e-01\n382 1.96303901 0.0049808034  1.236938e-03 9.937823e-01\n383 1.96577687 0.0049808034  1.136998e-03 9.938822e-01\n384 1.97125257 0.0049808034  1.044774e-03 9.939744e-01\n385 1.97399042 0.0049808034  9.594609e-04 9.940597e-01\n386 1.97946612 0.0049808034  8.807501e-04 9.941384e-01\n387 1.98767967 0.0048770975  9.844560e-04 9.941384e-01\n388 1.99589322 0.0048770975  9.037136e-04 9.942192e-01\n389 1.99863107 0.0047753647  9.309124e-04 9.942937e-01\n390 2.00136893 0.0046755861  1.030691e-03 9.942937e-01\n391 2.01232033 0.0045777241  1.128553e-03 9.942937e-01\n392 2.01505818 0.0045777241  1.036872e-03 9.943854e-01\n393 2.02327173 0.0044814931  1.048064e-03 9.944704e-01\n394 2.03148528 0.0043869959  1.142561e-03 9.944704e-01\n395 2.03422313 0.0043869959  9.557362e-04 9.946573e-01\n396 2.04791239 0.0042943311  1.048401e-03 9.946573e-01\n397 2.05612594 0.0042034669  1.139265e-03 9.946573e-01\n398 2.05886379 0.0041144120  1.228320e-03 9.946573e-01\n399 2.06160164 0.0041144120  1.128614e-03 9.947570e-01\n400 2.06707734 0.0041144120  1.036638e-03 9.948489e-01\n401 2.07529090 0.0041144120  9.517587e-04 9.949338e-01\n402 2.07802875 0.0041144120  7.946803e-04 9.950909e-01\n403 2.08076660 0.0041144120  7.284553e-04 9.951571e-01\n404 2.08350445 0.0041144120  6.673783e-04 9.952182e-01\n405 2.09171800 0.0041144120  6.109327e-04 9.952747e-01\n406 2.09445585 0.0041144120  5.589820e-04 9.953266e-01\n407 2.09719370 0.0041144120  5.112335e-04 9.953744e-01\n408 2.10814511 0.0041144120  4.672120e-04 9.954184e-01\n409 2.11362081 0.0040268786  5.547454e-04 9.954184e-01\n410 2.11909651 0.0039410449  5.928239e-04 9.954661e-01\n411 2.12183436 0.0039410449  5.415899e-04 9.955174e-01\n412 2.17659138 0.0039410449  4.944842e-04 9.955645e-01\n413 2.18206708 0.0038568775  5.354233e-04 9.956077e-01\n414 2.19575633 0.0038568775  4.413734e-04 9.957017e-01\n415 2.19849418 0.0037743650  5.238859e-04 9.957017e-01\n416 2.20396988 0.0036934700  6.047810e-04 9.957017e-01\n417 2.20670773 0.0036934700  4.979839e-04 9.958085e-01\n418 2.22039699 0.0036934700  4.535179e-04 9.958530e-01\n419 2.26420260 0.0036142150  5.327729e-04 9.958530e-01\n420 2.26694045 0.0035365188  6.104690e-04 9.958530e-01\n421 2.27789185 0.0035365188  5.565274e-04 9.959070e-01\n422 2.28062971 0.0035365188  4.571550e-04 9.960063e-01\n423 2.28610541 0.0034603596  5.333143e-04 9.960063e-01\n424 2.29979466 0.0034603596  4.853904e-04 9.960543e-01\n425 2.31074606 0.0034601901  4.853904e-04 9.960544e-01\n426 2.31348392 0.0034600198  4.853904e-04 9.960546e-01\n427 2.31622177 0.0034600198  4.414073e-04 9.960986e-01\n428 2.32443532 0.0033851377  5.162894e-04 9.960986e-01\n429 2.32991102 0.0033117977  5.896295e-04 9.960986e-01\n430 2.33538672 0.0032399217  6.615055e-04 9.960986e-01\n431 2.33812457 0.0032399217  6.025090e-04 9.961576e-01\n432 2.34086242 0.0031695222  6.729085e-04 9.961576e-01\n433 2.34907598 0.0031695222  6.128683e-04 9.962176e-01\n434 2.36002738 0.0031695222  5.578945e-04 9.962726e-01\n435 2.36276523 0.0031695222  5.075402e-04 9.963229e-01\n436 2.38466804 0.0031005256  5.765368e-04 9.963229e-01\n437 2.39288159 0.0031005256  5.243147e-04 9.963752e-01\n438 2.39561944 0.0031005256  4.765612e-04 9.964229e-01\n439 2.41752225 0.0030328969  5.005107e-04 9.964666e-01\n440 2.42026010 0.0030327440  5.005107e-04 9.964667e-01\n441 2.42299795 0.0030327440  4.547127e-04 9.965125e-01\n442 2.42847365 0.0030325909  3.704370e-04 9.965970e-01\n443 2.43668720 0.0030325909  3.357503e-04 9.966317e-01\n444 2.43942505 0.0029659826  4.023586e-04 9.966317e-01\n445 2.46406571 0.0029005423  4.677989e-04 9.966317e-01\n446 2.46680356 0.0029005423  4.244117e-04 9.966750e-01\n447 2.46954141 0.0029005423  3.846378e-04 9.967148e-01\n448 2.47501711 0.0028362529  4.489272e-04 9.967148e-01\n449 2.47775496 0.0028362529  3.648809e-04 9.967989e-01\n450 2.48870637 0.0028362529  3.303236e-04 9.968334e-01\n451 2.49418207 0.0028362529  2.988247e-04 9.968649e-01\n452 2.49691992 0.0027732079  3.618697e-04 9.968649e-01\n453 2.50787132 0.0027732079  3.272710e-04 9.968995e-01\n454 2.51334702 0.0027112966  3.891823e-04 9.968995e-01\n455 2.52429843 0.0026507014  4.497775e-04 9.968995e-01\n456 2.52977413 0.0026507014  4.072130e-04 9.969421e-01\n457 2.54072553 0.0026507014  3.683992e-04 9.969809e-01\n458 2.54346338 0.0026507014  3.329201e-04 9.970164e-01\n459 2.54620123 0.0025913561  3.922654e-04 9.970164e-01\n460 2.54893908 0.0025332269  4.503946e-04 9.970164e-01\n461 2.55715264 0.0024762969  5.073246e-04 9.970164e-01\n462 2.56262834 0.0024205775  5.146681e-04 9.970648e-01\n463 2.56810404 0.0024204511  5.146681e-04 9.970649e-01\n464 2.57084189 0.0024204511  4.657930e-04 9.971138e-01\n465 2.57357974 0.0024204511  4.212059e-04 9.971583e-01\n466 2.57905544 0.0024204511  3.805265e-04 9.971990e-01\n467 2.58453114 0.0024204511  3.434836e-04 9.972361e-01\n468 2.59822040 0.0024204511  3.097459e-04 9.972698e-01\n469 2.60643395 0.0024204511  2.791289e-04 9.973004e-01\n470 2.62012320 0.0024204511  2.513067e-04 9.973282e-01\n471 2.62559890 0.0023658235  3.059343e-04 9.973282e-01\n472 2.62833676 0.0023123879  3.593699e-04 9.973282e-01\n473 2.63107461 0.0023123879  2.147948e-04 9.974728e-01\n474 2.63655031 0.0023123879  1.927415e-04 9.974949e-01\n475 2.64476386 0.0023123879  1.727744e-04 9.975148e-01\n476 2.65023956 0.0022600530  2.070760e-04 9.975329e-01\n477 2.65297741 0.0022600530  1.855860e-04 9.975544e-01\n478 2.66940452 0.0022087591  2.368799e-04 9.975544e-01\n479 2.67214237 0.0022087591  2.122784e-04 9.975790e-01\n480 2.67488022 0.0022087591  1.900567e-04 9.976012e-01\n481 2.69952088 0.0022087591  1.699753e-04 9.976213e-01\n482 2.71868583 0.0022087591  1.519174e-04 9.976393e-01\n483 2.72963723 0.0022087591  1.191473e-04 9.976721e-01\n484 2.77344285 0.0021585330  1.693735e-04 9.976721e-01\n485 2.78713210 0.0021585330  1.510339e-04 9.976904e-01\n486 2.79260780 0.0021093595  2.002073e-04 9.976904e-01\n487 2.79534565 0.0021093595  1.784486e-04 9.977122e-01\n488 2.79808350 0.0021093595  1.588597e-04 9.977318e-01\n489 2.80355921 0.0020611986  2.070207e-04 9.977318e-01\n490 2.80629706 0.0020140791  2.541402e-04 9.977318e-01\n491 2.80903491 0.0019679822  3.002371e-04 9.977318e-01\n492 2.81724846 0.0019228499  3.453694e-04 9.977318e-01\n493 2.82272416 0.0019228499  3.082367e-04 9.977689e-01\n494 2.82546201 0.0018786998  3.523867e-04 9.977689e-01\n495 2.83093771 0.0018786998  3.145049e-04 9.978068e-01\n496 2.83915127 0.0018355074  3.236710e-04 9.978408e-01\n497 2.85010267 0.0018355074  2.885292e-04 9.978760e-01\n498 2.85284052 0.0017932890  3.307476e-04 9.978760e-01\n499 2.86379192 0.0017932890  2.947283e-04 9.979120e-01\n500 2.86926762 0.0017932890  2.624195e-04 9.979443e-01\n501 2.88021903 0.0017519633  3.037453e-04 9.979443e-01\n502 2.88843258 0.0017519633  2.704290e-04 9.979776e-01\n503 2.89390828 0.0016709814  3.514109e-04 9.979776e-01\n504 2.90485969 0.0016709814  3.131938e-04 9.980158e-01\n505 2.92950034 0.0016709814  2.787731e-04 9.980502e-01\n506 2.95414100 0.0016709814  2.478251e-04 9.980812e-01\n507 2.95961670 0.0016322483  2.865583e-04 9.980812e-01\n508 2.96509240 0.0016322483  2.548725e-04 9.981129e-01\n509 2.98151951 0.0015943428  2.927780e-04 9.981129e-01\n510 2.98973306 0.0015943428  2.605724e-04 9.981451e-01\n511 3.01437372 0.0015943428  2.317089e-04 9.981739e-01\n512 3.01984942 0.0015942561  2.317089e-04 9.981740e-01\n513 3.02532512 0.0015942561  2.058773e-04 9.981999e-01\n514 3.02806297 0.0015569039  2.432295e-04 9.981999e-01\n515 3.03353867 0.0015203860  2.797474e-04 9.981999e-01\n516 3.04449008 0.0015203860  2.489144e-04 9.982307e-01\n517 3.04996578 0.0014845633  2.847371e-04 9.982307e-01\n518 3.05817933 0.0014845633  2.532835e-04 9.982622e-01\n519 3.07186858 0.0014495443  2.601228e-04 9.982903e-01\n520 3.09377139 0.0014153108  2.943564e-04 9.982903e-01\n521 3.10198494 0.0014153108  2.620233e-04 9.983227e-01\n522 3.10472279 0.0014153108  2.330922e-04 9.983516e-01\n523 3.10746064 0.0014153108  2.071679e-04 9.983775e-01\n524 3.11019849 0.0014153108  1.839052e-04 9.984008e-01\n525 3.11567420 0.0013818199  1.965645e-04 9.984216e-01\n526 3.11841205 0.0013818199  1.742844e-04 9.984439e-01\n527 3.12662560 0.0013490535  2.070508e-04 9.984439e-01\n528 3.13483915 0.0013490535  1.599697e-04 9.984910e-01\n529 3.15126626 0.0013490535  1.414898e-04 9.985095e-01\n530 3.15947981 0.0013490535  1.250193e-04 9.985259e-01\n531 3.17316906 0.0013170238  1.423146e-04 9.985407e-01\n532 3.17864476 0.0013170238  1.256421e-04 9.985573e-01\n533 3.19233402 0.0013170238  1.107964e-04 9.985722e-01\n534 3.22518823 0.0013170238  8.434463e-05 9.985986e-01\n535 3.23887748 0.0012856611  1.157073e-04 9.985986e-01\n536 3.24709103 0.0012856611  1.018346e-04 9.986125e-01\n537 3.26078029 0.0012856611  8.945638e-05 9.986249e-01\n538 3.26625599 0.0012856611  7.850303e-05 9.986358e-01\n539 3.27173169 0.0012856611  6.877137e-05 9.986456e-01\n540 3.27994524 0.0012855893  6.877137e-05 9.986456e-01\n541 3.28815880 0.0012855893  6.016422e-05 9.986542e-01\n542 3.30458590 0.0012855893  5.256588e-05 9.986618e-01\n543 3.31006160 0.0012855893  4.587496e-05 9.986685e-01\n544 3.31553730 0.0012548475  7.661679e-05 9.986685e-01\n545 3.31827515 0.0012548475  6.687149e-05 9.986783e-01\n546 3.32648871 0.0012548475  5.826044e-05 9.986869e-01\n547 3.32922656 0.0012548475  5.068094e-05 9.986945e-01\n548 3.33744011 0.0012548475  4.399945e-05 9.987012e-01\n549 3.36755647 0.0012548475  3.812564e-05 9.987070e-01\n550 3.37577002 0.0012247772  6.819595e-05 9.987070e-01\n551 3.38398357 0.0011953896  9.758353e-05 9.987070e-01\n552 3.38672142 0.0011953896  8.467062e-05 9.987199e-01\n553 3.41136208 0.0011953896  6.189022e-05 9.987427e-01\n554 3.42778919 0.0011953896  5.340011e-05 9.987512e-01\n555 3.45516769 0.0011953896  3.844325e-05 9.987662e-01\n556 3.48254620 0.0011953896  3.296008e-05 9.987717e-01\n557 3.48528405 0.0011953896  2.820703e-05 9.987764e-01\n558 3.48802190 0.0011666394  5.695722e-05 9.987764e-01\n559 3.49075975 0.0011385457  8.505092e-05 9.987764e-01\n560 3.49349760 0.0011385457  6.044342e-05 9.988010e-01\n561 3.49623546 0.0011109910  8.799810e-05 9.988010e-01\n562 3.50171116 0.0011109910  7.523877e-05 9.988138e-01\n563 3.53182752 0.0011109910  6.419655e-05 9.988248e-01\n564 3.54551677 0.0011109910  4.511440e-05 9.988439e-01\n565 3.55373032 0.0010839880  7.211740e-05 9.988439e-01\n566 3.56468172 0.0010839880  6.138533e-05 9.988546e-01\n567 3.57015743 0.0010839880  5.214537e-05 9.988639e-01\n568 3.57563313 0.0010839880  4.422202e-05 9.988718e-01\n569 3.59479808 0.0010839880  3.743216e-05 9.988786e-01\n570 3.59753593 0.0010839264  3.743216e-05 9.988786e-01\n571 3.62217659 0.0010574045  6.395405e-05 9.988786e-01\n572 3.62765229 0.0010574045  5.411931e-05 9.988885e-01\n573 3.63312799 0.0010574045  4.575134e-05 9.988968e-01\n574 3.63860370 0.0010314794  7.167645e-05 9.988968e-01\n575 3.70431211 0.0010061563  9.699951e-05 9.988968e-01\n576 3.73169062 0.0010060984  9.699951e-05 9.988969e-01\n577 3.73716632 0.0010060984  8.219182e-05 9.989117e-01\n578 3.76454483 0.0010060984  6.951297e-05 9.989244e-01\n579 3.79739904 0.0010060984  5.870374e-05 9.989352e-01\n580 3.80013689 0.0010060984  4.947528e-05 9.989444e-01\n581 3.83025325 0.0010060984  4.157564e-05 9.989523e-01\n582 3.84668036 0.0010060984  3.486164e-05 9.989590e-01\n583 3.89869952 0.0010060984  2.916836e-05 9.989647e-01\n584 3.92060233 0.0009812494  5.401745e-05 9.989647e-01\n585 3.92607803 0.0009812494  3.625546e-05 9.989825e-01\n586 3.93155373 0.0009568952  6.060967e-05 9.989825e-01\n587 3.93429158 0.0009568952  5.053940e-05 9.989926e-01\n588 3.93976728 0.0009568952  4.205552e-05 9.990010e-01\n589 3.95893224 0.0009330943  5.868759e-05 9.990082e-01\n590 3.96167009 0.0009330943  4.870804e-05 9.990182e-01\n591 3.98357290 0.0009098127  7.198961e-05 9.990182e-01\n592 4.01368925 0.0008870625  9.473985e-05 9.990182e-01\n593 4.02737851 0.0008647891  1.170132e-04 9.990182e-01\n594 4.03832991 0.0008430298  1.387726e-04 9.990182e-01\n595 4.05749487 0.0008430298  1.158646e-04 9.990411e-01\n596 4.07392197 0.0008217750  1.371193e-04 9.990411e-01\n597 4.09308693 0.0008217750  1.145180e-04 9.990637e-01\n598 4.13141684 0.0008217750  9.529848e-05 9.990829e-01\n599 4.13689254 0.0008217750  7.905493e-05 9.990992e-01\n600 4.16427105 0.0008217750  6.540176e-05 9.991128e-01\n601 4.18891170 0.0008217750  5.387910e-05 9.991243e-01\n602 4.20260096 0.0008010150  7.463919e-05 9.991243e-01\n603 4.21355236 0.0007806866  9.496752e-05 9.991243e-01\n604 4.21629021 0.0007806866  7.844897e-05 9.991409e-01\n605 4.23819302 0.0007806409  6.461897e-05 9.991547e-01\n606 4.24366872 0.0007805950  6.461897e-05 9.991548e-01\n607 4.24640657 0.0007606341  8.457991e-05 9.991548e-01\n608 4.27378508 0.0007411367  1.040772e-04 9.991548e-01\n609 4.28199863 0.0007220476  1.231664e-04 9.991548e-01\n610 4.29295003 0.0007220476  1.019890e-04 9.991760e-01\n611 4.35044490 0.0007034030  1.206335e-04 9.991760e-01\n612 4.39698836 0.0006669528  1.570837e-04 9.991760e-01\n613 4.39972621 0.0006669131  1.570837e-04 9.991760e-01\n614 4.43531828 0.0006669131  1.305622e-04 9.992025e-01\n615 4.48186174 0.0006669131  1.082139e-04 9.992249e-01\n616 4.50102669 0.0006495289  1.255981e-04 9.992249e-01\n617 4.50924025 0.0006325657  1.425613e-04 9.992249e-01\n618 4.52292950 0.0006325657  1.185684e-04 9.992489e-01\n619 4.53388090 0.0006325657  9.843657e-05 9.992690e-01\n620 4.56399726 0.0006160064  1.149958e-04 9.992690e-01\n621 4.56673511 0.0006160064  9.564312e-05 9.992884e-01\n622 4.57494867 0.0006160064  7.919834e-05 9.993048e-01\n623 4.59685147 0.0006160064  6.540682e-05 9.993186e-01\n624 4.61875428 0.0005998283  8.158493e-05 9.993186e-01\n625 4.63244353 0.0005998283  6.740188e-05 9.993328e-01\n626 4.67898700 0.0005998283  5.555903e-05 9.993446e-01\n627 4.71731691 0.0005840367  6.138531e-05 9.993546e-01\n628 4.77207392 0.0005686117  7.681037e-05 9.993546e-01\n629 4.77754962 0.0005686117  6.331960e-05 9.993681e-01\n630 4.78850103 0.0005535750  7.835625e-05 9.993681e-01\n631 4.79671458 0.0005535750  6.461631e-05 9.993818e-01\n632 4.81587953 0.0005389019  7.928943e-05 9.993818e-01\n633 4.83778234 0.0005389019  6.538330e-05 9.993957e-01\n634 4.84052019 0.0005389019  5.369288e-05 9.994074e-01\n635 4.85147159 0.0005389019  4.395351e-05 9.994171e-01\n636 4.88158795 0.0005389019  3.586942e-05 9.994252e-01\n637 4.88980151 0.0005245870  5.018432e-05 9.994252e-01\n638 4.89527721 0.0005245870  4.086821e-05 9.994345e-01\n639 4.90075291 0.0005245870  3.317976e-05 9.994422e-01\n640 4.92265572 0.0005245870  2.685554e-05 9.994486e-01\n641 4.96098563 0.0005245870  2.164614e-05 9.994538e-01\n642 4.97741273 0.0005245543  2.164614e-05 9.994538e-01\n643 5.00752909 0.0005245543  1.734572e-05 9.994581e-01\n644 5.01300479 0.0005245209  1.734572e-05 9.994581e-01\n645 5.03490760 0.0005245209  1.386404e-05 9.994616e-01\n646 5.06502396 0.0005245209  1.104639e-05 9.994644e-01\n647 5.06776181 0.0005245209  8.762720e-06 9.994667e-01\n648 5.08145106 0.0005244872  8.762720e-06 9.994668e-01\n649 5.13347023 0.0005244872  6.930302e-06 9.994686e-01\n650 5.13620808 0.0005096940  2.172355e-05 9.994686e-01\n651 5.14442163 0.0005096940  1.724517e-05 9.994731e-01\n652 5.15811088 0.0005096940  1.359998e-05 9.994767e-01\n653 5.16084873 0.0005096940  1.068267e-05 9.994796e-01\n654 5.18822724 0.0004951979  2.517869e-05 9.994796e-01\n655 5.19096509 0.0004951979  1.977885e-05 9.994850e-01\n656 5.22108145 0.0004951979  1.541894e-05 9.994894e-01\n657 5.24298426 0.0004951979  1.197384e-05 9.994928e-01\n658 5.24845996 0.0004809601  2.621167e-05 9.994928e-01\n659 5.28952772 0.0004809601  2.027979e-05 9.994988e-01\n660 5.33880903 0.0004809601  1.550804e-05 9.995035e-01\n661 5.40999316 0.0004666043  2.986382e-05 9.995035e-01\n662 5.42368241 0.0004525053  4.396284e-05 9.995035e-01\n663 5.46201232 0.0004525053  3.375004e-05 9.995137e-01\n664 5.50855578 0.0004384379  4.781742e-05 9.995137e-01\n665 5.52498289 0.0004247719  6.148342e-05 9.995137e-01\n666 5.53319644 0.0004247719  4.733267e-05 9.995279e-01\n667 5.53867214 0.0004247719  3.622347e-05 9.995390e-01\n668 5.55236140 0.0004113696  4.962585e-05 9.995390e-01\n669 5.56057495 0.0003983141  6.268128e-05 9.995390e-01\n670 5.57152635 0.0003856513  7.534412e-05 9.995390e-01\n671 5.57426420 0.0003733550  8.764042e-05 9.995390e-01\n672 5.61806982 0.0003733265  8.764042e-05 9.995390e-01\n673 5.65913758 0.0003611063  9.986056e-05 9.995390e-01\n674 5.67830253 0.0003491889  1.117780e-04 9.995390e-01\n675 5.68651608 0.0003491889  8.749064e-05 9.995633e-01\n676 5.69199179 0.0003491610  8.749064e-05 9.995633e-01\n677 5.70294319 0.0003491610  6.816224e-05 9.995827e-01\n678 5.70841889 0.0003491610  5.290832e-05 9.995979e-01\n679 5.82340862 0.0003491610  4.047631e-05 9.996104e-01\n680 5.82614648 0.0003491610  3.080875e-05 9.996200e-01\n681 5.83983573 0.0003491610  2.321156e-05 9.996276e-01\n682 5.88090349 0.0003364112  3.596140e-05 9.996276e-01\n683 5.89185489 0.0003364112  2.664942e-05 9.996369e-01\n684 5.94387406 0.0003364112  1.226576e-05 9.996513e-01\n685 5.95208761 0.0003363809  1.226576e-05 9.996514e-01\n686 6.01505818 0.0003363809  8.677226e-06 9.996549e-01\n687 6.05886379 0.0003363466  8.677226e-06 9.996550e-01\n688 6.10814511 0.0003209623  2.406155e-05 9.996550e-01\n689 6.17932923 0.0003209259  2.406155e-05 9.996550e-01\n690 6.25325120 0.0003209259  1.588596e-05 9.996632e-01\n691 6.26146475 0.0003209259  1.034060e-05 9.996687e-01\n692 6.26420260 0.0003043028  2.696372e-05 9.996687e-01\n693 6.34633812 0.0003042637  2.696372e-05 9.996688e-01\n694 6.43668720 0.0003042637  1.622111e-05 9.996795e-01\n695 6.72963723 0.0003042098  1.622111e-05 9.996796e-01\n696 6.79534565 0.0003042098  6.941262e-06 9.996888e-01\n697 6.91854894 0.0003042098  1.980390e-06 9.996938e-01\n698 6.95961670 0.0003042098  4.298001e-07 9.996954e-01\n699 6.98699521 0.0003042098  6.768902e-08 9.996957e-01\n700 7.09924709 0.0003042098  5.913254e-09 9.996958e-01\n701 7.34565366 0.0003042098 -2.393579e-10 9.996958e-01\n702 7.37577002 0.0002574597  4.674983e-05 9.996958e-01\n703 7.44147844 0.0002574597 -1.256261e-05 9.997551e-01\n704 7.46064339 0.0002573225 -1.256261e-05 9.997552e-01\n705 7.63586585 0.0002571157 -1.256261e-05 9.997554e-01\n706 7.96714579 0.0002571157  4.908693e-05 9.996938e-01\n707 9.11430527 0.0002571157  4.908693e-05 9.996938e-01\n\n\nShow R code\npr_trt1[[1]]\n\n\n          time     pstate1       pstate2      pstate3\n1   0.00000000 1.000000000  0.000000e+00 0.000000e+00\n2   0.02190281 0.993665392  6.334608e-03 0.000000e+00\n3   0.02464066 0.987365470  1.263453e-02 0.000000e+00\n4   0.05201916 0.981097638  1.890236e-02 0.000000e+00\n5   0.05475702 0.974864032  2.513597e-02 0.000000e+00\n6   0.06297057 0.974837755  2.513597e-02 2.627727e-05\n7   0.06570842 0.974811472  2.513597e-02 5.256001e-05\n8   0.07665982 0.968603335  3.134410e-02 5.256001e-05\n9   0.09308693 0.968603335 -6.836335e-02 9.976002e-02\n10  0.09582478 0.962429465 -6.218948e-02 9.976002e-02\n11  0.09856263 0.956282799 -5.604282e-02 9.976002e-02\n12  0.10403833 0.950169412 -4.992943e-02 9.976002e-02\n13  0.10951403 0.944081188 -4.384120e-02 9.976002e-02\n14  0.11772758 0.938023672 -3.778369e-02 9.976002e-02\n15  0.12320329 0.931967497 -3.175327e-02 9.978577e-02\n16  0.13415469 0.925959632 -2.574540e-02 9.978577e-02\n17  0.14236824 0.925959632  9.497979e-03 6.454239e-02\n18  0.15331964 0.925934116  9.497979e-03 6.456790e-02\n19  0.16153320 0.919951412  1.548068e-02 6.456790e-02\n20  0.16974675 0.908033034  2.739906e-02 6.456790e-02\n21  0.17248460 0.902143378  3.328872e-02 6.456790e-02\n22  0.18617385 0.896284462  3.914763e-02 6.456790e-02\n23  0.19712526 0.884625772  5.080632e-02 6.456790e-02\n24  0.21081451 0.873076984  6.235511e-02 6.456790e-02\n25  0.21355236 0.867358487  6.807361e-02 6.456790e-02\n26  0.21629021 0.861670151  2.035966e-02 1.179702e-01\n27  0.21902806 0.844645886  3.738393e-02 1.179702e-01\n28  0.23271732 0.833463994  4.856582e-02 1.179702e-01\n29  0.23545517 0.822384991  5.964482e-02 1.179702e-01\n30  0.24093087 0.816909829  6.511999e-02 1.179702e-01\n31  0.24914442 0.806000043  7.602977e-02 1.179702e-01\n32  0.25462012 0.806000043  3.763136e-02 1.563686e-01\n33  0.25735797 0.800603052  4.302835e-02 1.563686e-01\n34  0.26830938 0.784456410  5.917499e-02 1.563686e-01\n35  0.27104723 0.773864825  6.976658e-02 1.563686e-01\n36  0.27378508 0.768634056  7.499735e-02 1.563686e-01\n37  0.27652293 0.758207345  8.542406e-02 1.563686e-01\n38  0.27926078 0.753045089  9.058631e-02 1.563686e-01\n39  0.28199863 0.747913208  9.571819e-02 1.563686e-01\n40  0.28747433 0.742810645  1.008208e-01 1.563686e-01\n41  0.29021218 0.737732047  1.058994e-01 1.563686e-01\n42  0.29568789 0.732675850  1.109556e-01 1.563686e-01\n43  0.29842574 0.727635653  1.159957e-01 1.563686e-01\n44  0.30390144 0.722625389  1.210060e-01 1.563686e-01\n45  0.30937714 0.707655128  9.415399e-02 1.981909e-01\n46  0.31759069 0.692922599  1.088865e-01 1.981909e-01\n47  0.32306639 0.688101883  1.137072e-01 1.981909e-01\n48  0.32580424 0.683306166  1.185029e-01 1.981909e-01\n49  0.33127995 0.673757518  1.280516e-01 1.981909e-01\n50  0.33401780 0.669038066  9.530141e-02 2.356605e-01\n51  0.34223135 0.669038066  6.751397e-02 2.634480e-01\n52  0.34770705 0.664340450  5.201932e-02 2.836402e-01\n53  0.35318275 0.664340450  3.647322e-02 2.991863e-01\n54  0.35865845 0.659671210  4.114246e-02 2.991863e-01\n55  0.36139630 0.655029616  4.578405e-02 2.991863e-01\n56  0.36413415 0.655029616  3.215803e-02 3.128124e-01\n57  0.36687201 0.650413231  3.677441e-02 3.128124e-01\n58  0.37234771 0.645822483  4.136516e-02 3.128124e-01\n59  0.37782341 0.645822483  2.937890e-02 3.247986e-01\n60  0.38056126 0.641253719  3.394767e-02 3.247986e-01\n61  0.38603696 0.636708312  2.843206e-02 3.348596e-01\n62  0.39151266 0.632190493  3.294988e-02 3.348596e-01\n63  0.39425051 0.632190493  2.313641e-02 3.446731e-01\n64  0.39698836 0.627699759  2.052663e-02 3.517736e-01\n65  0.39972621 0.618751989  2.947440e-02 3.517736e-01\n66  0.40246407 0.614331360  3.389503e-02 3.517736e-01\n67  0.41067762 0.614331360  2.403378e-02 3.616349e-01\n68  0.42162902 0.605528424  3.283672e-02 3.616349e-01\n69  0.42984257 0.592471670  4.589347e-02 3.616349e-01\n70  0.43805613 0.588199430  5.016571e-02 3.616349e-01\n71  0.44079398 0.579698892  5.866625e-02 3.616349e-01\n72  0.44900753 0.579698892  4.334839e-02 3.769527e-01\n73  0.45174538 0.567104907  4.446557e-02 3.884295e-01\n74  0.45448323 0.562990415  3.712366e-02 3.998859e-01\n75  0.45722108 0.558899445  4.121464e-02 3.998859e-01\n76  0.45995893 0.554833720  4.528036e-02 3.998859e-01\n77  0.46269678 0.550795640  4.931844e-02 3.998859e-01\n78  0.46817248 0.550795640  2.466402e-02 4.245403e-01\n79  0.47364819 0.538743824  3.671584e-02 4.245403e-01\n80  0.47638604 0.526892820  4.856684e-02 4.245403e-01\n81  0.47912389 0.523015585  5.244408e-02 4.245403e-01\n82  0.48186174 0.515294103  6.016556e-02 4.245403e-01\n83  0.49007529 0.511484409  6.397525e-02 4.245403e-01\n84  0.49555099 0.507699200  6.776046e-02 4.245403e-01\n85  0.50102669 0.500174674  7.528499e-02 4.245403e-01\n86  0.50650240 0.477771773  9.768789e-02 4.245403e-01\n87  0.50924025 0.477771773  7.811363e-02 4.441146e-01\n88  0.51197810 0.477771773  6.214291e-02 4.600853e-01\n89  0.51471595 0.474178599  6.573609e-02 4.600853e-01\n90  0.51745380 0.467023284  7.289140e-02 4.600853e-01\n91  0.52292950 0.459962440  6.533551e-02 4.747021e-01\n92  0.53661875 0.456479800  6.881815e-02 4.747021e-01\n93  0.54209446 0.453019823  7.227812e-02 4.747021e-01\n94  0.54483231 0.449580720  7.571723e-02 4.747021e-01\n95  0.55030801 0.446165188  6.460248e-02 4.892323e-01\n96  0.55578371 0.442769582  6.799809e-02 4.892323e-01\n97  0.55852156 0.439396188  7.137148e-02 4.892323e-01\n98  0.56125941 0.436039464  7.472821e-02 4.892323e-01\n99  0.56399726 0.436039464  6.080134e-02 5.031592e-01\n100 0.56947296 0.429368457  5.600524e-02 5.146263e-01\n101 0.58863792 0.422783412  5.213155e-02 5.250850e-01\n102 0.59137577 0.419534750  5.538021e-02 5.250850e-01\n103 0.59685147 0.409825685  5.497626e-02 5.351981e-01\n104 0.59958932 0.406641671  4.841823e-02 5.449401e-01\n105 0.60506502 0.403479250  5.158065e-02 5.449401e-01\n106 0.60780287 0.403479250  4.263231e-02 5.538884e-01\n107 0.61054073 0.400332836  4.577872e-02 5.538884e-01\n108 0.61327858 0.397208671  4.890289e-02 5.538884e-01\n109 0.61875428 0.397208671  4.045339e-02 5.623379e-01\n110 0.62149213 0.394105212  4.355685e-02 5.623379e-01\n111 0.62422998 0.391022594  4.663947e-02 5.623379e-01\n112 0.62696783 0.384890972  5.277109e-02 5.623379e-01\n113 0.62970568 0.369672646  6.798942e-02 5.623379e-01\n114 0.63518138 0.369672646  5.727719e-02 5.730502e-01\n115 0.64339493 0.366728989  6.022085e-02 5.730502e-01\n116 0.64887064 0.357925408  6.902443e-02 5.730502e-01\n117 0.65160849 0.355050867  6.135336e-02 5.835958e-01\n118 0.65982204 0.355050867  5.196775e-02 5.929814e-01\n119 0.66255989 0.352196190  4.679348e-02 6.010103e-01\n120 0.66529774 0.349362391  4.962727e-02 6.010103e-01\n121 0.67077344 0.343721630  5.526804e-02 6.010103e-01\n122 0.67351129 0.340937304  5.805236e-02 6.010103e-01\n123 0.67898700 0.338167510  6.082216e-02 6.010103e-01\n124 0.68446270 0.335418381  6.357128e-02 6.010103e-01\n125 0.68720055 0.335418381  5.427296e-02 6.103087e-01\n126 0.68993840 0.332688423  5.700292e-02 6.103087e-01\n127 0.69267625 0.329976335  5.136967e-02 6.186540e-01\n128 0.69815195 0.327279116  5.406689e-02 6.186540e-01\n129 0.70088980 0.321914612  5.943140e-02 6.186540e-01\n130 0.70362765 0.319270531  5.363313e-02 6.270963e-01\n131 0.70636550 0.316636335  5.626733e-02 6.270963e-01\n132 0.70910335 0.316636335  4.042875e-02 6.429349e-01\n133 0.71184120 0.311393411  4.567168e-02 6.429349e-01\n134 0.71457906 0.308809260  4.825583e-02 6.429349e-01\n135 0.71731691 0.306242223  5.082287e-02 6.429349e-01\n136 0.72005476 0.301141833  5.592326e-02 6.429349e-01\n137 0.72279261 0.298629791  5.082163e-02 6.505486e-01\n138 0.73648186 0.298629791  4.390470e-02 6.574655e-01\n139 0.74195756 0.293635331  4.288039e-02 6.634843e-01\n140 0.74743326 0.291170821  4.534490e-02 6.634843e-01\n141 0.75017112 0.288723061  4.167733e-02 6.695996e-01\n142 0.75290897 0.288723061  3.604311e-02 6.752338e-01\n143 0.75564682 0.283852774  3.601001e-02 6.801372e-01\n144 0.76386037 0.276645904  3.834352e-02 6.850106e-01\n145 0.76659822 0.274296329  4.069310e-02 6.850106e-01\n146 0.77481177 0.274296329  2.980501e-02 6.958987e-01\n147 0.78028747 0.271963950  3.213738e-02 6.958987e-01\n148 0.78302533 0.265003553  3.909778e-02 6.958987e-01\n149 0.79123888 0.265003553  3.397151e-02 7.010249e-01\n150 0.79397673 0.260451608  3.852346e-02 7.010249e-01\n151 0.79671458 0.258210435  4.076463e-02 7.010249e-01\n152 0.80219028 0.258210435  3.549332e-02 7.062963e-01\n153 0.80492813 0.253756813  3.994694e-02 7.062963e-01\n154 0.81040383 0.249361853  4.434190e-02 7.062963e-01\n155 0.82135524 0.247196340  4.650741e-02 7.062963e-01\n156 0.82683094 0.247196340  4.066979e-02 7.121339e-01\n157 0.82956879 0.245039323  4.282681e-02 7.121339e-01\n158 0.83230664 0.242899579  3.959544e-02 7.175050e-01\n159 0.84325804 0.240772245  4.172277e-02 7.175050e-01\n160 0.85147159 0.240772245  3.653215e-02 7.226956e-01\n161 0.85694730 0.238661032  3.406505e-02 7.272739e-01\n162 0.85968515 0.238661032  2.547279e-02 7.358662e-01\n163 0.86242300 0.234458526  2.967530e-02 7.358662e-01\n164 0.86516085 0.234458526  2.593451e-02 7.396070e-01\n165 0.88158795 0.230315594  2.678580e-02 7.428986e-01\n166 0.88432580 0.230315594  2.342487e-02 7.462595e-01\n167 0.88706366 0.230315594  2.046205e-02 7.492224e-01\n168 0.88980151 0.228274759  2.250288e-02 7.492224e-01\n169 0.89253936 0.228266521  2.250288e-02 7.492306e-01\n170 0.89801506 0.226239569  2.452983e-02 7.492306e-01\n171 0.90075291 0.224228971  2.654043e-02 7.492306e-01\n172 0.90349076 0.220237854  3.053155e-02 7.492306e-01\n173 0.90622861 0.220237854  2.676184e-02 7.530003e-01\n174 0.91170431 0.218274140  2.872555e-02 7.530003e-01\n175 0.91444216 0.216321610  3.067808e-02 7.530003e-01\n176 0.91718001 0.214380318  3.261937e-02 7.530003e-01\n177 0.91991786 0.210525182  3.647451e-02 7.530003e-01\n178 0.92265572 0.204826613  4.217308e-02 7.530003e-01\n179 0.93086927 0.204819103  4.217308e-02 7.530078e-01\n180 0.93360712 0.202961250  4.403093e-02 7.530078e-01\n181 0.93634497 0.202961250  3.886106e-02 7.581777e-01\n182 0.93908282 0.202961250  3.426414e-02 7.627746e-01\n183 0.94182067 0.201115089  3.611030e-02 7.627746e-01\n184 0.95277207 0.197440816  3.978458e-02 7.627746e-01\n185 0.95550992 0.195631322  3.695530e-02 7.674134e-01\n186 0.96372348 0.192032958  4.055366e-02 7.674134e-01\n187 0.96919918 0.190264127  4.232249e-02 7.674134e-01\n188 0.97193703 0.190257027  3.745774e-02 7.722852e-01\n189 0.97467488 0.186742759  3.663362e-02 7.766236e-01\n190 0.98562628 0.183285676  4.009070e-02 7.766236e-01\n191 0.99110198 0.181585625  3.722803e-02 7.811863e-01\n192 0.99383984 0.181585625  3.299431e-02 7.854201e-01\n193 0.99931554 0.179895254  3.090670e-02 7.891980e-01\n194 1.00205339 0.178217059  2.905446e-02 7.927285e-01\n195 1.01026694 0.176550738  3.072078e-02 7.927285e-01\n196 1.01300479 0.174896376  3.237514e-02 7.927285e-01\n197 1.01848049 0.173252228  3.037119e-02 7.963766e-01\n198 1.02395619 0.171613884  3.200954e-02 7.963766e-01\n199 1.02943190 0.171613884  2.842559e-02 7.999605e-01\n200 1.03490760 0.169985420  3.005405e-02 7.999605e-01\n201 1.03764545 0.168367448  3.167202e-02 7.999605e-01\n202 1.04038330 0.165153354  3.488612e-02 7.999605e-01\n203 1.04312115 0.165153354  3.104786e-02 8.037988e-01\n204 1.04585900 0.163574343  2.919235e-02 8.072333e-01\n205 1.05133470 0.162008284  2.427599e-02 8.137157e-01\n206 1.05681040 0.158892990  2.739128e-02 8.137157e-01\n207 1.06502396 0.157361550  2.591355e-02 8.167249e-01\n208 1.06776181 0.157361550  2.307111e-02 8.195673e-01\n209 1.07323751 0.155842939  2.458972e-02 8.195673e-01\n210 1.07597536 0.154337730  2.609493e-02 8.195673e-01\n211 1.08966461 0.152844042  2.758862e-02 8.195673e-01\n212 1.09514031 0.152844042  2.461838e-02 8.225376e-01\n213 1.09787817 0.151359879  2.610254e-02 8.225376e-01\n214 1.10061602 0.149888082  2.475359e-02 8.253583e-01\n215 1.10882957 0.148428352  2.621332e-02 8.253583e-01\n216 1.11156742 0.146981532  2.483567e-02 8.281828e-01\n217 1.11704312 0.145546892  2.627031e-02 8.281828e-01\n218 1.11978097 0.145546892  2.346509e-02 8.309880e-01\n219 1.12525667 0.144121482  2.236735e-02 8.335112e-01\n220 1.13073238 0.142707926  1.895580e-02 8.383363e-01\n221 1.13620808 0.139900815  2.176291e-02 8.383363e-01\n222 1.14168378 0.139900815  1.942552e-02 8.406737e-01\n223 1.14989733 0.139900815  1.732763e-02 8.427716e-01\n224 1.15263518 0.139895275  1.732763e-02 8.427771e-01\n225 1.15537303 0.138510093  1.682276e-02 8.446671e-01\n226 1.17180014 0.138510093  1.499120e-02 8.464987e-01\n227 1.17453799 0.137137481  1.636382e-02 8.464987e-01\n228 1.17727584 0.137137481  1.278817e-02 8.500744e-01\n229 1.18001369 0.135773804  1.415184e-02 8.500744e-01\n230 1.18548939 0.134422385  1.394481e-02 8.516328e-01\n231 1.18822724 0.133082536  1.528465e-02 8.516328e-01\n232 1.19096509 0.131753332  1.661386e-02 8.516328e-01\n233 1.19644079 0.130433143  1.613477e-02 8.534321e-01\n234 1.19917864 0.129122907  1.394402e-02 8.569331e-01\n235 1.20191650 0.127820866  1.373051e-02 8.584486e-01\n236 1.20465435 0.126527319  1.502406e-02 8.584486e-01\n237 1.20739220 0.126527319  1.340092e-02 8.600718e-01\n238 1.21286790 0.125244882  1.322261e-02 8.615325e-01\n239 1.21560575 0.125244882  1.178659e-02 8.629685e-01\n240 1.22655715 0.123972779  1.176932e-02 8.642579e-01\n241 1.22929500 0.122712480  1.302962e-02 8.642579e-01\n242 1.24024641 0.121463965  1.427814e-02 8.642579e-01\n243 1.24298426 0.120222559  1.398889e-02 8.657886e-01\n244 1.25393566 0.117754578  1.645687e-02 8.657886e-01\n245 1.25667351 0.117754578  1.470726e-02 8.675382e-01\n246 1.25941136 0.117754578  1.313155e-02 8.691139e-01\n247 1.26214921 0.116542494  1.434363e-02 8.691139e-01\n248 1.26488706 0.116542494  1.280289e-02 8.706546e-01\n249 1.27036277 0.116542494  1.141830e-02 8.720392e-01\n250 1.27310062 0.115340927  1.013365e-02 8.745254e-01\n251 1.27583847 0.112957344  1.251723e-02 8.745254e-01\n252 1.28405202 0.112957344  1.117250e-02 8.758702e-01\n253 1.29226557 0.112957344  9.966687e-03 8.770760e-01\n254 1.29774127 0.111787539  1.005366e-02 8.781588e-01\n255 1.30047912 0.111787539  8.960435e-03 8.792520e-01\n256 1.30321697 0.110626926  1.012105e-02 8.792520e-01\n257 1.31416838 0.109475492  1.127248e-02 8.792520e-01\n258 1.31964408 0.108332931  1.241504e-02 8.792520e-01\n259 1.32511978 0.108332931  1.107396e-02 8.805931e-01\n260 1.32785763 0.107195204  1.220724e-02 8.805976e-01\n261 1.33059548 0.107190772  1.220724e-02 8.806020e-01\n262 1.33880903 0.106063103  1.333491e-02 8.806020e-01\n263 1.34154689 0.104946364  1.301652e-02 8.820371e-01\n264 1.34428474 0.102725551  1.523733e-02 8.820371e-01\n265 1.34976044 0.101635082  1.632780e-02 8.820371e-01\n266 1.35523614 0.100554631  1.740825e-02 8.820371e-01\n267 1.35797399 0.099484062  1.847882e-02 8.820371e-01\n268 1.36071184 0.098423216  1.953966e-02 8.820371e-01\n269 1.36344969 0.097372724  1.856171e-02 8.840656e-01\n270 1.36618754 0.096331908  1.377201e-02 8.898961e-01\n271 1.37713895 0.096331908  1.231983e-02 8.913483e-01\n272 1.37987680 0.095300693  1.335104e-02 8.913483e-01\n273 1.38261465 0.094278697  1.437304e-02 8.913483e-01\n274 1.38535250 0.094278697  1.286401e-02 8.928573e-01\n275 1.39630390 0.093263915  1.252027e-02 8.942158e-01\n276 1.39904175 0.092259186  1.352500e-02 8.942158e-01\n277 1.40177960 0.092259186  1.210166e-02 8.956391e-01\n278 1.40451745 0.091263520  1.309733e-02 8.956391e-01\n279 1.42915811 0.091263520  1.171343e-02 8.970231e-01\n280 1.43189596 0.090277064  1.269988e-02 8.970231e-01\n281 1.43737166 0.089297948  1.367900e-02 8.970231e-01\n282 1.44010951 0.088327958  1.464899e-02 8.970231e-01\n283 1.44284736 0.087367561  1.560939e-02 8.970231e-01\n284 1.44558522 0.087367561  1.399033e-02 8.986421e-01\n285 1.44832307 0.087367561  1.253205e-02 9.001004e-01\n286 1.45653662 0.085463286  1.443632e-02 9.001004e-01\n287 1.46201232 0.084529800  1.536981e-02 9.001004e-01\n288 1.46748802 0.083605108  1.629450e-02 9.001004e-01\n289 1.47022587 0.083605108  1.461897e-02 9.017759e-01\n290 1.47843943 0.082689611  1.553447e-02 9.017759e-01\n291 1.48391513 0.081782595  1.644148e-02 9.017759e-01\n292 1.48665298 0.079983688  1.824039e-02 9.017759e-01\n293 1.49486653 0.079983688  1.639684e-02 9.036195e-01\n294 1.49760438 0.079102811  1.727771e-02 9.036195e-01\n295 1.50034223 0.078228146  1.815238e-02 9.036195e-01\n296 1.50581793 0.078228146  1.632603e-02 9.054458e-01\n297 1.51403149 0.078228146  1.467208e-02 9.070998e-01\n298 1.51676934 0.076493863  1.640636e-02 9.070998e-01\n299 1.51950719 0.075643742  1.725648e-02 9.070998e-01\n300 1.53045859 0.075643742  1.552570e-02 9.088306e-01\n301 1.53319644 0.074801659  1.636778e-02 9.088306e-01\n302 1.53593429 0.073967537  1.720190e-02 9.088306e-01\n303 1.54140999 0.073967537  1.376374e-02 9.122687e-01\n304 1.54688569 0.073139527  1.459175e-02 9.122687e-01\n305 1.55783710 0.073139527  1.313628e-02 9.137242e-01\n306 1.56057495 0.073139527  1.181362e-02 9.150468e-01\n307 1.56878850 0.071494628  1.225772e-02 9.162476e-01\n308 1.57700205 0.071494628  9.760079e-03 9.187453e-01\n309 1.57973990 0.070688426  1.056628e-02 9.187453e-01\n310 1.58247775 0.069089634  1.108325e-02 9.198271e-01\n311 1.58795346 0.069089634  8.818616e-03 9.220918e-01\n312 1.59069131 0.068305295  9.602955e-03 9.220918e-01\n313 1.59342916 0.068305295  8.617579e-03 9.230771e-01\n314 1.59616701 0.067526628  8.507775e-03 9.239656e-01\n315 1.60711841 0.067526628  7.626492e-03 9.248469e-01\n316 1.61259411 0.067526628  6.830033e-03 9.256433e-01\n317 1.61806982 0.066755583  6.884554e-03 9.263599e-01\n318 1.62080767 0.066755583  6.164585e-03 9.270798e-01\n319 1.62354552 0.064463163  8.457005e-03 9.270798e-01\n320 1.62628337 0.063723041  8.320272e-03 9.279567e-01\n321 1.62902122 0.063723041  7.458867e-03 9.288181e-01\n322 1.63997262 0.062987836  8.191252e-03 9.288209e-01\n323 1.64544832 0.062987836  7.342758e-03 9.296694e-01\n324 1.64818617 0.062260639  6.534358e-03 9.312050e-01\n325 1.65092402 0.062260639  5.849030e-03 9.318903e-01\n326 1.65366188 0.061541052  6.568617e-03 9.318903e-01\n327 1.66461328 0.060829299  6.588419e-03 9.325823e-01\n328 1.66735113 0.060829299  5.895973e-03 9.332747e-01\n329 1.67556468 0.060829299  5.272735e-03 9.338980e-01\n330 1.67830253 0.060123035  5.978999e-03 9.338980e-01\n331 1.68104038 0.060123035  5.350185e-03 9.345268e-01\n332 1.68377823 0.059422352  6.050868e-03 9.345268e-01\n333 1.68651608 0.058726963  6.108988e-03 9.351640e-01\n334 1.68925394 0.058038985  6.796967e-03 9.351640e-01\n335 1.70294319 0.057357473  6.769258e-03 9.358733e-01\n336 1.71115674 0.056683325  7.443406e-03 9.358733e-01\n337 1.71937029 0.056680758  7.443406e-03 9.358758e-01\n338 1.72210815 0.056680758  6.672140e-03 9.366471e-01\n339 1.73032170 0.056010981  7.341917e-03 9.366471e-01\n340 1.74127310 0.055347950  8.004948e-03 9.366471e-01\n341 1.74674880 0.054692051  8.660847e-03 9.366471e-01\n342 1.75496235 0.054692051  7.771654e-03 9.375363e-01\n343 1.75770021 0.054692051  6.160534e-03 9.391474e-01\n344 1.76043806 0.054692051  4.867711e-03 9.404402e-01\n345 1.77138946 0.054692051  4.352052e-03 9.409559e-01\n346 1.77686516 0.054042823  5.001280e-03 9.409559e-01\n347 1.78781656 0.053400590  5.643513e-03 9.409559e-01\n348 1.79055441 0.052763408  6.280696e-03 9.409559e-01\n349 1.79876797 0.052132733  6.911370e-03 9.409559e-01\n350 1.80424367 0.051508939  6.815067e-03 9.416760e-01\n351 1.81519507 0.050271555  7.339189e-03 9.423893e-01\n352 1.81793292 0.050271555  6.580174e-03 9.431483e-01\n353 1.82067077 0.050269221  6.580174e-03 9.431506e-01\n354 1.82340862 0.050269221  5.894156e-03 9.438366e-01\n355 1.82888433 0.049661447  6.501931e-03 9.438366e-01\n356 1.83162218 0.049661447  5.823328e-03 9.445152e-01\n357 1.83436003 0.049661447  5.211763e-03 9.451268e-01\n358 1.83983573 0.049059956  5.813254e-03 9.451268e-01\n359 1.84257358 0.049059956  5.205711e-03 9.457343e-01\n360 1.84531143 0.049059956  4.657895e-03 9.462821e-01\n361 1.84804928 0.048463488  4.760450e-03 9.467761e-01\n362 1.85626283 0.048463488  4.258224e-03 9.472783e-01\n363 1.86173854 0.047871971  4.849741e-03 9.472783e-01\n364 1.86995209 0.047286610  5.435102e-03 9.472783e-01\n365 1.87268994 0.047286610  4.865331e-03 9.478481e-01\n366 1.87542779 0.047286610  4.351858e-03 9.483615e-01\n367 1.87816564 0.046707783  4.930685e-03 9.483615e-01\n368 1.88090349 0.046707783  4.410089e-03 9.488821e-01\n369 1.89459274 0.046707783  2.999275e-03 9.502929e-01\n370 1.89733060 0.046707783  2.675805e-03 9.506164e-01\n371 1.90554415 0.046707783  2.385170e-03 9.509070e-01\n372 1.90828200 0.046135043  2.957910e-03 9.509070e-01\n373 1.91649555 0.044996888  4.096065e-03 9.509070e-01\n374 1.91923340 0.044439021  4.653932e-03 9.509070e-01\n375 1.92197125 0.043333244  5.759709e-03 9.509070e-01\n376 1.93292266 0.043333244  5.153419e-03 9.515133e-01\n377 1.93839836 0.043333244  4.607002e-03 9.520598e-01\n378 1.94113621 0.043333244  3.622157e-03 9.530446e-01\n379 1.94661191 0.042792593  4.162808e-03 9.530446e-01\n380 1.94934976 0.042258068  4.251549e-03 9.534904e-01\n381 1.96030116 0.042258068  3.796278e-03 9.539457e-01\n382 1.96303901 0.041729344  3.915442e-03 9.543552e-01\n383 1.96577687 0.041729344  3.493298e-03 9.547774e-01\n384 1.97125257 0.041729344  3.115201e-03 9.551555e-01\n385 1.97399042 0.041729344  2.775756e-03 9.554949e-01\n386 1.97946612 0.041729344  2.471895e-03 9.557988e-01\n387 1.98767967 0.041206323  2.994916e-03 9.557988e-01\n388 1.99589322 0.041206323  2.667140e-03 9.561265e-01\n389 1.99863107 0.040688911  2.891019e-03 9.564201e-01\n390 2.00136893 0.040177135  3.402796e-03 9.564201e-01\n391 2.01232033 0.039670926  3.909005e-03 9.564201e-01\n392 2.01505818 0.039670926  3.485254e-03 9.568438e-01\n393 2.02327173 0.039168917  3.605832e-03 9.572253e-01\n394 2.03148528 0.038671741  4.103008e-03 9.572253e-01\n395 2.03422313 0.038671741  3.207758e-03 9.581205e-01\n396 2.04791239 0.038180025  3.699474e-03 9.581205e-01\n397 2.05612594 0.037693722  4.185776e-03 9.581205e-01\n398 2.05886379 0.037213002  4.666496e-03 9.581205e-01\n399 2.06160164 0.037213002  4.161034e-03 9.586260e-01\n400 2.06707734 0.037213002  3.708539e-03 9.590785e-01\n401 2.07529090 0.037213002  3.303341e-03 9.594837e-01\n402 2.07802875 0.037213002  2.575846e-03 9.602112e-01\n403 2.08076660 0.037213002  2.289404e-03 9.604976e-01\n404 2.08350445 0.037213002  2.033260e-03 9.607537e-01\n405 2.09171800 0.037213002  1.803784e-03 9.609832e-01\n406 2.09445585 0.037213002  1.599107e-03 9.611879e-01\n407 2.09719370 0.037213002  1.416832e-03 9.613702e-01\n408 2.10814511 0.037213002  1.254033e-03 9.615330e-01\n409 2.11362081 0.036736425  1.730611e-03 9.615330e-01\n410 2.11909651 0.036265058  2.003180e-03 9.617318e-01\n411 2.12183436 0.036265058  1.772165e-03 9.619628e-01\n412 2.17659138 0.036265058  1.566484e-03 9.621685e-01\n413 2.18206708 0.035798834  1.849969e-03 9.623512e-01\n414 2.19575633 0.035798834  1.416346e-03 9.627848e-01\n415 2.19849418 0.035337808  1.877373e-03 9.627848e-01\n416 2.20396988 0.034881886  2.333295e-03 9.627848e-01\n417 2.20670773 0.034881886  1.783478e-03 9.633346e-01\n418 2.22039699 0.034881886  1.570974e-03 9.635471e-01\n419 2.26420260 0.034431313  2.021547e-03 9.635471e-01\n420 2.26694045 0.033985747  2.467113e-03 9.635471e-01\n421 2.27789185 0.033985747  2.176218e-03 9.638380e-01\n422 2.28062971 0.033985747  1.657694e-03 9.643566e-01\n423 2.28610541 0.033545175  2.098266e-03 9.643566e-01\n424 2.29979466 0.033545175  1.846663e-03 9.646082e-01\n425 2.31074606 0.033543498  1.846663e-03 9.646098e-01\n426 2.31348392 0.033541814  1.846663e-03 9.646115e-01\n427 2.31622177 0.033541814  1.623373e-03 9.648348e-01\n428 2.32443532 0.033104837  2.060350e-03 9.648348e-01\n429 2.32991102 0.032673089  2.492098e-03 9.648348e-01\n430 2.33538672 0.032246232  2.918955e-03 9.648348e-01\n431 2.33812457 0.032246232  2.571574e-03 9.651822e-01\n432 2.34086242 0.031824451  2.993355e-03 9.651822e-01\n433 2.34907598 0.031824451  2.636960e-03 9.655386e-01\n434 2.36002738 0.031824451  2.321329e-03 9.658542e-01\n435 2.36276523 0.031824451  2.041748e-03 9.661338e-01\n436 2.38466804 0.031407420  2.458779e-03 9.661338e-01\n437 2.39288159 0.031407420  2.161589e-03 9.664310e-01\n438 2.39561944 0.031407420  1.898881e-03 9.666937e-01\n439 2.41752225 0.030995037  2.079022e-03 9.669259e-01\n440 2.42026010 0.030993442  2.079022e-03 9.669275e-01\n441 2.42299795 0.030993442  1.825171e-03 9.671814e-01\n442 2.42847365 0.030991845  1.373777e-03 9.676344e-01\n443 2.43668720 0.030991845  1.202124e-03 9.678060e-01\n444 2.43942505 0.030582080  1.611889e-03 9.678060e-01\n445 2.46406571 0.030175902  2.018067e-03 9.678060e-01\n446 2.46680356 0.030175902  1.768306e-03 9.680558e-01\n447 2.46954141 0.030175902  1.547172e-03 9.682769e-01\n448 2.47501711 0.029773284  1.949791e-03 9.682769e-01\n449 2.47775496 0.029773284  1.462691e-03 9.687640e-01\n450 2.48870637 0.029773284  1.277838e-03 9.689489e-01\n451 2.49418207 0.029773284  1.115238e-03 9.691115e-01\n452 2.49691992 0.029374896  1.513625e-03 9.691115e-01\n453 2.50787132 0.029374896  1.320512e-03 9.693046e-01\n454 2.51334702 0.028980133  1.715275e-03 9.693046e-01\n455 2.52429843 0.028590250  2.105158e-03 9.693046e-01\n456 2.52977413 0.028590250  1.839318e-03 9.695704e-01\n457 2.54072553 0.028590250  1.605376e-03 9.698044e-01\n458 2.54346338 0.028590250  1.399067e-03 9.700107e-01\n459 2.54620123 0.028204934  1.784382e-03 9.700107e-01\n460 2.54893908 0.027824074  2.165243e-03 9.700107e-01\n461 2.55715264 0.027447664  2.541652e-03 9.700107e-01\n462 2.56262834 0.027075888  2.590024e-03 9.703341e-01\n463 2.56810404 0.027074445  2.590024e-03 9.703355e-01\n464 2.57084189 0.027074445  2.261815e-03 9.706637e-01\n465 2.57357974 0.027074445  1.972906e-03 9.709526e-01\n466 2.57905544 0.027074445  1.718649e-03 9.712069e-01\n467 2.58453114 0.027074445  1.495397e-03 9.714302e-01\n468 2.59822040 0.027074445  1.299399e-03 9.716262e-01\n469 2.60643395 0.027074445  1.128009e-03 9.717975e-01\n470 2.62012320 0.027074445  9.779760e-04 9.719476e-01\n471 2.62559890 0.026706614  1.345807e-03 9.719476e-01\n472 2.62833676 0.026343502  1.708919e-03 9.719476e-01\n473 2.63107461 0.026343502  7.915159e-04 9.728650e-01\n474 2.63655031 0.026343502  6.830740e-04 9.729734e-01\n475 2.64476386 0.026343502  5.886472e-04 9.730679e-01\n476 2.65023956 0.025984599  8.655650e-04 9.731498e-01\n477 2.65297741 0.025984599  7.456998e-04 9.732697e-01\n478 2.66940452 0.025629593  1.100706e-03 9.732697e-01\n479 2.67214237 0.025629593  9.481632e-04 9.734222e-01\n480 2.67488022 0.025629593  8.157161e-04 9.735547e-01\n481 2.69952088 0.025629593  7.007058e-04 9.736697e-01\n482 2.71868583 0.025629593  6.013706e-04 9.737690e-01\n483 2.72963723 0.025629593  4.282696e-04 9.739421e-01\n484 2.77344285 0.025278763  7.790994e-04 9.739421e-01\n485 2.78713210 0.025278763  6.665294e-04 9.740547e-01\n486 2.79260780 0.024932105  1.013187e-03 9.740547e-01\n487 2.79534565 0.024932105  8.662502e-04 9.742016e-01\n488 2.79808350 0.024932105  7.393603e-04 9.743285e-01\n489 2.80355921 0.024589435  1.082030e-03 9.743285e-01\n490 2.80629706 0.024251057  1.420409e-03 9.743285e-01\n491 2.80903491 0.023916940  1.754526e-03 9.743285e-01\n492 2.81724846 0.023586764  2.084702e-03 9.743285e-01\n493 2.82272416 0.023586764  1.785610e-03 9.746276e-01\n494 2.82546201 0.023260756  2.111618e-03 9.746276e-01\n495 2.83093771 0.023260756  1.808708e-03 9.749305e-01\n496 2.83915127 0.022938837  1.869506e-03 9.751917e-01\n497 2.85010267 0.022938837  1.598652e-03 9.754625e-01\n498 2.85284052 0.022621230  1.916259e-03 9.754625e-01\n499 2.86379192 0.022621230  1.637789e-03 9.757410e-01\n500 2.86926762 0.022621230  1.398212e-03 9.759806e-01\n501 2.88021903 0.022307426  1.712017e-03 9.759806e-01\n502 2.88843258 0.022307426  1.461440e-03 9.762311e-01\n503 2.89390828 0.021686721  2.082145e-03 9.762311e-01\n504 2.90485969 0.021686721  1.779983e-03 9.765333e-01\n505 2.92950034 0.021686721  1.518941e-03 9.767943e-01\n506 2.95414100 0.021686721  1.293927e-03 9.770194e-01\n507 2.95961670 0.021384114  1.596534e-03 9.770194e-01\n508 2.96509240 0.021384114  1.360966e-03 9.772549e-01\n509 2.98151951 0.021085177  1.659903e-03 9.772549e-01\n510 2.98973306 0.021085177  1.416255e-03 9.774986e-01\n511 3.01437372 0.021085177  1.206917e-03 9.777079e-01\n512 3.01984942 0.021084007  1.206917e-03 9.777091e-01\n513 3.02532512 0.021084007  1.027372e-03 9.778886e-01\n514 3.02806297 0.020786646  1.324733e-03 9.778886e-01\n515 3.03353867 0.020493150  1.618229e-03 9.778886e-01\n516 3.04449008 0.020493150  1.380229e-03 9.781266e-01\n517 3.04996578 0.020202490  1.670889e-03 9.781266e-01\n518 3.05817933 0.020202490  1.424592e-03 9.783729e-01\n519 3.07186858 0.019915621  1.499962e-03 9.785844e-01\n520 3.09377139 0.019632490  1.783093e-03 9.785844e-01\n521 3.10198494 0.019632490  1.521735e-03 9.788458e-01\n522 3.10472279 0.019632490  1.297528e-03 9.790700e-01\n523 3.10746064 0.019632490  1.104960e-03 9.792625e-01\n524 3.11019849 0.019632490  9.393942e-04 9.794281e-01\n525 3.11567420 0.019352835  1.077058e-03 9.795701e-01\n526 3.11841205 0.019352835  9.141518e-04 9.797330e-01\n527 3.12662560 0.019076590  1.190397e-03 9.797330e-01\n528 3.13483915 0.019076590  8.291965e-04 9.800942e-01\n529 3.15126626 0.019076590  7.013743e-04 9.802220e-01\n530 3.15947981 0.019076590  5.924265e-04 9.803310e-01\n531 3.17316906 0.018803945  7.719012e-04 9.804242e-01\n532 3.17864476 0.018803945  6.512310e-04 9.805448e-01\n533 3.19233402 0.018803945  5.485506e-04 9.806475e-01\n534 3.22518823 0.018803945  3.737943e-04 9.808223e-01\n535 3.23887748 0.018534393  6.433460e-04 9.808223e-01\n536 3.24709103 0.018534393  5.404181e-04 9.809252e-01\n537 3.26078029 0.018534393  4.527625e-04 9.810128e-01\n538 3.26625599 0.018534393  3.787862e-04 9.810868e-01\n539 3.27173169 0.018534393  3.161274e-04 9.811495e-01\n540 3.27994524 0.018533337  3.161274e-04 9.811505e-01\n541 3.28815880 0.018533337  2.633314e-04 9.812033e-01\n542 3.30458590 0.018533337  2.189532e-04 9.812477e-01\n543 3.31006160 0.018533337  1.817637e-04 9.812849e-01\n544 3.31553730 0.018266556  4.485442e-04 9.812849e-01\n545 3.31827515 0.018266556  3.724129e-04 9.813610e-01\n546 3.32648871 0.018266556  3.084207e-04 9.814250e-01\n547 3.32922656 0.018266556  2.548784e-04 9.814786e-01\n548 3.33744011 0.018266556  2.100401e-04 9.815234e-01\n549 3.36755647 0.018266556  1.726237e-04 9.815608e-01\n550 3.37577002 0.018003059  4.361214e-04 9.815608e-01\n551 3.38398357 0.017743027  6.961530e-04 9.815608e-01\n552 3.38672142 0.017743027  5.732282e-04 9.816837e-01\n553 3.41136208 0.017743027  3.674293e-04 9.818895e-01\n554 3.42778919 0.017743027  3.001701e-04 9.819568e-01\n555 3.45516769 0.017743027  1.879805e-04 9.820690e-01\n556 3.48254620 0.017743027  1.522028e-04 9.821048e-01\n557 3.48528405 0.017743027  1.229146e-04 9.821341e-01\n558 3.48802190 0.017486146  3.797956e-04 9.821341e-01\n559 3.49075975 0.017232669  6.332731e-04 9.821341e-01\n560 3.49349760 0.017232669  3.887800e-04 9.823786e-01\n561 3.49623546 0.016981613  6.398360e-04 9.823786e-01\n562 3.50171116 0.016981613  5.160389e-04 9.825023e-01\n563 3.53182752 0.016981613  4.149779e-04 9.826034e-01\n564 3.54551677 0.016981613  2.503787e-04 9.827680e-01\n565 3.55373032 0.016733154  4.988370e-04 9.827680e-01\n566 3.56468172 0.016733154  3.997791e-04 9.828671e-01\n567 3.57015743 0.016733154  3.194797e-04 9.829474e-01\n568 3.57563313 0.016733154  2.547023e-04 9.830121e-01\n569 3.59479808 0.016733154  2.025177e-04 9.830643e-01\n570 3.59753593 0.016732183  2.025177e-04 9.830653e-01\n571 3.62217659 0.016485732  4.489686e-04 9.830653e-01\n572 3.62765229 0.016485732  3.568393e-04 9.831574e-01\n573 3.63312799 0.016485732  2.832139e-04 9.832311e-01\n574 3.63860370 0.016242422  5.265243e-04 9.832311e-01\n575 3.70431211 0.016002384  7.665621e-04 9.832311e-01\n576 3.73169062 0.016001445  7.665621e-04 9.832320e-01\n577 3.73716632 0.016001445  6.104084e-04 9.833881e-01\n578 3.76454483 0.016001445  4.847595e-04 9.835138e-01\n579 3.79739904 0.016001445  3.841724e-04 9.836144e-01\n580 3.80013689 0.016001445  3.035833e-04 9.836950e-01\n581 3.83025325 0.016001445  2.389012e-04 9.837597e-01\n582 3.84668036 0.016001445  1.874202e-04 9.838111e-01\n583 3.89869952 0.016001445  1.465771e-04 9.838520e-01\n584 3.92060233 0.015763541  3.844814e-04 9.838520e-01\n585 3.92607803 0.015763541  2.157795e-04 9.840207e-01\n586 3.93155373 0.015528025  4.512961e-04 9.840207e-01\n587 3.93429158 0.015528025  3.512391e-04 9.841207e-01\n588 3.93976728 0.015528025  2.725609e-04 9.841994e-01\n589 3.95893224 0.015295528  4.430606e-04 9.842614e-01\n590 3.96167009 0.015295528  3.425262e-04 9.843619e-01\n591 3.98357290 0.015065794  5.722596e-04 9.843619e-01\n592 4.01368925 0.014839017  7.990367e-04 9.843619e-01\n593 4.02737851 0.014614727  1.023327e-03 9.843619e-01\n594 4.03832991 0.014393367  1.244687e-03 9.843619e-01\n595 4.05749487 0.014393367  9.705105e-04 9.846361e-01\n596 4.07392197 0.014174919  1.188959e-03 9.846361e-01\n597 4.09308693 0.014174919  9.274484e-04 9.848976e-01\n598 4.13141684 0.014174919  7.197438e-04 9.851053e-01\n599 4.13689254 0.014174919  5.560396e-04 9.852690e-01\n600 4.16427105 0.014174919  4.278959e-04 9.853972e-01\n601 4.18891170 0.014174919  3.272982e-04 9.854978e-01\n602 4.20260096 0.013959358  5.428590e-04 9.854978e-01\n603 4.21355236 0.013746103  7.561141e-04 9.854978e-01\n604 4.21629021 0.013746103  5.806166e-04 9.856733e-01\n605 4.23819302 0.013745281  4.440290e-04 9.858107e-01\n606 4.24366872 0.013744457  4.440290e-04 9.858115e-01\n607 4.24640657 0.013532886  6.555998e-04 9.858115e-01\n608 4.27378508 0.013324070  8.644154e-04 9.858115e-01\n609 4.28199863 0.013117485  1.071001e-03 9.858115e-01\n610 4.29295003 0.013117485  8.252705e-04 9.860572e-01\n611 4.35044490 0.012913589  1.029167e-03 9.860572e-01\n612 4.39698836 0.012510765  1.431991e-03 9.860572e-01\n613 4.39972621 0.012510004  1.431991e-03 9.860580e-01\n614 4.43531828 0.012510004  1.109369e-03 9.863806e-01\n615 4.48186174 0.012510004  8.559784e-04 9.866340e-01\n616 4.50102669 0.012313706  1.052277e-03 9.866340e-01\n617 4.50924025 0.012120121  1.245861e-03 9.866340e-01\n618 4.52292950 0.012120121  9.660678e-04 9.869138e-01\n619 4.53388090 0.012120121  7.471865e-04 9.871327e-01\n620 4.56399726 0.011929129  9.381786e-04 9.871327e-01\n621 4.56673511 0.011929129  7.274942e-04 9.873434e-01\n622 4.57494867 0.011929129  5.605809e-04 9.875103e-01\n623 4.59685147 0.011929129  4.303179e-04 9.876406e-01\n624 4.61875428 0.011740537  6.189104e-04 9.876406e-01\n625 4.63244353 0.011740537  4.753368e-04 9.877841e-01\n626 4.67898700 0.011740537  3.638887e-04 9.878956e-01\n627 4.71731691 0.011554474  4.628569e-04 9.879827e-01\n628 4.77207392 0.011370774  6.465572e-04 9.879827e-01\n629 4.77754962 0.011370774  4.950230e-04 9.881342e-01\n630 4.78850103 0.011189765  6.760313e-04 9.881342e-01\n631 4.79671458 0.011189765  5.178464e-04 9.882924e-01\n632 4.81587953 0.011011223  6.963883e-04 9.882924e-01\n633 4.83778234 0.011011223  5.334101e-04 9.884554e-01\n634 4.84052019 0.011011223  4.061443e-04 9.885826e-01\n635 4.85147159 0.011011223  3.078380e-04 9.886809e-01\n636 4.88158795 0.011011223  2.322859e-04 9.887565e-01\n637 4.88980151 0.010835153  4.083566e-04 9.887565e-01\n638 4.89527721 0.010835153  3.072003e-04 9.888576e-01\n639 4.90075291 0.010835153  2.300812e-04 9.889348e-01\n640 4.92265572 0.010835153  1.715615e-04 9.889933e-01\n641 4.96098563 0.010835153  1.271536e-04 9.890377e-01\n642 4.97741273 0.010834464  1.271536e-04 9.890384e-01\n643 5.00752909 0.010834464  9.344459e-05 9.890721e-01\n644 5.01300479 0.010833760  9.344459e-05 9.890728e-01\n645 5.03490760 0.010833760  6.841593e-05 9.890978e-01\n646 5.06502396 0.010833760  4.986178e-05 9.891164e-01\n647 5.06776181 0.010833760  3.610654e-05 9.891301e-01\n648 5.08145106 0.010833049  3.610654e-05 9.891308e-01\n649 5.13347023 0.010833049  2.603123e-05 9.891409e-01\n650 5.13620808 0.010649119  2.099612e-04 9.891409e-01\n651 5.14442163 0.010649119  1.522027e-04 9.891987e-01\n652 5.15811088 0.010649119  1.092726e-04 9.892416e-01\n653 5.16084873 0.010649119  7.799431e-05 9.892729e-01\n654 5.18822724 0.010466803  2.603108e-04 9.892729e-01\n655 5.19096509 0.010466803  1.858159e-04 9.893474e-01\n656 5.22108145 0.010466803  1.311589e-04 9.894020e-01\n657 5.24298426 0.010466803  9.205383e-05 9.894411e-01\n658 5.24845996 0.010285647  2.732096e-04 9.894411e-01\n659 5.28952772 0.010285647  1.907046e-04 9.895236e-01\n660 5.33880903 0.010285647  1.308273e-04 9.895835e-01\n661 5.40999316 0.010100838  3.156359e-04 9.895835e-01\n662 5.42368241 0.009917112  4.993620e-04 9.895835e-01\n663 5.46201232 0.009917112  3.445654e-04 9.897383e-01\n664 5.50855578 0.009731525  5.301525e-04 9.897383e-01\n665 5.52498289 0.009548931  7.127468e-04 9.897383e-01\n666 5.53319644 0.009548931  4.938478e-04 9.899572e-01\n667 5.53867214 0.009548931  3.391794e-04 9.901119e-01\n668 5.55236140 0.009367566  5.205445e-04 9.901119e-01\n669 5.56057495 0.009188605  6.995057e-04 9.901119e-01\n670 5.57152635 0.009012760  8.753499e-04 9.901119e-01\n671 5.57426420 0.008839775  1.048336e-03 9.901119e-01\n672 5.61806982 0.008839086  1.048336e-03 9.901126e-01\n673 5.65913758 0.008664918  1.222504e-03 9.901126e-01\n674 5.67830253 0.008492777  1.394645e-03 9.901126e-01\n675 5.68651608 0.008492777  9.902791e-04 9.905169e-01\n676 5.69199179 0.008492084  9.902791e-04 9.905176e-01\n677 5.70294319 0.008492084  6.983490e-04 9.908096e-01\n678 5.70841889 0.008492084  4.898052e-04 9.910181e-01\n679 5.82340862 0.008492084  3.362276e-04 9.911717e-01\n680 5.82614648 0.008492084  2.290667e-04 9.912788e-01\n681 5.83983573 0.008492084  1.536917e-04 9.913542e-01\n682 5.88090349 0.008305418  3.403581e-04 9.913542e-01\n683 5.89185489 0.008305418  2.227524e-04 9.914718e-01\n684 5.94387406 0.008305418  6.232037e-05 9.916323e-01\n685 5.95208761 0.008304654  6.232037e-05 9.916330e-01\n686 6.01505818 0.008304654  3.799052e-05 9.916574e-01\n687 6.05886379 0.008303792  3.799052e-05 9.916582e-01\n688 6.10814511 0.008075158  2.666246e-04 9.916582e-01\n689 6.17932923 0.008074223  2.666246e-04 9.916592e-01\n690 6.25325120 0.008074223  1.457366e-04 9.917800e-01\n691 6.26146475 0.008074223  7.785191e-05 9.918479e-01\n692 6.26420260 0.007822466  3.296089e-04 9.918479e-01\n693 6.34633812 0.007821440  3.296089e-04 9.918490e-01\n694 6.43668720 0.007821440  1.543759e-04 9.920242e-01\n695 6.72963723 0.007820027  1.543759e-04 9.920256e-01\n696 6.79534565 0.007820027  3.652668e-05 9.921434e-01\n697 6.91854894 0.007820027  1.691604e-06 9.921783e-01\n698 6.95961670 0.007820027 -7.578400e-08 9.921800e-01\n699 6.98699521 0.007820027  9.416035e-09 9.921800e-01\n700 7.09924709 0.007820027 -2.051100e-09 9.921800e-01\n701 7.34565366 0.007820027  7.966824e-10 9.921800e-01\n702 7.37577002 0.007096607  7.234206e-04 9.921800e-01\n703 7.44147844 0.007096607 -5.013185e-04 9.934047e-01\n704 7.46064339 0.007092747 -5.013185e-04 9.934086e-01\n705 7.63586585 0.007086929 -5.013185e-04 9.934144e-01\n706 7.96714579 0.007086929  2.781529e-03 9.901315e-01\n707 9.11430527 0.007086929  2.781529e-03 9.901315e-01\n\n\nShow R code\n#Simplify the model\ncfit_tspec_strata_red &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + trt.3 + strata(trans),\ndata=cdata_long_exp, id=id)\nsummary(cfit_tspec_strata_red)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + \n    trt.3 + strata(trans), data = cdata_long_exp, id = id)\n\n  n= 2326, number of events= 920 \n\n          coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)    \ntrt.1 -0.50458   0.60376  0.10624   0.10572 -4.773 1.82e-06 ***\ntrt.2  0.04585   1.04692  0.33275   0.33397  0.137    0.891    \ntrt.3  0.25551   1.29113  0.11246   0.11237  2.274    0.023 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntrt.1    0.6038     1.6563    0.4908    0.7428\ntrt.2    1.0469     0.9552    0.5440    2.0146\ntrt.3    1.2911     0.7745    1.0359    1.6092\n\nConcordance= 0.547  (se = 0.009 )\nLikelihood ratio test= 29.29  on 3 df,   p=2e-06\nWald test            = 28.35  on 3 df,   p=3e-06\nScore (logrank) test = 28.25  on 3 df,   p=3e-06,   Robust = 31.94  p=5e-07\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\n\nShow R code\n#Newdata to predict on - ref levels\nnewdata_tspec0_red &lt;- data.frame(\n  trans=1:3,\n  strata=1:3,\n  trt.1 = c(0,0,0),\n  trt.2 = c(0,0,0),\n  trt.3 = c(0,0,0))  \n  \n#Cumulative hazards - ref levels\nmsfit_tspec_trt0_red &lt;- msfit(cfit_tspec_strata_red, trans=tmat, newdata=newdata_tspec0_red)\n\n#Newdata to predict on - trt effect\nnewdata_tspec1_red &lt;- data.frame(\n  trans=1:3,\n  strata=1:3,\n  trt.1 = c(1,0,0),\n  trt.2 = c(0,1,0),\n  trt.3 = c(0,0,1))  \n  \n#Cumulative hazards - ref levels\nmsfit_tspec_trt1_red &lt;- msfit(cfit_tspec_strata_red, trans=tmat, newdata=newdata_tspec1_red)\n\n#Probabilities in state\npr_trt0_red &lt;- probtrans(msfit_tspec_trt0_red, predt = 0, variance=FALSE)\npr_trt1_red &lt;- probtrans(msfit_tspec_trt1_red, predt = 0, variance=FALSE)\n\n#Check output for from entry to recur\npr_trt0_red[[1]]\n\n\n          time   pstate1     pstate2     pstate3\n1   0.00000000 1.0000000 0.000000000 0.000000000\n2   0.02190281 0.9987632 0.001236793 0.000000000\n3   0.02464066 0.9975270 0.002472980 0.000000000\n4   0.05201916 0.9962914 0.003708560 0.000000000\n5   0.05475702 0.9950559 0.004944140 0.000000000\n6   0.06297057 0.9939964 0.004944140 0.001059505\n7   0.06570842 0.9929368 0.004944140 0.002119063\n8   0.07665982 0.9917014 0.006179549 0.002119063\n9   0.09308693 0.9917014 0.005072549 0.003226062\n10  0.09582478 0.9904660 0.006307958 0.003226062\n11  0.09856263 0.9892306 0.007543367 0.003226062\n12  0.10403833 0.9879952 0.008778776 0.003226062\n13  0.10951403 0.9867598 0.010014185 0.003226062\n14  0.11772758 0.9855250 0.011248982 0.003226062\n15  0.12320329 0.9832317 0.012483778 0.004284541\n16  0.13415469 0.9819973 0.013718181 0.004284541\n17  0.14236824 0.9819973 0.012562808 0.005439914\n18  0.15331964 0.9809391 0.012562808 0.006498121\n19  0.16153320 0.9797051 0.013796818 0.006498121\n20  0.16974675 0.9772355 0.016266394 0.006498121\n21  0.17248460 0.9760015 0.017500402 0.006498121\n22  0.18617385 0.9747681 0.018733792 0.006498121\n23  0.19712526 0.9723010 0.021200896 0.006498121\n24  0.21081451 0.9698339 0.023668001 0.006498121\n25  0.21355236 0.9686011 0.024900769 0.006498121\n26  0.21629021 0.9673683 0.024957002 0.007674655\n27  0.21902806 0.9636653 0.028660029 0.007674655\n28  0.23271732 0.9611982 0.031127132 0.007674655\n29  0.23545517 0.9587314 0.033593920 0.007674655\n30  0.24093087 0.9574993 0.034826051 0.007674655\n31  0.24914442 0.9550338 0.037291584 0.007674655\n32  0.25462012 0.9550338 0.036106054 0.008860185\n33  0.25735797 0.9538023 0.037337554 0.008860185\n34  0.26830938 0.9501030 0.041036832 0.008860185\n35  0.27104723 0.9476384 0.043501416 0.008860185\n36  0.27378508 0.9464069 0.044732907 0.008860185\n37  0.27652293 0.9439426 0.047197175 0.008860185\n38  0.27926078 0.9427118 0.048428028 0.008860185\n39  0.28199863 0.9414809 0.049658881 0.008860185\n40  0.28747433 0.9402501 0.050889734 0.008860185\n41  0.29021218 0.9390192 0.052120587 0.008860185\n42  0.29568789 0.9377884 0.053351440 0.008860185\n43  0.29842574 0.9365575 0.054582293 0.008860185\n44  0.30390144 0.9353267 0.055813146 0.008860185\n45  0.30937714 0.9316292 0.058316628 0.010054132\n46  0.31759069 0.9279325 0.062013410 0.010054132\n47  0.32306639 0.9267023 0.063243604 0.010054132\n48  0.32580424 0.9254721 0.064473799 0.010054132\n49  0.33127995 0.9230100 0.066935825 0.010054132\n50  0.33401780 0.9217799 0.066971542 0.011248607\n51  0.34223135 0.9217799 0.065776430 0.012443719\n52  0.34770705 0.9205497 0.065811510 0.013638831\n53  0.35318275 0.9205497 0.064609402 0.014840939\n54  0.35865845 0.9193195 0.065839595 0.014840939\n55  0.36139630 0.9180893 0.067069787 0.014840939\n56  0.36413415 0.9180893 0.065872922 0.016037804\n57  0.36687201 0.9168597 0.067102461 0.016037804\n58  0.37234771 0.9156308 0.068331347 0.016037804\n59  0.37782341 0.9156308 0.067139431 0.017229720\n60  0.38056126 0.9144020 0.068368318 0.017229720\n61  0.38603696 0.9131731 0.068398557 0.018428367\n62  0.39151266 0.9119442 0.069627443 0.018428367\n63  0.39425051 0.9119442 0.068421705 0.019634105\n64  0.39698836 0.9107153 0.068438636 0.020846061\n65  0.39972621 0.9082562 0.070897740 0.020846061\n66  0.40246407 0.9070280 0.072125966 0.020846061\n67  0.41067762 0.9070280 0.070918771 0.022053255\n68  0.42162902 0.9045702 0.073376558 0.022053255\n69  0.42984257 0.9008831 0.077063596 0.022053255\n70  0.43805613 0.8996563 0.078290491 0.022053255\n71  0.44079398 0.8972024 0.080744299 0.022053255\n72  0.44900753 0.8972024 0.079555331 0.023242223\n73  0.45174538 0.8935214 0.082047433 0.024431191\n74  0.45448323 0.8922965 0.082086712 0.025616807\n75  0.45722108 0.8910716 0.083311608 0.025616807\n76  0.45995893 0.8898467 0.084536504 0.025616807\n77  0.46269678 0.8886225 0.085760731 0.025616807\n78  0.46817248 0.8886225 0.083378159 0.027999379\n79  0.47364819 0.8849447 0.087055914 0.027999379\n80  0.47638604 0.8812670 0.090733669 0.027999379\n81  0.47912389 0.8800427 0.091957883 0.027999379\n82  0.48186174 0.8775926 0.094408016 0.027999379\n83  0.49007529 0.8763684 0.095632227 0.027999379\n84  0.49555099 0.8751442 0.096856438 0.027999379\n85  0.50102669 0.8726944 0.099306236 0.027999379\n86  0.50650240 0.8653308 0.106669845 0.027999379\n87  0.50924025 0.8653308 0.105489436 0.029179788\n88  0.51197810 0.8653308 0.104305170 0.030364054\n89  0.51471595 0.8641086 0.105527298 0.030364054\n90  0.51745380 0.8616627 0.107973285 0.030364054\n91  0.52292950 0.8592167 0.109233740 0.031549587\n92  0.53661875 0.8579945 0.110455863 0.031549587\n93  0.54209446 0.8567724 0.111677987 0.031549587\n94  0.54483231 0.8555510 0.112899420 0.031549587\n95  0.55030801 0.8543303 0.112939922 0.032729827\n96  0.55578371 0.8531095 0.114160664 0.032729827\n97  0.55852156 0.8518888 0.115381407 0.032729827\n98  0.56125941 0.8506680 0.116602149 0.032729827\n99  0.56399726 0.8506680 0.115423744 0.033908232\n100 0.56947296 0.8482265 0.116686841 0.035086637\n101 0.58863792 0.8457864 0.117951150 0.036262438\n102 0.59137577 0.8445678 0.119169804 0.036262438\n103 0.59685147 0.8409072 0.121656629 0.037436162\n104 0.59958932 0.8386535 0.121702801 0.039643720\n105 0.60506502 0.8374353 0.122921013 0.039643720\n106 0.60780287 0.8374353 0.121748354 0.040816379\n107 0.61054073 0.8362171 0.122966567 0.040816379\n108 0.61327858 0.8349988 0.124184779 0.040816379\n109 0.61875428 0.8349988 0.123011259 0.041989898\n110 0.62149213 0.8337806 0.124229471 0.041989898\n111 0.62422998 0.8325624 0.125447683 0.041989898\n112 0.62696783 0.8301242 0.127885892 0.041989898\n113 0.62970568 0.8240152 0.133994896 0.041989898\n114 0.63518138 0.8240152 0.132817669 0.043167125\n115 0.64339493 0.8227970 0.134035852 0.043167125\n116 0.64887064 0.8191378 0.137695107 0.043167125\n117 0.65160849 0.8179203 0.137736826 0.044342864\n118 0.65982204 0.8179203 0.136560731 0.045518960\n119 0.66255989 0.8167029 0.136602094 0.046695055\n120 0.66529774 0.8154861 0.137818833 0.046695055\n121 0.67077344 0.8130512 0.140253770 0.046695055\n122 0.67351129 0.8118352 0.141469787 0.046695055\n123 0.67898700 0.8106191 0.142685803 0.046695055\n124 0.68446270 0.8094038 0.143901098 0.046695055\n125 0.68720055 0.8094038 0.142731046 0.047865106\n126 0.68993840 0.8081886 0.143946341 0.047865106\n127 0.69267625 0.8069740 0.143990492 0.049035525\n128 0.69815195 0.8057594 0.145205062 0.049035525\n129 0.70088980 0.8033303 0.147634221 0.049035525\n130 0.70362765 0.8021171 0.147680908 0.050201956\n131 0.70636550 0.8009040 0.148894025 0.050201956\n132 0.70910335 0.8009040 0.146550479 0.052545502\n133 0.71184120 0.7984763 0.148978188 0.052545502\n134 0.71457906 0.7972639 0.150190573 0.052545502\n135 0.71731691 0.7960523 0.151402228 0.052545502\n136 0.72005476 0.7936271 0.153827384 0.052545502\n137 0.72279261 0.7924155 0.153875013 0.053709525\n138 0.73648186 0.7924155 0.152710630 0.054873908\n139 0.74195756 0.7899903 0.153968816 0.056040882\n140 0.74743326 0.7887787 0.155180465 0.056040882\n141 0.75017112 0.7875670 0.155221552 0.057211443\n142 0.75290897 0.7875670 0.154048104 0.058384891\n143 0.75564682 0.7851418 0.155299821 0.059558340\n144 0.76386037 0.7815013 0.157763754 0.060734969\n145 0.76659822 0.7802896 0.158975391 0.060734969\n146 0.77481177 0.7802896 0.156604759 0.063105601\n147 0.78028747 0.7790780 0.157816396 0.063105601\n148 0.78302533 0.7754397 0.161454731 0.063105601\n149 0.79123888 0.7754397 0.160273607 0.064286725\n150 0.79397673 0.7730160 0.162697266 0.064286725\n151 0.79671458 0.7718051 0.163908145 0.064286725\n152 0.80219028 0.7718051 0.162726364 0.065468506\n153 0.80492813 0.7693815 0.165150026 0.065468506\n154 0.81040383 0.7669582 0.167573309 0.065468506\n155 0.82135524 0.7657481 0.168783426 0.065468506\n156 0.82683094 0.7657481 0.167600607 0.066651325\n157 0.82956879 0.7645380 0.168810724 0.066651325\n158 0.83230664 0.7633286 0.168837072 0.067834335\n159 0.84325804 0.7621192 0.170046430 0.067834335\n160 0.85147159 0.7621192 0.168860651 0.069020115\n161 0.85694730 0.7609099 0.168884230 0.070205895\n162 0.85968515 0.7609099 0.166503953 0.072586172\n163 0.86242300 0.7584896 0.168924213 0.072586172\n164 0.86516085 0.7584896 0.167740407 0.073769977\n165 0.88158795 0.7560713 0.168974950 0.074953783\n166 0.88432580 0.7560713 0.167795601 0.076133132\n167 0.88706366 0.7560713 0.166616252 0.077312481\n168 0.88980151 0.7548642 0.167823314 0.077312481\n169 0.89253936 0.7538443 0.167823314 0.078332358\n170 0.89801506 0.7526377 0.169029909 0.078332358\n171 0.90075291 0.7514319 0.170235739 0.078332358\n172 0.90349076 0.7490198 0.172647801 0.078332358\n173 0.90622861 0.7490198 0.171469875 0.079510284\n174 0.91170431 0.7478148 0.172674935 0.079510284\n175 0.91444216 0.7466097 0.173879995 0.079510284\n176 0.91718001 0.7454047 0.175085056 0.079510284\n177 0.91991786 0.7429930 0.177496740 0.079510284\n178 0.92265572 0.7393743 0.181115463 0.079510284\n179 0.93086927 0.7383572 0.181115463 0.080527354\n180 0.93360712 0.7371534 0.182319265 0.080527354\n181 0.93634497 0.7371534 0.181141951 0.081704667\n182 0.93908282 0.7371534 0.179964637 0.082881981\n183 0.94182067 0.7359496 0.181168439 0.082881981\n184 0.95277207 0.7335400 0.183578014 0.082881981\n185 0.95550992 0.7323362 0.183603976 0.084059817\n186 0.96372348 0.7299266 0.186013554 0.084059817\n187 0.96919918 0.7287228 0.187217349 0.084059817\n188 0.97193703 0.7277078 0.186038847 0.086253369\n189 0.97467488 0.7252992 0.187268974 0.087431872\n190 0.98562628 0.7228909 0.189677207 0.087431872\n191 0.99110198 0.7216884 0.189702715 0.088608884\n192 0.99383984 0.7216884 0.188525545 0.089786053\n193 0.99931554 0.7204859 0.188548750 0.090965367\n194 1.00205339 0.7192842 0.188573160 0.092142682\n195 1.01026694 0.7180824 0.189774884 0.092142682\n196 1.01300479 0.7168807 0.190976609 0.092142682\n197 1.01848049 0.7156790 0.191000567 0.093320448\n198 1.02395619 0.7144773 0.192202291 0.093320448\n199 1.02943190 0.7144773 0.191024231 0.094498508\n200 1.03490760 0.7132755 0.192225955 0.094498508\n201 1.03764545 0.7120738 0.193427680 0.094498508\n202 1.04038330 0.7096687 0.195832757 0.094498508\n203 1.04312115 0.7096687 0.194656179 0.095675087\n204 1.04585900 0.7084678 0.194680517 0.096851665\n205 1.05133470 0.7072669 0.193520826 0.099212271\n206 1.05681040 0.7048634 0.195924296 0.099212271\n207 1.06502396 0.7036633 0.195949326 0.100387343\n208 1.06776181 0.7036633 0.194772047 0.101564622\n209 1.07323751 0.7024632 0.195972150 0.101564622\n210 1.07597536 0.7012639 0.197171441 0.101564622\n211 1.08966461 0.7000655 0.198369920 0.101564622\n212 1.09514031 0.7000655 0.197196306 0.102738236\n213 1.09787817 0.6988670 0.198394785 0.102738236\n214 1.10061602 0.6976685 0.198417478 0.103914021\n215 1.10882957 0.6964700 0.199615957 0.103914021\n216 1.11156742 0.6952724 0.199639580 0.105088061\n217 1.11704312 0.6940747 0.200837242 0.105088061\n218 1.11978097 0.6940747 0.199664922 0.106260381\n219 1.12525667 0.6928779 0.199689445 0.107432702\n220 1.13073238 0.6916810 0.198534436 0.109784555\n221 1.13620808 0.6892857 0.200929787 0.109784555\n222 1.14168378 0.6892857 0.199758916 0.110955426\n223 1.14989733 0.6892857 0.198588045 0.112126296\n224 1.15263518 0.6882786 0.198588045 0.113133363\n225 1.15537303 0.6870822 0.198613521 0.114304234\n226 1.17180014 0.6870822 0.197444507 0.115473248\n227 1.17453799 0.6858867 0.198640029 0.115473248\n228 1.17727584 0.6858867 0.196289710 0.117823567\n229 1.18001369 0.6846912 0.197485232 0.117823567\n230 1.18548939 0.6834965 0.197508652 0.118994841\n231 1.18822724 0.6823018 0.198703348 0.118994841\n232 1.19096509 0.6811079 0.199897214 0.118994841\n233 1.19644079 0.6799141 0.199921396 0.120164527\n234 1.19917864 0.6787202 0.198768723 0.122511066\n235 1.20191650 0.6775263 0.198792662 0.123680994\n236 1.20465435 0.6763325 0.199986529 0.123680994\n237 1.20739220 0.6763325 0.198816321 0.124851202\n238 1.21286790 0.6751386 0.198837971 0.126023419\n239 1.21560575 0.6751386 0.197667636 0.127193754\n240 1.22655715 0.6739456 0.197690331 0.128364090\n241 1.22929500 0.6727534 0.198882526 0.128364090\n242 1.24024641 0.6715620 0.200073884 0.128364090\n243 1.24298426 0.6703694 0.200099776 0.129530834\n244 1.25393566 0.6679824 0.202486751 0.129530834\n245 1.25667351 0.6679824 0.201319549 0.130698035\n246 1.25941136 0.6679824 0.200152347 0.131865237\n247 1.26214921 0.6667906 0.201344137 0.131865237\n248 1.26488706 0.6667906 0.200174819 0.133034555\n249 1.27036277 0.6667906 0.199005501 0.134203873\n250 1.27310062 0.6655988 0.197851743 0.136549420\n251 1.27583847 0.6632140 0.200236612 0.136549420\n252 1.28405202 0.6632140 0.199070898 0.137715134\n253 1.29226557 0.6632140 0.197905184 0.138880848\n254 1.29774127 0.6620239 0.197929562 0.140046562\n255 1.30047912 0.6620239 0.196763704 0.141212419\n256 1.30321697 0.6608338 0.197953797 0.141212419\n257 1.31416838 0.6596437 0.199143889 0.141212419\n258 1.31964408 0.6584536 0.200333981 0.141212419\n259 1.32511978 0.6584536 0.199167700 0.142378700\n260 1.32785763 0.6562613 0.200357792 0.143380944\n261 1.33059548 0.6552592 0.200357792 0.144382972\n262 1.33880903 0.6540693 0.201547711 0.144382972\n263 1.34154689 0.6528794 0.201571074 0.145549527\n264 1.34428474 0.6504978 0.203952653 0.145549527\n265 1.34976044 0.6493088 0.205141706 0.145549527\n266 1.35523614 0.6481197 0.206330760 0.145549527\n267 1.35797399 0.6469307 0.207519813 0.145549527\n268 1.36071184 0.6457416 0.208708867 0.145549527\n269 1.36344969 0.6445534 0.208731491 0.146715090\n270 1.36618754 0.6433652 0.206395198 0.150239569\n271 1.37713895 0.6433652 0.205225691 0.151409076\n272 1.37987680 0.6421770 0.206413878 0.151409076\n273 1.38261465 0.6409889 0.207602065 0.151409076\n274 1.38535250 0.6409889 0.206430425 0.152580715\n275 1.39630390 0.6398007 0.206446972 0.153752354\n276 1.39904175 0.6386134 0.207634285 0.153752354\n277 1.40177960 0.6386134 0.206464386 0.154922254\n278 1.40451745 0.6374260 0.207651699 0.154922254\n279 1.42915811 0.6374260 0.206481702 0.156092251\n280 1.43189596 0.6362387 0.207669015 0.156092251\n281 1.43737166 0.6350514 0.208856328 0.156092251\n282 1.44010951 0.6338641 0.210043641 0.156092251\n283 1.44284736 0.6326777 0.211230073 0.156092251\n284 1.44558522 0.6326777 0.210061582 0.157260742\n285 1.44832307 0.6326777 0.208893091 0.158429233\n286 1.45653662 0.6303026 0.211268184 0.158429233\n287 1.46201232 0.6291162 0.212454612 0.158429233\n288 1.46748802 0.6279297 0.213641040 0.158429233\n289 1.47022587 0.6279297 0.212472144 0.159598129\n290 1.47843943 0.6267442 0.213657685 0.159598129\n291 1.48391513 0.6255586 0.214843225 0.159598129\n292 1.48665298 0.6231858 0.217216111 0.159598129\n293 1.49486653 0.6231858 0.216048676 0.160765564\n294 1.49760438 0.6220011 0.217233320 0.160765564\n295 1.50034223 0.6208165 0.218417964 0.160765564\n296 1.50581793 0.6208165 0.217250346 0.161933182\n297 1.51403149 0.6208165 0.216080897 0.163102631\n298 1.51676934 0.6184458 0.218451552 0.163102631\n299 1.51950719 0.6172630 0.219634398 0.163102631\n300 1.53045859 0.6172630 0.218468325 0.164268704\n301 1.53319644 0.6160801 0.219651171 0.164268704\n302 1.53593429 0.6148973 0.220834017 0.164268704\n303 1.54140999 0.6148973 0.218495325 0.166607396\n304 1.54688569 0.6137144 0.219678170 0.166607396\n305 1.55783710 0.6137144 0.218511865 0.167773701\n306 1.56057495 0.6137144 0.217345560 0.168940007\n307 1.56878850 0.6113465 0.218547230 0.170106312\n308 1.57700205 0.6113465 0.216207065 0.172446477\n309 1.57973990 0.6101636 0.217389907 0.172446477\n310 1.58247775 0.6077961 0.218589063 0.173614845\n311 1.58795346 0.6077961 0.216244796 0.175959112\n312 1.59069131 0.6066142 0.217426723 0.175959112\n313 1.59342916 0.6066142 0.216256325 0.177129510\n314 1.59616701 0.6054322 0.216267854 0.178299908\n315 1.60711841 0.6054322 0.215095546 0.179472215\n316 1.61259411 0.6054322 0.213923239 0.180644522\n317 1.61806982 0.6042503 0.213932858 0.181816829\n318 1.62080767 0.6042503 0.212762366 0.182987322\n319 1.62354552 0.6007013 0.216311426 0.182987322\n320 1.62628337 0.5995212 0.216320810 0.184158018\n321 1.62902122 0.5995212 0.215151905 0.185326923\n322 1.63997262 0.5973533 0.216331065 0.186315629\n323 1.64544832 0.5973533 0.215162105 0.187484589\n324 1.64818617 0.5961738 0.213993611 0.189832620\n325 1.65092402 0.5961738 0.212824648 0.191001583\n326 1.65366188 0.5949952 0.214003260 0.191001583\n327 1.66461328 0.5938175 0.214011932 0.192170598\n328 1.66735113 0.5938175 0.212842869 0.193339662\n329 1.67556468 0.5938175 0.211671934 0.194510597\n330 1.67830253 0.5926398 0.212849622 0.194510597\n331 1.68104038 0.5926398 0.211678649 0.195681570\n332 1.68377823 0.5914621 0.212856337 0.195681570\n333 1.68651608 0.5902844 0.212861137 0.196854458\n334 1.68925394 0.5891076 0.214037895 0.196854458\n335 1.70294319 0.5879318 0.214042654 0.198025525\n336 1.71115674 0.5867569 0.215217550 0.198025525\n337 1.71937029 0.5857710 0.215217550 0.199011447\n338 1.72210815 0.5857710 0.214048289 0.200180709\n339 1.73032170 0.5845957 0.215223564 0.200180709\n340 1.74127310 0.5834205 0.216398839 0.200180709\n341 1.74674880 0.5822461 0.217573177 0.200180709\n342 1.75496235 0.5822461 0.216405650 0.201348236\n343 1.75770021 0.5822461 0.214059639 0.203694246\n344 1.76043806 0.5822461 0.211709880 0.206044006\n345 1.77138946 0.5822461 0.210536845 0.207217040\n346 1.77686516 0.5810718 0.211711183 0.207217040\n347 1.78781656 0.5798984 0.212884581 0.207217040\n348 1.79055441 0.5787250 0.214057979 0.207217040\n349 1.79876797 0.5775516 0.215231377 0.207217040\n350 1.80424367 0.5763791 0.215234494 0.208386377\n351 1.81519507 0.5740318 0.216412439 0.209555731\n352 1.81793292 0.5740318 0.215243039 0.210725131\n353 1.82067077 0.5730489 0.215243039 0.211708072\n354 1.82340862 0.5730489 0.214073639 0.212877472\n355 1.82888433 0.5718761 0.215246476 0.212877472\n356 1.83162218 0.5718761 0.214075204 0.214048743\n357 1.83436003 0.5718761 0.212903933 0.215220015\n358 1.83983573 0.5707032 0.214076770 0.215220015\n359 1.84257358 0.5707032 0.212905490 0.216391295\n360 1.84531143 0.5707032 0.211734210 0.217562575\n361 1.84804928 0.5695304 0.211733878 0.218735744\n362 1.85626283 0.5695304 0.210560711 0.219908912\n363 1.86173854 0.5683575 0.211733548 0.219908912\n364 1.86995209 0.5671847 0.212906385 0.219908912\n365 1.87268994 0.5671847 0.211735100 0.221080196\n366 1.87542779 0.5671847 0.210563815 0.222251481\n367 1.87816564 0.5660128 0.211735692 0.222251481\n368 1.88090349 0.5660128 0.210564404 0.223422770\n369 1.89459274 0.5660128 0.207026938 0.226960236\n370 1.89733060 0.5660128 0.205851913 0.228135261\n371 1.90554415 0.5660128 0.204674932 0.229312241\n372 1.90828200 0.5648409 0.205846809 0.229312241\n373 1.91649555 0.5624952 0.208192516 0.229312241\n374 1.91923340 0.5613243 0.209363422 0.229312241\n375 1.92197125 0.5589820 0.211705745 0.229312241\n376 1.93292266 0.5589820 0.210530838 0.230487148\n377 1.93839836 0.5589820 0.209355931 0.231662055\n378 1.94113621 0.5589820 0.206999487 0.234018499\n379 1.94661191 0.5578121 0.208169421 0.234018499\n380 1.94934976 0.5566431 0.208165469 0.235191414\n381 1.96030116 0.5566431 0.206990650 0.236366233\n382 1.96303901 0.5554742 0.206984794 0.237541052\n383 1.96577687 0.5554742 0.205810008 0.238715837\n384 1.97125257 0.5554742 0.204635223 0.239890623\n385 1.97399042 0.5554742 0.203460437 0.241065409\n386 1.97946612 0.5554742 0.202285651 0.242240195\n387 1.98767967 0.5543052 0.203454614 0.242240195\n388 1.99589322 0.5543052 0.202279862 0.243414947\n389 1.99863107 0.5531362 0.202274072 0.244589699\n390 2.00136893 0.5519673 0.203443035 0.244589699\n391 2.01232033 0.5507983 0.204611998 0.244589699\n392 2.01505818 0.5507983 0.203437345 0.245764352\n393 2.02327173 0.5496293 0.203429678 0.246940982\n394 2.03148528 0.5484604 0.204598640 0.246940982\n395 2.03422313 0.5484604 0.202238751 0.249300871\n396 2.04791239 0.5472914 0.203407714 0.249300871\n397 2.05612594 0.5461225 0.204576677 0.249300871\n398 2.05886379 0.5449535 0.205745640 0.249300871\n399 2.06160164 0.5449535 0.204569266 0.250477244\n400 2.06707734 0.5449535 0.203392893 0.251653618\n401 2.07529090 0.5449535 0.202216520 0.252829991\n402 2.07802875 0.5449535 0.199856890 0.255189621\n403 2.08076660 0.5449535 0.198680557 0.256365953\n404 2.08350445 0.5449535 0.197504224 0.257542286\n405 2.09171800 0.5449535 0.196327892 0.258718619\n406 2.09445585 0.5449535 0.195151559 0.259894952\n407 2.09719370 0.5449535 0.193973158 0.261073352\n408 2.10814511 0.5449535 0.192794758 0.262251753\n409 2.11362081 0.5437845 0.193963721 0.262251753\n410 2.11909651 0.5426156 0.193954340 0.263430096\n411 2.12183436 0.5426156 0.192776054 0.264608382\n412 2.17659138 0.5426156 0.191597767 0.265786669\n413 2.18206708 0.5414466 0.191588444 0.266964955\n414 2.19575633 0.5414466 0.189222556 0.269330843\n415 2.19849418 0.5402776 0.190391518 0.269330843\n416 2.20396988 0.5391087 0.191560481 0.269330843\n417 2.20670773 0.5391087 0.189191753 0.271699571\n418 2.22039699 0.5391087 0.188009488 0.272881836\n419 2.26420260 0.5379407 0.189177448 0.272881836\n420 2.26694045 0.5367738 0.190344403 0.272881836\n421 2.27789185 0.5367738 0.189162322 0.274063917\n422 2.28062971 0.5367738 0.186790728 0.276435511\n423 2.28610541 0.5356068 0.187957683 0.276435511\n424 2.29979466 0.5356068 0.186775744 0.277617450\n425 2.31074606 0.5346342 0.186775744 0.278590020\n426 2.31348392 0.5336616 0.186775744 0.279562673\n427 2.31622177 0.5336616 0.185593806 0.280744611\n428 2.32443532 0.5324948 0.186760600 0.280744611\n429 2.32991102 0.5313290 0.187926382 0.280744611\n430 2.33538672 0.5301632 0.189092164 0.280744611\n431 2.33812457 0.5301632 0.187914805 0.281921970\n432 2.34086242 0.5289985 0.189079573 0.281921970\n433 2.34907598 0.5289985 0.187902293 0.283099250\n434 2.36002738 0.5289985 0.186725013 0.284276530\n435 2.36276523 0.5289985 0.185545568 0.285455975\n436 2.38466804 0.5278337 0.186710335 0.285455975\n437 2.39288159 0.5278337 0.185530983 0.286635327\n438 2.39561944 0.5278337 0.184351631 0.287814679\n439 2.41752225 0.5266689 0.184337046 0.288994031\n440 2.42026010 0.5256982 0.184337046 0.289964720\n441 2.42299795 0.5256982 0.183157787 0.291143979\n442 2.42847365 0.5247275 0.180789384 0.294483155\n443 2.43668720 0.5247275 0.179605694 0.295666845\n444 2.43942505 0.5235629 0.180770298 0.295666845\n445 2.46406571 0.5223983 0.181934902 0.295666845\n446 2.46680356 0.5223983 0.180751461 0.296850286\n447 2.46954141 0.5223983 0.179568019 0.298033728\n448 2.47501711 0.5212336 0.180732624 0.298033728\n449 2.47775496 0.5212336 0.178361582 0.300404770\n450 2.48870637 0.5212336 0.177178293 0.301588058\n451 2.49418207 0.5212336 0.175995004 0.302771347\n452 2.49691992 0.5200701 0.177158578 0.302771347\n453 2.50787132 0.5200701 0.175973116 0.303956809\n454 2.51334702 0.5189065 0.177136690 0.303956809\n455 2.52429843 0.5177440 0.178299231 0.303956809\n456 2.52977413 0.5177440 0.177114067 0.305141974\n457 2.54072553 0.5177440 0.175928902 0.306327138\n458 2.54346338 0.5177440 0.174743738 0.307512302\n459 2.54620123 0.5165814 0.175906279 0.307512302\n460 2.54893908 0.5154189 0.177068820 0.307512302\n461 2.55715264 0.5142563 0.178231361 0.307512302\n462 2.56262834 0.5130948 0.178210437 0.308694727\n463 2.56810404 0.5121273 0.178210437 0.309662214\n464 2.57084189 0.5121273 0.177030430 0.310842221\n465 2.57357974 0.5121273 0.175850423 0.312022228\n466 2.57905544 0.5121273 0.174670416 0.313202235\n467 2.58453114 0.5121273 0.173490409 0.314382242\n468 2.59822040 0.5121273 0.172310402 0.315562249\n469 2.60643395 0.5121273 0.171130395 0.316742257\n470 2.62012320 0.5121273 0.169950387 0.317922264\n471 2.62559890 0.5109665 0.171111285 0.317922264\n472 2.62833676 0.5098056 0.172272182 0.317922264\n473 2.63107461 0.5098056 0.167500289 0.322694156\n474 2.63655031 0.5098056 0.166318494 0.323875951\n475 2.64476386 0.5098056 0.165136699 0.325057746\n476 2.65023956 0.5086447 0.165115801 0.326239542\n477 2.65297741 0.5086447 0.163936612 0.327418731\n478 2.66940452 0.5074848 0.165096460 0.327418731\n479 2.67214237 0.5074848 0.163917409 0.328597781\n480 2.67488022 0.5074848 0.162738358 0.329776832\n481 2.69952088 0.5074848 0.161556815 0.330958375\n482 2.71868583 0.5074848 0.160375273 0.332139918\n483 2.72963723 0.5074848 0.157998300 0.334516891\n484 2.77344285 0.5063250 0.159158148 0.334516891\n485 2.78713210 0.5063250 0.157974311 0.335700727\n486 2.79260780 0.5051651 0.159134160 0.335700727\n487 2.79534565 0.5051651 0.157950501 0.336884386\n488 2.79808350 0.5051651 0.156766843 0.338068044\n489 2.80355921 0.5040053 0.157926691 0.338068044\n490 2.80629706 0.5028465 0.159085483 0.338068044\n491 2.80903491 0.5016887 0.160243217 0.338068044\n492 2.81724846 0.5005310 0.161400951 0.338068044\n493 2.82272416 0.5005310 0.160220548 0.339248447\n494 2.82546201 0.4993733 0.161378283 0.339248447\n495 2.83093771 0.4993733 0.160200553 0.340426177\n496 2.83915127 0.4982166 0.160179495 0.341603907\n497 2.85010267 0.4982166 0.159004435 0.342778967\n498 2.85284052 0.4970610 0.160160044 0.342778967\n499 2.86379192 0.4970610 0.158985127 0.343953884\n500 2.86926762 0.4970610 0.157810209 0.345128801\n501 2.88021903 0.4959054 0.158965818 0.345128801\n502 2.88843258 0.4959054 0.157791044 0.346303576\n503 2.89390828 0.4935915 0.160104960 0.346303576\n504 2.90485969 0.4935915 0.158930447 0.347478089\n505 2.92950034 0.4935915 0.157755934 0.348652602\n506 2.95414100 0.4935915 0.156581421 0.349827115\n507 2.95961670 0.4924359 0.157737023 0.349827115\n508 2.96509240 0.4924359 0.156562651 0.351001488\n509 2.98151951 0.4912803 0.157718253 0.351001488\n510 2.98973306 0.4912803 0.156544020 0.352175721\n511 3.01437372 0.4912803 0.155369788 0.353349953\n512 3.01984942 0.4903190 0.155369788 0.354311169\n513 3.02532512 0.4903190 0.154195555 0.355485402\n514 3.02806297 0.4891630 0.155351616 0.355485402\n515 3.03353867 0.4880069 0.156507677 0.355485402\n516 3.04449008 0.4880069 0.155333717 0.356659362\n517 3.04996578 0.4868509 0.156489777 0.356659362\n518 3.05817933 0.4868509 0.155315952 0.357833188\n519 3.07186858 0.4856948 0.155298187 0.359007013\n520 3.09377139 0.4845398 0.156453158 0.359007013\n521 3.10198494 0.4845398 0.155282164 0.360178007\n522 3.10472279 0.4845398 0.154111170 0.361349001\n523 3.10746064 0.4845398 0.152940176 0.362519995\n524 3.11019849 0.4845398 0.151769182 0.363690989\n525 3.11567420 0.4833849 0.151753160 0.364861983\n526 3.11841205 0.4833849 0.150579653 0.366035490\n527 3.12662560 0.4822299 0.151734625 0.366035490\n528 3.13483915 0.4822299 0.149382730 0.368387384\n529 3.15126626 0.4822299 0.148209408 0.369560707\n530 3.15947981 0.4822299 0.147033375 0.370736739\n531 3.17316906 0.4810760 0.147011218 0.371912772\n532 3.17864476 0.4810760 0.145838095 0.373085896\n533 3.19233402 0.4810760 0.144664971 0.374259020\n534 3.22518823 0.4810760 0.142309132 0.376614859\n535 3.23887748 0.4799232 0.143461913 0.376614859\n536 3.24709103 0.4799232 0.142289033 0.377787738\n537 3.26078029 0.4799232 0.141116154 0.378960617\n538 3.26625599 0.4799232 0.139943275 0.380133497\n539 3.27173169 0.4799232 0.138767527 0.381309245\n540 3.27994524 0.4789652 0.138767527 0.382267247\n541 3.28815880 0.4789652 0.137591779 0.383442995\n542 3.30458590 0.4789652 0.136413099 0.384621676\n543 3.31006160 0.4789652 0.135234419 0.385800356\n544 3.31553730 0.4778120 0.136387668 0.385800356\n545 3.31827515 0.4778120 0.135209208 0.386978816\n546 3.32648871 0.4778120 0.134027750 0.388160275\n547 3.32922656 0.4778120 0.132846291 0.389341733\n548 3.33744011 0.4778120 0.131664833 0.390523191\n549 3.36755647 0.4778120 0.130483375 0.391704650\n550 3.37577002 0.4766587 0.131636624 0.391704650\n551 3.38398357 0.4755066 0.132788770 0.391704650\n552 3.38672142 0.4755066 0.131610873 0.392882547\n553 3.41136208 0.4755066 0.129242877 0.395250542\n554 3.42778919 0.4755066 0.128061958 0.396431461\n555 3.45516769 0.4755066 0.125689129 0.398804290\n556 3.48254620 0.4755066 0.124508314 0.399985106\n557 3.48528405 0.4755066 0.123327498 0.401165921\n558 3.48802190 0.4743544 0.124479643 0.401165921\n559 3.49075975 0.4732023 0.125631788 0.401165921\n560 3.49349760 0.4732023 0.123250188 0.403547521\n561 3.49623546 0.4720501 0.124402334 0.403547521\n562 3.50171116 0.4720501 0.123215972 0.404733883\n563 3.53182752 0.4720501 0.122026276 0.405923579\n564 3.54551677 0.4720501 0.119635170 0.408314685\n565 3.55373032 0.4708974 0.120787899 0.408314685\n566 3.56468172 0.4708974 0.119598682 0.409503902\n567 3.57015743 0.4708974 0.118406012 0.410696572\n568 3.57563313 0.4708974 0.117213343 0.411889241\n569 3.59479808 0.4708974 0.116017130 0.413085454\n570 3.59753593 0.4699400 0.116017130 0.414042910\n571 3.62217659 0.4687868 0.117170338 0.414042910\n572 3.62765229 0.4687868 0.115974564 0.415238685\n573 3.63312799 0.4687868 0.114778790 0.416434459\n574 3.63860370 0.4676335 0.115931998 0.416434459\n575 3.70431211 0.4664815 0.117084081 0.416434459\n576 3.73169062 0.4655251 0.117084081 0.417390805\n577 3.73716632 0.4655251 0.115892726 0.418582160\n578 3.76454483 0.4655251 0.114697796 0.419777090\n579 3.79739904 0.4655251 0.113502865 0.420972020\n580 3.80013689 0.4655251 0.112304262 0.422170624\n581 3.83025325 0.4655251 0.111101922 0.423372964\n582 3.84668036 0.4655251 0.109899582 0.424575304\n583 3.89869952 0.4655251 0.108697242 0.425777644\n584 3.92060233 0.4643708 0.109851535 0.425777644\n585 3.92607803 0.4643708 0.107426847 0.428202331\n586 3.93155373 0.4632165 0.108581140 0.428202331\n587 3.93429158 0.4632165 0.107376204 0.429407267\n588 3.93976728 0.4632165 0.106171268 0.430612203\n589 3.95893224 0.4620622 0.106116631 0.431821133\n590 3.96167009 0.4620622 0.104904304 0.433033460\n591 3.98357290 0.4609079 0.106058597 0.433033460\n592 4.01368925 0.4597537 0.107212889 0.433033460\n593 4.02737851 0.4585994 0.108367182 0.433033460\n594 4.03832991 0.4574433 0.109523231 0.433033460\n595 4.05749487 0.4574433 0.108313449 0.434243241\n596 4.07392197 0.4562873 0.109469499 0.434243241\n597 4.09308693 0.4562873 0.108264186 0.435448554\n598 4.13141684 0.4562873 0.107054955 0.436657786\n599 4.13689254 0.4562873 0.105845723 0.437867017\n600 4.16427105 0.4562873 0.104632456 0.439080284\n601 4.18891170 0.4562873 0.103415080 0.440297661\n602 4.20260096 0.4551324 0.104569969 0.440297661\n603 4.21355236 0.4539745 0.105727797 0.440297661\n604 4.21629021 0.4539745 0.104511824 0.441513634\n605 4.23819302 0.4530160 0.103295851 0.443688099\n606 4.24366872 0.4520576 0.103295851 0.444646592\n607 4.24640657 0.4508999 0.104453525 0.444646592\n608 4.27378508 0.4497422 0.105611199 0.444646592\n609 4.28199863 0.4485845 0.106768873 0.444646592\n610 4.29295003 0.4485845 0.105554889 0.445860577\n611 4.35044490 0.4474269 0.106712563 0.445860577\n612 4.39698836 0.4451085 0.109030914 0.445860577\n613 4.39972621 0.4441525 0.109030914 0.446816593\n614 4.43531828 0.4441525 0.107818775 0.448028733\n615 4.48186174 0.4441525 0.106602655 0.449244853\n616 4.50102669 0.4429955 0.107759651 0.449244853\n617 4.50924025 0.4418397 0.108915452 0.449244853\n618 4.52292950 0.4418397 0.107700664 0.450459640\n619 4.53388090 0.4418397 0.106485876 0.451674428\n620 4.56399726 0.4406839 0.107641676 0.451674428\n621 4.56673511 0.4406839 0.106431528 0.452884577\n622 4.57494867 0.4406839 0.105217360 0.454098744\n623 4.59685147 0.4406839 0.103999100 0.455317005\n624 4.61875428 0.4395293 0.105153700 0.455317005\n625 4.63244353 0.4395293 0.103936177 0.456534528\n626 4.67898700 0.4395293 0.102718653 0.457752052\n627 4.71731691 0.4383747 0.102655730 0.458969575\n628 4.77207392 0.4372213 0.103809127 0.458969575\n629 4.77754962 0.4372213 0.102601330 0.460177372\n630 4.78850103 0.4360691 0.103753522 0.460177372\n631 4.79671458 0.4360691 0.102546372 0.461384523\n632 4.81587953 0.4349169 0.103698564 0.461384523\n633 4.83778234 0.4349169 0.102487953 0.462595134\n634 4.84052019 0.4349169 0.101273164 0.463809923\n635 4.85147159 0.4349169 0.100058375 0.465024712\n636 4.88158795 0.4349169 0.098843586 0.466239501\n637 4.88980151 0.4337647 0.099995779 0.466239501\n638 4.89527721 0.4337647 0.098781750 0.467453530\n639 4.90075291 0.4337647 0.097567721 0.468667559\n640 4.92265572 0.4337647 0.096353692 0.469881588\n641 4.96098563 0.4337647 0.095135193 0.471100086\n642 4.97741273 0.4328012 0.095135193 0.472063656\n643 5.00752909 0.4328012 0.093912134 0.473286715\n644 5.01300479 0.4318221 0.093912134 0.474265746\n645 5.03490760 0.4318221 0.092689075 0.475488805\n646 5.06502396 0.4318221 0.091466016 0.476711864\n647 5.06776181 0.4318221 0.090242957 0.477934923\n648 5.08145106 0.4308339 0.090242957 0.478923127\n649 5.13347023 0.4308339 0.089019898 0.480146186\n650 5.13620808 0.4296265 0.090227299 0.480146186\n651 5.14442163 0.4296265 0.089009258 0.481364227\n652 5.15811088 0.4296265 0.087791217 0.482582268\n653 5.16084873 0.4296265 0.086573176 0.483800308\n654 5.18822724 0.4284136 0.087786044 0.483800308\n655 5.19096509 0.4284136 0.086568074 0.485018278\n656 5.22108145 0.4284136 0.085332725 0.486253627\n657 5.24298426 0.4284136 0.084097375 0.487488977\n658 5.24845996 0.4271897 0.085321357 0.487488977\n659 5.28952772 0.4271897 0.084068027 0.488742307\n660 5.33880903 0.4271897 0.082790099 0.490020235\n661 5.40999316 0.4259377 0.084042102 0.490020235\n662 5.42368241 0.4246760 0.085303760 0.490020235\n663 5.46201232 0.4246760 0.084026464 0.491297531\n664 5.50855578 0.4233765 0.085326002 0.491297531\n665 5.52498289 0.4220769 0.086625539 0.491297531\n666 5.53319644 0.4220769 0.085342074 0.492580996\n667 5.53867214 0.4220769 0.084052966 0.493870105\n668 5.55236140 0.4207660 0.085363850 0.493870105\n669 5.56057495 0.4194502 0.086679684 0.493870105\n670 5.57152635 0.4181360 0.087993885 0.493870105\n671 5.57426420 0.4168218 0.089308086 0.493870105\n672 5.61806982 0.4157276 0.089308086 0.494964285\n673 5.65913758 0.4143846 0.090651114 0.494964285\n674 5.67830253 0.4130363 0.091999419 0.494964285\n675 5.68651608 0.4130363 0.090722992 0.496240711\n676 5.69199179 0.4119065 0.090722992 0.497370556\n677 5.70294319 0.4119065 0.089446566 0.498646982\n678 5.70841889 0.4119065 0.088170139 0.499923409\n679 5.82340862 0.4119065 0.086849923 0.501243625\n680 5.82614648 0.4119065 0.085523839 0.502569710\n681 5.83983573 0.4119065 0.084176869 0.503916679\n682 5.88090349 0.4104091 0.085674208 0.503916679\n683 5.89185489 0.4104091 0.084257953 0.505332934\n684 5.94387406 0.4104091 0.081337301 0.508253586\n685 5.95208761 0.4091015 0.081337301 0.509561182\n686 6.01505818 0.4091015 0.079808473 0.511090010\n687 6.05886379 0.4076257 0.079808473 0.512565801\n688 6.10814511 0.4057695 0.081664674 0.512565801\n689 6.17932923 0.4041710 0.081664674 0.514164370\n690 6.25325120 0.4041710 0.079885923 0.515943120\n691 6.26146475 0.4041710 0.078107173 0.517721871\n692 6.26420260 0.4021001 0.080178057 0.517721871\n693 6.34633812 0.4003075 0.080178057 0.519514425\n694 6.43668720 0.4003075 0.078101988 0.521590494\n695 6.72963723 0.3979853 0.078101988 0.523912754\n696 6.79534565 0.3979853 0.075257325 0.526757416\n697 6.91854894 0.3979853 0.071967154 0.530047588\n698 6.95961670 0.3979853 0.068519358 0.533495384\n699 6.98699521 0.3979853 0.065020303 0.536994438\n700 7.09924709 0.3979853 0.061322239 0.540692503\n701 7.34565366 0.3979853 0.057386848 0.544627893\n702 7.37577002 0.3922456 0.063126546 0.544627893\n703 7.44147844 0.3922456 0.058109436 0.549645004\n704 7.46064339 0.3869124 0.058109436 0.554978163\n705 7.63586585 0.3792008 0.058109436 0.562689720\n706 7.96714579 0.3792008 0.038739624 0.582059532\n707 9.11430527 0.3792008 0.038739624 0.582059532\n\n\nShow R code\npr_trt1_red[[1]]\n\n\n          time   pstate1      pstate2     pstate3\n1   0.00000000 1.0000000 0.0000000000 0.000000000\n2   0.02190281 0.9992533 0.0007467243 0.000000000\n3   0.02464066 0.9985066 0.0014934486 0.000000000\n4   0.05201916 0.9977598 0.0022401730 0.000000000\n5   0.05475702 0.9970127 0.0029872642 0.000000000\n6   0.06297057 0.9959013 0.0029872642 0.001111401\n7   0.06570842 0.9947899 0.0029872642 0.002222802\n8   0.07665982 0.9940427 0.0037345448 0.002222802\n9   0.09308693 0.9940427 0.0028707775 0.003086569\n10  0.09582478 0.9932950 0.0036184269 0.003086569\n11  0.09856263 0.9925470 0.0043664459 0.003086569\n12  0.10403833 0.9917986 0.0051148350 0.003086569\n13  0.10951403 0.9910498 0.0058635949 0.003086569\n14  0.11772758 0.9903011 0.0066123548 0.003086569\n15  0.12320329 0.9884384 0.0073614864 0.004200085\n16  0.13415469 0.9876892 0.0081107145 0.004200085\n17  0.14236824 0.9876892 0.0072287455 0.005082054\n18  0.15331964 0.9865749 0.0072287455 0.006196335\n19  0.16153320 0.9858256 0.0079780698 0.006196335\n20  0.16974675 0.9843253 0.0094784119 0.006196335\n21  0.17248460 0.9835748 0.0102288597 0.006196335\n22  0.18617385 0.9828244 0.0109793075 0.006196335\n23  0.19712526 0.9813225 0.0124811534 0.006196335\n24  0.21081451 0.9798192 0.0139845093 0.006196335\n25  0.21355236 0.9790672 0.0147364663 0.006196335\n26  0.21629021 0.9783149 0.0145898149 0.007095323\n27  0.21902806 0.9760538 0.0168508473 0.007095323\n28  0.23271732 0.9745451 0.0183595302 0.007095323\n29  0.23545517 0.9730351 0.0198695552 0.007095323\n30  0.24093087 0.9722801 0.0206245629 0.007095323\n31  0.24914442 0.9707685 0.0221361286 0.007095323\n32  0.25462012 0.9707685 0.0212275306 0.008003921\n33  0.25735797 0.9700128 0.0219833087 0.008003921\n34  0.26830938 0.9677413 0.0242547382 0.008003921\n35  0.27104723 0.9662257 0.0257703761 0.008003921\n36  0.27378508 0.9654676 0.0265284828 0.008003921\n37  0.27652293 0.9639498 0.0280462703 0.008003921\n38  0.27926078 0.9631909 0.0288051591 0.008003921\n39  0.28199863 0.9624316 0.0295644406 0.008003921\n40  0.28747433 0.9616720 0.0303241154 0.008003921\n41  0.29021218 0.9609119 0.0310841842 0.008003921\n42  0.29568789 0.9601514 0.0318446478 0.008003921\n43  0.29842574 0.9593906 0.0326055070 0.008003921\n44  0.30390144 0.9586293 0.0333667623 0.008003921\n45  0.30937714 0.9563413 0.0347331568 0.008925497\n46  0.31759069 0.9540502 0.0370243242 0.008925497\n47  0.32306639 0.9532865 0.0377879697 0.008925497\n48  0.32580424 0.9525225 0.0385520168 0.008925497\n49  0.33127995 0.9509926 0.0400819334 0.008925497\n50  0.33401780 0.9502273 0.0399236926 0.009848993\n51  0.34223135 0.9502273 0.0390038416 0.010768844\n52  0.34770705 0.9494617 0.0388545171 0.011683830\n53  0.35318275 0.9494617 0.0379381877 0.012600159\n54  0.35865845 0.9486956 0.0387042540 0.012600159\n55  0.36139630 0.9479291 0.0394707264 0.012600159\n56  0.36413415 0.9479291 0.0385613119 0.013509574\n57  0.36687201 0.9471626 0.0393277844 0.013509574\n58  0.37234771 0.9463962 0.0400942568 0.013509574\n59  0.37782341 0.9463962 0.0391912808 0.014412550\n60  0.38056126 0.9456293 0.0399581609 0.014412550\n61  0.38603696 0.9448620 0.0398209451 0.015317054\n62  0.39151266 0.9440943 0.0405886427 0.015317054\n63  0.39425051 0.9440943 0.0396811452 0.016224551\n64  0.39698836 0.9433262 0.0395417553 0.017132049\n65  0.39972621 0.9417883 0.0410796242 0.017132049\n66  0.40246407 0.9410194 0.0418485535 0.017132049\n67  0.41067762 0.9410194 0.0409442075 0.018036395\n68  0.42162902 0.9394799 0.0424837276 0.018036395\n69  0.42984257 0.9371679 0.0447957176 0.018036395\n70  0.43805613 0.9363973 0.0455663010 0.018036395\n71  0.44079398 0.9348553 0.0471083110 0.018036395\n72  0.44900753 0.9348553 0.0462126901 0.018932016\n73  0.45174538 0.9325395 0.0476367130 0.019823740\n74  0.45448323 0.9317677 0.0475197786 0.020712510\n75  0.45722108 0.9309955 0.0482920335 0.020712510\n76  0.45995893 0.9302228 0.0490647092 0.020712510\n77  0.46269678 0.9294501 0.0498373848 0.020712510\n78  0.46817248 0.9294501 0.0480497396 0.022500155\n79  0.47364819 0.9271276 0.0503722344 0.022500155\n80  0.47638604 0.9248013 0.0526985538 0.022500155\n81  0.47912389 0.9240256 0.0534741959 0.022500155\n82  0.48186174 0.9224724 0.0550274163 0.022500155\n83  0.49007529 0.9216955 0.0558043430 0.022500155\n84  0.49555099 0.9209181 0.0565816997 0.022500155\n85  0.50102669 0.9193617 0.0581381483 0.022500155\n86  0.50650240 0.9146781 0.0628217300 0.022500155\n87  0.50924025 0.9146781 0.0619241585 0.023397726\n88  0.51197810 0.9146781 0.0610265871 0.024295298\n89  0.51471595 0.9138982 0.0618065359 0.024295298\n90  0.51745380 0.9123363 0.0633684129 0.024295298\n91  0.52292950 0.9107727 0.0640337114 0.025193633\n92  0.53661875 0.9099905 0.0648158532 0.025193633\n93  0.54209446 0.9092079 0.0655984365 0.025193633\n94  0.54483231 0.9084253 0.0663810197 0.025193633\n95  0.55030801 0.9076428 0.0662676380 0.026089598\n96  0.55578371 0.9068597 0.0670506643 0.026089598\n97  0.55852156 0.9060763 0.0678341346 0.026089598\n98  0.56125941 0.9052924 0.0686180497 0.026089598\n99  0.56399726 0.9052924 0.0677226956 0.026984952\n100 0.56947296 0.9037236 0.0683987356 0.027877645\n101 0.58863792 0.9021540 0.0690784884 0.028767519\n102 0.59137577 0.9013692 0.0698632963 0.028767519\n103 0.59685147 0.8990105 0.0713336049 0.029655937\n104 0.59958932 0.8970650 0.0712326633 0.031702345\n105 0.60506502 0.8962783 0.0720193964 0.031702345\n106 0.60780287 0.8962783 0.0711323152 0.032589426\n107 0.61054073 0.8954911 0.0719195017 0.032589426\n108 0.61327858 0.8947034 0.0727071427 0.032589426\n109 0.61875428 0.8947034 0.0718200532 0.033476516\n110 0.62149213 0.8939153 0.0726081495 0.033476516\n111 0.62422998 0.8931268 0.0733967020 0.033476516\n112 0.62696783 0.8915476 0.0749758777 0.033476516\n113 0.62970568 0.8875863 0.0789371529 0.033476516\n114 0.63518138 0.8875863 0.0780417433 0.034371925\n115 0.64339493 0.8867941 0.0788339728 0.034371925\n116 0.64887064 0.8844130 0.0812151182 0.034371925\n117 0.65160849 0.8836193 0.0811133831 0.035267286\n118 0.65982204 0.8836193 0.0802191443 0.036161524\n119 0.66255989 0.8828252 0.0801212409 0.037053521\n120 0.66529774 0.8820311 0.0809153342 0.037053521\n121 0.67077344 0.8804411 0.0825054116 0.037053521\n122 0.67351129 0.8796460 0.0833004444 0.037053521\n123 0.67898700 0.8788505 0.0840959491 0.037053521\n124 0.68446270 0.8780550 0.0848914538 0.037053521\n125 0.68720055 0.8780550 0.0840002579 0.037944717\n126 0.68993840 0.8772590 0.0847962359 0.037944717\n127 0.69267625 0.8764631 0.0847020176 0.038834913\n128 0.69815195 0.8756666 0.0854984703 0.038834913\n129 0.70088980 0.8740727 0.0870923389 0.038834913\n130 0.70362765 0.8732758 0.0870008435 0.039723337\n131 0.70636550 0.8724784 0.0877982495 0.039723337\n132 0.70910335 0.8724784 0.0860140208 0.041507566\n133 0.71184120 0.8708817 0.0876107601 0.041507566\n134 0.71457906 0.8700833 0.0884091238 0.041507566\n135 0.71731691 0.8692849 0.0892074875 0.041507566\n136 0.72005476 0.8676860 0.0908063957 0.041507566\n137 0.72279261 0.8668862 0.0907190242 0.042394748\n138 0.73648186 0.8668862 0.0898326957 0.043281076\n139 0.74195756 0.8652844 0.0905481833 0.044167405\n140 0.74743326 0.8644831 0.0913494500 0.044167405\n141 0.75017112 0.8636814 0.0912615292 0.045057080\n142 0.75290897 0.8636814 0.0903707540 0.045947855\n143 0.75564682 0.8620757 0.0910876768 0.046836655\n144 0.76386037 0.8596623 0.0926100353 0.047727695\n145 0.76659822 0.8588576 0.0934147354 0.047727695\n146 0.77481177 0.8588576 0.0916162034 0.049526226\n147 0.78028747 0.8580524 0.0924213986 0.049526226\n148 0.78302533 0.8556330 0.0948407484 0.049526226\n149 0.79123888 0.8556330 0.0939449547 0.050422020\n150 0.79397673 0.8540184 0.0955595889 0.050422020\n151 0.79671458 0.8532107 0.0963672754 0.050422020\n152 0.80219028 0.8532107 0.0954701886 0.051319107\n153 0.80492813 0.8515931 0.0970878358 0.051319107\n154 0.81040383 0.8499736 0.0987072490 0.051319107\n155 0.82135524 0.8491639 0.0995169494 0.051319107\n156 0.82683094 0.8491639 0.0986165109 0.052219545\n157 0.82956879 0.8483537 0.0994267182 0.052219545\n158 0.83230664 0.8475435 0.0993373034 0.053119168\n159 0.84325804 0.8467328 0.1001480194 0.053119168\n160 0.85147159 0.8467328 0.0992463502 0.054020837\n161 0.85694730 0.8459216 0.0991577500 0.054920663\n162 0.85968515 0.8459216 0.0973533470 0.056725066\n163 0.86242300 0.8442971 0.0989778560 0.056725066\n164 0.86516085 0.8442971 0.0980822953 0.057620626\n165 0.88158795 0.8426718 0.0988138530 0.058514347\n166 0.88432580 0.8426718 0.0979234095 0.059404791\n167 0.88706366 0.8426718 0.0970347880 0.060293412\n168 0.88980151 0.8418596 0.0978470354 0.060293412\n169 0.89253936 0.8406688 0.0978470354 0.061484195\n170 0.89801506 0.8398564 0.0986594321 0.061484195\n171 0.90075291 0.8390440 0.0994718288 0.061484195\n172 0.90349076 0.8374179 0.1010979271 0.061484195\n173 0.90622861 0.8374179 0.1002073576 0.062374765\n174 0.91170431 0.8366044 0.1010207889 0.062374765\n175 0.91444216 0.8357905 0.1018347395 0.062374765\n176 0.91718001 0.8349760 0.1026492107 0.062374765\n177 0.91991786 0.8333450 0.1042802544 0.062374765\n178 0.92265572 0.8308945 0.1067307767 0.062374765\n179 0.93086927 0.8296979 0.1067307767 0.063571359\n180 0.93360712 0.8288811 0.1075474935 0.063571359\n181 0.93634497 0.8288811 0.1066508322 0.064468020\n182 0.93908282 0.8288811 0.1057558676 0.065362985\n183 0.94182067 0.8280639 0.1065731129 0.065362985\n184 0.95277207 0.8264270 0.1082100027 0.065362985\n185 0.95550992 0.8256082 0.1081324434 0.066259381\n186 0.96372348 0.8239681 0.1097725336 0.066259381\n187 0.96919918 0.8231476 0.1105929737 0.066259381\n188 0.97193703 0.8219473 0.1096941378 0.068358593\n189 0.97467488 0.8203047 0.1104395155 0.069255771\n190 0.98562628 0.8186603 0.1120839618 0.069255771\n191 0.99110198 0.8178381 0.1120081757 0.070153773\n192 0.99383984 0.8178381 0.1111107804 0.071051169\n193 0.99931554 0.8170153 0.1110361443 0.071948564\n194 1.00205339 0.8161925 0.1109637413 0.072843726\n195 1.01026694 0.8153692 0.1117870452 0.072843726\n196 1.01300479 0.8145454 0.1126108950 0.072843726\n197 1.01848049 0.8137210 0.1125386320 0.073740386\n198 1.02395619 0.8128960 0.1133635776 0.073740386\n199 1.02943190 0.8128960 0.1124664568 0.074637507\n200 1.03490760 0.8120705 0.1132919522 0.074637507\n201 1.03764545 0.8112445 0.1141179987 0.074637507\n202 1.04038330 0.8095902 0.1157723166 0.074637507\n203 1.04312115 0.8095902 0.1148742499 0.075535574\n204 1.04585900 0.8087630 0.1148049155 0.076432060\n205 1.05133470 0.8079353 0.1138352841 0.078229399\n206 1.05681040 0.8062777 0.1154929422 0.078229399\n207 1.06502396 0.8054488 0.1154274290 0.079123734\n208 1.06776181 0.8054488 0.1145320377 0.080019126\n209 1.07323751 0.8046195 0.1153614198 0.080019126\n210 1.07597536 0.8037901 0.1161908020 0.080019126\n211 1.08966461 0.8029607 0.1170201842 0.080019126\n212 1.09514031 0.8029607 0.1161263055 0.080913004\n213 1.09787817 0.8021307 0.1169562503 0.080913004\n214 1.10061602 0.8013002 0.1168918273 0.081807936\n215 1.10882957 0.8004692 0.1177229013 0.081807936\n216 1.11156742 0.7996381 0.1176600178 0.082701894\n217 1.11704312 0.7988064 0.1184916591 0.082701894\n218 1.11978097 0.7988064 0.1175986451 0.083594908\n219 1.12525667 0.7979748 0.1175387988 0.084486395\n220 1.13073238 0.7971426 0.1165836790 0.086273725\n221 1.13620808 0.7954759 0.1182503984 0.086273725\n222 1.14168378 0.7954759 0.1173607145 0.087163409\n223 1.14989733 0.7954759 0.1164725488 0.088051575\n224 1.15263518 0.7942591 0.1164725488 0.089268322\n225 1.15537303 0.7934256 0.1164194317 0.090154963\n226 1.17180014 0.7934256 0.1155347134 0.091039682\n227 1.17453799 0.7925921 0.1163682375 0.091039682\n228 1.17727584 0.7925921 0.1145905194 0.092817400\n229 1.18001369 0.7917580 0.1154246191 0.092817400\n230 1.18548939 0.7909239 0.1153748437 0.093701275\n231 1.18822724 0.7900892 0.1162095211 0.093701275\n232 1.19096509 0.7892545 0.1170441986 0.093701275\n233 1.19644079 0.7884193 0.1169951943 0.094585536\n234 1.19917864 0.7875834 0.1160580477 0.096358521\n235 1.20191650 0.7867470 0.1160124966 0.097240493\n236 1.20465435 0.7859100 0.1168495015 0.097240493\n237 1.20739220 0.7859100 0.1159667110 0.098123284\n238 1.21286790 0.7850724 0.1159215108 0.099006074\n239 1.21560575 0.7850724 0.1150405765 0.099887009\n240 1.22655715 0.7842348 0.1149987509 0.100766425\n241 1.22929500 0.7833972 0.1158363412 0.100766425\n242 1.24024641 0.7825596 0.1166739315 0.100766425\n243 1.24298426 0.7817206 0.1166345382 0.101644896\n244 1.25393566 0.7800400 0.1183150764 0.101644896\n245 1.25667351 0.7800400 0.1174345187 0.102525454\n246 1.25941136 0.7800400 0.1165554472 0.103404525\n247 1.26214921 0.7791998 0.1173957089 0.103404525\n248 1.26488706 0.7791998 0.1165154421 0.104284792\n249 1.27036277 0.7791998 0.1156366724 0.105163561\n250 1.27310062 0.7783589 0.1147178110 0.106923280\n251 1.27583847 0.7766751 0.1164016282 0.106923280\n252 1.28405202 0.7766751 0.1155266927 0.107798215\n253 1.29226557 0.7766751 0.1146532488 0.108671659\n254 1.29774127 0.7758336 0.1146227549 0.109543605\n255 1.30047912 0.7758336 0.1137510407 0.110415320\n256 1.30321697 0.7749916 0.1145930924 0.110415320\n257 1.31416838 0.7741489 0.1154357450 0.110415320\n258 1.31964408 0.7733057 0.1162789999 0.110415320\n259 1.32511978 0.7733057 0.1154049862 0.111289333\n260 1.32785763 0.7712295 0.1162488450 0.112521625\n261 1.33059548 0.7699967 0.1162488450 0.113754450\n262 1.33880903 0.7691525 0.1170930660 0.113754450\n263 1.34154689 0.7683077 0.1170628570 0.114629489\n264 1.34428474 0.7666155 0.1187549737 0.114629489\n265 1.34976044 0.7657695 0.1196010243 0.114629489\n266 1.35523614 0.7649228 0.1204476888 0.114629489\n267 1.35797399 0.7640755 0.1212949688 0.114629489\n268 1.36071184 0.7632276 0.1221428659 0.114629489\n269 1.36344969 0.7623797 0.1221100564 0.115510195\n270 1.36618754 0.7615312 0.1202964576 0.118172310\n271 1.37713895 0.7615312 0.1194163728 0.119052395\n272 1.37987680 0.7606821 0.1202655102 0.119052395\n273 1.38261465 0.7598323 0.1211152701 0.119052395\n274 1.38535250 0.7598323 0.1202327398 0.119934926\n275 1.39630390 0.7589820 0.1202020517 0.120815998\n276 1.39904175 0.7581316 0.1210524358 0.120815998\n277 1.40177960 0.7581316 0.1201718102 0.121696623\n278 1.40451745 0.7572806 0.1210228207 0.121696623\n279 1.42915811 0.7572806 0.1201424106 0.122577033\n280 1.43189596 0.7564289 0.1209940492 0.122577033\n281 1.43737166 0.7555766 0.1218463175 0.122577033\n282 1.44010951 0.7547237 0.1226992173 0.122577033\n283 1.44284736 0.7538708 0.1235521170 0.122577033\n284 1.44558522 0.7538708 0.1226696706 0.123459480\n285 1.44832307 0.7538708 0.1217886533 0.124340497\n286 1.45653662 0.7521622 0.1234973239 0.124340497\n287 1.46201232 0.7513074 0.1243521288 0.124340497\n288 1.46748802 0.7504519 0.1252075724 0.124340497\n289 1.47022587 0.7504519 0.1243230879 0.125224982\n290 1.47843943 0.7495965 0.1251785315 0.125224982\n291 1.48391513 0.7487404 0.1260346164 0.125224982\n292 1.48665298 0.7470256 0.1277493757 0.125224982\n293 1.49486653 0.7470256 0.1268628981 0.126111459\n294 1.49760438 0.7461683 0.1277202697 0.126111459\n295 1.50034223 0.7453103 0.1285782882 0.126111459\n296 1.50581793 0.7453103 0.1276908283 0.126998919\n297 1.51403149 0.7453103 0.1268033684 0.127886379\n298 1.51676934 0.7435919 0.1285216934 0.127886379\n299 1.51950719 0.7427333 0.1293803596 0.127886379\n300 1.53045859 0.7427333 0.1284934850 0.128773254\n301 1.53319644 0.7418739 0.1293528032 0.128773254\n302 1.53593429 0.7410140 0.1302127751 0.128773254\n303 1.54140999 0.7410140 0.1284323277 0.130553701\n304 1.54688569 0.7401533 0.1292929551 0.130553701\n305 1.55783710 0.7401533 0.1284066797 0.131439976\n306 1.56057495 0.7401533 0.1275217814 0.132324875\n307 1.56878850 0.7384291 0.1283624980 0.133208391\n308 1.57700205 0.7384291 0.1265878684 0.134983020\n309 1.57973990 0.7375665 0.1274504717 0.134983020\n310 1.58247775 0.7358386 0.1282939441 0.135867424\n311 1.58795346 0.7358386 0.1265174933 0.137643875\n312 1.59069131 0.7349747 0.1273814228 0.137643875\n313 1.59342916 0.7349747 0.1264961133 0.138529184\n314 1.59616701 0.7341101 0.1264767952 0.139413099\n315 1.60711841 0.7341101 0.1255916209 0.140298273\n316 1.61259411 0.7341101 0.1247078511 0.141182043\n317 1.61806982 0.7332448 0.1246907565 0.142064403\n318 1.62080767 0.7332448 0.1238099229 0.142945236\n319 1.62354552 0.7306446 0.1264101347 0.142945236\n320 1.62628337 0.7297780 0.1263934280 0.143828550\n321 1.62902122 0.7297780 0.1255116203 0.144710358\n322 1.63997262 0.7276514 0.1263782275 0.145970350\n323 1.64544832 0.7276514 0.1254965258 0.146852051\n324 1.64818617 0.7267839 0.1245957927 0.148620279\n325 1.65092402 0.7267839 0.1237170296 0.149499042\n326 1.65366188 0.7259164 0.1245845239 0.149499042\n327 1.66461328 0.7250489 0.1245733345 0.150377725\n328 1.66735113 0.7250489 0.1236947298 0.151256330\n329 1.67556468 0.7250489 0.1228161251 0.152134935\n330 1.67830253 0.7241808 0.1236843011 0.152134935\n331 1.68104038 0.7241808 0.1228057705 0.153013465\n332 1.68377823 0.7233119 0.1236746301 0.153013465\n333 1.68651608 0.7224424 0.1236643041 0.153893337\n334 1.68925394 0.7215728 0.1245338492 0.153893337\n335 1.70294319 0.7207033 0.1245236690 0.154773062\n336 1.71115674 0.7198337 0.1253932141 0.154773062\n337 1.71937029 0.7185674 0.1253932141 0.156039345\n338 1.72210815 0.7185674 0.1245136317 0.156918928\n339 1.73032170 0.7176970 0.1253840788 0.156918928\n340 1.74127310 0.7168259 0.1262552193 0.156918928\n341 1.74674880 0.7159547 0.1271263598 0.156918928\n342 1.75496235 0.7159547 0.1262455836 0.157799704\n343 1.75770021 0.7159547 0.1244785450 0.159566743\n344 1.76043806 0.7159547 0.1227143297 0.161330958\n345 1.77138946 0.7159547 0.1218364532 0.162208835\n346 1.77686516 0.7150829 0.1227082899 0.162208835\n347 1.78781656 0.7142110 0.1235801266 0.162208835\n348 1.79055441 0.7133385 0.1244526623 0.162208835\n349 1.79876797 0.7124653 0.1253258991 0.162208835\n350 1.80424367 0.7115920 0.1253200255 0.163087945\n351 1.81519507 0.7098424 0.1261906190 0.163967014\n352 1.81793292 0.7098424 0.1253102262 0.164847407\n353 1.82067077 0.7085698 0.1253102262 0.166119936\n354 1.82340862 0.7085698 0.1244312259 0.166998936\n355 1.82888433 0.7076943 0.1253067980 0.166998936\n356 1.83162218 0.7076943 0.1244264293 0.167879305\n357 1.83436003 0.7076943 0.1235474629 0.168758271\n358 1.83983573 0.7068180 0.1244237465 0.168758271\n359 1.84257358 0.7068180 0.1235447990 0.169637218\n360 1.84531143 0.7068180 0.1226672593 0.170514758\n361 1.84804928 0.7059410 0.1226667167 0.171392298\n362 1.85626283 0.7059410 0.1217891808 0.172269834\n363 1.86173854 0.7050633 0.1226668936 0.172269834\n364 1.86995209 0.7041848 0.1235453240 0.172269834\n365 1.87268994 0.7041848 0.1226677806 0.173147377\n366 1.87542779 0.7041848 0.1217916504 0.174023507\n367 1.87816564 0.7033064 0.1226700808 0.174023507\n368 1.88090349 0.7033064 0.1217939342 0.174899654\n369 1.89459274 0.7033064 0.1191521250 0.177541463\n370 1.89733060 0.7033064 0.1182789718 0.178414617\n371 1.90554415 0.7033064 0.1174058185 0.179287770\n372 1.90828200 0.7024273 0.1182849696 0.179287770\n373 1.91649555 0.7006660 0.1200461835 0.179287770\n374 1.91923340 0.6997854 0.1209267812 0.179287770\n375 1.92197125 0.6980224 0.1226898159 0.179287770\n376 1.93292266 0.6980224 0.1218106967 0.180166889\n377 1.93839836 0.6980224 0.1209330058 0.181044580\n378 1.94113621 0.6980224 0.1191755467 0.182802039\n379 1.94661191 0.6971404 0.1200576027 0.182802039\n380 1.94934976 0.6962583 0.1200662702 0.183675427\n381 1.96030116 0.6962583 0.1191913836 0.184550314\n382 1.96303901 0.6953755 0.1192007326 0.185423755\n383 1.96577687 0.6953755 0.1183272231 0.186297264\n384 1.97125257 0.6953755 0.1174551652 0.187169322\n385 1.97399042 0.6953755 0.1165845648 0.188039923\n386 1.97946612 0.6953755 0.1157154278 0.188909060\n387 1.98767967 0.6944920 0.1165989539 0.188909060\n388 1.99589322 0.6944920 0.1157297097 0.189778304\n389 1.99863107 0.6936077 0.1157461995 0.190646079\n390 2.00136893 0.6927227 0.1166312044 0.190646079\n391 2.01232033 0.6918370 0.1175169519 0.190646079\n392 2.01505818 0.6918370 0.1166458935 0.191517137\n393 2.02327173 0.6909505 0.1166613275 0.192388195\n394 2.03148528 0.6900632 0.1175485670 0.192388195\n395 2.03422313 0.6900632 0.1157980165 0.194138746\n396 2.04791239 0.6891752 0.1166860053 0.194138746\n397 2.05612594 0.6882865 0.1175747456 0.194138746\n398 2.05886379 0.6873970 0.1184642397 0.194138746\n399 2.06160164 0.6873970 0.1175897187 0.195013267\n400 2.06707734 0.6873970 0.1167166618 0.195886324\n401 2.07529090 0.6873970 0.1158450750 0.196757911\n402 2.07802875 0.6873970 0.1140997621 0.198503224\n403 2.08076660 0.6873970 0.1132326719 0.199370314\n404 2.08350445 0.6873970 0.1123670764 0.200235909\n405 2.09171800 0.6873970 0.1115029817 0.201100004\n406 2.09445585 0.6873970 0.1106403943 0.201962591\n407 2.09719370 0.6873970 0.1097778069 0.202825179\n408 2.10814511 0.6873970 0.1089167451 0.203686241\n409 2.11362081 0.6865068 0.1098069952 0.203686241\n410 2.11909651 0.6856158 0.1098367129 0.204547531\n411 2.12183436 0.6856158 0.1089751890 0.205409055\n412 2.17659138 0.6856158 0.1081151982 0.206269046\n413 2.18206708 0.6847240 0.1081485161 0.207127497\n414 2.19575633 0.6847240 0.1064242117 0.208851802\n415 2.19849418 0.6838315 0.1073167437 0.208851802\n416 2.20396988 0.6829382 0.1082100408 0.208851802\n417 2.20670773 0.6829382 0.1064824322 0.210579410\n418 2.22039699 0.6829382 0.1056233023 0.211438540\n419 2.26420260 0.6820449 0.1065165994 0.211438540\n420 2.26694045 0.6811516 0.1074098965 0.211438540\n421 2.27789185 0.6811516 0.1065486653 0.212299771\n422 2.28062971 0.6811516 0.1048239307 0.214024506\n423 2.28610541 0.6802575 0.1057179973 0.214024506\n424 2.29979466 0.6802575 0.1048596713 0.214882832\n425 2.31074606 0.6789643 0.1048596713 0.216176023\n426 2.31348392 0.6776711 0.1048596713 0.217469213\n427 2.31622177 0.6776711 0.1040029265 0.218325958\n428 2.32443532 0.6767766 0.1048974886 0.218325958\n429 2.32991102 0.6758820 0.1057920506 0.218325958\n430 2.33538672 0.6749867 0.1066873903 0.218325958\n431 2.33812457 0.6749867 0.1058297273 0.219183621\n432 2.34086242 0.6740913 0.1067250671 0.219183621\n433 2.34907598 0.6740913 0.1058671011 0.220041587\n434 2.36002738 0.6740913 0.1050107001 0.220897988\n435 2.36276523 0.6740913 0.1041542991 0.221754389\n436 2.38466804 0.6731952 0.1050504200 0.221754389\n437 2.39288159 0.6731952 0.1041936951 0.222611114\n438 2.39561944 0.6731952 0.1033385556 0.223466253\n439 2.41752225 0.6722983 0.1033819132 0.224319800\n440 2.42026010 0.6710011 0.1033819132 0.225617036\n441 2.42299795 0.6710011 0.1025280083 0.226470941\n442 2.42847365 0.6697038 0.1008162549 0.229479931\n443 2.43668720 0.6697038 0.0999640109 0.230332175\n444 2.43942505 0.6688064 0.1008614200 0.230332175\n445 2.46406571 0.6679082 0.1017596201 0.230332175\n446 2.46680356 0.6679082 0.1009049969 0.231186798\n447 2.46954141 0.6679082 0.1000520027 0.232039792\n448 2.47501711 0.6670092 0.1009509962 0.232039792\n449 2.47775496 0.6670092 0.0992410527 0.233749735\n450 2.48870637 0.6670092 0.0983909933 0.234599795\n451 2.49418207 0.6670092 0.0975425867 0.235448201\n452 2.49691992 0.6661102 0.0984415802 0.235448201\n453 2.50787132 0.6661102 0.0975910837 0.236298698\n454 2.51334702 0.6652104 0.0984908742 0.236298698\n455 2.52429843 0.6643106 0.0993906647 0.236298698\n456 2.52977413 0.6643106 0.0985376763 0.237151686\n457 2.54072553 0.6643106 0.0976863496 0.238003013\n458 2.54346338 0.6643106 0.0968366926 0.238852670\n459 2.54620123 0.6634100 0.0977372836 0.238852670\n460 2.54893908 0.6625087 0.0986386777 0.238852670\n461 2.55715264 0.6616065 0.0995408775 0.238852670\n462 2.56262834 0.6607043 0.0995904496 0.239705298\n463 2.56810404 0.6594000 0.0995904496 0.241009573\n464 2.57084189 0.6594000 0.0987390418 0.241860981\n465 2.57357974 0.6594000 0.0978892862 0.242710736\n466 2.57905544 0.6594000 0.0970411906 0.243558832\n467 2.58453114 0.6594000 0.0961947630 0.244405259\n468 2.59822040 0.6594000 0.0953500114 0.245250011\n469 2.60643395 0.6594000 0.0945069439 0.246093078\n470 2.62012320 0.6594000 0.0936655689 0.246934453\n471 2.62559890 0.6584975 0.0945680287 0.246934453\n472 2.62833676 0.6575942 0.0954713009 0.246934453\n473 2.63107461 0.6575942 0.0920568822 0.250348872\n474 2.63655031 0.6575942 0.0912182889 0.251187466\n475 2.64476386 0.6575942 0.0903814303 0.252024324\n476 2.65023956 0.6566902 0.0904504025 0.252859439\n477 2.65297741 0.6566902 0.0896163878 0.253693454\n478 2.66940452 0.6557861 0.0905204750 0.253693454\n479 2.67214237 0.6557861 0.0896858142 0.254528115\n480 2.67488022 0.6557861 0.0888529012 0.255361028\n481 2.69952088 0.6557861 0.0880199881 0.256193941\n482 2.71868583 0.6557861 0.0871888485 0.257025080\n483 2.72963723 0.6557861 0.0855203871 0.258693542\n484 2.77344285 0.6548812 0.0864252931 0.258693542\n485 2.78713210 0.6548812 0.0855953042 0.259523531\n486 2.79260780 0.6539754 0.0865010316 0.259523531\n487 2.79534565 0.6539754 0.0856703153 0.260354247\n488 2.79808350 0.6539754 0.0848414114 0.261183151\n489 2.80355921 0.6530689 0.0857479628 0.261183151\n490 2.80629706 0.6521623 0.0866545141 0.261183151\n491 2.80903491 0.6512558 0.0875610655 0.261183151\n492 2.81724846 0.6503484 0.0884684458 0.261183151\n493 2.82272416 0.6503484 0.0876330716 0.262018525\n494 2.82546201 0.6494402 0.0885412835 0.262018525\n495 2.83093771 0.6494402 0.0877069978 0.262852811\n496 2.83915127 0.6485320 0.0877827096 0.263685311\n497 2.85010267 0.6485320 0.0869512703 0.264516750\n498 2.85284052 0.6476238 0.0878594822 0.264516750\n499 2.86379192 0.6476238 0.0870273157 0.265348917\n500 2.86926762 0.6476238 0.0861969396 0.266179293\n501 2.88021903 0.6467147 0.0871059882 0.266179293\n502 2.88843258 0.6467147 0.0862748615 0.267010420\n503 2.89390828 0.6448928 0.0880967627 0.267010420\n504 2.90485969 0.6448928 0.0872623488 0.267844834\n505 2.92950034 0.6448928 0.0864297301 0.268677452\n506 2.95414100 0.6448928 0.0855989161 0.269508266\n507 2.95961670 0.6439812 0.0865104892 0.269508266\n508 2.96509240 0.6439812 0.0856788989 0.270339857\n509 2.98151951 0.6430688 0.0865913197 0.270339857\n510 2.98973306 0.6430688 0.0857589524 0.271172224\n511 3.01437372 0.6430688 0.0849284028 0.272002774\n512 3.01984942 0.6417516 0.0849284028 0.273320009\n513 3.02532512 0.6417516 0.0840996805 0.274148732\n514 3.02806297 0.6408380 0.0850132299 0.274148732\n515 3.03353867 0.6399236 0.0859276348 0.274148732\n516 3.04449008 0.6399236 0.0850954515 0.274980915\n517 3.04996578 0.6390084 0.0860107147 0.274980915\n518 3.05817933 0.6390084 0.0851777268 0.275813903\n519 3.07186858 0.6380922 0.0852626961 0.276645058\n520 3.09377139 0.6371761 0.0861788204 0.276645058\n521 3.10198494 0.6371761 0.0853460231 0.277477855\n522 3.10472279 0.6371761 0.0845150541 0.278308824\n523 3.10746064 0.6371761 0.0836859232 0.279137955\n524 3.11019849 0.6371761 0.0828586405 0.279965238\n525 3.11567420 0.6362591 0.0829502057 0.280790662\n526 3.11841205 0.6362591 0.0821220088 0.281618859\n527 3.12662560 0.6353413 0.0830398666 0.281618859\n528 3.13483915 0.6353413 0.0813780302 0.283280696\n529 3.15126626 0.6353413 0.0805527668 0.284105959\n530 3.15947981 0.6353413 0.0797275034 0.284931223\n531 3.17316906 0.6344234 0.0798220194 0.285754564\n532 3.17864476 0.6344234 0.0789996166 0.286576967\n533 3.19233402 0.6344234 0.0781791397 0.287397444\n534 3.22518823 0.6344234 0.0765353679 0.289041216\n535 3.23887748 0.6335056 0.0774532257 0.289041216\n536 3.24709103 0.6335056 0.0766356563 0.289858785\n537 3.26078029 0.6335056 0.0758200488 0.290674393\n538 3.26625599 0.6335056 0.0750064148 0.291488027\n539 3.27173169 0.6335056 0.0741927809 0.292301661\n540 3.27994524 0.6321816 0.0741927809 0.293625575\n541 3.28815880 0.6321816 0.0733811538 0.294437202\n542 3.30458590 0.6321816 0.0725695268 0.295248829\n543 3.31006160 0.6321816 0.0717599414 0.296058415\n544 3.31553730 0.6312626 0.0726789603 0.296058415\n545 3.31827515 0.6312626 0.0718681541 0.296869221\n546 3.32648871 0.6312626 0.0710573478 0.297680027\n547 3.32922656 0.6312626 0.0702486224 0.298488753\n548 3.33744011 0.6312626 0.0694419907 0.299295384\n549 3.36755647 0.6312626 0.0686374663 0.300099909\n550 3.37577002 0.6303427 0.0695573642 0.300099909\n551 3.38398357 0.6294228 0.0704772620 0.300099909\n552 3.38672142 0.6294228 0.0696700949 0.300907076\n553 3.41136208 0.6294228 0.0680516273 0.302525544\n554 3.42778919 0.6294228 0.0672488032 0.303328368\n555 3.45516769 0.6294228 0.0656400134 0.304937158\n556 3.48254620 0.6294228 0.0648438147 0.305733356\n557 3.48528405 0.6294228 0.0640498142 0.306527357\n558 3.48802190 0.6285020 0.0649705953 0.306527357\n559 3.49075975 0.6275804 0.0658922625 0.306527357\n560 3.49349760 0.6275804 0.0642794934 0.308140126\n561 3.49623546 0.6266578 0.0652020498 0.308140126\n562 3.50171116 0.6266578 0.0643992297 0.308942946\n563 3.53182752 0.6266578 0.0635964096 0.309745766\n564 3.54551677 0.6266578 0.0619874450 0.311354731\n565 3.55373032 0.6257339 0.0629113616 0.311354731\n566 3.56468172 0.6257339 0.0621116466 0.312154446\n567 3.57015743 0.6257339 0.0613119316 0.312954161\n568 3.57563313 0.6257339 0.0605145617 0.313751530\n569 3.59479808 0.6257339 0.0597171918 0.314548900\n570 3.59753593 0.6244019 0.0597171918 0.315880877\n571 3.62217659 0.6234768 0.0606423005 0.315880877\n572 3.62765229 0.6234768 0.0598432475 0.316679931\n573 3.63312799 0.6234768 0.0590465930 0.317476585\n574 3.63860370 0.6225508 0.0599726035 0.317476585\n575 3.70431211 0.6216248 0.0608986140 0.317476585\n576 3.73169062 0.6202906 0.0608986140 0.318810794\n577 3.73716632 0.6202906 0.0600985606 0.319610847\n578 3.76454483 0.6202906 0.0592985072 0.320410900\n579 3.79739904 0.6202906 0.0585008804 0.321208527\n580 3.80013689 0.6202906 0.0577032536 0.322006154\n581 3.83025325 0.6202906 0.0569056268 0.322803781\n582 3.84668036 0.6202906 0.0561105129 0.323598895\n583 3.89869952 0.6202906 0.0553179315 0.324391476\n584 3.92060233 0.6193620 0.0562465368 0.324391476\n585 3.92607803 0.6193620 0.0546436092 0.325994404\n586 3.93155373 0.6184325 0.0555731292 0.325994404\n587 3.93429158 0.6184325 0.0547768913 0.326790642\n588 3.93976728 0.6184325 0.0539832548 0.327584278\n589 3.95893224 0.6175020 0.0541200559 0.328377915\n590 3.96167009 0.6175020 0.0533217618 0.329176209\n591 3.98357290 0.6165707 0.0542531206 0.329176209\n592 4.01368925 0.6156384 0.0551854036 0.329176209\n593 4.02737851 0.6147052 0.0561186140 0.329176209\n594 4.03832991 0.6137696 0.0570541769 0.329176209\n595 4.05749487 0.6137696 0.0562404911 0.329989895\n596 4.07392197 0.6128331 0.0571769908 0.329989895\n597 4.09308693 0.6128331 0.0563641673 0.330802718\n598 4.13141684 0.6128331 0.0555513438 0.331615542\n599 4.13689254 0.6128331 0.0547411932 0.332425692\n600 4.16427105 0.6128331 0.0539310426 0.333235843\n601 4.18891170 0.6128331 0.0531208919 0.334045993\n602 4.20260096 0.6118966 0.0540573917 0.334045993\n603 4.21355236 0.6109568 0.0549972178 0.334045993\n604 4.21629021 0.6109568 0.0541805529 0.334862658\n605 4.23819302 0.6096063 0.0533666541 0.337027019\n606 4.24366872 0.6082560 0.0533666541 0.338377347\n607 4.24640657 0.6073155 0.0543071180 0.338377347\n608 4.27378508 0.6063741 0.0552485387 0.338377347\n609 4.28199863 0.6054317 0.0561909195 0.338377347\n610 4.29295003 0.6054317 0.0553660162 0.339202250\n611 4.35044490 0.6044884 0.0563093608 0.339202250\n612 4.39698836 0.6025973 0.0582004338 0.339202250\n613 4.39972621 0.6012423 0.0582004338 0.340557256\n614 4.43531828 0.6012423 0.0573650276 0.341392662\n615 4.48186174 0.6012423 0.0565296214 0.342228068\n616 4.50102669 0.6002967 0.0574752327 0.342228068\n617 4.50924025 0.5993511 0.0584208441 0.342228068\n618 4.52292950 0.5993511 0.0575795512 0.343069361\n619 4.53388090 0.5993511 0.0567410209 0.343907892\n620 4.56399726 0.5984045 0.0576876124 0.343907892\n621 4.56673511 0.5984045 0.0568502580 0.344745246\n622 4.57494867 0.5984045 0.0560129036 0.345582600\n623 4.59685147 0.5984045 0.0551755492 0.346419955\n624 4.61875428 0.5974579 0.0561221407 0.346419955\n625 4.63244353 0.5974579 0.0552831533 0.347258942\n626 4.67898700 0.5974579 0.0544470271 0.348095068\n627 4.71731691 0.5965103 0.0545613628 0.348928309\n628 4.77207392 0.5955628 0.0555089396 0.348928309\n629 4.77754962 0.5955628 0.0546750859 0.349762163\n630 4.78850103 0.5946152 0.0556226626 0.349762163\n631 4.79671458 0.5946152 0.0547871006 0.350597725\n632 4.81587953 0.5936666 0.0557356694 0.350597725\n633 4.83778234 0.5936666 0.0548955641 0.351437830\n634 4.84052019 0.5936666 0.0540554589 0.352277936\n635 4.85147159 0.5936666 0.0532182873 0.353115107\n636 4.88158795 0.5936666 0.0523840748 0.353949320\n637 4.88980151 0.5927170 0.0533336394 0.353949320\n638 4.89527721 0.5927170 0.0524976186 0.354785341\n639 4.90075291 0.5927170 0.0516645891 0.355618370\n640 4.92265572 0.5927170 0.0508345772 0.356448382\n641 4.96098563 0.5927170 0.0500045653 0.357278394\n642 4.97741273 0.5913386 0.0500045653 0.358656843\n643 5.00752909 0.5913386 0.0491745534 0.359486855\n644 5.01300479 0.5899382 0.0491745534 0.360887277\n645 5.03490760 0.5899382 0.0483476885 0.361714142\n646 5.06502396 0.5899382 0.0475239999 0.362537830\n647 5.06776181 0.5899382 0.0467035179 0.363358313\n648 5.08145106 0.5885248 0.0467035179 0.364771705\n649 5.13347023 0.5885248 0.0458862731 0.365588949\n650 5.13620808 0.5875290 0.0468820669 0.365588949\n651 5.14442163 0.5875290 0.0460649220 0.366406094\n652 5.15811088 0.5875290 0.0452510324 0.367219984\n653 5.16084873 0.5875290 0.0444404303 0.368030586\n654 5.18822724 0.5865276 0.0454418465 0.368030586\n655 5.19096509 0.5865276 0.0446278263 0.368844606\n656 5.22108145 0.5865276 0.0438055715 0.369666861\n657 5.24298426 0.5865276 0.0429867822 0.370485650\n658 5.24845996 0.5855158 0.0439985090 0.370485650\n659 5.28952772 0.5855158 0.0431640328 0.371320126\n660 5.33880903 0.5855158 0.0423168717 0.372167288\n661 5.40999316 0.5844798 0.0433529350 0.372167288\n662 5.42368241 0.5834345 0.0443982050 0.372167288\n663 5.46201232 0.5834345 0.0435398690 0.373025624\n664 5.50855578 0.5823566 0.0446177888 0.373025624\n665 5.52498289 0.5812774 0.0456970196 0.373025624\n666 5.53319644 0.5812774 0.0448228527 0.373899790\n667 5.53867214 0.5812774 0.0439486858 0.374773957\n668 5.55236140 0.5801874 0.0450386678 0.374773957\n669 5.56057495 0.5790919 0.0461341164 0.374773957\n670 5.57152635 0.5779965 0.0472295650 0.374773957\n671 5.57426420 0.5768997 0.0483263778 0.374773957\n672 5.61806982 0.5753142 0.0483263778 0.376359409\n673 5.65913758 0.5741921 0.0494485114 0.376359409\n674 5.67830253 0.5730641 0.0505765004 0.376359409\n675 5.68651608 0.5730641 0.0496705008 0.377265409\n676 5.69199179 0.5714229 0.0496705008 0.378906558\n677 5.70294319 0.5714229 0.0487682121 0.379808847\n678 5.70841889 0.5714229 0.0478696720 0.380707387\n679 5.82340862 0.5714229 0.0469442232 0.381632836\n680 5.82614648 0.5714229 0.0460187744 0.382558285\n681 5.83983573 0.5714229 0.0450829935 0.383494066\n682 5.88090349 0.5701688 0.0463371229 0.383494066\n683 5.89185489 0.5701688 0.0453481400 0.384483049\n684 5.94387406 0.5701688 0.0433186037 0.386512585\n685 5.95208761 0.5682670 0.0433186037 0.388414428\n686 6.01505818 0.5682670 0.0422673396 0.389465692\n687 6.05886379 0.5661208 0.0422673396 0.391611844\n688 6.10814511 0.5645644 0.0438237916 0.391611844\n689 6.17932923 0.5622358 0.0438237916 0.393940364\n690 6.25325120 0.5622358 0.0425913701 0.395172785\n691 6.26146475 0.5622358 0.0413669375 0.396397218\n692 6.26420260 0.5604966 0.0431062291 0.396397218\n693 6.34633812 0.5578806 0.0431062291 0.399013144\n694 6.43668720 0.5578806 0.0416651269 0.400454246\n695 6.72963723 0.5544924 0.0416651269 0.403842477\n696 6.79534565 0.5544924 0.0397057870 0.405801817\n697 6.91854894 0.5544924 0.0374645283 0.408043075\n698 6.95961670 0.5544924 0.0351471549 0.410360449\n699 6.98699521 0.5544924 0.0328297814 0.412677822\n700 7.09924709 0.5544924 0.0304189770 0.415088626\n701 7.34565366 0.5544924 0.0278984993 0.417609104\n702 7.37577002 0.5496642 0.0327266500 0.417609104\n703 7.44147844 0.5496642 0.0293684105 0.420967344\n704 7.46064339 0.5418401 0.0293684105 0.428791518\n705 7.63586585 0.5305339 0.0293684105 0.440097676\n706 7.96714579 0.5305339 0.0167289760 0.452737110\n707 9.11430527 0.5305339 0.0167289760 0.452737110\n\n\nShow R code\n#Store data into one\npr1 &lt;- pr_trt0_red[[1]] %&gt;% mutate(model = \"Control\")\npr2 &lt;- pr_trt1_red[[1]] %&gt;% mutate(model = \"Treatment\")\n\n#Plot of probabilities in state\n#| fig-width: 2\n#| fig-height: 3\nmatplot(pr1$time,\n        pr1[, grep(\"^pstate\", names(pr1))],\n        type = \"l\",\n        lwd  = 2,\n        lty  = 1,\n        xlab = \"Years from enrolment\",\n        ylab = \"Probability in state\",\n        col  = mycolor[c(2,4, 1)])\n\nmatlines(pr2$time,\n         pr2[, grep(\"^pstate\", names(pr2))],\n         type = \"l\",\n         lwd  = 2,\n         lty  = 2,\n         col  = mycolor[c(2,4, 1)])\n\n# legend for states (colours)\nlegend(\"topright\",\n       legend = c(\"Alive w/o recurrence\", \"Recurrence\", \"Death\"),\n       col    = mycolor[c(2,4, 1)],\n       lty    = 1,\n       lwd    = 2,\n       bty    = \"n\")\n\n# legend for models (linetypes)\nlegend(\"top\",\n       legend = c(\"Control\", \"Treatment\"),\n       lty    = c(1, 2),\n       lwd    = 2,\n       col    = \"black\",\n       bty    = \"n\")\n\n\n\n\n\n\n\n\n\n\n\n11.6 Flexible parametric ‘cause specific’ survival model\nLet’s move onto how we can fit flexible parametric survival models for multi-state approach.\n\n\nShow R code\n#Treatment variable\ncdata_long$trt &lt;- 1*(cdata_long$rx == \"Lev+5FU\")\ncdata_long$age10 &lt;- cdata_long$age/10 # age in decades\ncdata_long$male &lt;- 1*(cdata_long$sex ==1) # 0/1: male\n\n\n#Fit separate models for each transition - as given by msprep\nmsm_alive_recur &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==1), k=1, scale=\"hazard\")\nmsm_alive_recur\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0        NA   -0.82768  -1.71303   0.05767   0.45172        NA        NA\ngamma1        NA    2.53880   2.22200   2.85560   0.16164        NA        NA\ngamma2        NA    0.10153   0.08571   0.11734   0.00807        NA        NA\ntrt      0.32723   -0.50849  -0.71716  -0.29983   0.10646   0.60140   0.48814\nage10    5.97546   -0.02998  -0.10644   0.04649   0.03901   0.97047   0.89903\nmale     0.52099   -0.08630  -0.26799   0.09538   0.09270   0.91731   0.76491\nextent   2.88698    0.52915   0.30772   0.75058   0.11297   1.69749   1.36032\nnode4    0.27449    0.83298   0.64459   1.02138   0.09612   2.30017   1.90520\n        U95%    \ngamma0        NA\ngamma1        NA\ngamma2        NA\ntrt      0.74095\nage10    1.04758\nmale     1.10008\nextent   2.11822\nnode4    2.77704\n\nN = 929,  Events: 468,  Censored: 461\nTotal time at risk: 3573.892\nLog-likelihood = -1199.725, df = 8\nAIC = 2415.45\n\n\nShow R code\nmsm_alive_death &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==2), k=1, scale=\"hazard\")\nmsm_alive_death\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0        NA   -12.2813  -15.9276   -8.6349    1.8604        NA        NA\ngamma1        NA     0.7110    0.1039    1.3181    0.3097        NA        NA\ngamma2        NA    -0.0515   -0.1288    0.0257    0.0394        NA        NA\ntrt       0.3272     0.0329   -0.6236    0.6894    0.3350    1.0334    0.5360\nage10     5.9755     0.8619    0.4820    1.2419    0.1939    2.3678    1.6193\nmale      0.5210     0.4345   -0.2230    1.0920    0.3354    1.5442    0.8001\nextent    2.8870     0.4540   -0.3056    1.2136    0.3876    1.5746    0.7367\nnode4     0.2745     0.6487   -0.0843    1.3817    0.3740    1.9130    0.9191\n        U95%    \ngamma0        NA\ngamma1        NA\ngamma2        NA\ntrt       1.9925\nage10     3.4623\nmale      2.9801\nextent    3.3656\nnode4     3.9815\n\nN = 929,  Events: 38,  Censored: 891\nTotal time at risk: 3573.892\nLog-likelihood = -195.6232, df = 8\nAIC = 407.2465\n\n\nShow R code\nmsm_recur_death &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==3), k=1, scale=\"hazard\")\nmsm_recur_death\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    3), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0        NA   -1.17734  -2.00900  -0.34569   0.42432        NA        NA\ngamma1        NA    1.00044   0.36068   1.64021   0.32642        NA        NA\ngamma2        NA    0.02605  -0.02633   0.07843   0.02673        NA        NA\ntrt      0.25427    0.30244   0.07922   0.52567   0.11389   1.35316   1.08244\nage10    5.90363    0.10621   0.02803   0.18439   0.03989   1.11205   1.02842\nmale     0.51068    0.20393   0.00699   0.40087   0.10048   1.22621   1.00702\nextent   2.96795    0.09632  -0.11008   0.30271   0.10531   1.10111   0.89577\nnode4    0.38462    0.42685   0.22293   0.63077   0.10404   1.53242   1.24974\n        U95%    \ngamma0        NA\ngamma1        NA\ngamma2        NA\ntrt      1.69159\nage10    1.20249\nmale     1.49312\nextent   1.35353\nnode4    1.87905\n\nN = 468,  Events: 414,  Censored: 54\nTotal time at risk: 673.5797\nLog-likelihood = -582.0249, df = 8\nAIC = 1180.05\n\n\nWe have fitted a separate model for each transition, using the subset option, and each has 1 internal knots. We can use the above to determine the covariate effects for each transition.\nWe see that the treatment does reduce hazard of recurrence (HR: 0.60, 95%CI: 0.49, 0.74), but does not affect the hazard of death either from disease-free state (HR: 1.03, 0.53, 1.99) or the recurrence state (HR: 1.07, 95%CI: 0.86, 1.35).\nWe can then group the transition models together using fmsm, and the associated transition matrix. We can produce the AIC for the entire transition model, allowing us to compare different knot selections.\n\n\nShow R code\n#Define transition matrix\ntmat_flexsurv &lt;- rbind(c(NA,1,2), c(NA, NA, 3), c(NA, NA, NA))\ntmat_flexsurv\n\n\n     [,1] [,2] [,3]\n[1,]   NA    1    2\n[2,]   NA   NA    3\n[3,]   NA   NA   NA\n\n\nShow R code\n#Group transitions together\nmsm_alltrans &lt;- fmsm(msm_alive_recur, msm_alive_death, msm_recur_death, trans=tmat_flexsurv)\nmsm_alltrans\n\n\nState 1 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nState 1 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\nState 2 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    3), k = 1, scale = \"hazard\")\n\n\nShow R code\n#AIC for entire transition model\nAIC(msm_alltrans)\n\n\n[1] 4002.746\n\n\nWe are now able to use the entire transition model to produce other relevant estimates. Below we are able to produce the cumulative transition-specific intensity function (cumulative hazard) for newdata with set covariates. We can only define one covariate set per msfit.flexsurvreg(), so we would need to re-run with alternate covariate pattern to make any comparisons.\n\n\nShow R code\n#New data to estimate on - ref level\nmsm_preddata0 &lt;- data.frame(\n  trt = c(0),\n  age10=c(4),\n  male=c(0),\n  extent = c(0),\n  node4 = c(0)\n)\n\n#Cumulative intensity function - control\ncum_trans0&lt;- msfit.flexsurvreg(msm_alltrans, t=seq(0,5,by=0.2), newdata=msm_preddata0, trans=tmat_flexsurv)\n\n#New data to estimate on - treatment\nmsm_preddata1 &lt;- data.frame(\n  trt = c(1),\n  age10=c(4),\n  male=c(0),\n  extent = c(0),\n  node4 = c(0)\n)\n\n#Cumulative intensity function - treatment\ncum_trans1&lt;- msfit.flexsurvreg(msm_alltrans, t=seq(0,5,by=0.2), newdata=msm_preddata1, trans=tmat_flexsurv)\n\n#Store data into one\nct1 &lt;- cum_trans0$Haz %&gt;% mutate(model = \"Control\")\nct2 &lt;- cum_trans1$Haz %&gt;% mutate(model = \"Treatment\")\n\nct_all &lt;- bind_rows(ct1, ct2)\nct_all &lt;- ct_all %&gt;% \n  mutate(trans2 = case_when(\n    trans==1 ~ \"Alive to recur\",\n    trans==2 ~ \"Alive to death\",\n    trans==3 ~ \"Recur to death\"\n  ))\n\n#Plot - stepped\n#| fig-width: 2\n#| fig-height: 3\nggplot(ct_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_step(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nShow R code\n#Plot - smoothed line\n#| fig-width: 2\n#| fig-height: 3\nggplot(ct_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_line(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nFrom the output of msfit.flexsurvreg(), we can then estimate the probability in state using mstate package.\n\n\nShow R code\n#Probability in state - control\nprob_instate0 &lt;- probtrans(cum_trans0, predt=0, direction=\"forward\")\n\n#Probability in state - treatment\nprob_instate1 &lt;- probtrans(cum_trans1, predt=0, direction=\"forward\")\n\n#Check output for from entry to recur\nprob_instate0[[1]]\n\n\n   time   pstate1     pstate2      pstate3         se1         se2          se3\n1   0.0 1.0000000 0.000000000 0.000000e+00 0.000000000 0.000000000 0.0000000000\n2   0.2 0.9954378 0.004514964 4.720236e-05 0.002128013 0.002147415 0.0005516069\n3   0.4 0.9834792 0.016033100 4.877184e-04 0.006895012 0.006962216 0.0013854631\n4   0.6 0.9691903 0.028929685 1.880012e-03 0.012380766 0.012344107 0.0027372136\n5   0.8 0.9552236 0.040550723 4.225664e-03 0.017642693 0.017337914 0.0044648924\n6   1.0 0.9426501 0.050024228 7.325672e-03 0.022314658 0.021611156 0.0064362832\n7   1.2 0.9317913 0.057258488 1.095020e-02 0.026302141 0.025107300 0.0085319625\n8   1.4 0.9225291 0.062573807 1.489708e-02 0.029667622 0.027924767 0.0106626518\n9   1.6 0.9146090 0.066378067 1.901290e-02 0.032518153 0.030197649 0.0127683564\n10  1.8 0.9077973 0.069013115 2.318958e-02 0.034948826 0.032037297 0.0148107330\n11  2.0 0.9018972 0.070750109 2.735274e-02 0.037038053 0.033531547 0.0167670448\n12  2.2 0.8967480 0.071799559 3.145241e-02 0.038848823 0.034748670 0.0186254293\n13  2.4 0.8922204 0.072320310 3.545934e-02 0.040431316 0.035740800 0.0203820973\n14  2.6 0.8882097 0.072432079 3.935821e-02 0.041825509 0.036548153 0.0220384820\n15  2.8 0.8846318 0.072227587 4.314066e-02 0.043063366 0.037202715 0.0235985673\n16  3.0 0.8814180 0.071779061 4.680289e-02 0.044170597 0.037730152 0.0250676363\n17  3.2 0.8785128 0.071143059 5.034417e-02 0.045168010 0.038151234 0.0264515177\n18  3.4 0.8758701 0.070364082 5.376584e-02 0.046072567 0.038482902 0.0277561808\n19  3.6 0.8734521 0.069477308 5.707060e-02 0.046898184 0.038739088 0.0289874867\n20  3.8 0.8712273 0.068510654 6.026201e-02 0.047656357 0.038931332 0.0301510434\n21  4.0 0.8691695 0.067486352 6.334417e-02 0.048356643 0.039069261 0.0312521310\n22  4.2 0.8672564 0.066422148 6.632146e-02 0.049007036 0.039160955 0.0322956694\n23  4.4 0.8654694 0.065332240 6.919840e-02 0.049614260 0.039213241 0.0332862114\n24  4.6 0.8637925 0.064227994 7.197952e-02 0.050184004 0.039231914 0.0342279517\n25  4.8 0.8622122 0.063118509 7.466930e-02 0.050721106 0.039221922 0.0351247443\n26  5.0 0.8607168 0.062011065 7.727210e-02 0.051229697 0.039187510 0.0359801239\n\n\nShow R code\nprob_instate1[[1]]\n\n\n   time   pstate1     pstate2      pstate3         se1         se2          se3\n1   0.0 1.0000000 0.000000000 0.000000e+00 0.000000000 0.000000000 0.0000000000\n2   0.2 0.9972359 0.002715308 4.878061e-05 0.001258283 0.001271663 0.0004495674\n3   0.4 0.9900162 0.009568952 4.148045e-04 0.004103927 0.004153996 0.0011273600\n4   0.6 0.9813515 0.017101654 1.546867e-03 0.007433526 0.007397342 0.0021562064\n5   0.8 0.9728321 0.023736583 3.431276e-03 0.010669975 0.010409454 0.0034386521\n6   1.0 0.9651164 0.028988203 5.895361e-03 0.013575235 0.012979484 0.0048804375\n7   1.2 0.9584154 0.032837891 8.746703e-03 0.016077175 0.015066276 0.0063940255\n8   1.4 0.9526707 0.035509815 1.181950e-02 0.018204454 0.016727368 0.0079140260\n9   1.6 0.9477363 0.037273195 1.499054e-02 0.020017437 0.018044599 0.0093975561\n10  1.8 0.9434752 0.038349455 1.817531e-02 0.021571647 0.019086418 0.0108185225\n11  2.0 0.9397709 0.038911531 2.131754e-02 0.022913841 0.019907301 0.0121628192\n12  2.2 0.9365273 0.039091630 2.438111e-02 0.024082151 0.020550045 0.0134244930\n13  2.4 0.9336661 0.038987512 2.734636e-02 0.025107310 0.021047571 0.0146033647\n14  2.6 0.9311242 0.038671355 3.020441e-02 0.026014034 0.021425534 0.0157028192\n15  2.8 0.9288502 0.038198196 3.295164e-02 0.026822245 0.021704692 0.0167278307\n16  3.0 0.9268021 0.037610206 3.558773e-02 0.027548065 0.021901960 0.0176840241\n17  3.2 0.9249456 0.036939819 3.811455e-02 0.028204610 0.022031211 0.0185771384\n18  3.4 0.9232527 0.036212053 4.053529e-02 0.028802616 0.022103895 0.0194127529\n19  3.6 0.9216997 0.035446255 4.285400e-02 0.029350927 0.022129517 0.0201961371\n20  3.8 0.9202674 0.034657405 4.507519e-02 0.029856875 0.022116014 0.0209321784\n21  4.0 0.9189393 0.033857109 4.720358e-02 0.030326570 0.022070045 0.0216253575\n22  4.2 0.9177017 0.033054342 4.924397e-02 0.030765139 0.021997223 0.0222797515\n23  4.4 0.9165429 0.032256027 5.120108e-02 0.031176899 0.021902301 0.0228990533\n24  4.6 0.9154530 0.031467476 5.307952e-02 0.031565512 0.021789316 0.0234865974\n25  4.8 0.9144235 0.030692734 5.488372e-02 0.031934093 0.021661711 0.0240453895\n26  5.0 0.9134472 0.029934841 5.661792e-02 0.032285307 0.021522430 0.0245781369\n\n\nShow R code\n#Store data into one\npr_is1 &lt;- prob_instate0[[1]] %&gt;% mutate(model = \"Control\")\npr_is2 &lt;- prob_instate1[[1]] %&gt;% mutate(model = \"Treatment\")\n\n#Plot of probabilities in state\n#| fig-width: 2\n#| fig-height: 3\nmatplot(pr_is1$time,\n        pr_is1[, grep(\"^pstate\", names(pr1))],\n        type = \"l\",\n        lwd  = 2,\n        lty  = 1,\n        xlab = \"Years from enrolment\",\n        ylab = \"Probability in state\",\n        col  = mycolor[c(2,4, 1)])\n\nmatlines(pr_is2$time,\n         pr_is2[, grep(\"^pstate\", names(pr2))],\n         type = \"l\",\n         lwd  = 2,\n         lty  = 2,\n         col  = mycolor[c(2,4, 1)])\n\n# legend for states (colours)\nlegend(\"right\",\n       legend = c(\"Alive w/o recurrence\", \"Recurrence\", \"Death\"),\n       col    = mycolor[c(2,4, 1)],\n       lty    = 1,\n       lwd    = 2,\n       bty    = \"n\")\n\n# legend for models (linetypes)\nlegend(3.25,0.35,\n       legend = c(\"Control\", \"Treatment\"),\n       lty    = c(1, 2),\n       lwd    = 2,\n       col    = \"black\",\n       bty    = \"n\")\n\n\n\n\n\n\n\n\n\nSimilar to what was produced from the coxph(), we can produce the expected time in each state. From the below, we are predicting for the reference level.\n\n\nShow R code\n#Expected time in states by 8 years - ref level\nELOS(prob_instate0,t=8)\n\n\n          in1       in2       in3\nfrom1 7.12111 0.4725666 0.4063239\nfrom2 0.00000 3.0353899 4.9646101\nfrom3 0.00000 0.0000000 8.0000000\n\n\nStarting from the alive state, there would be 7.12 years expected in the alive state, 0.47 years in the recurrence state and 0.41 years in the death state. These can vary as we vary the covariates included. For example, now including the treatment effect below.\n\n\nShow R code\n#Expected time in states by 8 years - treatment effect\nELOS(prob_instate1,t=8)\n\n\n           in1       in2       in3\nfrom1 7.456105 0.2422315 0.3016635\nfrom2 0.000000 2.2670303 5.7329697\nfrom3 0.000000 0.0000000 8.0000000\n\n\n\n\n11.7 Flexsurvreg\nA special mention about flexsurvreg that this fits standard parametric survival models and does not include splines, as covered in the first lecture for flexible parametric survival.\nWe are also able to fit these models, under the same basis as covered above, and compare these to select best model fit. There is more functionality in flexsurv to produce subsequent outputs of interest, such as total length of stay in particular states over time and transition probability matrix.\n\n\nShow R code\n#Standard parametric survival using Weibull\nmsm_alive_recur_para &lt;- flexsurvreg(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==1), dist=\"weibull\")\nmsm_alive_recur_para\n\n\nCall:\nflexsurvreg(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + \n    male + extent + node4, data = cdata_long, subset = (trans == \n    1), dist = \"weibull\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \nshape         NA     0.7213    0.6666    0.7805    0.0290        NA        NA\nscale         NA    71.4934   22.4423  227.7535   42.2643        NA        NA\ntrt       0.3272     0.7531    0.4612    1.0449    0.1489    2.1235    1.5860\nage10     5.9755     0.0355   -0.0709    0.1419    0.0543    1.0361    0.9315\nmale      0.5210     0.0949   -0.1570    0.3469    0.1285    1.0996    0.8547\nextent    2.8870    -0.7613   -1.0689   -0.4537    0.1570    0.4671    0.3434\nnode4     0.2745    -1.2116   -1.4796   -0.9436    0.1367    0.2977    0.2277\n        U95%    \nshape         NA\nscale         NA\ntrt       2.8432\nage10     1.1524\nmale      1.4146\nextent    0.6353\nnode4     0.3892\n\nN = 929,  Events: 468,  Censored: 461\nTotal time at risk: 3573.892\nLog-likelihood = -1296.548, df = 7\nAIC = 2607.096\n\n\nShow R code\nmsm_alive_death_para &lt;- flexsurvreg(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==2), dist=\"weibull\")\nmsm_alive_death_para\n\n\nCall:\nflexsurvreg(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + \n    male + extent + node4, data = cdata_long, subset = (trans == \n    2), dist = \"weibull\")\n\nEstimates: \n        data mean  est        L95%       U95%       se         exp(est) \nshape          NA   1.10e+00   8.41e-01   1.44e+00   1.52e-01         NA\nscale          NA   5.14e+04   9.62e+02   2.74e+06   1.04e+05         NA\ntrt      3.27e-01  -4.07e-02  -6.38e-01   5.56e-01   3.05e-01   9.60e-01\nage10    5.98e+00  -7.79e-01  -1.18e+00  -3.80e-01   2.03e-01   4.59e-01\nmale     5.21e-01  -3.90e-01  -9.94e-01   2.15e-01   3.08e-01   6.77e-01\nextent   2.89e+00  -4.11e-01  -1.11e+00   2.86e-01   3.56e-01   6.63e-01\nnode4    2.74e-01  -5.80e-01  -1.25e+00   9.01e-02   3.42e-01   5.60e-01\n        L95%       U95%     \nshape          NA         NA\nscale          NA         NA\ntrt      5.29e-01   1.74e+00\nage10    3.08e-01   6.84e-01\nmale     3.70e-01   1.24e+00\nextent   3.30e-01   1.33e+00\nnode4    2.87e-01   1.09e+00\n\nN = 929,  Events: 38,  Censored: 891\nTotal time at risk: 3573.892\nLog-likelihood = -196.3709, df = 7\nAIC = 406.7417\n\n\nShow R code\nmsm_recur_death_para &lt;-flexsurvreg(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==3), dist=\"weibull\")\nmsm_recur_death_para\n\n\nCall:\nflexsurvreg(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + \n    male + extent + node4, data = cdata_long, subset = (trans == \n    3), dist = \"weibull\")\n\nEstimates: \n        data mean  est        L95%       U95%       se         exp(est) \nshape          NA   6.73e-01   5.55e-01   8.16e-01   6.61e-02         NA\nscale          NA   4.94e+00   1.54e+00   1.59e+01   2.94e+00         NA\ntrt      2.54e-01  -4.47e-01  -7.95e-01  -9.97e-02   1.77e-01   6.39e-01\nage10    5.90e+00  -1.57e-01  -2.77e-01  -3.81e-02   6.08e-02   8.54e-01\nmale     5.11e-01  -2.98e-01  -5.96e-01   8.37e-06   1.52e-01   7.42e-01\nextent   2.97e+00  -1.50e-01  -4.57e-01   1.57e-01   1.57e-01   8.61e-01\nnode4    3.85e-01  -6.38e-01  -9.36e-01  -3.40e-01   1.52e-01   5.28e-01\n        L95%       U95%     \nshape          NA         NA\nscale          NA         NA\ntrt      4.52e-01   9.05e-01\nage10    7.58e-01   9.63e-01\nmale     5.51e-01   1.00e+00\nextent   6.33e-01   1.17e+00\nnode4    3.92e-01   7.12e-01\n\nN = 468,  Events: 414,  Censored: 54\nTotal time at risk: 673.5797\nLog-likelihood = -582.4635, df = 7\nAIC = 1178.927\n\n\nWe see that the treatment effect does suggest longer time until recurrence (TR: 2.12, 95%CI: 1.59, 2.84) and shorter time until recurrence state (TR: 0.64, 95%CI: 0.45, 0.91), but does not affect the time until death from disease-free state (TR: 0.96, 95%CI: 0.53, 1.74). This is consistent with our findings from above models.\nSee below similar coding to above to produce the cumulative hazard and probability in state using these parametric survival models.\n\n\nShow R code\n#Create list of transition models\nbexp.list &lt;- vector(3, mode=\"list\")\nbexp.list[[1]] &lt;- msm_alive_recur_para\nbexp.list[[2]] &lt;- msm_alive_death_para\nbexp.list[[3]] &lt;- msm_recur_death_para\n\n#Newdata to predict on - control\nnewdata_prob0 &lt;- data.frame(\n  trt = c(0),\n  age10=c(4),\n  male=c(0),\n  extent = c(0),\n  node4 = c(0)\n)  \n\n#Newdata to predict on - treatment\nnewdata_prob1 &lt;- data.frame(\n  trt = c(1),\n  age10=c(4),\n  male=c(0),\n  extent = c(0),\n  node4 = c(0)\n)  \n\n#Cumulative transition specific hazard function - control\ncum_thaz0 &lt;- msfit.flexsurvreg(bexp.list, t=seq(0,5,by=0.2), newdata=newdata_prob0, trans=tmat_flexsurv)\n\n#Cumulative transition specific hazard function - treatment\ncum_thaz1 &lt;- msfit.flexsurvreg(bexp.list, t=seq(0,5,by=0.2), newdata=newdata_prob1, trans=tmat_flexsurv)\n\n#Store data into one\ncth1 &lt;- cum_thaz0$Haz %&gt;% mutate(model = \"Control\")\ncth2 &lt;- cum_thaz1$Haz %&gt;% mutate(model = \"Treatment\")\n\ncth_all &lt;- bind_rows(cth1, cth2)\ncth_all &lt;- cth_all %&gt;% \n  mutate(trans2 = case_when(\n    trans==1 ~ \"Alive to recur\",\n    trans==2 ~ \"Alive to death\",\n    trans==3 ~ \"Recur to death\"\n  ))\n\n\n#Plot - smoothed line\n#| fig-width: 2\n#| fig-height: 3\nggplot(cth_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_line(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nShow R code\n#Probability in state - control\nprob_para0 &lt;- probtrans(cum_thaz0, predt=0, direction=\"forward\")\n\n#Probability in state - treatment\nprob_para1 &lt;- probtrans(cum_thaz1, predt=0, direction=\"forward\")\n\n#Check output for from entry to recur\nprob_para0[[1]]\n\n\n   time   pstate1    pstate2      pstate3         se1         se2         se3\n1   0.0 1.0000000 0.00000000 0.000000e+00 0.000000000 0.000000000 0.000000000\n2   0.2 0.9869684 0.01299746 3.412263e-05 0.005154824 0.005291113 0.001084210\n3   0.4 0.9786085 0.01995642 1.435128e-03 0.008296809 0.008263388 0.002120478\n4   0.6 0.9714439 0.02531996 3.236179e-03 0.010951844 0.010671464 0.003231063\n5   0.8 0.9649710 0.02975294 5.276075e-03 0.013326797 0.012763367 0.004390395\n6   1.0 0.9589752 0.03354457 7.480242e-03 0.015508880 0.014642378 0.005580616\n7   1.2 0.9533389 0.03685591 9.805150e-03 0.017545577 0.016364010 0.006790067\n8   1.4 0.9479888 0.03978901 1.222221e-02 0.019466470 0.017962377 0.008010829\n9   1.6 0.9428748 0.04241399 1.471124e-02 0.021291624 0.019460292 0.009237308\n10  1.8 0.9379610 0.04478177 1.725728e-02 0.023035471 0.020873929 0.010465431\n11  2.0 0.9332203 0.04693084 1.984885e-02 0.024708850 0.022215267 0.011692160\n12  2.2 0.9286318 0.04889126 2.247691e-02 0.026320178 0.023493480 0.012915191\n13  2.4 0.9241788 0.05068701 2.513419e-02 0.027876166 0.024715789 0.014132755\n14  2.6 0.9198476 0.05233767 2.781473e-02 0.029382281 0.025888002 0.015343480\n15  2.8 0.9156269 0.05385946 3.051362e-02 0.030843054 0.027014880 0.016546300\n16  3.0 0.9115073 0.05526598 3.322673e-02 0.032262299 0.028100388 0.017740382\n17  3.2 0.9074806 0.05656881 3.595057e-02 0.033643267 0.029147877 0.018925076\n18  3.4 0.9035400 0.05777787 3.868218e-02 0.034988761 0.030160209 0.020099881\n19  3.6 0.8996792 0.05890177 4.141900e-02 0.036301219 0.031139859 0.021264410\n20  3.8 0.8958931 0.05994799 4.415886e-02 0.037582781 0.032088984 0.022418372\n21  4.0 0.8921770 0.06092313 4.689984e-02 0.038835339 0.033009483 0.023561553\n22  4.2 0.8885267 0.06183301 4.964030e-02 0.040060579 0.033903040 0.024693802\n23  4.4 0.8849384 0.06268278 5.237880e-02 0.041260008 0.034771159 0.025815018\n24  4.6 0.8814089 0.06347707 5.511406e-02 0.042434987 0.035615188 0.026925144\n25  4.8 0.8779350 0.06422001 5.784499e-02 0.043586745 0.036436350 0.028024158\n26  5.0 0.8745141 0.06491532 6.057061e-02 0.044716399 0.037235753 0.029112067\n\n\nShow R code\nprob_para1[[1]]\n\n\n   time   pstate1     pstate2      pstate3         se1         se2          se3\n1   0.0 1.0000000 0.000000000 0.0000000000 0.000000000 0.000000000 0.0000000000\n2   0.2 0.9924142 0.007550081 0.0000356882 0.003192939 0.003273272 0.0008478535\n3   0.4 0.9875132 0.011341122 0.0011456879 0.005158922 0.005073481 0.0016533179\n4   0.6 0.9832946 0.014165071 0.0025403516 0.006833464 0.006520637 0.0024996161\n5   0.8 0.9794692 0.016435827 0.0040949779 0.008342640 0.007772852 0.0033692186\n6   1.0 0.9759141 0.018332336 0.0057536041 0.009739293 0.008894659 0.0042505389\n7   1.2 0.9725619 0.019953590 0.0074844616 0.011052042 0.009920207 0.0051365461\n8   1.4 0.9693709 0.021361849 0.0092672408 0.012298627 0.010870245 0.0060228332\n9   1.6 0.9663125 0.022599535 0.0110879847 0.013491019 0.011758548 0.0069065505\n10  1.8 0.9633662 0.023697182 0.0129366247 0.014637793 0.012594847 0.0077858181\n11  2.0 0.9605167 0.024677670 0.0148056406 0.015745357 0.013386346 0.0086593848\n12  2.2 0.9577521 0.025558674 0.0166892689 0.016818667 0.014138575 0.0095264214\n13  2.4 0.9550628 0.026354180 0.0185830035 0.017861658 0.014855904 0.0103863890\n14  2.6 0.9524413 0.027075476 0.0204832662 0.018877521 0.015541872 0.0112389524\n15  2.8 0.9498810 0.027731818 0.0223871802 0.019868890 0.016199403 0.0120839217\n16  3.0 0.9473767 0.028330898 0.0242924097 0.020837975 0.016830954 0.0129212113\n17  3.2 0.9449238 0.028879185 0.0261970433 0.021786650 0.017438617 0.0137508114\n18  3.4 0.9425183 0.029382172 0.0280995066 0.022716526 0.018024200 0.0145727668\n19  3.6 0.9401569 0.029844564 0.0299984973 0.023628999 0.018589277 0.0153871623\n20  3.8 0.9378366 0.030270421 0.0318929335 0.024525289 0.019135238 0.0161941112\n21  4.0 0.9355548 0.030663273 0.0337819148 0.025406471 0.019663313 0.0169937468\n22  4.2 0.9333091 0.031026203 0.0356646907 0.026273500 0.020174603 0.0177862164\n23  4.4 0.9310974 0.031361924 0.0375406355 0.027127225 0.020670100 0.0185716767\n24  4.6 0.9289179 0.031672828 0.0394092282 0.027968412 0.021150701 0.0193502898\n25  4.8 0.9267689 0.031961042 0.0412700359 0.028797749 0.021617220 0.0201222208\n26  5.0 0.9246488 0.032228456 0.0431227004 0.029615860 0.022070403 0.0208876358\n\n\nShow R code\n#Store data into one\npr_th1 &lt;- prob_para0[[1]] %&gt;% mutate(model = \"Control\")\npr_th2 &lt;- prob_para1[[1]] %&gt;% mutate(model = \"Treatment\")\n\n#Plot of probabilities in state\n#| fig-width: 2\n#| fig-height: 3\nmatplot(pr_th1$time,\n        pr_th1[, grep(\"^pstate\", names(pr1))],\n        type = \"l\",\n        lwd  = 2,\n        lty  = 1,\n        xlab = \"Years from enrolment\",\n        ylab = \"Probability in state\",\n        col  = mycolor[c(2,4, 1)])\n\nmatlines(pr_th2$time,\n         pr_th2[, grep(\"^pstate\", names(pr2))],\n         type = \"l\",\n         lwd  = 2,\n         lty  = 2,\n         col  = mycolor[c(2,4, 1)])\n\n# legend for states (colours)\nlegend(\"right\",\n       legend = c(\"Alive w/o recurrence\", \"Recurrence\", \"Death\"),\n       col    = mycolor[c(2,4, 1)],\n       lty    = 1,\n       lwd    = 2,\n       bty    = \"n\")\n\n# legend for models (linetypes)\nlegend(3.25,0.35,\n       legend = c(\"Control\", \"Treatment\"),\n       lty    = c(1, 2),\n       lwd    = 2,\n       col    = \"black\",\n       bty    = \"n\")\n\n\n\n\n\n\n\n\n\nThe expected mean time in each state is similar to our flexible parametric survival model above.\n\n\nShow R code\n#Expected time in states by 8 years - ref level\nELOS(prob_para0, t=8)\n\n\n           in1       in2       in3\nfrom1 7.265087 0.4226893 0.3122241\nfrom2 0.000000 2.7754790 5.2245210\nfrom3 0.000000 0.0000000 8.0000000\n\n\nStarting from the alive state, there would be 7.27 years expected in the alive state, 0.42 years in the recurrence state and 0.31 years in the death state. These can vary as we vary the covariates included. For example, now including the treatment effect below. We see there was more time spent in alive state, and less time in recurrence and death.\n\n\nShow R code\n#Expected time in states by 8 years - treatment\nELOS(prob_para1, t=8)\n\n\n           in1       in2       in3\nfrom1 7.560813 0.2147308 0.2244565\nfrom2 0.000000 2.0004054 5.9995946\nfrom3 0.000000 0.0000000 8.0000000",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Intro_to_R_LearnR.html",
    "href": "Intro_to_R_LearnR.html",
    "title": "Advanced Survival",
    "section": "",
    "text": "In this tutorial, we will use the statistical programming language R to carry out analyses. RStudio allows you to run R in a more user-friendly environment. This is an introduction to R and RStudio and to the basic skills you need to complete the exercises.\nFirst, let’s make sure you have the latest, or sufficiently up-to-date, versions of R and RStudio installed on your computer as you may not otherwise be able to install all the R packages needed for the course.\nIf you already have R and RStudio installed, check on to see the R version installed. You can view your R version in the start menu, in R Console when you first open R or Rstudio, or by typing getRversion() in your R Console.\nIf you have an older version of R installed on your computer, it is recommended that you uninstall that version and then follow the steps below for installing R and RStudio.\nThe latest version of R is available from the Comprehensive R Archive Network (CRAN) webpage: https://cran.r-project.org/. There are versions available for Windows, Linux, and Mac.\nTo install R on a PC click on “Download R for Windows”. You need to install the base system so click on “install R for the first time”. This will take you to a new window with the latest version of R. Click on “Download R 4.X.X for Windows” and follow the installation instructions.\nTo install R on a Mac click on “Download R for macOS” and download the R binary under “Latest release”. The file will have an extension of .pkg, for example, R-4.X.X.pkg. Click on this link and follow the instructions.\nPlease note that on Windows, R is typically installed under C:/Program Files/R/. However, if you do not have administrative privileges on your computer, you will not be able to write to the /Program Files/ directory and this may cause difficulties when you are trying to install R packages later on. The easiest way to avoid this issue is to create a new installation location (e.g. C:/Users/myname/R/) and use it instead of the default C:/Program Files/R/ when installing R. Further instructions are available from https://rpubs.com/tomhopper/windows_nonadmin_install. Otherwise, default settings are OK.\nAll R functions and many datasets are stored in packages. For example, a collection of 12 base packages are installed when the base distribution of R is downloaded from the CRAN webpage. Some other recommended packages are also automatically installed with the base system. If you already have R and RStudio installed, you can check for updates on the packages that you have already installed by typing update.packages() in your R Console. This may take several minutes and require use input.\nTo install RStudio go to https://rstudio.com/products/rstudio/download/, scroll down and download the free RStudio Desktop, choosing the appropriate file for your operating system and following the prompts. When installing RStudio, remember to select the same new installation location as you did for R if not the default C:/Program Files/R/. If you may need to use RStudio on several different computers, you can install R and RStudio onto a USB stick and then you can use RStudio on any computer that reads your USB stick.\nOnce you have successfully installed the latest versions of R and RStudio, navigate to the RStudio program in the start menu and launch the program. Once RStudio opens (it may take a little while) you should see three panels on your RStudio screen:\n\nThe big left panel is the Console where you can type commands and see output\nThe top right panel contains the tabs Environment and History. The Environment tab stores any object, value, function or anything else you create during your R session. The History tab keeps a record of all previous commands.\nThe bottom right panel contains the tabs Files, Plots, Packages, and Help. The Files tab shows all the files and folders in your working directory as if you were on a PC/Mac window. The Plots tab will show all your graphs. The Packages tab will show a list of packages or add-ons needed to run certain process. The Help tab provides additional info.\n\nYou can think of R as a (very advanced) calculator. Try typing some basic mathematical calculations in the Console before moving on."
  },
  {
    "objectID": "Intro_to_R_LearnR.html#introduction-to-r-and-rstudio",
    "href": "Intro_to_R_LearnR.html#introduction-to-r-and-rstudio",
    "title": "Advanced Survival",
    "section": "",
    "text": "In this tutorial, we will use the statistical programming language R to carry out analyses. RStudio allows you to run R in a more user-friendly environment. This is an introduction to R and RStudio and to the basic skills you need to complete the exercises.\nFirst, let’s make sure you have the latest, or sufficiently up-to-date, versions of R and RStudio installed on your computer as you may not otherwise be able to install all the R packages needed for the course.\nIf you already have R and RStudio installed, check on to see the R version installed. You can view your R version in the start menu, in R Console when you first open R or Rstudio, or by typing getRversion() in your R Console.\nIf you have an older version of R installed on your computer, it is recommended that you uninstall that version and then follow the steps below for installing R and RStudio.\nThe latest version of R is available from the Comprehensive R Archive Network (CRAN) webpage: https://cran.r-project.org/. There are versions available for Windows, Linux, and Mac.\nTo install R on a PC click on “Download R for Windows”. You need to install the base system so click on “install R for the first time”. This will take you to a new window with the latest version of R. Click on “Download R 4.X.X for Windows” and follow the installation instructions.\nTo install R on a Mac click on “Download R for macOS” and download the R binary under “Latest release”. The file will have an extension of .pkg, for example, R-4.X.X.pkg. Click on this link and follow the instructions.\nPlease note that on Windows, R is typically installed under C:/Program Files/R/. However, if you do not have administrative privileges on your computer, you will not be able to write to the /Program Files/ directory and this may cause difficulties when you are trying to install R packages later on. The easiest way to avoid this issue is to create a new installation location (e.g. C:/Users/myname/R/) and use it instead of the default C:/Program Files/R/ when installing R. Further instructions are available from https://rpubs.com/tomhopper/windows_nonadmin_install. Otherwise, default settings are OK.\nAll R functions and many datasets are stored in packages. For example, a collection of 12 base packages are installed when the base distribution of R is downloaded from the CRAN webpage. Some other recommended packages are also automatically installed with the base system. If you already have R and RStudio installed, you can check for updates on the packages that you have already installed by typing update.packages() in your R Console. This may take several minutes and require use input.\nTo install RStudio go to https://rstudio.com/products/rstudio/download/, scroll down and download the free RStudio Desktop, choosing the appropriate file for your operating system and following the prompts. When installing RStudio, remember to select the same new installation location as you did for R if not the default C:/Program Files/R/. If you may need to use RStudio on several different computers, you can install R and RStudio onto a USB stick and then you can use RStudio on any computer that reads your USB stick.\nOnce you have successfully installed the latest versions of R and RStudio, navigate to the RStudio program in the start menu and launch the program. Once RStudio opens (it may take a little while) you should see three panels on your RStudio screen:\n\nThe big left panel is the Console where you can type commands and see output\nThe top right panel contains the tabs Environment and History. The Environment tab stores any object, value, function or anything else you create during your R session. The History tab keeps a record of all previous commands.\nThe bottom right panel contains the tabs Files, Plots, Packages, and Help. The Files tab shows all the files and folders in your working directory as if you were on a PC/Mac window. The Plots tab will show all your graphs. The Packages tab will show a list of packages or add-ons needed to run certain process. The Help tab provides additional info.\n\nYou can think of R as a (very advanced) calculator. Try typing some basic mathematical calculations in the Console before moving on."
  },
  {
    "objectID": "Intro_to_R_LearnR.html#r-markdown",
    "href": "Intro_to_R_LearnR.html#r-markdown",
    "title": "Advanced Survival",
    "section": "2 2. R Markdown",
    "text": "2 2. R Markdown\nR Markdown is a format for writing reproducible, dynamic reports with R. This is an R Markdown document that has been turned into an interactive introduction using the learnr package which we will cover in more detail below. We will be using similar interactive R Learnr tutorials to prepare you for some of the exercises. Your final data analysis report can also be prepared and returned as an R Markdown file, so let us practice creating one.\nFirst, you need to install the rmarkdown package from CRAN. Packages not included with the base distribution (like rmarkdown) can be installed from within R. You can use the install.packages() function from the R Console window or by typing install.packages(\"rmarkdown\").\nYou can then create a new R Markdown file by clicking File &gt; New File &gt; R Markdown in the menu bar at the top of your RStudio screen. A window will open where you can enter a Title (e.g., My first R Markdown document) and Author Name (your name) and choose the desired Output Format. The default output format is html and we will start with that format. Then click OK.\nAn example R Markdown file was created and opens up in R Studio above your R Console on the left. It has three parts:\n\nHeader: The text at the top of the document that begins and ends with three dashes --- and includes four default elements\n\ntitle: The title of your document\nauthor: Who wrote the document\ndate: By default, this is the date that the file was created\noutput: What format will the output be in (in this case html)\n\nR code chunks: Chunks of R code that can be run and rendered to an output document (as explained below). All code chunks begin and end with three backticks (found on the same key as the tilde (~) on your keyboard) ```\n\nThe first line contains the language (R) and the name of the chunk within curly brackets. You can also add options within the curly brackets to customise what code or output appears on the rendered output (e.g., the echo = FALSE will suppress the R code, note the code will still run and all output will be presented unless another option is used).\nThe following lines are for the R code and comments (i.e., text that describes the intent of your code and is not processed by R, indicated by the # comment character at the beginning of a line).\n\nR Markdown sections: Text that describes and documents your workflow written using R Markdown syntax. Markdown is a human readable syntax for formatting text documents, similar to using the format tools (heading, bold) in a word processing tool like Microsoft Word or Google Docs, that can be transformed to web pages, PDFs or Word documents.\n\nYou can save the example file that was created as usual by clicking File &gt; Save As under a name of your choosing (note that the document title is not the same as the file name). R Markdown files have the extension .Rmd which will be associated with RStudio by default.\nThe R Markdown file including R code chunks can be converted to html (or another format) using the knitr package. You can install the knitr package by typing install.packages(\"knitr\") on the R Console. Typically, to use the functions and datasets contained in a package, that package must be loaded using the library function (e.g., library(knitr). In RStudio, however, you can just click the Knit button and it will automatically load the rmarkdown and knitr packages. RStudio will usually also automatically suggest installing the necessary packages for you when needed for the first time. In that case, a yellow message stating “Package ‘package_name’ required but is not installed” will appear above your R Markdown file and you can install it by clicking the Install button next to the message. Using the functions from these packages, RStudio then executes the code chunks and converts the R Markdown file into the output format specified. When knitting is complete, an html format (web page) output, that was built from a combination of text documentation and R code that was written using R Markdown syntax, should automatically open. An html file has also been automatically saved to your working directory. If you cannot see the Knit button, you can use the keyboard shortcut Ctrl + Shift + K (Windows/Linux) or Cmd + Shift + K (Mac). You can also always knit from the R console directly rmarkdown::render(\"your_document_name.Rmd\"). Make sure you are in the directory where your .Rmd file is saved or provide the full path.\nYou might want to output your final data analysis report in PDF file format, and you can now practice creating and converting an R Markdown file into a PDF file. Note that you will need the tinytex package for helping compile the R Markdown file to PDF. You can install the TinyTex distribution by typing tinytex::install_tinytex() in the R Console and this will also install the actual TinyTex LaTeX program that you need. If you run into difficulties in converting your R Markdown file to PDF, an error message will appear in red in your Console window with instructions on how to try to debug the error.\nOnce you are familiar with the structure of the R Markdown document and the R Markdown syntax you can just open a new text file, save it with the extension .Rmd and produce your own R Markdown syntax instead of using the RStudio Markdown template. For example, you can just change the output option in your header from html_document into pdf_document if you want to convert your R Markdown file into a PDF instead of an html document.\nMore examples of the most commonly used R Markdown syntax are provided at https://rmarkdown.rstudio.com/authoring_basics.html. You can also download an R Markdown cheat sheet by clicking Help &gt; Cheat Sheets &gt; R Markdown Cheat Sheet. You can also find cheat sheets for R packages here.\nHave a go at trying some of the R Markdown options and syntax before moving on."
  },
  {
    "objectID": "Intro_to_R_LearnR.html#r-learnr",
    "href": "Intro_to_R_LearnR.html#r-learnr",
    "title": "Advanced Survival",
    "section": "3 3. R Learnr",
    "text": "3 3. R Learnr\nDuring this course we will prepare you for some of the exercises using the R Learnr tutorials which combine text, code and live coding boxes where you can practice your R coding. The R Learnr tutorials run as packages in RStudio, with the learnr package making it easy to turn any R Markdown document into an interactive tutorial.\nNote you will need to have the package learnr installed before running the tutorials. You can practice installing this package now using the syntax provided before and this live coding box. You can run the code by clicking Run Code.\n\n\n\nShow R code\n# type your code here:\n\n\n\n\nThis document is also an R Learnr tutorial which you can now open in RStudio and have a closer look at.\nThe R Learnr document differs from the R Markdown document in the following ways:\n\nIn the header, you need to specify output: learnr::tutorial (instead of output: html_document) and runtime: shiny_prerendered.\nThe first R code chunk is the setup section of our learnr tutorial, which for example includes code for checking whether all of the packages needed for the tutorial have been installed, prompting the installation of packages not installed, and loading all the necessary packages. You can use similar setup code for installing and loading the packages needed for your final data analysis report. The set up code also prepares the environment for the interactive exercises so that that they imitate working on the R Console where R remembers everything you have defined in that session, as otherwise R code written in separate coding boxes is not chained.\nThe later R code chunks also have custom options such as exercise that allow the user to interact with the tutorial.\n\nYou can run the Learnr tutorial by clicking the Run Document button above the tutorial. This automatically loads the learnr package which will then turn it into an interactive tutorial which opens up in a new window.\nNext we will practice how to use the Learnr tutorial while learning some R basics that we will need later on."
  },
  {
    "objectID": "Intro_to_R_LearnR.html#r-basics",
    "href": "Intro_to_R_LearnR.html#r-basics",
    "title": "Advanced Survival",
    "section": "4 4. R basics",
    "text": "4 4. R basics\n\n4.1 4.1. Objects and assignment\nR is an object-oriented language, which means that everything in R is an object and that analyses, models and graphs can be stored as objects.\nThe most basic type of R object is a vector (note a scalar is a vector of length 1). Other objects include matrices, arrays, lists, factors, data frames and functions.\nTo assign a value to an object use &lt;- or =. For example, vectors x and y can be created as follows using the c() function. You can run the code by clicking Run Code.\n\n\n\nShow R code\n# c() function is used to concatenate elements together\nx &lt;- c(1,2,3,4,5)\nx\ny = c(5,4,3,2,1)\ny\n\n\n\n\nTo find out the length of a vector, you can use the function length():\n\n\n\nShow R code\nlength(x)\n\n\n\n\nVectors of sequential numbers can be built up using :, or seq(), and rep() functions:\n\n\n\nShow R code\n# : assigns consecutive integers\nx &lt;- 1:5\nx\ny &lt;- 5:1\ny\n\n# rev() function reverses the order of elements in a vector\ny &lt;- rev(x)\ny\n\n# seq() function generates a sequence from the starting point of the sequence to the ending \n# point for the sequence by given increment\nseq(from = 1, to = 5, by = 1)\nseq (1, 5, 1)\n\n# rep() function replicates elements\nrep(1, 5)\nrep(x, times=2)\nrep(x, each=2)\n\n\n\n\nTo learn more about vectors and how to create and use matrices, arrays, lists, factors, data frames and functions see the comprehensive web tutorial Introduction to R available from the CRAN webpage.\nYou can now try creating a vector or another object using this live coding box. You can run your code by clicking Run Code and you can empty your coding box by clicking Start Over:\n\n\n\n\n\nIf there is an error in the code, an error message will appear with a line number in the R coding box to help you diagnose the problem.\nNote that learnr remembers what you typed in the exercise boxes unless you click the Start Over button, either on top of a coding box (to reset that exercise) or under the main menu on the left hand side of this document (to reset all exercises). However, to make sure you do not lose your R code you can save your code by typing it in the space for R exercise code within the Learnr tutorial and saving a copy of the Learnr tutorial.\n\n\n4.2 4.2. Accessing data\n\n4.2.1 4.2.1. Reading data from files\nAs demonstrated above, small amounts of data can be entered using functions such as c(), matrix() and array(). However, R is not very useful as a database or for data entry.\nInstead, it is usually better to use Excel (or another spreadsheet program) for inputting data, saved as a CSV file, which is then imported into R. First, save the data to your working directory. You can use the getwd() function in the console to check what is your current working directory. If needed, you can use the setwd() function to change your working directory to another folder on your computer. Note that R uses forward slash / or two backslashes \\\\ instead of the backslash \\ in its path names. Alternatively, you can choose a working directory by navigating to Session &gt; Set Working Directory &gt; Choose Directory from your menu bar. You can then use the read.csv() function to read in a file from your working directory. Let us read in the data from the lymphoma.csv file. This data file is available for download on the provided Github. You will need to amend the coding below to align to your file directory, remove the hashes before “lymphoma” or “setwd” to test the coding using direct file path and setting the working directory.\nNote that you can also read this file in directly from Github, as given below. We do, however, recommend you practice importing files directly from a folder location.\n\n\n\nShow R code\n# to get your working directory\ngetwd()\n\n# Option 1 : read in the lymphoma.csv file using the read.csv() function and the full pathname\n# Please replace the example pathname with the pathname to your working directory\n# lymphoma &lt;- read.csv(\"C:/Users/R files/lymphoma.csv\", header=T) # Windows\n# lymphoma &lt;- read.csv(\"/Volumes/R files/lymphoma.csv\", header=T) # Mac\n\n# Option 2: use the setwd() command to change your working directory\n# Please replace the example pathname with the pathname to your working directory\n# setwd(\"C:/Users/R files/\") # Windows\n# setwd(\"/Volumes/R files/\") # Mac\n# read in the lymphoma.csv file using the read.csv() function\n# lymphoma &lt;- read.csv(\"lymphoma.csv\", header=T)\n\n#Option 3 (direct from Github)\nlymphoma &lt;- read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/lymphoma.csv\", header=T)\n\n\n\n\nOnce you have read in your data file, you can use some of the following functions to familiarise yourself with other ways to import. Remember to remove the pre-ceding hashes to each line:\n\n\n\nShow R code\n# head() function returns the first rows of a data frame (six by default)\nhead(lymphoma)\n\n# tail() function returns the last rows of a data frame, you can specify how many rows you \n# want to see by adding n \ntail(lymphoma, n=10)\n\n# nrow() function returns the number of rows\nnrow(lymphoma)\n\n# names() function returns the names of all the variables in the data set, and works also for 1-dimensional objects (vector, list)\nnames(lymphoma)\n\n# for 2-dimensional objects that have a column dimension (matrix, data frame) you should however use the specific colnames() function\ncolnames(lymphoma)\n\n# str() function returns the structure of the data set, i.e., data type of each attribute\nstr(lymphoma)\n\n# summary() function returns a set of descriptive statistics depending on the type of variable\nsummary(lymphoma)\n\n\n\n\nTo learn more about other ways of inputting data to R see the Introduction to R.\n\n\n4.2.2 4.2.2. R built-in datasets\nR also supplies hundreds of built-in datasets, both in the package datasets (installed with base distribution) and other available packages. To see the list of datasets currently available through all loaded packages, you can run data() command by clicking Run Code:\n\n\n\nShow R code\ndata()\n\n# you can use this command to see all the packages available in R\ndata(package = .packages(all.available = TRUE))\n\n\n\n\nFor example, the dataset cars used in the R Markdown template is among the datasets readily available in R.\nTake a closer look at some of the datasets available by applying for example the head(), tail(), nrow(), names(), str() and summary() functions presented above:\n\n\n\n\n\n\n\n\n4.3 4.3. Data manipulation\n\n4.3.1 4.3.1. Dplyr package\nBefore carrying out your data analysis, you often need to clean or transform data in preparation for your analysis. The dplyr package is very useful for such data manipulation as it includes readily available functions for commonly required data manipulation tasks.\nFunctions in dplyr process faster than base R functions as they are written in a more computationally efficient manner. See below some examples of these functions using the starwars dataset available in the dplyr package. When carrying out your analysis, remember to first install and load the package dplyr (you can use the code available from the tutorial set up in the beginning of this tutorial).\n\n\n\nShow R code\n# tibble() is a cross between the head() and str() functions\ntibble(starwars)\n\n# starwars dataset has 87 rows and 14 columns with each row describing a Star Wars character\ndim(starwars)\n\n# gives dimensions as above, variable type, and lists first few rows of obs\nglimpse(starwars)\n\n# filter() function allows to you filter or select a subset of rows in a data frame, e.g. \n# all female Star Wars characters\nfilter(starwars, sex == \"female\")\n\n# arrange() function rearranges the data frame rows, e.g., sort the rows by sex and name\nstarwars_bysex &lt;- arrange(starwars, sex, name)\nstarwars_bysex\n\n# select() function allows you to select the variables that you are interested in, \n# e.g., sex and name, so you do not have to scroll through all the columns in the data\nselect(starwars_bysex, sex, name)\n\n# you can use the select() function together with the everything() function to place the \n# variables you are interested in first while keeping all the variables in the data frame\nselect(starwars_bysex, sex, name, everything())\n\n# rename() function allows you to rename variables, e.g. rename height as height_cm\nstarwars_renamed &lt;- rename(starwars, height_cm = height)\n\n# using select() to output name and height_cm first\nselect(starwars_renamed, name, height_cm, everything())\n\n# mutate() function allows you to add new columns to the data frame that are functions \n# of existing columns\nstarwars_renamed &lt;- mutate(starwars_renamed, height_m = height_cm / 100)\nstarwars_renamed &lt;- mutate(starwars_renamed, BMI = mass / (height_m^2))\n\n# using select() to output name, mass, height_cm and BMI first\nselect(starwars_renamed, name, mass, height_m, BMI, everything())\n\n# summarise() function allows you to summarise data frame columns, e.g. to calculate \n# a mean of BMI in the data\n\n# note that if the variable you want to summarise has missing values, you need to include \n# the option 'na.rm=TRUE'\nsummarise(starwars_renamed, mean(BMI, na.rm=TRUE))\n\n# you can create a dichotomous overweight variable using the mutate() and if_else() functions\nstarwars_renamed &lt;- mutate(starwars_renamed, overweight = if_else(BMI &gt;= 25, 1, 0))\n\n# you can convert the numeric overweight variable to a factor variable using factor() function\nstarwars_renamed &lt;- mutate(starwars_renamed, BMI2 = factor(overweight,\n                           levels = c(0, 1),\n                           labels = c(\"normal weight\", \"overweight\")))\n\n# you can create categorical variables using the mutate() and case_when() functions\nstarwars_renamed &lt;- mutate(starwars_renamed, BMI3 = case_when(\n      (BMI &gt;= 0) & (BMI &lt; 25) ~ 'normal weight', \n      (BMI &gt;= 25) & (BMI &lt; 30) ~ 'overweight', \n      (BMI &gt;= 30) ~ 'obese',\n      TRUE ~ 'NA'\n))\n\n# alternatively you can use cut() and factor() functions\nstarwars_renamed &lt;- mutate(starwars_renamed, BMI3=cut(BMI,  # Create BMI3 based on cutting BMI at the specified break points\n                    breaks=c(0,25,30,Inf),\n                    right=FALSE), # We want the intervals to be closed on the left, e.g. 0 to &lt;25\n                    BMI3=factor(BMI3,             # Convert BMI3 to a factor variable with the specified labels\n                       labels=c('normal weight',\n                                'overweight',\n                                'obese')))\n\n# using select() to output name, mass, height_cm, BMI, overweight and BMI3 variables first\nselect(starwars_renamed, name, mass, height_m, BMI, overweight, BMI2, BMI3, everything())\n\n\n\n\n\n\n4.3.2 4.3.2. The pipe %&gt;%\nAll of the dplyr functions discussed above take a data frame as the first argument. The modified data frames are saved as intermediate objects that in turn are used by other dplyr functions.\nThere is, however, a more efficient way for chaining commands, called the forward-pipe operator, %&gt;%, or simply the pipe, available from the magrittr package, and also automatically made available when you load dplyr package. This operator will forward or pipe a value or a result from one step into the next. See below how part of the code above can be simplified using the pipe:\n\n\n\nShow R code\n# starwars_bysex &lt;- arrange(starwars, sex, name)\n# starwars_bysex\n# select(starwars_bysex, sex, name, everything())\n\n# The commands above can be chained in the following way using %&gt;%\nstarwars %&gt;% \n  arrange(sex, name) %&gt;% \n  select(sex, name, everything())\n\n# starwars_renamed &lt;- rename(starwars, height_cm = height)\n# starwars_renamed &lt;- mutate(starwars_renamed, height_m = height_cm / 100)\n# starwars_renamed &lt;- mutate(starwars_renamed, BMI = mass / (height_m^2))\n# starwars_renamed &lt;- mutate(starwars_renamed, overweight = if_else(BMI &gt;= 25, 1, 0))\n# select(starwars_renamed, name,  mass, height_m, BMI, overweight, everything())\n\n# The commands above can be chained in the following way using %&gt;%\nstarwars %&gt;% \n  rename(height_cm = height) %&gt;% \n  mutate(height_m = height_cm / 100) %&gt;% \n  mutate(BMI = mass / (height_m^2)) %&gt;% \n  mutate(overweight = if_else(BMI &gt;= 25, 1, 0)) %&gt;% \n  select(name, mass, height_m, BMI, overweight, everything())\n\n# Remember that you need to assign the modified data frame into an object to be able to use it later on\nstarwars_saved &lt;- starwars %&gt;% \n                    rename(height_cm = height) %&gt;% \n                    mutate(height_m = height_cm / 100) %&gt;% \n                    mutate(BMI = mass / (height_m^2)) %&gt;% \n                    mutate(overweight = if_else(BMI &gt;= 25, 1, 0)) %&gt;% \n                    select(name, mass, height_m, BMI, overweight, everything())\n\n\n\n\nYou can learn more about other functions available in dplyr and see examples of their use here.\nTry using the dplyr functions and piping. You can, for example, try sorting the starwars data frame by the BMI variable created above or try applying some of the other functions to these data:\n\n\n\n\n\n\n\n\n4.4 4.4. Summarising data\nTo summarise data using simple descriptive statistics, e.g., mean, SD, median, IQR, you can use the summary() function which comes with the base distribution. You can also the skim() function from the skimr() package:\n\n\n\nShow R code\n# summarising BMI in the Starwars dataset\n\n# using the summary() function\nsummary(starwars_saved$BMI)\n\n# using the skim() function\nskim(starwars_saved, BMI)\n\n\n\n\nTo create a frequency table for a categorical variable, you can for example use the tabyl() function from the janitor() package. It is a better version of the table() function which comes with the base distribution.\n\n\n\nShow R code\n# summarising BMI in the Starwars dataset\ntabyl(starwars_saved, overweight)\n\n\n\n\n\n\n4.5 4.5. Data analysis and visualisation in R\n\n4.5.1 4.5.1. Data analysis\nAnalyses, models and graphs can also be stored as objects in R. For example, the following code fits a linear regression model for speed and distance variables in the cars data using the lm() function. The result is an lm object that is stored into the object named results:\n\n\n\nShow R code\n# In R's formula notation where we have our outcome variable on the left hand side of the equation \n# and the explanatory variables on the right hand side of the tilde.\nresults &lt;- lm(dist ~ speed, data = cars)\nresults\n\n# summary() function provides more detailed information on the model's performance and coefficients\nsummary(results)\n\n\n\n\n\n\n4.5.2 4.5.2. Data visualisation\nWe can visualise the data and analysis results by creating histograms or boxplots using the hist() and boxplot() functions, or by creating a simple plot of the two variables using the plot() function, available from base graphics, and adding a regression line to the plot:\n\n\n\nShow R code\n# hist() function for histograms\nhist(cars$speed)\nhist(cars$dist)\n\n# boxplot() function\nboxplot(cars$speed)\nboxplot(cars$dist)\n\n# plot() function for plotting two variables\nplot(cars$speed, cars$dist)\n# adding a regression line to the plot\nabline(lm(dist ~ speed, data = cars))\n\n\n\n\nWe can also do the same visualisation using ggplot() function from the ggplot2 package.\n\n\n\nShow R code\nggplot(cars, aes(x=speed, y=dist)) + geom_point(shape=1) + geom_smooth(method=\"lm\")\n\n\n\n\n\n\n\n4.6 4.6. Good programming practices\nWe should learn and apply good programming practices to write R code that is as easy to read and replicate as possible.\nGood practices should be applied every time we write a program. Please use the following resources to familiarise yourself with good practices when writing a program in R:\nR Tidyverse style guide. R code - best practices\nDuring this short course, we will make use of these R basics and gain practice in good coding as we learn how to analyse data using R."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Advanced Survival Short Course 2026",
    "section": "",
    "text": "Welcome to the “Advanced survival concepts and analysis” short course in 2026!\nYou will find all the related content either here on this webpage or via Github.\nPlease let us know if there are any technical issues.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#welcome",
    "href": "index.html#welcome",
    "title": "Advanced Survival Short Course 2026",
    "section": "",
    "text": "Welcome to the “Advanced survival concepts and analysis” short course in 2026!\nYou will find all the related content either here on this webpage or via Github.\nPlease let us know if there are any technical issues.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#timetable",
    "href": "index.html#timetable",
    "title": "Advanced Survival Short Course 2026",
    "section": "2 Timetable",
    "text": "2 Timetable\nDay 1: Thursday 26th Feb\n\n\n\nTimes\nTopic\nFacilitator\n\n\n\n\n8:30 - 9:00\nOptional: Introduction to R\nAll\n\n\n9:00 - 9:15\nWelcome and overview: Today’s topics\nNicole\n\n\n9:15 - 11.20\nPH assumption violation in Cox models\nFarzaneh\n\n\n11:20 - 11.30\nBreak\n\n\n\n11:30 - 12:30\nJoint modelling: survival concepts\nFarzaneh\n\n\n12.30 - 1:15\nLunch\n\n\n\n1:15 - 2:00\nJoint modelling: survival concepts (continued)\nFarzaneh\n\n\n2:00 - 2:50\nParametric survival models\nMaarit\n\n\n2:50 - 3:00\nBreak\n\n\n\n3:00 - 3:50\nFlexible parametric survival models\nMaarit\n\n\n3:50 - 4.00\nWrap-up\nMaarit\n\n\n\nDay 2: Friday 27th Feb\n\n\n\nTimes\nTopic\nFacilitator\n\n\n\n\n9:00 - 9:15\nRecap and overview: today’s topics\nNicole\n\n\n9:15 - 11.00\nCompeting risks models\nMaarit\n\n\n11:00 - 11.10\nBreak\n\n\n\n11:10 - 12:30\nFlexible parametric survival models (continued)\nNicole\n\n\n12.30 - 1:15\nLunch\n\n\n\n1:15 - 2:50\nMulti-state modelling\nNicole\n\n\n2:50 - 3:00\nBreak\n\n\n\n3:00 - 3:50\nMulti-state modelling (continued)\nNicole\n\n\n3:50 - 4.00\nWrap-up\nMaarit",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#facilitators",
    "href": "index.html#facilitators",
    "title": "Advanced Survival Short Course 2026",
    "section": "3 Facilitators",
    "text": "3 Facilitators\n\n\n\n\nDr Nicole De La Mata is a senior lecturer in biostatistics at the University of Sydney. Her expertise lies in establishing data linkage studies and using these to apply advanced statistical models to understand patient journeys and complex clinical scenarios. Her work has broadly aimed to improve health service quality and efficiency to translate into better and more equitable patient outcomes. She has a special interest in multi-state modelling and competing risks models.\n\n\n\nDr Farzaneh Boroumand is a Lecturer in Biostatistics at the Sydney School of Public Health and a senior biostatistician at the Centre for Kidney Research, Westmead Hospital. She is passionate about transforming complex statistical concepts into clear, practical insights and designing interactive learning experiences that help postgraduate students apply biostatistics confidently in real-world health research. Her research focuses on survival analysis, causal inference, and chronic kidney disease, collaborating with clinicians and multidisciplinary teams to improve patient outcomes.\n\n\n\nAssociate Professor Maarit Laaksonen is an Associate Professor in Biostatistics in the Sydney School of Public Health. She leads national and international data linkage projects evaluating the determinants of the future burden of cancer with the aim of improving cancer prevention, early detection and outcomes. Maarit has a strong interest in the development and application of disease burden measures, survival models and the impact of competing risks on health outcomes.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "Flexible1.html",
    "href": "Flexible1.html",
    "title": "4 Flexible parametric survival",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine the flexible parametric survival model (Royston-Parmar) and explain how it bridges the gap between standard parametric models and the semi-parametric Cox model.\nUnderstand and evaluate the key advantages of using splines in survival analysis\nExplain the mathematical role of restricted cubic splines (RCS)\nJustify the use of the log-time transformation (\\(\\log(t)\\))\nIdentify how flexible parametric models relate to standard parametric models\nImplement flexible parametric models in R using the flexsurvspline function, including fitting models with time-dependent effects when proportional hazards assumptions are violated.\nCompare model fit using statistical criteria such as AIC, BIC, and the Likelihood Ratio Test, as appropriate, to determine the optimal number of knots for a given dataset.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#learning-objectives",
    "href": "Flexible1.html#learning-objectives",
    "title": "4 Flexible parametric survival",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine the flexible parametric survival model (Royston-Parmar) and explain how it bridges the gap between standard parametric models and the semi-parametric Cox model.\nUnderstand and evaluate the key advantages of using splines in survival analysis\nExplain the mathematical role of restricted cubic splines (RCS)\nJustify the use of the log-time transformation (\\(\\log(t)\\))\nIdentify how flexible parametric models relate to standard parametric models\nImplement flexible parametric models in R using the flexsurvspline function, including fitting models with time-dependent effects when proportional hazards assumptions are violated.\nCompare model fit using statistical criteria such as AIC, BIC, and the Likelihood Ratio Test, as appropriate, to determine the optimal number of knots for a given dataset.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#what-is-a-flexible-parametric-survival-model",
    "href": "Flexible1.html#what-is-a-flexible-parametric-survival-model",
    "title": "4 Flexible parametric survival",
    "section": "2 What is a flexible parametric survival model?",
    "text": "2 What is a flexible parametric survival model?\nWhile standard parametric models are useful, they are often limited by rigid assumptions about the shape of the hazard function. Flexible parametric models, famously introduced by Patrick Royston and Catherine Parmar in 2002, were developed to bridge the gap between these standard models (like the Weibull) and semi-parametric approaches like Cox proportional hazards model. As parametric model, they provide a fully defined mathematical formula for the entire survival curve, allowing for easy extrapolation and absolute risk measures. As a Cox model, they are flexible enough to fit almost any data shape.\nThe flexibility in these models comes from the use of restricted cubic splines (polynomials) to model the log-cumulative hazard or log-hazard function rather than the hazard itself. Rather than assuming a simple linear trend, the model uses these splines joined at specific ‘knots’ to capture complex, irregular, or multi-modal hazard shapes that simpler models would miss.\nUnlike piecewise models, which require splitting data into arbitrary time intervals, flexible parametric models provide smooth, continuous estimates of both survival and hazard functions.\nWhile ‘flexible parametric model’ is the broad category for any parametric model that uses splines, the Royston-Parmar (RP) model is the most famous implementation of this idea.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#why-use-flexible-parametric-survival-models",
    "href": "Flexible1.html#why-use-flexible-parametric-survival-models",
    "title": "4 Flexible parametric survival",
    "section": "3 Why use flexible parametric survival models?",
    "text": "3 Why use flexible parametric survival models?\nKey advantages of flexible parametric models\n\nWider hazard variety: Beyond the other benefits of parametric models, flexible parametric models can capture a wider range of hazard shapes (and thus biological realities) than standard parametric models\nTime-dependent effects: Often the standard choice when proportional hazards fail, as they easily allow for time-dependent effects (e.g., the impact of a treatment changes over the duration of the study)\nAbsolute measures and extrapolation: Because they are fully parametric, they allow for extrapolation and calculation of absolute measures of effect (like absolute risks and rates or life expectancy) which are difficult to obtain from Cox models.\n\nFlexible parametric models are thus a good methodological choice when:\n1. The hazard function is complex and of interest: When \\(h(t)\\) is non-monotonic, simpler models may fail to capture the nuance\n2. A single hazard ratio fails to capture the complete clinical story: The HR is a summary measure; it doesn’t tell how risk evolves over time\n3. The proportional hazars assumption is violated or inappropriate: Flexible parametric models allow for non-proportional hazards and time-dependent effects",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#key-concepts-in-flexible-parametric-models",
    "href": "Flexible1.html#key-concepts-in-flexible-parametric-models",
    "title": "4 Flexible parametric survival",
    "section": "4 Key concepts in flexible parametric models",
    "text": "4 Key concepts in flexible parametric models\nPolynomials\nThe foundation of flexibility starts with high-order functions. Polynomials can be used to model a non-linear function. A cubic polynomial can model a non-linear function using the form:\n\\[y_i = \\beta_0 + \\beta_1x_i + \\beta_2x_i^2 + \\beta_3x_i^3\\]\nSplines\nWhen a single polynomial is too rigid to fit the entire range of data, we use splines. They are a series of polynomials, essentially piecewise polynomials. Cubic splines are piecewise cubic polynomials. They are thus flexible mathematical functions composed of several polynomial segments joined together at specific time points called knots. Each segment models a specific time interval, allowing for local flexibility.\nRestricted cubic splines (RCS)\nRestricted cubic splines, also known as natural splines, are the “gold standard” for flexible parametric modelling because they add necessary constraints:\n\nContinuity: They are defined to be continuous at the knots.\nSmoothness: They have continuous first and second derivatives at the knots (i.e., no sharp ‘corners’).\nLinear Constraints: They are constrained to be linear beyond the boundary knots.\nBoundary Placement: Boundary knots are typically placed at the minimum and maximum of the (uncensored) event times to prevent erratic behavior at the ends of the data.\n\nBy forcing the spline function to be linear at the tails (before the first knot and after the last knot), we avoid the common issue where polynomials ‘fly off’ to infinity in areas where we have very little data.\nKnot placement and number of knots\nThe flexibility of the model is determined by the placement and number of knots. Internal knots are usually placed at equally spaced centiles of the distribution of event times. For example, if using one internal knot, it is typically placed at the median survival time. Choosing the number of knots (denoted as \\(k\\)) involves a trade-off between capturing detail and avoiding overfitting.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#spline-function-and-basis-calculation",
    "href": "Flexible1.html#spline-function-and-basis-calculation",
    "title": "4 Flexible parametric survival",
    "section": "5 Spline function and basis calculation",
    "text": "5 Spline function and basis calculation\nThe flexibility of a restricted cubic spline is derived from its basis functions. Let \\(x\\) be a function of time — typically \\(x = \\log(t)\\).\nNotation and knots\n\nBoundary knots: \\(k_{min}\\) and \\(k_{max}\\) represent the minimum and maximum of the log event times.\nInternal knots: \\(k_1, \\cdots, k_m\\) represent the location of \\(m \\ge 0\\) internal knots, with \\(k_j\\) representing the location of the \\(j^{th}\\) internal knot.\n\nThe spline function\nThe spline function \\(s(x,\\gamma)\\) is defined as:\n\\[s(x,\\gamma) = \\gamma_0 + \\gamma_1 x + \\sum_{j=1}^{m} \\gamma_{j+1} v_j(x)\\]\nCalculating the basis functions\nFor each internal knot \\(k_j\\), the \\(j^{th}\\) basis function \\(v_j(x)\\) is calculated using a combination of cubic terms:\n\\[v_j(x) = (x - k_j)^3_+ - \\lambda_j(x - k_{min})^3_+ + (\\lambda_j - 1)(x - k_{max})^3_+\\] Key components:\n\nThe truncated power function: The term \\((x - k)_+^3\\) equals \\((x - k)^3\\) if \\(x &gt; k\\), and \\(0\\) if \\(x \\leq k\\).\nThe weighting factor (\\(\\lambda_j\\)): This is calculated based on the distance between the knots:\n\n\\[\\lambda_j = \\frac{k_{max} - k_j}{k_{max} - k_{min}}\\]\n\n\n\n\n\n\nImportant\n\n\n\nWhy the weighting factor matters\nThe \\(\\lambda_j\\) factor is what makes the cubic spline restricted. It is mathematically engineered to force the cubic (\\(x^3\\)) and quadratic (\\(x^2\\)) components of the function to sum to zero beyond the boundary knots. This ensures that the model remains linear at the tails, preventing unstable predictions where data is sparse.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#how-do-flexible-parametric-models-work",
    "href": "Flexible1.html#how-do-flexible-parametric-models-work",
    "title": "4 Flexible parametric survival",
    "section": "6 How do flexible parametric models work?",
    "text": "6 How do flexible parametric models work?\nIntegration into regression\nRegression splines are highly versatile because they can be incorporated into any regression model that utilises a linear predictor. This allows us to move beyond rigid assumptions while maintaining a familiar framework.\nThe scale of modelling\nWhile splines can be used to model either the log-hazard or the log-cumulative hazard function, most flexible parametric models (such as the Royston-Parmar model) focus on the log-cumulative hazard:\n\nMonotonicity: It is mathematically easier for a cubic spline to fit a smooth, monotonically increasing curve like the cumulative hazard.\nStability: Estimating the cumulative hazard often leads to more stable numerical estimation compared to the instantaneous hazard.\n\nThe importance of the log-time transformation\nIn these models, it is generally superior to use \\(\\log(t)\\) rather than raw time (\\(t\\)). This transformation serves two critical purposes:\n\n1. Distributional balancing: As survival times are often positively skewed, the log transformation ‘compresses’ the long right tail of survival distributions (where events are sparse) and ‘stretches’ the early period (where many events typically occur).\n2. Improved Extrapolation: A linear trend on the log-time scale is more biologically and statistically plausible for extrapolation beyond the boundary knots compared to a linear trend on the raw time scale.\n\n\n\n\n\n\n\nNoteWhy using \\(\\log(t)\\) is important?\n\n\n\nUsing \\(\\log(t)\\) ensures that the ‘restricted’ part of our cubic spline (the linear tail) behaves predictably. Extrapolating a linear trend in log-time is equivalent to a Weibull-like tail, which is a standard and safe assumption in survival analysis.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#review-the-weibull-model",
    "href": "Flexible1.html#review-the-weibull-model",
    "title": "4 Flexible parametric survival",
    "section": "7 Review: The Weibull model",
    "text": "7 Review: The Weibull model\nRoyston and Parmar designed their flexible parametric model as a direct extension of the Weibull model. They used the Weibull model because of its relationship with the log-cumulative hazard that is linear with log-time.\nBefore diving into Royston-Parmar model, let’s recall the framework of the Weibull model:\n\nSurvival function: \\[S(t) = \\exp(-\\lambda t^\\gamma)\\]\nLog cumulative hazard: \\[\\log(-\\log(S(t))) = \\log(H(t)) = \\log(\\lambda) + \\gamma \\log(t)\\] \\(\\rightarrow\\) This is a linear function of \\(\\log(t)\\).\nIntroducing covariates gives: \\[\\log(H(t|x_i)) = \\log(\\lambda) + \\gamma \\log(t) + x_i \\beta\\]",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#the-log-cumulative-hazard-framework-in-flexible-parametric-models",
    "href": "Flexible1.html#the-log-cumulative-hazard-framework-in-flexible-parametric-models",
    "title": "4 Flexible parametric survival",
    "section": "8 The Log-cumulative hazard framework in flexible parametric models",
    "text": "8 The Log-cumulative hazard framework in flexible parametric models\nThe Royston-Parmar model starts with the linear relationship from the Weibull model:\n\\[\\log(H(t)) = \\gamma_0 + \\gamma_1 \\log(t) + x_i \\beta\\] It then adds flexibility to it where needed. That is, rather than assuming a strictly linear relationship with \\(\\log(t)\\), it uses restricted cubic splines (RCS) for \\(\\log(t)\\):\n\\[\\log(H(t)) = \\gamma_0 + \\gamma_1 \\log(t) + \\sum_{j=1}^{k} \\gamma_{j+1} v_j(log(t)) + x_i \\beta\\]\nUsing the Weibull model as a starting point, the flexible parametric models use cubic splines to ‘bend’ that line into more complex shapes. This allows the model to capture deviations from the Weibull assumption (i.e., when the hazard isn’t strictly monotonic).\nThe complexity of the model is governed by the number of knots (\\(k\\)). Adding more knots allows for more ‘bends’ in the log-cumulative hazard curve.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#generalisations-of-flexible-parametric-models",
    "href": "Flexible1.html#generalisations-of-flexible-parametric-models",
    "title": "4 Flexible parametric survival",
    "section": "9 Generalisations of flexible parametric models",
    "text": "9 Generalisations of flexible parametric models\nMore generally, in flexible parametric models, a link function \\(g(\\cdot)\\) transforms the survival function so it can be modelled as a restricted cubic spline function of log-time:\n\\[g(S(t|x)) = s(\\log(t), \\gamma) + x\\beta\\] The link function defines the scale on which the spline and covariate effects are additive. The following link functions appear in the Royston-Parmar framework:\n\nComplementary log-log: Typically, we use \\(g(S(t|x)) = \\log(-\\log(S(t|x))) = \\log(H(t|x))\\), the log-cumulative hazard which gives a proportional hazards model.\nLogit: Using \\(g(S(t|x_i)) = \\log(S(t|x)^{-1} - 1)\\), log-cumulative odds, gives a proportional odds model.\nProbit: Using \\(g(S(t|x_i)) = \\Phi^{-1}(S(t|x))\\), the inverse normal cumulative distribution function (CDF), gives a normal/probit model.\n\nThe normal/probit model (often referred to as the log-normal flexible parametric model) shifts the focus from the hazard rate to the probability of the event occurring by a certain time.\nIf we assume linearity with log-time (0 internal knots), we are back to a standard parametric model, i.e., Weibull model, log-logistic model, and log-normal model covered before.\nAdding internal knots allows the cubic splines to ‘bend’ the log-time relationship, accommodating hazards that do not follow these strict parametric shapes.\n\n\n\n\n\n\nImportant\n\n\n\nThe choice of link function determines the underlying framework and the ‘baseline’ distribution the model reverts to if 0 internal knots are used:\n\n\n\nLink Function \\(g(S(t))\\)\nModel Type\nReverts to (0 knots)\n\n\n\n\n\\(\\log(-\\log(S(t)))\\)\nProportional Hazards\nWeibull\n\n\n\\(\\log(S(t)^{-1} - 1)\\)\nProportional Odds\nLog-logistic\n\n\n\\(\\Phi^{-1}(1 - S(t))\\)\nNormal/Probit\nLog-normal",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#modelling-time-dependent-effects",
    "href": "Flexible1.html#modelling-time-dependent-effects",
    "title": "4 Flexible parametric survival",
    "section": "10 Modelling time-dependent effects",
    "text": "10 Modelling time-dependent effects\nFlexible parametric models include the effect of time as covariates in the linear predictor, so time-dependent effects can be included by fitting interactions between the covariate of interest and the covariates defining the effect of time:\n\\[g(S(t|x)) = s(\\log(t), \\gamma) + x\\beta + s(\\log(t), \\delta) \\cdot x\\]\nFor any time-dependent effect there is thus an interaction between the covariate and the spline variables.\nThis allows the effect of covariates to vary over time, which is a universal feature of flexible parametric models that allows us to move beyond restrictive assumptions:\n\nIn PH models: Relaxes the proportional hazards assumption (gives Non-PH).\nIn PO models: Relaxes the proportional odds assumption (gives Non-PO).\nIn Probit/AFT models: Allows the acceleration factor to vary over time.\n\nIt is important to think about why the effect might be time-dependent. Is it due to true causal effect or perhaps just due to unobserved frailty.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#data-example-fitting-a-flexible-parametric-model",
    "href": "Flexible1.html#data-example-fitting-a-flexible-parametric-model",
    "title": "4 Flexible parametric survival",
    "section": "11 Data example: Fitting a flexible parametric model",
    "text": "11 Data example: Fitting a flexible parametric model\nIn practice, R packages like flexsurv or rstpm2 handle the estimation process.\n\n11.1 Data example 1: Gehan leukaemia data\nWe will first practise fitting flexible parametric models to the same leukaemia data we used for fitting standard parametric models.\nFlexible parametric proportional hazards model\nWe can fit flexible parametric proportional hazards model using flexsurvspline function from the flexsurv package, by specifying scale = hazard.\nFirst, fitting flexible parametric proportional hazards model with 0 knots (\\(k = 0\\)) shows that it reverts back to Weibull model:\n\n\nShow R code\n# make sure you have installed the MASS and flexsurv packages\n# install.packages(\"MASS\")\n# install.packages(\"flexsurv\")\n# load the flexsurv package\n# note that when you load the flexsurv package, it also automatically loads the \n# survival package, as it is built directly on top of the survival package's \n# infrastructure, and needs the Surv() function and the underlying survival object \n# logic to function\nlibrary(flexsurv) # flexsurvreg for parametric models and flexsurvspline for\n# flexible parametric models\nlibrary(MASS) # for gehan data\n\n# read in the gehan data for the leukaemia trial in MASS package gehan\nleukdata &lt;- MASS::gehan\n\n# Setting control group as the reference group\nleukdata$treat &lt;- factor(leukdata$treat, levels = c(\"control\", \"6-MP\"))\n\n# WEIBULL PH MODEL\n\n# 1. Fitting the Weibull model using flexsurv package\nwei_PH &lt;- flexsurvreg( Surv(time, cens) ~ treat, data = leukdata, dist = \"weibullPH\")\nwei_PH\n\n\nCall:\nflexsurvreg(formula = Surv(time, cens) ~ treat, data = leukdata, \n    dist = \"weibullPH\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \nshape           NA     1.3658   1.0233   1.8228   0.2012       NA        NA\nscale           NA     0.0464   0.0155   0.1385   0.0259       NA        NA\ntreat6-MP   0.5000    -1.7309  -2.5405  -0.9212   0.4131   0.1771    0.0788\n           U95%   \nshape           NA\nscale           NA\ntreat6-MP   0.3980\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.5795, df = 3\nAIC = 219.159\n\n\nShow R code\n# 2. Fitting the flexible parametric proportional hazards model with 0 internal knots\n# k = 0 means only boundary knots exist, making it a linear model on the log-log scale\nspline_PH_0 &lt;- flexsurvspline(Surv(time, cens) ~ treat, \n                                data = leukdata, \n                                k = 0, \n                                scale = \"hazard\")\nspline_PH_0\n\n\nCall:\nflexsurvspline(formula = Surv(time, cens) ~ treat, data = leukdata, \n    k = 0, scale = \"hazard\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0          NA    -3.0707  -4.1645  -1.9769   0.5581       NA        NA\ngamma1          NA     1.3658   0.9715   1.7600   0.2012       NA        NA\ntreat6-MP   0.5000    -1.7309  -2.5405  -0.9212   0.4131   0.1771    0.0788\n           U95%   \ngamma0          NA\ngamma1          NA\ntreat6-MP   0.3980\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.5795, df = 3\nAIC = 219.159\n\n\nShow R code\n# 3. Compare log-Likelihoods\nprint(wei_PH$loglik)\n\n\n[1] -106.5795\n\n\nShow R code\nprint(spline_PH_0$loglik)\n\n\n[1] -106.5795\n\n\nYou can see that their log-likelihoods are the same and the parameters are the same except for the scale parameter that is reported on a different scale (log(0.0464) = -3.0707).\nFlexsurvspline output can also be converted into the Weibull AFT parameters in the following way:\n\n\nShow R code\nconvert_spline_to_weibull &lt;- function(spline_model) {\n  # Extract gamma coefficients\n  # gamma0 is the intercept, gamma1 is the slope of log(t)\n  g0 &lt;- spline_model$res[\"gamma0\", \"est\"]\n  g1 &lt;- spline_model$res[\"gamma1\", \"est\"]\n  \n  # Transformation logic\n  weibull_shape &lt;- g1\n  weibull_scale &lt;- exp(-g0 / g1)\n  \n  return(data.frame(\n    Parameter = c(\"Weibull Shape (p)\", \"Weibull Scale (lambda)\"),\n    Value = c(weibull_shape, weibull_scale)\n  ))\n}\n\nmy_weibull_params &lt;- convert_spline_to_weibull(spline_PH_0)\nprint(my_weibull_params)\n\n\n               Parameter    Value\n1      Weibull Shape (p) 1.365756\n2 Weibull Scale (lambda) 9.472107\n\n\nSimilarly, we can fit flexible parametric proportional hazards model with 1, 2, or 3 knots, varying the \\(k\\):\n\n\nShow R code\n# Fitting the flexible parametric proportional hazards model with \n# 1 internal knot\nspline_PH_1 &lt;- flexsurvspline(Surv(time, cens) ~ treat, \n                                data = leukdata, \n                                k = 1, \n                                scale = \"hazard\")\nspline_PH_1\n\n\nCall:\nflexsurvspline(formula = Surv(time, cens) ~ treat, data = leukdata, \n    k = 1, scale = \"hazard\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0          NA    -3.4189  -5.1348  -1.7030   0.8755       NA        NA\ngamma1          NA     1.6446   0.5501   2.7392   0.5584       NA        NA\ngamma2          NA     0.0618  -0.1574   0.2809   0.1118       NA        NA\ntreat6-MP   0.5000    -1.6873  -2.5072  -0.8674   0.4183   0.1850    0.0815\n           U95%   \ngamma0          NA\ngamma1          NA\ngamma2          NA\ntreat6-MP   0.4200\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.4189, df = 4\nAIC = 220.8379\n\n\nShow R code\n# 2 internal knots\nspline_PH_2 &lt;- flexsurvspline(Surv(time, cens) ~ treat, \n                                data = leukdata, \n                                k = 2, \n                                scale = \"hazard\")\nspline_PH_2\n\n\nCall:\nflexsurvspline(formula = Surv(time, cens) ~ treat, data = leukdata, \n    k = 2, scale = \"hazard\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0          NA    -3.3873  -5.1596  -1.6150   0.9043       NA        NA\ngamma1          NA     1.5953   0.2210   2.9696   0.7012       NA        NA\ngamma2          NA    -0.0321  -1.1047   1.0405   0.5472       NA        NA\ngamma3          NA     0.1202  -1.3114   1.5518   0.7304       NA        NA\ntreat6-MP   0.5000    -1.6810  -2.5073  -0.8547   0.4216   0.1862    0.0815\n           U95%   \ngamma0          NA\ngamma1          NA\ngamma2          NA\ngamma3          NA\ntreat6-MP   0.4254\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.4145, df = 5\nAIC = 222.8291\n\n\nShow R code\n# 3 internal knots\nspline_PH_3 &lt;- flexsurvspline(Surv(time, cens) ~ treat, \n                                data = leukdata, \n                                k = 3, \n                                scale = \"hazard\")\nspline_PH_3\n\n\nCall:\nflexsurvspline(formula = Surv(time, cens) ~ treat, data = leukdata, \n    k = 3, scale = \"hazard\")\n\nEstimates: \n           data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0          NA    -3.3749  -5.1472  -1.6026   0.9043       NA        NA\ngamma1          NA     1.5580   0.0650   3.0510   0.7617       NA        NA\ngamma2          NA    -0.1584  -2.6286   2.3117   1.2603       NA        NA\ngamma3          NA     0.2839  -4.6262   5.1939   2.5052       NA        NA\ngamma4          NA    -0.0810  -3.8051   3.6431   1.9001       NA        NA\ntreat6-MP   0.5000    -1.6832  -2.5122  -0.8543   0.4229   0.1858    0.0811\n           U95%   \ngamma0          NA\ngamma1          NA\ngamma2          NA\ngamma3          NA\ngamma4          NA\ntreat6-MP   0.4256\n\nN = 42,  Events: 30,  Censored: 12\nTotal time at risk: 541\nLog-likelihood = -106.4059, df = 6\nAIC = 224.8118",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible1.html#how-many-knots-to-use",
    "href": "Flexible1.html#how-many-knots-to-use",
    "title": "4 Flexible parametric survival",
    "section": "12 How many knots to use?",
    "text": "12 How many knots to use?\nThe flexible parametric models are usually not nested and can be compared using the AIC and BIC:\n\nIf the improvement in fit (likelihood) is greater than the penalty for the new parameter, the AIC/BIC decreases (model with more knots is better)\nIf the improvement in fit is marginal and does not justify the extra parameter, the AIC/BIC increases (model with fewer knots is better)\n\nFrom the above outputs, we can see that the AIC increases with each model and additional knot, hence supporting standard Weibull model as the optimal model fit in these data.\nNote that as the Weibull model is nested within the flexible parametric proportional hazards model, we can also use the likelihood ratio test to determine which model provides a better fit for the data:\n\n\nShow R code\n# Make sure you have installed the lmtest package\n# install.packages(\"lmtest\")\n# Load the lmtest package\nlibrary(lmtest)\n\n# Likelihood Ratio Test\n\n# It is recommended to list the most complex model first\nlrtest(spline_PH_1, wei_PH)\n\n\nLikelihood ratio test\n\nModel 1: Surv(time, cens) ~ treat\nModel 2: Surv(time, cens) ~ treat\n  #Df  LogLik Df  Chisq Pr(&gt;Chisq)\n1   4 -106.42                     \n2   3 -106.58 -1 0.3211     0.5709\n\n\nNote also that the default knot positions have been shown to work fairly well.\n\n\n\n\n\n\nTipStudent exercise\n\n\n\nTry fitting flexible parametric models with proportional odds assumption (scale = odds) or normal assumption (scale = normal) to these data. Compare the model fit with 0 knots with the log-logistic parametric model and log-normal parametric model we fit before and compare the model fit with with different number of knots.\n\n\n\n12.1 Data example 2: Breast cancer data\nIn this data example, we will use breast cancer data, available in the flexsurv package as bc. This dataset contains survival data for 686 patients with primary node positive breast cancer from the German Breast Cancer Study Group (1984–1989).\nWe can load the bc data and familiarise ourselves with it:\n\n\nShow R code\n# make sure you have installed the skimr and janitor packages\n# install.packages(\"skimr\")\n# install.packages(\"janitor\")\n# load the skimr package\nlibrary(skimr) # for skim() function\nlibrary(janitor) # for tabyl() function\n\ndata(bc) # load the breast cancer data\nhead(bc) # display the first few rows\n\n\n  censrec rectime group   recyrs\n1       0    1342  Good 3.676712\n2       0    1578  Good 4.323288\n3       0    1760  Good 4.821918\n4       0    1152  Good 3.156164\n5       0     967  Good 2.649315\n6       0     629  Good 1.723288\n\n\nShow R code\nskim(bc)\n\n\n\nData summary\n\n\nName\nbc\n\n\nNumber of rows\n686\n\n\nNumber of columns\n4\n\n\n_______________________\n\n\n\nColumn type frequency:\n\n\n\nfactor\n1\n\n\nnumeric\n3\n\n\n________________________\n\n\n\nGroup variables\nNone\n\n\n\nVariable type: factor\n\n\n\n\n\n\n\n\n\n\n\nskim_variable\nn_missing\ncomplete_rate\nordered\nn_unique\ntop_counts\n\n\n\n\ngroup\n0\n1\nFALSE\n3\nGoo: 229, Med: 229, Poo: 228\n\n\n\nVariable type: numeric\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nskim_variable\nn_missing\ncomplete_rate\nmean\nsd\np0\np25\np50\np75\np100\nhist\n\n\n\n\ncensrec\n0\n1\n0.44\n0.50\n0.00\n0.00\n0.00\n1.00\n1.00\n▇▁▁▁▆\n\n\nrectime\n0\n1\n1124.49\n642.79\n8.00\n567.75\n1084.00\n1684.75\n2659.00\n▆▇▆▆▂\n\n\nrecyrs\n0\n1\n3.08\n1.76\n0.02\n1.56\n2.97\n4.62\n7.28\n▆▇▆▆▂\n\n\n\n\n\nShow R code\ntabyl(bc$censrec)\n\n\n bc$censrec   n   percent\n          0 387 0.5641399\n          1 299 0.4358601\n\n\nThis dataset includes the following variables:\n\nrectime: Recurrence-free survival time in days, i.e., time from the start of follow-up (diagnosis/surgery) to recurrence or death.\nrecyrs: Recurrence-free survival time in years.\ncensrec: Vital status/censoring indicator (1 = dead/recurrence, 0 = censored)\ngroup: A 3-level prognostic factor with levels “Good”, “Medium”, and “Poor”. This factor is based on the number of positive lymph nodes and is from on a regression model developed by Sauerbrei and Royston (1999).\n\nLet’s plot the Kaplan-Meier survival curve, cumulative hazard and hazard for these data:\n\n\nShow R code\n# make sure you have installed the muhaz package\n# install.packages(\"muhaz\")\n# load the muhaz package\nlibrary(muhaz) # for plotting hazard\n\nbc_km &lt;- survfit(Surv(recyrs, censrec) ~ group, data = bc)\ncols &lt;- c(\"seagreen\", \"orange\", \"firebrick\")\n\npar(mfrow = c(1, 3))\n\nplot(bc_km, col = cols, main = \"1. Survival (KM)\", xlab = \"Time\", ylab = \"S(t)\")\nlegend(\"bottomleft\", legend = c(\"Good\", \"Medium\", \"Poor\"), col = cols, lwd = 2, bty = \"n\")\n\nplot(bc_km, fun = \"cumhaz\", col = cols, main = \"2. Cumulative Hazard\", xlab = \"Time\", ylab = \"H(t)\")\n\n# Fit the hazard with boundary correction\n# 'min.grid' and 'max.grid' define where the estimation starts and ends\nhaz_good &lt;- muhaz(bc$recyrs[bc$group == \"Good\"], bc$censrec[bc$group == \"Good\"], max.time = 6)\nhaz_med  &lt;- muhaz(bc$recyrs[bc$group == \"Medium\"], bc$censrec[bc$group == \"Medium\"], max.time = 6)\nhaz_poor &lt;- muhaz(bc$recyrs[bc$group == \"Poor\"], bc$censrec[bc$group == \"Poor\"], max.time = 6)\n\n# Plot the first one, then add the others with 'lines'\nplot(haz_good, col = cols[1], main = \"3. Hazard Rates\", xlab = \"Time\", ylab = \"h(t)\", ylim = c(0, max(haz_poor$haz)))\nlines(haz_med, col = cols[2])\nlines(haz_poor, col = cols[3])\n\n\n\n\n\n\n\n\n\nWe can now see from the hazard plot that the hazards are not monotonic like in the Weibull model and that the “Poor” prognostic group has a much sharper, earlier peak in risk compared to the “Good” group. If the proportional hazards assumption held, the hazard for the “Poor” group would be a constant multiple of the hazard for the Good group across the entire follow-up. Instead, the gap between the groups changes, being very wide in the first 2-3 years and then begins to narrow.\nWe can try to fit a Cox proportional hazards model to these data and test the proportional hazards assumption:\n\n\nShow R code\nbc_cox &lt;- coxph(Surv(recyrs, censrec) ~ group, data = bc)\nsummary(bc_cox)\n\n\nCall:\ncoxph(formula = Surv(recyrs, censrec) ~ group, data = bc)\n\n  n= 686, number of events= 299 \n\n              coef exp(coef) se(coef)     z Pr(&gt;|z|)    \ngroupMedium 0.8401    2.3166   0.1714 4.902 9.51e-07 ***\ngroupPoor   1.6181    5.0434   0.1645 9.834  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n            exp(coef) exp(-coef) lower .95 upper .95\ngroupMedium     2.317     0.4317     1.656     3.241\ngroupPoor       5.043     0.1983     3.653     6.963\n\nConcordance= 0.678  (se = 0.014 )\nLikelihood ratio test= 114.1  on 2 df,   p=&lt;2e-16\nWald test            = 104.4  on 2 df,   p=&lt;2e-16\nScore (logrank) test = 120.5  on 2 df,   p=&lt;2e-16\n\n\nShow R code\nph_test &lt;- cox.zph(bc_cox)\nph_test\n\n\n       chisq df     p\ngroup    8.1  2 0.017\nGLOBAL   8.1  2 0.017\n\n\nShow R code\nplot(ph_test)\n\n\n\n\n\n\n\n\n\nWe can see a significant p-value (0.017), indicating that the proportional hazards assumption was violated.\nFlexible parametric models allow you to relax the proportional hazards assumption and allow for time-dependent effects. We can fit a flexible parametric model with time-dependent effect, by adding a term gamma1(group) to the model, and compare different amount of knots:\n\n\nShow R code\nbc_sp1 &lt;- flexsurvspline(Surv(recyrs, censrec) ~ group + gamma1(group), \n                         data = bc, k = 1, scale = \"hazard\")\nbc_sp1\n\n\nCall:\nflexsurvspline(formula = Surv(recyrs, censrec) ~ group + gamma1(group), \n    data = bc, k = 1, scale = \"hazard\")\n\nEstimates: \n                     data mean  est      L95%     U95%     se       exp(est)\ngamma0                    NA    -3.8213  -4.4922  -3.1505   0.3423       NA \ngamma1                    NA     3.4742   2.7824   4.1661   0.3530       NA \ngamma2                    NA     0.2470   0.1718   0.3222   0.0384       NA \ngroupMedium           0.3338     1.4667   0.6987   2.2347   0.3918   4.3350 \ngroupPoor             0.3324     2.5734   1.8543   3.2924   0.3669  13.1097 \ngamma1(groupMedium)   0.3338    -0.4234  -0.8896   0.0428   0.2379   0.6548 \ngamma1(groupPoor)     0.3324    -0.7013  -1.1469  -0.2556   0.2274   0.4960 \n                     L95%     U95%   \ngamma0                    NA       NA\ngamma1                    NA       NA\ngamma2                    NA       NA\ngroupMedium           2.0112   9.3438\ngroupPoor             6.3870  26.9086\ngamma1(groupMedium)   0.4108   1.0438\ngamma1(groupPoor)     0.3176   0.7744\n\nN = 686,  Events: 299,  Censored: 387\nTotal time at risk: 2113.425\nLog-likelihood = -786.9792, df = 7\nAIC = 1587.958\n\n\nShow R code\nbc_sp2 &lt;- flexsurvspline(Surv(recyrs, censrec) ~ group + gamma1(group), \n                         data = bc, k = 2, scale = \"hazard\")\nbc_sp2\n\n\nCall:\nflexsurvspline(formula = Surv(recyrs, censrec) ~ group + gamma1(group), \n    data = bc, k = 2, scale = \"hazard\")\n\nEstimates: \n                     data mean  est      L95%     U95%     se       exp(est)\ngamma0                    NA    -3.5024  -4.2615  -2.7434   0.3873       NA \ngamma1                    NA     4.1173   3.0470   5.1875   0.5461       NA \ngamma2                    NA     0.5480   0.0475   1.0486   0.2554       NA \ngamma3                    NA    -0.3064  -0.8214   0.2085   0.2627       NA \ngroupMedium           0.3338     1.4857   0.7163   2.2551   0.3926   4.4182 \ngroupPoor             0.3324     2.5663   1.8463   3.2863   0.3673  13.0178 \ngamma1(groupMedium)   0.3338    -0.4362  -0.9028   0.0305   0.2381   0.6465 \ngamma1(groupPoor)     0.3324    -0.6947  -1.1408  -0.2485   0.2276   0.4992 \n                     L95%     U95%   \ngamma0                    NA       NA\ngamma1                    NA       NA\ngamma2                    NA       NA\ngamma3                    NA       NA\ngroupMedium           2.0469   9.5366\ngroupPoor             6.3366  26.7436\ngamma1(groupMedium)   0.4054   1.0309\ngamma1(groupPoor)     0.3195   0.7800\n\nN = 686,  Events: 299,  Censored: 387\nTotal time at risk: 2113.425\nLog-likelihood = -785.8381, df = 8\nAIC = 1587.676\n\n\nShow R code\nbc_sp3 &lt;- flexsurvspline(Surv(recyrs, censrec) ~ group + gamma1(group), \n                         data = bc, k = 3, scale = \"hazard\")\nbc_sp3\n\n\nCall:\nflexsurvspline(formula = Surv(recyrs, censrec) ~ group + gamma1(group), \n    data = bc, k = 3, scale = \"hazard\")\n\nEstimates: \n                     data mean  est      L95%     U95%     se       exp(est)\ngamma0                    NA    -3.8075  -4.7215  -2.8935   0.4664       NA \ngamma1                    NA     3.6656   2.3993   4.9319   0.6461       NA \ngamma2                    NA    -0.4413  -1.6045   0.7218   0.5935       NA \ngamma3                    NA     1.3451  -0.3405   3.0306   0.8600       NA \ngamma4                    NA    -0.8507  -1.7231   0.0217   0.4451       NA \ngroupMedium           0.3338     1.4973   0.7313   2.2633   0.3908   4.4697 \ngroupPoor             0.3324     2.5548   1.8373   3.2724   0.3661  12.8691 \ngamma1(groupMedium)   0.3338    -0.4432  -0.9069   0.0206   0.2366   0.6420 \ngamma1(groupPoor)     0.3324    -0.6842  -1.1286  -0.2397   0.2268   0.5045 \n                     L95%     U95%   \ngamma0                    NA       NA\ngamma1                    NA       NA\ngamma2                    NA       NA\ngamma3                    NA       NA\ngamma4                    NA       NA\ngroupMedium           2.0778   9.6152\ngroupPoor             6.2795  26.3740\ngamma1(groupMedium)   0.4038   1.0208\ngamma1(groupPoor)     0.3235   0.7869\n\nN = 686,  Events: 299,  Censored: 387\nTotal time at risk: 2113.425\nLog-likelihood = -784.5366, df = 9\nAIC = 1587.073\n\n\nShow R code\nAIC(bc_sp1)\n\n\n[1] 1587.958\n\n\nShow R code\nAIC(bc_sp2)\n\n\n[1] 1587.676\n\n\nShow R code\nAIC(bc_sp3)\n\n\n[1] 1587.073\n\n\nShow R code\nBIC(bc_sp1)\n\n\n[1] 1619.674\n\n\nShow R code\nBIC(bc_sp2)\n\n\n[1] 1623.923\n\n\nShow R code\nBIC(bc_sp3)\n\n\n[1] 1627.851\n\n\nShow R code\n# This will calculate the actual hazard rates for each group at different times\n# summary(bc_sp1, newdata = data.frame(group = c(\"Good\", \"Medium\", \"Poor\")), type = \"hazard\")\n\n\nWhile adding additional knots reduces AIC slightly, the additional parameters increase BIC significantly, so we choose the model with 1 knot.\nNow the hazard ratio varies over time and the \\(\\exp(est)\\) of the interaction term tells us the ‘speed’ and ‘direction’ of that move. If it’s less than 1, the groups are becoming more similar over time; if it’s greater than 1, they are diverging. Here, at the start of follow-up, the “Poor” group has 13.1 times and the “Medium” group 4.3 times the risk of the “Good” group. However, for every unit increase in log-time, those risk ratios drop by 50% and 35% (multiplied by 0.5 and 0.65), respectively. This suggests that the difference between the groups is greatest early on and diminishes as time passes.\nNote that we can also allow all the spline parameters to vary with the covariate. This would be an equivalent of a ‘stratified’ Cox model:\n\n\nShow R code\nbc_sp4 &lt;- flexsurvspline(Surv(recyrs, censrec) ~ group + gamma1(group) + gamma2(group), \n                         data = bc, k = 1, scale = \"hazard\")\nbc_sp4\n\n\nCall:\nflexsurvspline(formula = Surv(recyrs, censrec) ~ group + gamma1(group) + \n    gamma2(group), data = bc, k = 1, scale = \"hazard\")\n\nEstimates: \n                     data mean  est       L95%      U95%      se      \ngamma0                     NA   -4.00167  -4.73805  -3.26529   0.37571\ngamma1                     NA    5.68414   2.64681   8.72147   1.54969\ngamma2                     NA    0.53635   0.15009   0.92260   0.19707\ngroupMedium           0.33382    1.64701   0.82121   2.47281   0.42133\ngroupPoor             0.33236    2.73853   1.95737   3.51968   0.39856\ngamma1(groupMedium)   0.33382   -2.61372  -5.82220   0.59476   1.63701\ngamma1(groupPoor)     0.33236   -3.04969  -6.15023   0.05084   1.58194\ngamma2(groupMedium)   0.33382   -0.28660  -0.69733   0.12414   0.20956\ngamma2(groupPoor)     0.33236   -0.31048  -0.70758   0.08662   0.20260\n                     exp(est)  L95%      U95%    \ngamma0                     NA        NA        NA\ngamma1                     NA        NA        NA\ngamma2                     NA        NA        NA\ngroupMedium           5.19145   2.27326  11.85574\ngroupPoor            15.46421   7.08070  33.77378\ngamma1(groupMedium)   0.07326   0.00296   1.81260\ngamma1(groupPoor)     0.04737   0.00213   1.05216\ngamma2(groupMedium)   0.75082   0.49791   1.13218\ngamma2(groupPoor)     0.73309   0.49284   1.09048\n\nN = 686,  Events: 299,  Censored: 387\nTotal time at risk: 2113.425\nLog-likelihood = -785.6636, df = 9\nAIC = 1589.327\n\n\nIn this case this does not improve the model fit.\nWe can plot the fitted flexible parametric model survival curve \\(\\hat{S}(t)\\) by prognostic group directly over the respective Kaplan-Meier (KM) curves:\n\n\nShow R code\n# Plot \nplot(bc_sp1, \n     type = \"survival\", \n     ci = FALSE, \n     col = \"blue\",\n     main = \"Time-dependent flexible parametric model\", \n     lwd = 1,\n     xlab = \"Time (years)\",\n     ylab = \"Recurrence-free survival\" )\n\n\n\n\n\n\n\n\n\nWe can see that it fits quite well.\nWe can also plot the fitted flexible parametric model hazards \\(\\hat{h}(t)\\) by prognostic group over the kernel density estimates:\n\n\nShow R code\n# Plot \nplot(bc_sp1, \n     type = \"hazard\", \n     ci = FALSE, \n     col = \"blue\", \n     main = \"Time-dependent flexible parametric model\", \n     lwd = 1,\n     xlab = \"Time (years)\",\n     ylab = \"Hazard\",\n     ylim = c(0, 0.50)) \n\n\n\n\n\n\n\n\n\nWe can again see that the fit is quite good.\nWe can also plot the fitted flexible parametric model cumulative hazards \\(\\hat{H}(t)\\) by prognostic group over the cumulative hazards:\n\n\nShow R code\n# Plot \nplot(bc_sp1, \n     type = \"cumhaz\", \n     ci = FALSE, \n     col = \"blue\", \n     main = \"Time-dependent flexible parametric model\", \n     lwd = 1,\n     xlab = \"Time (years)\",\n     ylab = \"Cumulative hazard\") \n\n\n\n\n\n\n\n\n\nAgain the fit is good.\n\n\n\n\n\n\nTipStudent exercise\n\n\n\nTry fitting:\n\n\nParametric models that may be suitable and allow for time-dependent effects to these data\n\n\nFlexible parametric models with proportional odds assumption to these data\n\n\nCompare their fit to the flexible parametric model with time-dependent effects fitted above.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "4 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Competing.html",
    "href": "Competing.html",
    "title": "1 Competing risks",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine a competing risk and explain how it differs from traditional non-informative censoring.\nEvaluate the three main analytical approaches to competing risks: Combined analysis (time-to-first-event), marginal analysis (cause-specific hazards), and competing risk analysis (cumulative incidence).\nContrast the “real-world” probability captured by the Cumulative Incidence Function (CIF) with the overestimation bias produced by the naive Kaplan-Meier estimator.\nUnderstand when to use of the sub-distribution hazard (Fine-Gray framework) as opposed to the cause-specific hazard\nInterpret differences in the risk set (“at-risk” pool) between models\nCompare groups statistically using the classical log-rank test for cause-specific hazards and the Gray test for differences in cumulative incidence functions.\nImplement competing risk models in R, utilising packages like cmprsk, tidycmprsk, and mstate to estimate CIFs and fit Fine-Gray sub-distribution proportional hazards models.\nValidate model assumptions for the Fine-Gray model, including proportional sub-distribution hazards and the independence of administrative censoring.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#learning-objectives",
    "href": "Competing.html#learning-objectives",
    "title": "1 Competing risks",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nDefine a competing risk and explain how it differs from traditional non-informative censoring.\nEvaluate the three main analytical approaches to competing risks: Combined analysis (time-to-first-event), marginal analysis (cause-specific hazards), and competing risk analysis (cumulative incidence).\nContrast the “real-world” probability captured by the Cumulative Incidence Function (CIF) with the overestimation bias produced by the naive Kaplan-Meier estimator.\nUnderstand when to use of the sub-distribution hazard (Fine-Gray framework) as opposed to the cause-specific hazard\nInterpret differences in the risk set (“at-risk” pool) between models\nCompare groups statistically using the classical log-rank test for cause-specific hazards and the Gray test for differences in cumulative incidence functions.\nImplement competing risk models in R, utilising packages like cmprsk, tidycmprsk, and mstate to estimate CIFs and fit Fine-Gray sub-distribution proportional hazards models.\nValidate model assumptions for the Fine-Gray model, including proportional sub-distribution hazards and the independence of administrative censoring.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#what-is-a-competing-risk",
    "href": "Competing.html#what-is-a-competing-risk",
    "title": "1 Competing risks",
    "section": "2 What is a competing risk?",
    "text": "2 What is a competing risk?\nA competing risk is an event that “competes” with your primary event of interest. Its occurrence precludes the event of interest from ever happening.\nFor example, consider a group of people are followed to see if they develop a cancer. By the end of the study, some may have been observed to develop a cancer and some are alive and well. In real life, however, these are not the only two options. Some patients may die before experiencing a cancer. This is a competing risks situation because death prohibits the occurrence of cancer.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#traditional-survival-analysis-versus-competing-risk-survival-analysis",
    "href": "Competing.html#traditional-survival-analysis-versus-competing-risk-survival-analysis",
    "title": "1 Competing risks",
    "section": "3 Traditional survival analysis versus competing risk survival analysis",
    "text": "3 Traditional survival analysis versus competing risk survival analysis\n\n3.0.1 1. Traditional survival analysis\nIn traditional survival analysis (e.g., time to death), censoring occurs when the event of interest has not yet occurred by the end of the study or when the study participant is lost to follow-up.\nPremise: The event could still happen if follow-up continued. The observation is incomplete, but the participant is still hypothetically “at risk”.\nAssumption: We assume non-informative censoring. This means the reason for censoring is unrelated to the probability of the event happening. A censored participant is assumed to have the same future risk of experiencing the event as those still being observed.\n\n\n3.0.2 2. Competing risk survival analysis\nIn competing risk survival analysis, occurrence of a competing event precludes the event of interest from ever happening.\nPremise: The observation is complete regarding the event of interest. Because the competing event (e.g., death) happened, the primary event (e.g., cancer) is now biologically or logically impossible. The participant is removed from the “at risk” pool for the event of interest.\nStatistical challenge: The occurrence of a competing event is inherently informative regarding the event of interest. Because the probability of the event of interest has dropped to zero, treating these people as “censored” may bias our real-world estimates of the probability of the event occurring in a population where people can experience competing events.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#generalising-competing-risks",
    "href": "Competing.html#generalising-competing-risks",
    "title": "1 Competing risks",
    "section": "4 Generalising competing risks",
    "text": "4 Generalising competing risks\n\n4.0.1 The \\(K\\) event framework\nAn individual may experience \\(k = 1,...,K\\) different event types (e.g., causes of deaths). We typically focus on one event of interest, while the remaining \\(K-1\\) events are treated as competing risks.\nAs in traditional survival analysis, the individuals may be censored before having experienced an event, i.e., due to loss to follow-up or end of follow-up.\nCompeting events provide partial information about the event of interest: they tell us that the event of interest had not occurred up until that moment, and exactly when it became impossible.\n\n\n4.0.2 The first event framework\nThe \\(K\\) different event types may be terminal (e.g., death), precluding the event of interest, or non-terminal, changing the state of the individual but not precluding the event of interest.\nHowever, if we are interested only in the first event, then all other event types – terminal or non-terminal – function as competing risks; we only observe the time to the first event and type of this event.\nIf we continue follow-up after a non-terminal event, we move into semi-competing risks; they do not drop the probability of the primary event to zero but they alter the risk profile.\nThis is the foundation of multi-state modelling, which we will explore in a future lecture.\n\\(\\rightarrow\\) In this lecture: We focus on traditional competing risk analysis, which stops at the first event among \\(K\\) mutually exclusive possibilities.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#analysis-in-the-presence-of-competing-risks",
    "href": "Competing.html#analysis-in-the-presence-of-competing-risks",
    "title": "1 Competing risks",
    "section": "5 Analysis in the presence of competing risks",
    "text": "5 Analysis in the presence of competing risks\nThere are three main types of analyses that can be performed in the presence of competing risks:\n\n5.0.1 1. Combined analysis or time to the first event analysis\nIn combined analysis, the \\(K\\) different event types are merged into one combined event. Some examples include overall survival (all causes of death are combined into one outcome) or progression-free survival (common in cancer studies). In such analysis the goal is typically to delay all event types.\nHowever, there are many limitations to combined analysis:\n\nResults can be difficult to interpret if one event type is much rarer than the other\nMay be inappropriate if the severity of event types differs significantly\nConfusing when clinical goals conflict - for example, wanting to delay/prevent one event (e.g., in-hospital infection) while wanting to shorten the other (e.g., time to hospital discharge)\n\nCombined analysis is technically straightforward as standard survival analysis techniques apply (e.g., Kaplan-Meier, Cox PH). However, this approach is usually not considered sufficient as a standalone analysis for competing risks data.\n\n\n5.0.2 2. Marginal analysis or cause-specific hazard approach\nIn marginal analysis, the focus is on one event of interest (e.g., in-hospital infection) and objective is to quantify a marginal or net probability of such an event, in an ideal or hypothetical world where competing events are absent. For example, one might want to investigate what factors impact the risk of in-hospital infection if patients were to stay in hospital indefinitely.\nThis approach is thus useful for etiological research to understand biological mechanisms or direct preventative factors (e.g., hand hygiene, antiseptic use) rather than indirect factors (e.g., shortening hospital stay).\nThe marginal analysis relies on strong – and often unrealistic – assumption of independence between event types. However, it remains valid for estimating the hazard of an event among those who are currently alive and event-free. Standard regression techniques (e.g., Cox PH) can be used to estimate the cause-specific hazard ratio, with competing events treated as censored at their time of occurrence. However, standard non-parametric estimators (e.g., Kaplan-Meier) are inappropriate for estimating the probability of an event as they overestimate it by ignoring the competing events.\n\n\n5.0.3 3. Competing risk analysis\nIn competing risk analysis, the focus is still on one event of interest (e.g., in-hospital infection) but objective is to quantify the ‘real-world’ probability of such an event, while accounting for other competing events that may occur first. For example, one might be interested in the probability of a patient developing an in-hospital infection, while acknowledging that they may be discharged or die first.\nThis approach is useful for clinical decision-making and resource planning or evaluating the real-world impact of factors that may influence multiple, competing outcomes simultaneously.\nIt requires specific competing risk analysis methods such as cause-specific cumulative incidence function (or sub-distribution function) and hazard of the sub-distribution, where individuals who experience a competing event are not treated as censored but remain in the risk set.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#competing-risks-notation",
    "href": "Competing.html#competing-risks-notation",
    "title": "1 Competing risks",
    "section": "6 Competing risks notation",
    "text": "6 Competing risks notation\nIn the absence of competing risks, survival data are usually presented as a bivariate random variable or pair \\((T,C)\\):\n\nThe censoring variable \\(C\\) is 1 if the event of interest is observed, and 0 if the observation is censored\nWhen \\(C=1\\), \\(T\\) is the time at which the event of interest occurred and when \\(C=0\\), \\(T\\) is the time at which the observation was censored\n\nThis definition can be extended to the competing risk situation where \\(K\\) types of mutually exclusive events are possible:\n\nThe censoring indicator \\(C\\) is again defined as 0 if the observation is censored, but if the observation is not censored, \\(C\\) will take on the value \\(k\\), where \\(k\\) is the type of the first event observed \\((k=1,2,...,K)\\)\nIf \\(C=k\\), \\(T\\) is the time at which the event of type \\(k\\) occurred; otherwise it is the time of censoring",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#measures-of-risk-cumulative-incidence-and-hazards",
    "href": "Competing.html#measures-of-risk-cumulative-incidence-and-hazards",
    "title": "1 Competing risks",
    "section": "7 Measures of risk: cumulative incidence and hazards",
    "text": "7 Measures of risk: cumulative incidence and hazards\n\n7.0.1 Kaplan-Meier estimator and competing risks\nIn traditional survival analysis, when there is only one type of event or a combined event, we are primarily interested in the probability of “surviving” past a certain time without the event of interest occurring.\nFor such single-event survival data, the Kaplan-Meier estimator is the standard for describing time-to-event outcomes. The Kaplan–Meier estimator at time \\(t\\) is defined as:\n\\[\n  \\hat{S}(t) = \\prod_{t_j \\le t} \\left( 1 - \\frac{d_j}{n_j} \\right),\n\\]\nwhere \\(d_j\\) is the number of events occurring at time \\(t_j\\) and \\(n_j\\) is the number of individuals at risk just before time \\(t_j\\)\nIn the presence of competing risks, treating them as regular censoring incorrectly assumes that individuals who experience a competing event remain ‘at risk’ for the event of interest at the same rate as the rest of the cohort, leading to an overestimation of the event probability. If we were to calculate cause-specific KM estimates, their sum would add up to more than 1 (100%).\n\n\n7.0.2 Cumulative incidence function (CIF)\nIn the presence of competing risks, our perspective shifts from the absence of events to the occurrence of specific events. Therefore, while the survival function \\(S(t) = P(T &gt; t)\\) is often preferred in traditional survival analysis, in competing risks setting, the distribution function \\(F(t) = P(T \\le t\\)) becomes the preferred measured.\nIn competing risks setting, the term cumulative incidence function (CIF), rather than cumulative distribution function (CDF), is used to emphasise that we are measuring the probability of a specific event occurring by time \\(t\\), acknowledging that other event types may happen first. Thus, we “partition” the total probability of any event happening into the individual probabilities of each specific type of event. Because we are specifically looking at the occurrence of event \\(k\\), the term incidence more accurately reflects the “new cases” of that specific cause within the population. The concept of cause-specific cumulative incidence function has therefore been introduced.\nThe cause-specific cumulative incidence function (CIF) for an event of type \\(k\\) \\((k=1,2,...,K)\\) is defined as a joint probability\n\\[F_k(t)=P(T \\le t, C=k)\\]\nThe cause-specific CIF for an event of type \\(k\\) can take values only up to \\(P(C=k)\\) (not \\([0,1]\\)) because \\(\\lim_{t \\to \\infty} F_k(t) = P(C=k)\\). Therefore, \\(F_k(t)\\) is not a proper distribution function, and is hence referred to as a sub-distribution function.\nThe overall cumulative incidence function is the probability that an event of any type occurs at or before time \\(t\\) and is equal to the sum of CIFs for all event types:\n\\[\nF(t) = P(T \\le t) = \\sum_{k=1}^K P(T \\le t, C=k) = \\sum_{k=1}^K F_k(t) = 1−S(t)\n\\] In the absence of censoring, an empirical estimate of the cause-specific CIF for the event of type \\(k\\) can be obtained as\n\\[\n  \\hat{F}_k(t)= \\frac{\\text{Number of observations with 𝑇≤𝑡 and 𝐶=k}}{\\text{Total number of observations 𝑛}}\n\\]\nIf any of the \\(n\\) observations remain free of the \\(k\\) event types at the end of the follow-up, right-censoring is present and must be accounted for in the CIF calculation\n\\[\n\\hat{F}_k(t) = \\sum_{t_j \\le t} \\hat{\\lambda}_{kj} \\hat{S}(t_{j-1}) = \\sum_{t_j \\le t} \\frac{d_{jk}}{n_j} \\hat{S}(t_{j-1})\n\\]\nwhere \\(\\lambda_{kj}\\) is the cause-specific hazard for event \\(k\\) at time \\(t_j\\), \\(d_{kj}\\) is the number of events of type \\(k\\) at time \\(t_j\\), \\(n_j\\) is the number at risk just before time \\(t_j\\) and \\(\\hat{S}(t_{j-1})\\) is the overall survival probability (surviving all risks) until just before \\(t_j\\).\n\n\n7.0.3 Hazard of the sub-distribution\nFrom the cause-specific cumulative incidence function, one can define a hazard function which has a one-to-one relationship with this cumulative incidence function and is often referred to as the sub-distribution hazard\n\\[\nh_k(t) = \\frac{−d \\text{log}(1−F_k(t))}{dt} = \\frac{f_k(t)}{1−F_k(t)},\n\\]\nwhere \\(f_k(t)\\) is called sub-density.\nThis hazard takes the form\n\\[\nh_k(t) = \\lim_{\\Delta t \\to \\infty} \\frac{P(t \\le 𝑇&lt;t+\\Delta t, C=k |T_k \\ge t)}{\\Delta t} = \\frac{P(t \\le T &lt; t+\\Delta t,C=k|T \\ge t ∪ (T \\le t ∩ C \\ne k))}{\\Delta t}\n\\] Thus, it is based on the fraction of individuals that develops the event of interest at some point, amongst the individuals that either are still at risk for this event of interest or have already experienced a competing event. Individuals that experienced a competing event thus remain in the risk set.\n\n\n7.0.4 Cause-specific hazard\nThe cause-specific hazard is more intuitive\n\\[\n\\lambda_k(t) = \\lim_{\\Delta t \\to \\infty} \\frac{P(t \\le T &lt; t+\\Delta t, C=k|𝑇\\ge t)}{\\Delta t}\n\\] as it quantifies the progression to the event of interest amongst the individuals who are still at risk and did not experience any event of any type before. Individuals that experienced a competing event are censored and removed from the risk set.\nThe sum of cause-specific hazards for all event types gives the overall hazard:\n\\[\\sum_{k=1}^K \\lambda_k(t) = h(t),\\]\nwhereas the sub-distribution hazard ‘sacrifices’ additivity in exchange for direct one-to-one relationship with real-world probability of an event.\nThe cause-specific cumulative incidence and the cause-specific hazard are related as follows:\n\\[\nF_k(t)=P(T \\le t, C=k)= \\int_0^t S(u) \\lambda_k(u) du\n\\] \\(F_k(t)\\) thus depends on \\(\\lambda_k(t)\\) but also on the cause-specific hazards of all other event types (via \\(S(t)\\)), and there is no one-to-one relationship between \\(\\lambda_k(t)\\) and \\(F_k(t)\\), as there is between \\(h_k(t)\\) and \\(F_k(t)\\).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#goals-of-competing-risk-analysis",
    "href": "Competing.html#goals-of-competing-risk-analysis",
    "title": "1 Competing risks",
    "section": "8 Goals of competing risk analysis",
    "text": "8 Goals of competing risk analysis\nThe common goals of competing risk analysis and approaches to addressing them are:\n1. Estimation: Quantifying real-world risk\n\nGoal: To estimate the probability of a specific event in the presence of other competing events\nApproach: Cause-specific cumulative incidence function\n\n2. Hypothesis testing: Comparing groups\n\nGoal: To determine if the occurrence of events differs significantly between groups (e.g., treatment vs. control) in the presence of competing risks\nApproach: Statistical comparison of CIF curves or underlying hazards (cause-specific or sub-distribution)\n\n3. Modelling: Identifying risk factors\n\nGoal: To investigate the impact of multiple covariates simultaneously on the event of interest\nApproach: Utilising specific models – such as Fine-Gray sub-distribution model or cause-specific hazards model – depending on the research question of interest\n\nIn the following, we will demonstrate these goals and approaches using a hands on R example.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Competing.html#data-example",
    "href": "Competing.html#data-example",
    "title": "1 Competing risks",
    "section": "9 Data example",
    "text": "9 Data example\n\n9.0.1 Data\nIn this data example, we will use data on ovarian cancer patients in the dataOvarian dataset from the frailtypack package.\nThis dataset is derived from the Ovarian Cancer Meta-analysis Project. It compiles data on 1192 advanced ovarian cancer patients who participated in one of four double-blind RCTs to assess the efficacy of cyclophosphamide plus cisplatin (CP) versus cyclophosphamide plus adriamycin plus cisplatin (CAP). Patients were diagnosed with advanced ovarian cancer and then randomised into one of the two treatment groups. They were followed from the point of randomisation to monitor for cancer progression (disease growth or advancement) or recurrence/relapse (return of cancer after a period of improvement or remission). These events are combined into a single surrogate outcome referred to hereafter as progression.\nLet’s load and view these data to get a better understanding of the data and the variables in this dataset:\n\n\nShow R code\n# make sure you have installed the frailtypack package\n# install.packages(\"frailtypack\")\n# load the frailtypack package\nlibrary(frailtypack)\n\n# load the dataset dataOvarian from the frailtypack package\ndata(dataOvarian)\n# view the first observations\nhead(dataOvarian)\n\n\n  patientID trialID trt      timeS statusS     timeT statusT\n1         1       2   0 0.10515873       1 0.1857143       1\n2         2       2   0 0.89523809       1 1.4087302       1\n3         3       2   0 0.07896825       1 0.1261905       1\n4         4       2   1 1.73928571       0 1.7392857       0\n5         5       2   0 0.09126984       1 0.1273810       1\n6         6       2   1 0.16984127       1 0.2253968       1\n\n\nWhen you load the dataset in R, you will see the following variables in the data:\n\npatientID: Unique identifier for each patient\ntrialID: An identifier for trial centers where patients were treated (there are 50).\ntrt: The indicator for the two treatment arms (0 = CP, 1 = CAP).\ntimeS: The time (in years) to the progression-free survival, i.e., until disease progression or death\nstatusS: The censoring indicator for progression-free survival (0 = censoring, 1 = progression or death)\ntimeT: The time (in years) to death of any cause\nstatusT: The censoring indicator for death (0 = censoring, 1 = death)\n\nThe main outcomes of interest in these trials were progression-free survival and overall survival. Note that both of these outcomes are essentially combined events, which align with the first analysis approach we discussed for competing risks survival data. Because these approaches simplify the multi-event reality into a single “first event” framework, the standard survival analysis techniques - such as Kaplan-Meier estimation and Cox proportional hazards modelling - remain applicable.\n\n\n\n\n\n\nTipStudent exercise\n\n\n\nPractise the previously covered survival analysis techniques to evaluate progression-free survival and overall survival using the dataOvarian dataset. Specifically:\n\nKaplan-Meier estimation: Estimate and visualise the survivor functions for the entire cohort and stratified by treatment group. Assess median survival time.\nLog-rank test: Test the null hypotheses of no difference in survival experience between the two treatment groups.\nCox proportional hazards model: Fit a semi-parametric model with treatment group as a covariate to estimate the hazard ratio (HR) and compare the p-value to your log-rank test results. Assess the model assumptions.\nParametric models: Fit various parametric models (e.g., Exponential, Weibull, Log-logistic) with treatment group as a covariate to estimate HR. Assess whether the chosen parametric distributions adequately fulfill their respective assumptions. Compare models that meet their assumptions (e.g., using AIC/BIC) to identify the most appropriate fit for the data.\n\n\n\nIn this data example, our primary event of interest is time to progression. Death from any cause is a competing risk. Censoring occurred when patients did not experience disease progression or death, but were alive and free of disease progression at the end of the follow-up.\nWe will use the follow-up time and indicator variables available in the data - timeS and statusS for progression-free survival (0=censoring, 1 = progression or death) and timeT and statusT for overall survival (0=censoring, 1=death) to define new follow-up time and indicator variables for progression as the first event (\\(k=1\\)) or death as the first event (\\(k=2\\)). We will also transform the follow-up time to months instead of years for easier interpretation.\n\n\nShow R code\n# make sure you have installed the tidyverse package\n# install.packages(\"tidyverse\")\n# load the tidyverse package\nlibrary(tidyverse) # we are using tidyverse tools such as the pipe (%&gt;%) and dplyr\n\n# Progression-free and overall survival times were transformed to months \n# for easier interpretation\ndataOvarian2 &lt;- dataOvarian %&gt;%\n  mutate(timeMonthsS = timeS * 12) %&gt;%\n  mutate(timeMonthsT = timeT * 12)\n\n# defining new follow-up time and indicator variables for progression or death\n# as the first event\ndataOvarian2 &lt;- dataOvarian2 %&gt;%\n  mutate(timeMonthsCR = pmin(timeMonthsS, timeMonthsT)) %&gt;%\n  mutate(statusCR = case_when(\n    statusS == 0 ~ 0, # censored observations\n    statusS == 1 & timeS == timeT ~ 2, # cases with death as the first event\n    TRUE ~ 1 # cases with disease progression as the first event\n  )) \n\n\nLet’s have a look at the original indicator variables and the new indicator variable statusCR for competing risks. We will first look at all patients together (i.e., not taking the treatment group into account yet).\n\n\nShow R code\n# make sure you have installed the janitor package\n# install.packages(\"janitor\")\n# load the janitor package\nlibrary(janitor) # for tabyl() function\n\n# you can use table() function from baseR but tabyl() function gives percentages\n# table(dataOvarian2$statusS)\n# table(dataOvarian2$statusT)\n# table(dataOvarian2$statusCR)\n\ndataOvarian2 %&gt;% tabyl(statusS) \n\n\n statusS   n   percent\n       0 215 0.1803691\n       1 977 0.8196309\n\n\nShow R code\ndataOvarian2 %&gt;% tabyl(statusT) \n\n\n statusT   n   percent\n       0 241 0.2021812\n       1 951 0.7978188\n\n\nShow R code\ndataOvarian2 %&gt;% tabyl(statusCR)\n\n\n statusCR   n   percent\n        0 215 0.1803691\n        1 777 0.6518456\n        2 200 0.1677852\n\n\nWe can see that 777 patients had time to progression as the first event, 200 death, and 215 were censored.\n\n\n9.0.2 Cause-specific cumulative incidence functions (CIFs)\nTo estimate the probability of progression over time, while acknowledging that the patients may die before disease progression, we can calculate non-parametric cause-specific cumulative incidence functions (CIFs).\nCumulative incidences can be obtained using cuminc() function from cmprsk package, cuminc() function from tidycmprsk package, or Cuminc() function from mstate package\nCumulative incidences obtained from the cuminc() function from the cmprsk package or from the Cuminc() function from the mstate package can be visualised using plot(x). If x is a cuminc object from the cmprsk package, R actually runs a function called plot.cuminc(), and if x is a Cuminc object, R runs a function called plot.Cuminc(). Cumulative incidences form the cuminc() function from the tidycmprsk package can be visualised using the ggcuminc() function.\n\n\nShow R code\n# make sure you have installed the cmprsk package\n# install.packages(\"cmprsk\")\n# load the cmprsk package\n# note: this package loads the survival package automatically\nlibrary(cmprsk) # for cuminc() function\n\n# cuminc() function in cmprsk package does not use R formula syntax, but\n# requires the follow-up time and indicator data to be passed as separate vectors \nci0 &lt;- cmprsk::cuminc(dataOvarian2$timeMonthsCR, dataOvarian2$statusCR)\nci0\n\n\nEstimates and Variances:\n$est\n            5        10        15        20\n1 1 0.5606960 0.6515249 0.6650220 0.6727072\n1 2 0.1142162 0.1394503 0.1607624 0.1786919\n\n$var\n               5           10           15           20\n1 1 2.120353e-04 0.0001980099 0.0001953527 0.0001946661\n1 2 8.641319e-05 0.0001036609 0.0001185882 0.0001350590\n\n\nShow R code\n# prints a simple CIF plot with cause-specific CIF curves\nplot(ci0)\n\n\n\n\n\n\n\n\n\n\n\nShow R code\n# make sure you have installed the tidycmprsk and ggsurvfit packages\n# install.packages(\"tidycmprsk\")\n# install.packages(\"ggsurvfit\")\n# load the tidycmprsk and ggsurvit packages\n# note: tidycmprsk package loads the survival package automatically\n# note: loading tidycmprsk automatically loads ggcuminc() and tidycmprsk also \n# imports ggplot2 to make ggcuminc() work (although some functionality is missing)\n# note: tidyverse package also automatically loads ggplot2() \n# note: sometimes tidycmprsk fails to load ggsurvfit package needed for ggcuminc()\n# function, and therefore we load it here separately\nlibrary(tidycmprsk) # for cuminc() function\nlibrary(tidyverse) # reloaded to be able to run this code block independently\nlibrary(ggsurvfit) # needed for ggcuminc() function\n\n# tidycmprsk was created specifically to make the cmprsk package more user-friendly\n# cuminc() function in tidycmprsk package uses R formula syntax \n# status variable must be a factor\nci1 &lt;- tidycmprsk::cuminc( Surv(timeMonthsCR, factor(statusCR)) ~ 1, data = dataOvarian2)\nci1\n\n\ntime   n.risk   estimate   std.error   95% CI          \n5.00   368      0.561      0.015       0.532, 0.589    \n10.0   226      0.652      0.014       0.623, 0.678    \n15.0   171      0.665      0.014       0.637, 0.692    \n20.0   66       0.673      0.014       0.645, 0.699    \n\n\ntime   n.risk   estimate   std.error   95% CI          \n5.00   368      0.114      0.009       0.097, 0.133    \n10.0   226      0.139      0.010       0.120, 0.160    \n15.0   171      0.161      0.011       0.140, 0.183    \n20.0   66       0.179      0.012       0.157, 0.202    \n\n\nShow R code\n# Plotting the CIF\n\n# CIF plot for time to progression\n# ci1 %&gt;% ggcuminc(outcome = \"1\")\n# CIF plot for death\n# ci1 %&gt;% ggcuminc(outcome = \"2\")\n# CIF plot for time to progression and death\n# ci1 %&gt;% ggcuminc(outcome = c(\"1\", \"2\"))\n\n# A bit nicer plots:\n\nci1 %&gt;%\n  ggcuminc(outcome = \"1\") + \n  add_confidence_interval() +\n  add_risktable() +\n  labs(x = \"Months\")\n\n\n\n\n\n\n\n\n\nShow R code\nci1 %&gt;%\n  ggcuminc(outcome = \"2\") + \n  add_confidence_interval() +\n  add_risktable() +\n  labs(x = \"Months\")\n\n\n\n\n\n\n\n\n\nShow R code\nci1 %&gt;%\n  # Pass both outcomes as a vector\n  ggcuminc(outcome = c(\"1\", \"2\")) + \n  add_confidence_interval() +\n  # could also add n at risk and events at different timepoints\n  # add_risktable() +\n  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) + \n  labs(\n    x = \"Months\",\n    title = \"Cumulative Incidence: Progression vs. Death\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nShow R code\n# make sure you have installed the mstate package\n# install.packages(\"mstate\")\n# load the mstate package\n# note: this package loads the survival package automatically\nlibrary(mstate) # for Cuminc() function\nlibrary(tidyverse) # reloaded to be able to run this code block independently\n\n# Cuminc() function in mstate package does not use R formula syntax, but\n# requires the follow-up time and indicator data to be passed as separate vectors\nci2 &lt;- Cuminc(time=dataOvarian2$timeMonthsCR, status=dataOvarian2$statusCR)\n# The ci2 object stores estimates for each event time, including\n# Overall survival: the probability of remaining free of any event\n# CIF (progression): cumulative incidence function of progression as the first event \n# CIF (death): cumulative incidence of death as the first event (\n# Precision: standard errors for each of these point estimates\nhead(ci2)\n\n\n         time      Surv         CI.1        CI.2       seSurv       seCI.1\n1 0.009523812 0.9991611 0.0008389262 0.000000000 0.0008385742 0.0008385742\n2 0.014285712 0.9974832 0.0008389262 0.001677852 0.0014512331 0.0008385742\n3 0.038095236 0.9966443 0.0008389262 0.002516779 0.0016750348 0.0008385742\n4 0.047619048 0.9949664 0.0008389262 0.004194631 0.0020497627 0.0008385742\n5 0.066666672 0.9941275 0.0008389262 0.005033557 0.0022130632 0.0008385742\n6 0.071428572 0.9924497 0.0008389262 0.006711409 0.0025072593 0.0008385742\n       seCI.2\n1 0.000000000\n2 0.001185425\n3 0.001451233\n4 0.001871957\n5 0.002049763\n6 0.002364866\n\n\nShow R code\n# obtaining the estimated values at specific timepoints\nsummary(ci2, time=c(5,10,15,20))\n\n\nCall: survfit(formula = Surv(time, statuscr) ~ 1, data = tmp)\n\n time n.risk n.event Pr((s0)) Pr(1) Pr(2)\n    5    368     789    0.325 0.561 0.114\n   10    226     129    0.209 0.652 0.139\n   15    171      36    0.174 0.665 0.161\n   20     66      22    0.149 0.673 0.179\n\n\nShow R code\n# prints a simple CIF plot with cause-specific CIF curves with their CIs\nplot(ci2)\n\n\n\n\n\n\n\n\n\nTo demonstrate the overestimation of the event probability by Kaplan-Meier estimation, we calculate the naive Kaplan-Meier estimates which treat deaths as censored:\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this code block independently\nlibrary(survival) # loaded to be able to run this code block independently\nlibrary(gtsummary) # tbl_survfit() function\n\n# KM - NAIVE ESTIMATES\n\n# creating binary indicator variables for progression and death as first events\ndataOvarian2 &lt;- dataOvarian2 %&gt;%\n  mutate(\n    statusP = as.numeric(statusCR==1),\n    statusD = as.numeric(statusCR==2)\n  )\n\n# Kaplan-Meier estimates for progression, treating competing deaths as censored\nkm_P &lt;- survfit( Surv(timeMonthsCR, statusP) ~ 1, data = dataOvarian2)\n#summary(km_P)\n# Kaplan-Meier estimates for death, treating disease progression as censored\nkm_D &lt;- survfit( Surv(timeMonthsCR, statusD) ~ 1, data = dataOvarian2)\n#summary(km_D)\n\n# Kaplan-Meier estimates for progression-free survival can be obtained using \n# the variables timeS and statusS available from the original data\n# These estimates are the same as the overall survival estimates from the \n# Cuminc function from the mstate package above\nkm_PD &lt;- survfit( Surv(timeMonthsS, statusS) ~ 1, data = dataOvarian2)\n#summary(km_PD)\n\n# 1-KM estimates to compare to ci estimates\nkm_P %&gt;%\n  tbl_survfit(\n    times = c(5, 10, 15, 20),\n    type = \"risk\", # 1 - KM\n    label_header = \"**{time} Months**\",\n    estimate_fun = function(x) style_number(x, digits = 3)\n  )\n\n\n\n\n\n\n\n\nCharacteristic\n5 Months\n10 Months\n15 Months\n20 Months\n\n\n\n\nOverall\n0.612 (0.582, 0.641)\n0.725 (0.696, 0.752)\n0.744 (0.714, 0.770)\n0.756 (0.726, 0.782)\n\n\n\n\n\n\n\nShow R code\nkm_D %&gt;%\n  tbl_survfit(\n    times = c(5, 10, 15, 20),\n    type = \"risk\", # 1 - KM\n    label_header = \"**{time} Months**\",\n    estimate_fun = function(x) style_number(x, digits = 3)\n  )\n\n\n\n\n\n\n\n\nCharacteristic\n5 Months\n10 Months\n15 Months\n20 Months\n\n\n\n\nOverall\n0.161 (0.134, 0.187)\n0.239 (0.201, 0.275)\n0.320 (0.272, 0.364)\n0.391 (0.335, 0.443)\n\n\n\n\n\n\n\nShow R code\nkm_PD %&gt;%\n  tbl_survfit(\n    times = c(5, 10, 15, 20),\n    type = \"risk\", # 1 - KM\n    label_header = \"**{time} Months**\",\n    estimate_fun = function(x) style_number(x, digits = 3)\n  )\n\n\n\n\n\n\n\n\nCharacteristic\n5 Months\n10 Months\n15 Months\n20 Months\n\n\n\n\nOverall\n0.675 (0.647, 0.701)\n0.791 (0.766, 0.813)\n0.826 (0.802, 0.847)\n0.851 (0.828, 0.871)\n\n\n\n\n\n\n\nThe results from the above analyses are summarised in the table below for comparison of cumulative incidences with the naïve KM estimates:\n\n\n\n\n\n\n\n\n\n\n\nTime (months)\nAny Event \\(1-S(t)\\)\nKM Progression \\(\\hat{F}_1^{n}\\)\nKM Death \\(\\hat{F}_2^{n}\\)\nCIF Progression \\(\\hat{F}_1(t)\\)\nCIF Death \\(\\hat{F}_2(t)\\)\n\n\n\n\n5\n0.675\n0.612\n0.161\n0.561\n0.114\n\n\n10\n0.791\n0.725\n0.239\n0.652\n0.139\n\n\n15\n0.826\n0.744\n0.320\n0.665\n0.161\n\n\n20\n0.851\n0.756\n0.391\n0.673\n0.179\n\n\n\nThe cumulative incidences can be interpreted as probabilities to experience an event (disease progression) by time \\(t\\) while accounting for the presence of competing death. For example, we see that the probability to have a progression within 10 months (acknowledging that the patient may die before and thus not experience a progression) is estimated to be 65.2% for these patients. The naive\nKM estimate overestimates this probability to be 72.5%.\nNote: \\(\\hat{F}_1(t) + \\hat{F}_2(t) = 1-S(t)\\), whereas \\(\\hat{F}_1^n + \\hat{F}_2^n &gt; 1−S(t)\\) and sums &gt; 1 after 15 months of follow-up.\nWe can also visualise the overestimation bias when using naive KM estimates instead of cumulative incidences:\n\n\nShow R code\n# make sure you have installed the broom package\n# install.packages(\"broom\")\nlibrary(tidyverse) # reloaded to be able to run this code block independently\nlibrary(broom) # for tidy() function\n\n# Plotting the cumulative incidence functions and the naive 1-KM estimates\n\n# 1. Get the CIF for Progression (Failure Type 1)\ncif_p &lt;- tidy(ci1) %&gt;%\n  filter(outcome == \"1\") %&gt;%\n  select(time, estimate) %&gt;%\n  mutate(type = \"CIF (Correct)\")\n\n# 2. Get the 1-KM for Progression\nkm_p &lt;- tidy(km_P) %&gt;%\n  mutate(estimate = 1 - estimate) %&gt;% # Convert S(t) to 1-S(t)\n  select(time, estimate) %&gt;%\n  mutate(type = \"1-KM (Naive)\")\n\n# 3. Combine them for plotting\ncomp_data &lt;- bind_rows(cif_p, km_p)\n\n# Create a 'starting row' to ensure both methods begin at time 0\nstart_row &lt;- data.frame(\n  time = 0, \n  estimate = 0, \n  type = c(\"CIF (Correct)\", \"1-KM (Naive)\")\n)\n\ncomp_data_fixed &lt;- bind_rows(start_row, comp_data) %&gt;%\n  distinct(time, type, .keep_all = TRUE) # Remove duplicates if 0 already existed\n\nggplot(comp_data_fixed, aes(x = time)) +\n  \n  # Layer 1: CIF Area (Uses 'estimate')\n  geom_area(data = filter(comp_data_fixed, type == \"CIF (Correct)\"), \n            aes(y = estimate, fill = \"CIF (Progression)\"), alpha = 0.5) +\n  \n  # Layer 2: Overestimation bias\n  geom_ribbon(data = pivot_wider(comp_data_fixed, names_from = type, values_from = estimate) %&gt;% \n                fill(`CIF (Correct)`, `1-KM (Naive)`, .direction = \"down\"),\n              aes(ymin = `CIF (Correct)`, ymax = `1-KM (Naive)`, fill = \"Overestimation Bias\"), \n              alpha = 0.3) +\n  \n  # Layer 3: The 1-KM Line (Uses 'estimate')\n  geom_step(data = filter(comp_data_fixed, type == \"1-KM (Naive)\"), \n            aes(y = estimate, color = \"1-KM Estimate\"), linewidth = 1) +\n  \n  # Formatting\n  scale_fill_manual(values = c(\"CIF (Progression)\" = \"steelblue\", \n                               \"Overestimation Bias\" = \"firebrick\")) +\n  scale_color_manual(values = c(\"1-KM Estimate\" = \"black\")) +\n  theme_minimal() +\n  labs(\n    title = \"Overestimation Bias: 1-KM vs. CIF (Progression)\",\n    subtitle = \"Highlighting the impact of ignoring competing deaths\",\n    x = \"Months\",\n    y = \"Cumulative Probability\",\n    fill = \"Legend\",\n    color = \"\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n9.0.3 Comparing event occurrence\nLet’s now consider the effect of the treatment group (CP versus CAP) on the two event types.\n\n\nShow R code\nlibrary(tidyverse) # reloaded to be able to run this code block independently\nlibrary(janitor) # reloaded to be able to run this code block independently\n\ndataOvarian2 &lt;- dataOvarian2 %&gt;%\n  mutate(trt = factor(trt, \n                            levels = c(0, 1), \n                            labels = c(\"CP\", \"CAP\")))\n\ndataOvarian2 %&gt;% tabyl(statusS, trt) \n\n\n statusS  CP CAP\n       0  93 122\n       1 513 464\n\n\nShow R code\ndataOvarian2 %&gt;% tabyl(statusT, trt) \n\n\n statusT  CP CAP\n       0 107 134\n       1 499 452\n\n\nShow R code\ndataOvarian2 %&gt;% tabyl(statusCR, trt)\n\n\n statusCR  CP CAP\n        0  93 122\n        1 415 362\n        2  98 102\n\n\nShow R code\n# nicer tables with percentages\n\n# percentages by row\n\nmy_table1 &lt;- dataOvarian2 %&gt;%\n  tabyl(statusS, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"row\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table1)\n\n\n statusS          CP         CAP          Total\n       0 43.3%  (93) 56.7% (122) 100.0%   (215)\n       1 52.5% (513) 47.5% (464) 100.0%   (977)\n   Total 50.8% (606) 49.2% (586) 100.0% (1,192)\n\n\nShow R code\nmy_table2 &lt;- dataOvarian2 %&gt;%\n  tabyl(statusT, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"row\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table2)\n\n\n statusT          CP         CAP          Total\n       0 44.4% (107) 55.6% (134) 100.0%   (241)\n       1 52.5% (499) 47.5% (452) 100.0%   (951)\n   Total 50.8% (606) 49.2% (586) 100.0% (1,192)\n\n\nShow R code\nmy_table3 &lt;- dataOvarian2 %&gt;%\n  tabyl(statusCR, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"row\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table3)\n\n\n statusCR          CP         CAP          Total\n        0 43.3%  (93) 56.7% (122) 100.0%   (215)\n        1 53.4% (415) 46.6% (362) 100.0%   (777)\n        2 49.0%  (98) 51.0% (102) 100.0%   (200)\n    Total 50.8% (606) 49.2% (586) 100.0% (1,192)\n\n\nShow R code\nmy_table1b &lt;- dataOvarian2 %&gt;%\n  tabyl(statusS, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"col\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table1b)\n\n\n statusS           CP          CAP          Total\n       0  15.3%  (93)  20.8% (122)  18.0%   (215)\n       1  84.7% (513)  79.2% (464)  82.0%   (977)\n   Total 100.0% (606) 100.0% (586) 100.0% (1,192)\n\n\nShow R code\nmy_table2b &lt;- dataOvarian2 %&gt;%\n  tabyl(statusT, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"col\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table2b)\n\n\n statusT           CP          CAP          Total\n       0  17.7% (107)  22.9% (134)  20.2%   (241)\n       1  82.3% (499)  77.1% (452)  79.8%   (951)\n   Total 100.0% (606) 100.0% (586) 100.0% (1,192)\n\n\nShow R code\nmy_table3b &lt;- dataOvarian2 %&gt;%\n  tabyl(statusCR, trt) %&gt;%\n  adorn_totals(c(\"row\", \"col\")) %&gt;%          # Adds 'Total' rows and columns\n  adorn_percentages(\"col\") %&gt;%               # Calculates percentages by row\n  adorn_pct_formatting(digits = 1) %&gt;%       # Formats as % with 1 decimal place\n  adorn_ns()                                 # Shows the raw counts (n) in parentheses\n\nprint(my_table3b)\n\n\n statusCR           CP          CAP          Total\n        0  15.3%  (93)  20.8% (122)  18.0%   (215)\n        1  68.5% (415)  61.8% (362)  65.2%   (777)\n        2  16.2%  (98)  17.4% (102)  16.8%   (200)\n    Total 100.0% (606) 100.0% (586) 100.0% (1,192)\n\n\n415 patients out of 606 patients (68.5%) in CP treatment group and 362 patients out of 586 patients (61.8%) in the CAP treatment group experienced progression as the first event. 98 (16.2%) patients in CP treatment group and 102 (17.4%) patients in CAP treatment group died during the follow-up.\nTo determine if the occurrence of events differs significantly between groups, we can compare the underlying hazards.\n1. Comparison of cause-specific hazards\nWhen comparing cause-specific hazards we ask: “Among patients who are still alive and have not yet progressed, is the instantaneous rate of progression different between the treatment groups?”\nWe test the null hypothesis that the hazards are equal across all time points for the specific event of interest (\\(k\\)):\n\\[H_0: \\lambda_{k,1}(t) = \\lambda_{k,2}(t), \\text{ for all } t ∈ [0,\\tau]\\] \\[H_1: \\lambda_{k,1}(t) \\ne \\lambda_{k,2}(t), \\text{ for some } t ∈ [0,\\tau]\\]\nWe can use the classical log-rank test provided we correctly handle the competing events. That is, when testing the hazard for event \\(k\\), individuals who experience a competing event (any event other than \\(k\\)) are treated as censored at the time that competing event occurs. We are interested in the rate of the event among those still alive and event-free.\nWe calculate the aggregate difference between the observed and expected events across all event times:\n\\[U = \\sum_{allt_j} \\left(d_{kj}^{(1)} - \\frac{d_{jk}R_j^{(1)}} {R_j}\\right)\\] We also calculate the variance of \\(U\\), which is the sum of the variances at each event time. To determine if \\(U\\) is statistically significant, we square the statistic and divide it by its variance. This standardised value follows a Chi-square (\\(\\chi^2\\)) distribution with 1 degree of freedom (for a two-group comparison):\n\\[\\frac{U^2}{\\widehat{Var}(U)} \\sim \\chi_1^2 \\] We can carry out the log-rank test in R using the survdiff() function in the survival package:\n\n\nShow R code\n# For disease progression as the first event (censoring patients who died)\nsurvdiff( Surv(timeMonthsCR, statusP) ~ trt, data = dataOvarian2)\n\n\nCall:\nsurvdiff(formula = Surv(timeMonthsCR, statusP) ~ trt, data = dataOvarian2)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ntrt=CP  606      415      369      5.74        11\ntrt=CAP 586      362      408      5.19        11\n\n Chisq= 11  on 1 degrees of freedom, p= 9e-04 \n\n\nShow R code\n# For death as the first event (censoring patients who experienced progression)\nsurvdiff( Surv(timeMonthsCR, statusD) ~ trt, data = dataOvarian2)\n\n\nCall:\nsurvdiff(formula = Surv(timeMonthsCR, statusD) ~ trt, data = dataOvarian2)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ntrt=CP  606       98     93.8     0.184     0.349\ntrt=CAP 586      102    106.2     0.163     0.349\n\n Chisq= 0.3  on 1 degrees of freedom, p= 0.6 \n\n\nWe see a significant difference (\\(p = 0.0009\\)) in the rate of disease progression between the two different treatment groups, but not in the rate of death (\\(p = 0.6\\)), i.e., people are being removed from the risk set (due to death) at the same rate.\nNote that comparing the equality of cause-specific hazards is not equal to testing the equality of the cause-specific CIFs because there is no one-to-one relationship between cause-specific hazards and CIF, as there is between sub-distribution hazards and CIFs, as demonstrated before.\nIt is therefore important to realise and remember that any effect of a covariate supported by the log-rank test for cause-specific hazards may not necessarily translate into a similar effect of the covariate on the cumulative incidence functions.\n2. Comparison of sub-distribution hazards\nWhile the log-rank test is used to compare cause-specific hazards, we often want to test whether the cumulative incidence functions (CIFs) themselves differ between groups. This is typically done using Gray test.\nGray test evaluates the null hypothesis that the sub-distribution hazards - and therefore the CIFs due to their one-to-one-relationship - are equal across groups for the event of interest (\\(k\\)):\n\\[H_0: h_{k,1}(t) = h_{k,2}(t), \\text{ for all } t ∈ [0,\\tau]\\] \\[H_1: h_{k,1}(t) \\ne h_{k,2}(t), \\text{ for some } t ∈ [0,\\tau]\\]\nA key difference to the classical log-rank test used for the comparison of cause-specific hazards, in which individuals are removed from the risk set as soon as they experience a competing event, is that in the Gray test individuals who experience a competing event remain in the risk set indefinitely. They are treated as if they can never experience the event of interest, effectively weighting the denominator to reflect the total population.\n\\[U^* = \\sum_{allt_j} \\left(d_{kj}^{(1)} - \\frac{d_{jk}R_{*j}^{(1)}} {R_{*j}}\\right),\\] where \\(R_{*j}^{(1)} = n_{j}^{(1)} \\frac{1-\\hat{F}_k^{(1)}(t_{j-1})} {\\hat{S}^{(1)}(t_{j-1})}\\) and \\(R_{*j} = R_{*j}^{(1)} + R_{*j}^{(2)}\\),\nwhere \\(n_{j}^{(1)}\\) is the number of individuals at risk at time \\(t_j\\) in group 1, \\(F_k^{(1)}(t_{j-1})\\) is the CIF for the event \\(k\\) at time \\(t_{j-1}\\), and \\(S(t_{j-1})\\) is the probability of being free of any event at time \\(t_{j-1}\\) (KM estimate). \\(R_{*j}^{(1)}\\) thus represents an adjusted number of individuals at risk at time \\(t_j\\).\nThe ratio of sub-distribution survival \\(\\left(1-F_k(t)\\right)\\) to KM \\(\\left(S(t)\\right)\\)) mathematically “inflates” the risk set to include the individuals who experienced competing events. By including the number at risk at time \\(t_j\\) (\\(n_j\\)), the test ensures that the comparison is most heavily weighted at time points where you have the most data. Essentially, the Gray test is a weighted log-rank test on the sub-distribution hazard.\nWe can carry out the Gray test in R using the cuminc()] function in the cmprsk package:\n\n\nShow R code\n# Gray test for difference of sub-distribution hazards or CIFs\ncmprsk::cuminc(dataOvarian2$timeMonthsCR, dataOvarian2$statusCR, group=dataOvarian2$trt)$Tests\n\n\n       stat          pv df\n1 8.5954507 0.003370038  1\n2 0.2346319 0.628110418  1\n\n\nThe first line refers to progression as the first event (statusCR = 1) and the second line to death as the first event (statusCR = 2). The output also displays the value of the test statistic (stat), the p-value of the Gray test (pv), and the number of degrees of freedom of the chi-square distribution (df).\nWe can see that the difference in the sub-distribution hazards or CIFs for time to progression as the first event was statistically significant (p-value = 0.003) but not for death as the first event (p-value = 0.628).\nNote that you can also obtain these test values from the tidycmprsk::cuminc() function, that also allows you to plot the cause-specific CIFs by treatment group:\n\n\nShow R code\nlibrary(dplyr)\nlibrary(tidycmprsk)\n\ndataOvarian2_clean &lt;- dataOvarian2 %&gt;%\n  mutate(\n    # Clean labels for Treatment\n    trt = recode_factor(trt, \"0\" = \"CP\", \"1\" = \"CAP\"),\n    # Clean labels for Events (1 = Progression, 2 = Death)\n    statusCR = recode_factor(factor(statusCR), \n                             \"0\" = \"Censored\",\n                             \"1\" = \"Progression\", \n                             \"2\" = \"Death\")\n  )\n\nci1_treat &lt;- cuminc(Surv(timeMonthsCR, statusCR) ~ trt, data = dataOvarian2_clean)\nci1_treat\n\n\nstrata   time   n.risk   estimate   std.error   95% CI          \nCP       5.00   165      0.118      0.013       0.093, 0.145    \nCP       10.0   97       0.141      0.014       0.114, 0.170    \nCP       15.0   74       0.158      0.015       0.130, 0.189    \nCP       20.0   27       0.172      0.016       0.142, 0.205    \nCAP      5.00   203      0.111      0.013       0.087, 0.138    \nCAP      10.0   129      0.138      0.014       0.111, 0.168    \nCAP      15.0   97       0.164      0.016       0.134, 0.196    \nCAP      20.0   39       0.186      0.017       0.154, 0.220    \n\n\nstrata   time   n.risk   estimate   std.error   95% CI          \nCP       5.00   165      0.597      0.020       0.557, 0.636    \nCP       10.0   97       0.682      0.019       0.643, 0.719    \nCP       15.0   74       0.696      0.019       0.656, 0.731    \nCP       20.0   27       0.708      0.019       0.669, 0.744    \nCAP      5.00   203      0.523      0.021       0.481, 0.563    \nCAP      10.0   129      0.620      0.020       0.578, 0.658    \nCAP      15.0   97       0.634      0.020       0.592, 0.672    \nCAP      20.0   39       0.636      0.020       0.595, 0.674    \n\n\noutcome       statistic   df     p.value    \nProgression   8.60        1.00   0.003      \nDeath         0.235       1.00   0.63       \n\n\nShow R code\nci1_treat %&gt;%\n  ggcuminc(outcome = c(\"Progression\", \"Death\")) + \n  add_confidence_interval() +\n  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) + \n  labs(\n    x = \"Months\",\n    y = \"Cumulative Incidence\",\n    title = \"Cumulative Incidence: Progression vs. Death\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThe more general form of the score for group \\(i\\) for the event of interest is the basis for Gray’s test to compare sub-distribution hazards, effectively testing for differences between the CIFs\n\\[U_i = \\int_0^{\\tau} W_i(t) [h_i(t)-h_0(t)] dt,\\] where \\(\\tau\\) is the maximum time, \\(W_i(t)\\) is a weight function, \\(h_i(t)\\) is the hazard of the sub-distribution for group \\(i\\), and \\(h_0(t)\\) is the hazard of the sub-distribution for all groups together.\nIn general, the weight function is of the form \\(W_i(t) = L(t) R_i(t)\\), where typically \\(L(t)=1\\) (by default in cmprsk, tidycmprsk, and mstate packages), and\n\\[R_i(t) = n_i(t) \\frac{1-\\hat{F}_i{(t-)}} {\\hat{S}{(t-)}},\\] where \\(n_i{(t)}\\) is the number of individuals at risk at time \\(t\\) in group \\(i\\), \\(F(t-)\\) is the left-hand limit of the CIF for the event of interest, and \\(S(t-)\\) is left-hand limit of the probability of being free of any event. (KM estimate).\nThe Gray test thus incorporates time-dependent weights to account for individuals who remain in the risk set after experiencing a competing event. But if they hadn’t experienced a competing event they could have been censored, and therefore the Gray test takes into account the inverse probability of being censored, to correctly adjust for those who are no longer under observation.\n\n\n9.0.4 Modelling in the presence of competing risks\nIn competing risks setting, the objective of modelling is to estimate the impact of specific covariates on the occurrence of the event of interest, in the presence of competing risks. In practice, this often involves evaluating the simultaneous impact of multiple covariates, as outcomes are rarely driven by a single factor.\nIn the data example going forward, we will continue to use the treatment group as our covariate of interest. In the context of randomised clinical trials (RCT), we would except potential confounding factors to be balanced across treatment groups. This balance allows us to attribute any differences in the outcomes more directly to the intervention itself.\nAgain, depending on our research question of interest we might choose to use cause-specific hazards model or the Fine-Gray sub-distribution model.\n1. Proportional cause-specific hazards model\nIf the interest lies in the biological effect of a covariate on the rate of an event among those currently at risk, the cause-specific hazards model is appropriate; specifically, we utilise the proportional cause-specific hazards model When the primary goal is to estimate a hazard ratio (HR).\nThe most commonly used proportional cause-specific hazards model is the Cox proportional hazards (PH) model:\n\\[\\lambda_k(t|X_i = x_i) = \\lambda_{k,0}(t)exp(x_i\\beta_k),\\]\nwhere \\(\\lambda_k(t|X_i = x_i)\\) is the cause-specific hazard for event type \\(k\\) for a subject with a covariate vector \\(x_i\\), \\(\\lambda_{k,0}(t)\\) the baseline cause-specific hazard for event type \\(k\\), and \\(\\beta_k = (\\beta_{k1},\\cdots,\\beta_{kp})\\) ) the \\(p\\)-vector of parameters associates with the vector \\(X\\).\nNote again, that individuals experiencing competing events are treated as censored.\nThe estimation procedure is identical to the standard Cox PH model for one type of event. Cause-specific Cox PH models for progression as the first event and death as the first event with the treatment group as the covariate of interest can be fitted using the coxph function from the survival package as before:\n\n\nShow R code\n# Cause-specific Cox PH model\n\n# For disease progression as the first event\ncsh_p &lt;- coxph( Surv(timeMonthsCR, statusP) ~ trt, data = dataOvarian2)\nsummary(csh_p)\n\n\nCall:\ncoxph(formula = Surv(timeMonthsCR, statusP) ~ trt, data = dataOvarian2)\n\n  n= 1192, number of events= 777 \n\n           coef exp(coef) se(coef)      z Pr(&gt;|z|)    \ntrtCAP -0.23780   0.78836  0.07198 -3.304 0.000954 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       exp(coef) exp(-coef) lower .95 upper .95\ntrtCAP    0.7884      1.268    0.6846    0.9078\n\nConcordance= 0.531  (se = 0.01 )\nLikelihood ratio test= 10.95  on 1 df,   p=9e-04\nWald test            = 10.92  on 1 df,   p=0.001\nScore (logrank) test = 10.97  on 1 df,   p=9e-04\n\n\nShow R code\n# For death as the first event\ncsh_d &lt;- coxph( Surv(timeMonthsCR, statusD) ~ trt, data = dataOvarian2)\nsummary(csh_d)\n\n\nCall:\ncoxph(formula = Surv(timeMonthsCR, statusD) ~ trt, data = dataOvarian2)\n\n  n= 1192, number of events= 200 \n\n           coef exp(coef) se(coef)      z Pr(&gt;|z|)\ntrtCAP -0.08393   0.91949  0.14201 -0.591    0.554\n\n       exp(coef) exp(-coef) lower .95 upper .95\ntrtCAP    0.9195      1.088    0.6961     1.215\n\nConcordance= 0.508  (se = 0.02 )\nLikelihood ratio test= 0.35  on 1 df,   p=0.6\nWald test            = 0.35  on 1 df,   p=0.6\nScore (logrank) test = 0.35  on 1 df,   p=0.6\n\n\nBefore interpreting any analysis results, we should always verify that the underlying model assumptions are met:\n\n\nShow R code\n# Proportional hazards check\n\n# For disease progression as the first event\nph_test1 &lt;- cox.zph(csh_p)\nph_test1\n\n\n       chisq df    p\ntrt    0.283  1 0.59\nGLOBAL 0.283  1 0.59\n\n\nShow R code\nplot(ph_test1)\n\n\n\n\n\n\n\n\n\nShow R code\n# For death as the first event\nph_test2 &lt;- cox.zph(csh_d)\nph_test2\n\n\n        chisq df    p\ntrt    0.0119  1 0.91\nGLOBAL 0.0119  1 0.91\n\n\nShow R code\nplot(ph_test2)\n\n\n\n\n\n\n\n\n\nThe HR for progression as the first event for CAP versus CP treatment is 0.79 (95% CI = 0.68, 0.91), indicating a significant 21% reduction in the instantaneous rate of progression among those receiving CAP treatment compared to those receiving CP treatment, among patients who are currently live and free of progression. There appeared to be no significant difference in the instantaneous rate of death among those receiving CAP versus CP treatment (HR = 0.92 (95% CI = 0.70, 1.22), among patients who were alive and free of progression.\n2. Fine and Gray sub-distribution PH model\nTo quantify the ‘real-world’ effect of covariates while accounting for competing events, we model sub-distribution hazards:\n\\[h_k(t|X_i = x_i) = h_{k,0}(t)exp(x_i\\gamma_k),\\]\nwhere \\(h_k(t|X_i = x_i)\\) is the sub-distribution hazard for event type \\(k\\) for a subject with a covariate vector \\(x_i\\), \\(h_{k,0}(t)\\) the baseline sub-distribution hazard for event type \\(k\\), and \\(\\gamma_k = (\\gamma_{k1},…,\\gamma_{kp})\\) the \\(p\\)-vector of parameters associates with the vector \\(X\\).\nThis allows for the direct quantification of covariate impacts on the cumulative incidence functions.\nThe Fine and Gray model utilises a partial likelihood approach similar to the Cox model, but with a modified risk set and the inclusion of weights:\n\\[L(\\gamma_k) = \\prod_{j=1}^r \\frac{exp(x_i\\gamma_k)} {\\sum_{i∈R_j} w_{ji}exp(x_i\\gamma_k)},\\] where the product is taken over the \\(r\\) time points \\((t_1&lt; t_2 &lt;⋯&lt;t_r)\\) where the event of interest occurs.\nThe weights are defined using the inverse probability of censoring weighting (IPCW) approach:\n\\[w_{ji} = \\frac{\\hat{G}(t_j)}{\\hat{G}(min(t_j,t_i))},\\] where \\(\\hat{G}\\) is the KM estimate of survivor function of the censoring distribution; for those still alive and event-free \\(w=1\\) while for those with competing events the weight gradually decreases based on the probability of being censored.\nThe Fine and Gray model for progression as the first event and death as the first event with the treatment group as the covariate of interest can be fitted using the crr function from the cmprsk package:\n\n\nShow R code\n# Fine and Gray model\n\n# Can be built using the crr function from the cmprsk package\n# Before doing so, we first have to put all covariates (here only treatment)\n# in a design matrix removing intercept\n\n# putting covariates into design matrix\nov_cov_matrix &lt;- model.matrix(~dataOvarian2$trt)\nhead(ov_cov_matrix)\n\n\n  (Intercept) dataOvarian2$trtCAP\n1           1                   0\n2           1                   0\n3           1                   0\n4           1                   1\n5           1                   0\n6           1                   1\n\n\nShow R code\n# removing intercept\nov_cov_matrix_ni &lt;- ov_cov_matrix[,-1]\nhead(ov_cov_matrix_ni)\n\n\n1 2 3 4 5 6 \n0 0 0 1 0 1 \n\n\nShow R code\n# Fine and Gray model for progression as first event\n# failcode = 1 indicates that we are considering progression as first event\nsh_p &lt;- cmprsk::crr(dataOvarian2$timeMonthsCR, dataOvarian2$statusCR, cov1 = ov_cov_matrix_ni, failcode = 1)\nsh_p\n\n\nconvergence:  TRUE \ncoefficients:\nov_cov_matrix_ni1 \n          -0.2109 \nstandard errors:\n[1] 0.0717\ntwo-sided p-values:\nov_cov_matrix_ni1 \n           0.0033 \n\n\nShow R code\nsummary(sh_p)\n\n\nCompeting Risks Regression\n\nCall:\ncmprsk::crr(ftime = dataOvarian2$timeMonthsCR, fstatus = dataOvarian2$statusCR, \n    cov1 = ov_cov_matrix_ni, failcode = 1)\n\n                    coef exp(coef) se(coef)     z p-value\nov_cov_matrix_ni1 -0.211      0.81   0.0717 -2.94  0.0033\n\n                  exp(coef) exp(-coef)  2.5% 97.5%\nov_cov_matrix_ni1      0.81       1.23 0.704 0.932\n\nNum. cases = 1192\nPseudo Log-likelihood = -5128 \nPseudo likelihood ratio test = 8.62  on 1 df,\n\n\nShow R code\n# Fine and Gray model for death as first event\n# failcode = 2 indicates that we are considering death as first event\nsh_d &lt;- cmprsk::crr(dataOvarian2$timeMonthsCR, dataOvarian2$statusCR, cov1 = ov_cov_matrix_ni, failcode = 2)\nsh_d\n\n\nconvergence:  TRUE \ncoefficients:\nov_cov_matrix_ni1 \n          0.07135 \nstandard errors:\n[1] 0.1411\ntwo-sided p-values:\nov_cov_matrix_ni1 \n             0.61 \n\n\nShow R code\nsummary(sh_d)\n\n\nCompeting Risks Regression\n\nCall:\ncmprsk::crr(ftime = dataOvarian2$timeMonthsCR, fstatus = dataOvarian2$statusCR, \n    cov1 = ov_cov_matrix_ni, failcode = 2)\n\n                    coef exp(coef) se(coef)     z p-value\nov_cov_matrix_ni1 0.0714      1.07    0.141 0.506    0.61\n\n                  exp(coef) exp(-coef)  2.5% 97.5%\nov_cov_matrix_ni1      1.07      0.931 0.814  1.42\n\nNum. cases = 1192\nPseudo Log-likelihood = -1381 \nPseudo likelihood ratio test = 0.25  on 1 df,\n\n\nAssuming that the Fine and Gray model assumptions hold, the sub-distribution hazard ratio (SHR) for progression for CAP versus CP treatment is 0.81 (95% CI = 0.70, 0.93). This indicates a significant 19% reduction in the sub-distribution hazard - and consequently the cumulative incidence - of progression for those receiving CAP, accounting for the competing risk of death. Furthermore, there was no significant difference in the sub-distribution hazard of death between the groups (HR = 1.07 (95% CI = 0.81, 1.42), after accounting for the competing risk of disease progression. Since the death hazards are similar, the reduction in progression is likely a true treatment effect on the diseases, and not because the CAP group is dying faster.\nFine and Gray PH model assumptions\nSince the Fine and Gray model is essentially a proportional hazards model adapted for the sub-distribution hazard, its assumptions mirror those of the standard Cox model:\n1. Proportional sub-distribution hazards The ratio of the sub-distribution hazards between groups remains constant over time.\n2. Linearity of covariates For continuous variables, the model assumes that the relationship between the covariate and the log sub-distribution hazard is linear.\n3. Independence of administrative censoring The model assumes that administrative censoring (loss to follow-up or study end) is independent of the risk of the event. This is particularly important because the Fine and Gray model uses IPCW weights based on the censoring distribution. If those who are censored are fundamentally different from those who remain, the weights — and therefore the model results — will be biased.\nThe model assumption checks are also similar to those of the Cox model:\n\n\nVisual inspection: Plot the CIFs. If the curves cross, proportionality may be an issue\nSchoenfeld residuals: Just like in a Cox model, you can test the residuals. You can use cox.zph() function from survival package on a Fine and Gray model.\nTime-interaction terms: Include a term in your model for covariate * log(time). If the p-value for this term is significant, the proportionality assumption likely fails.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "1 Competing risks"
    ]
  },
  {
    "objectID": "Flexible2.html",
    "href": "Flexible2.html",
    "title": "2 Flexible parametric survival",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nApply understanding of flexible parametric survival models and competing risks approaches\nUse cause-specific approach to fit flexible parametric survival models\nInterpret transition-specific hazard ratios for covariate effects",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "2 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible2.html#learning-objectives",
    "href": "Flexible2.html#learning-objectives",
    "title": "2 Flexible parametric survival",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nApply understanding of flexible parametric survival models and competing risks approaches\nUse cause-specific approach to fit flexible parametric survival models\nInterpret transition-specific hazard ratios for covariate effects",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "2 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible2.html#flexible-parametric-competing-risks",
    "href": "Flexible2.html#flexible-parametric-competing-risks",
    "title": "2 Flexible parametric survival",
    "section": "2 Flexible parametric & competing risks",
    "text": "2 Flexible parametric & competing risks\nWe have learnt about flexible parametric survival models and competing risks approach. Let’s now apply competing risks approach, similar to what we have learnt from fitting cause-specific Cox models, to flexible parametric survival models.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "2 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Flexible2.html#worked-example",
    "href": "Flexible2.html#worked-example",
    "title": "2 Flexible parametric survival",
    "section": "3 Worked example",
    "text": "3 Worked example\n\n3.1 Data set up\nWe have produced simulated data on 300 individuals who can experience cardiovascular death (state==2) or other death (state==3), and the remainder have been censored (state==0).\n\n\nShow R code\n#load libraries\nlibrary(readr)\nlibrary(mstate)\nlibrary(dplyr)\nlibrary(tidyverse)\nlibrary(flexsurv)\n\n#Read in data\ncvd_death &lt;- read_csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/cvd_death.csv\")\n\n#Tablulate events\ntable(cvd_death$state)\n\n\n\n  0   2   3 \n443 212  95 \n\n\n\n\n3.2 msprep data\nLet’s now run our data through msprep from the mstate package. We need to define our transition matrix and we will subsequently see how our data creates new observation rows for each individual, censoring for the other possible outcome that wasn’t observed and creating a trans variable.\n\n\nShow R code\n#Transition matrix - 2 death outcomes\ntmat &lt;- transMat(x = list(c(2,3), c(), c()), names=c(\"Alive\", \"CVD death\", \"Other death\"))\ntmat\n\n\n             to\nfrom          Alive CVD death Other death\n  Alive          NA         1           2\n  CVD death      NA        NA          NA\n  Other death    NA        NA          NA\n\n\nShow R code\n#Minor adjustments to data prep\ncvd_death &lt;- cvd_death %&gt;% \n  mutate(time = case_when(\n        time&lt;=time0 ~ time0+0.01,\n        time&gt;time0 ~ time\n  ),\n         time_cvdd=time,\n         time_othd=time,\n         status_cvdd=case_when(\n         state==2 & status==1 ~ 1,\n         TRUE ~ 0\n         ),\n         status_othd=case_when(\n         state==3 & status==1 ~ 1,\n         TRUE ~ 0\n         ),\n         )\n\n#Reshape using msprep\ncvd_death_msp &lt;- msprep(data=cvd_death, trans=tmat, time=c(NA, \"time_cvdd\", \"time_othd\"), status=c(NA, \"status_cvdd\", \"status_othd\"), keep=c(\"age\", \"cvd\", \"diab\", \"malesex\", \"ses\", \"trt\"))\n\n\n\n\n3.3 Fit flexsurvspline\nOur data has been prepared in a way that makes it easier for us to fit specific models for each competing event, calling upon the trans variable. Below we have fitted 1 internal knots.\n\n\nShow R code\n#Model factor variables\ncvd_death_msp$ses &lt;- as.factor(cvd_death_msp$ses)\n\n#Age to per 10 years\ncvd_death_msp$age10 &lt;- cvd_death_msp$age/10 #in decades\n\n#Fit separate models for each cause of death\nfs_cvdd &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ age10 + cvd + diab + malesex + ses + trt, data=cvd_death_msp, subset=(trans==1), k=1, scale=\"hazard\")\nfs_cvdd\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ age10 + \n    cvd + diab + malesex + ses + trt, data = cvd_death_msp, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nEstimates: \n         data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0        NA    -4.5331  -5.4737  -3.5926   0.4799       NA        NA\ngamma1        NA     2.0970   1.5104   2.6836   0.2993       NA        NA\ngamma2        NA     0.0447  -0.0294   0.1187   0.0378       NA        NA\nage10     5.4257     0.1697   0.0530   0.2865   0.0596   1.1850    1.0544\ncvd       0.5120     1.6280   1.1551   2.1010   0.2413   5.0939    3.1742\ndiab      0.5640     0.4441   0.0825   0.8057   0.1845   1.5590    1.0860\nmalesex   0.5813     0.2822  -0.0305   0.5948   0.1595   1.3260    0.9700\nses2      0.2000     0.2323  -0.2544   0.7189   0.2483   1.2615    0.7754\nses3      0.2387    -0.0437  -0.5259   0.4386   0.2460   0.9573    0.5910\nses4      0.3373     0.1080  -0.3416   0.5577   0.2294   1.1141    0.7106\ntrt       0.6027    -0.2833  -0.5929   0.0264   0.1580   0.7533    0.5527\n         U95%   \ngamma0        NA\ngamma1        NA\ngamma2        NA\nage10     1.3318\ncvd       8.1746\ndiab      2.2382\nmalesex   1.8127\nses2      2.0522\nses3      1.5505\nses4      1.7467\ntrt       1.0267\n\nN = 750,  Events: 212,  Censored: 538\nTotal time at risk: 939.2144\nLog-likelihood = -389.756, df = 11\nAIC = 801.5121\n\n\nShow R code\nfs_othd &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ age10 + cvd + diab + malesex + ses + trt, data=cvd_death_msp, subset=(trans==2), k=1, scale=\"hazard\")\nfs_othd\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ age10 + \n    cvd + diab + malesex + ses + trt, data = cvd_death_msp, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\nEstimates: \n         data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0         NA   -10.6494  -12.7719   -8.5270    1.0829        NA        NA\ngamma1         NA     1.2414    0.5476    1.9351    0.3540        NA        NA\ngamma2         NA    -0.0249   -0.0920    0.0422    0.0342        NA        NA\nage10      5.4257     1.1208    0.8964    1.3452    0.1145    3.0673    2.4509\ncvd        0.5120    -1.1678   -1.6176   -0.7180    0.2295    0.3111    0.1984\ndiab       0.5640     0.0931   -0.4858    0.6720    0.2954    1.0976    0.6152\nmalesex    0.5813    -0.1697   -0.5987    0.2594    0.2189    0.8439    0.5495\nses2       0.2000     0.7454   -0.3862    1.8769    0.5773    2.1072    0.6797\nses3       0.2387     1.3262    0.2789    2.3735    0.5344    3.7668    1.3217\nses4       0.3373     0.9098   -0.1366    1.9563    0.5339    2.4839    0.8723\ntrt        0.6027    -0.0854   -0.5350    0.3641    0.2294    0.9181    0.5857\n         U95%    \ngamma0         NA\ngamma1         NA\ngamma2         NA\nage10      3.8388\ncvd        0.4877\ndiab       1.9582\nmalesex    1.2962\nses2       6.5333\nses3      10.7354\nses4       7.0728\ntrt        1.4393\n\nN = 750,  Events: 95,  Censored: 655\nTotal time at risk: 939.2144\nLog-likelihood = -197.1684, df = 11\nAIC = 416.3368\n\n\nWe can see the covariates effects differ between those relating to CVD deaths and other deaths. Associated with CVD deaths, we see older age (per 10 years) increases risk of cardiovascular death by nearly 20% (HR: 1.19, 95%CI: 1.05, 1.33), cardiovascular comorbidity by 5 times (HR: 5.09, 95%CI: 3.17, 8.17) and diabetes comorbidity by approximately 50% (HR: 1.56, 95%CI: 1.09, 2.24).\nIn contrast, associated with other death was older age (per 10 years) by over three times (HR: 3.07, 95%CI: 2.45, 3.84), cardiovascular comorbidity reduced risk by 70% (HR: 0.31, 95%CI: 0.20, 0.49). No other covariates were associated with other death.\n\n\n3.4 Binding models\nSince we have two models, one for each cause of death (CVD death and other death), we can bind these two models together. The benefit of this is being able use functions to produce estimates for each outcome, such as cumulative incidence.\n\n\nShow R code\n#Define matrix for each transition\ntmat_fsurv &lt;- rbind(c(NA,1,2), c(NA, NA, NA), c(NA, NA, NA))\ntmat_fsurv\n\n\n     [,1] [,2] [,3]\n[1,]   NA    1    2\n[2,]   NA   NA   NA\n[3,]   NA   NA   NA\n\n\nShow R code\n#Group models together\nfsurv_2dth &lt;- fmsm(fs_cvdd, fs_othd, trans=tmat_fsurv)\nfsurv_2dth\n\n\nState 1 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ age10 + \n    cvd + diab + malesex + ses + trt, data = cvd_death_msp, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nState 1 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ age10 + \n    cvd + diab + malesex + ses + trt, data = cvd_death_msp, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\n\nShow R code\n#AIC for entire model\nAIC(fs_cvdd)+AIC(fs_othd)\n\n\n[1] 1217.849\n\n\nShow R code\nAIC(fsurv_2dth)\n\n\n[1] 1217.849\n\n\n\n\n3.5 Cumulative hazard\nLet’s use our models to produce the cumulative hazard. This can be for the reference levels of the covariates (i.e. no covariate effects) or for certain covariate patterns. We will look at the difference between those with cardiovascular comorbidity, and its relation to cardiovascular deaths and other deaths.\n\n\nShow R code\n#New data to estimate on - ref level\npreddata0 &lt;- data.frame(\n  trt = c(0),\n  age10=c(4),\n  cvd=c(0),\n  diab=c(0),\n  malesex=c(0),\n  ses = c(\"1\"))\n\n#Cumulative intensity function\ncum_haz0&lt;- msfit.flexsurvreg(fsurv_2dth, t=seq(0,5,by=0.2), newdata=preddata0, trans=tmat_fsurv)\n\n#New data to estimate on - cvd comorbidity\npreddata1 &lt;- data.frame(\n  trt = c(0),\n  age10=c(4),\n  cvd=c(1),\n  diab=c(0),\n  malesex=c(0),\n  ses = c(\"1\"))\n\n#Cumulative intensity function - cvd comorbidity\ncum_haz1&lt;- msfit.flexsurvreg(fsurv_2dth, t=seq(0,5,by=0.2), newdata=preddata1, trans=tmat_fsurv)\n\n#Store data into one\nct1 &lt;- cum_haz0$Haz %&gt;% mutate(model = \"No cvd comorbid\")\nct2 &lt;- cum_haz1$Haz %&gt;% mutate(model = \"Cvd comorbid\")\n\nct_all &lt;- bind_rows(ct1, ct2)\nct_all &lt;- ct_all %&gt;% \n  mutate(trans2 = case_when(\n    trans==1 ~ \"CVD death\",\n    trans==2 ~ \"Other death\"  ))\n\n#Graph settings\nmycolor &lt;- c(\"#440154FF\",\"#32648EFF\",\"#21908CFF\",\"#5DC863FF\",\"#DCE318FF\",\"#FFFFFF\")\n\n#Plot - stepped\n#| fig-width: 2\n#| fig-height: 3\nggplot(ct_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_step(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nShow R code\n#Plot - smoothed line\n#| fig-width: 2\n#| fig-height: 3\nggplot(ct_all,\n       aes(x = time,\n           y = Haz,\n           colour = factor(trans2),\n           linetype = model,\n           group = interaction(trans2, model))) +\n  geom_line(size = 1) +\n  scale_colour_manual(values = mycolor[c(2,4, 1)],\n                      name = \"Transition\") +\n  scale_linetype_manual(values = c(\"solid\", \"dashed\"),\n                        name = \" \") +\n  labs(x = \"Years since enrolment\", y = \"Cumulative hazard\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nAs expected, the pattern of the cumulative hazard is similar to the interpretation of the covariates. The cardiovascular comorbidity greatly increases the risk of cardiovascular death, but not so much other death. We also see the cumulative hazard of cardiovascular death is much greater than other deaths.\n\n\n3.6 Transition probability\nLet’s now look at the probability of having CVD death and other death, compared to being alive over follow-up time. You will need to call upon an object from msfit, so those specifications will carry onto the probability estimates.\n\n\nShow R code\n#Probabilities in state - ref level\npr0 &lt;- probtrans(cum_haz0, predt = 0)\npr0[[1]]\n\n\n   time   pstate1      pstate2      pstate3          se1          se2\n1   0.0 1.0000000 0.0000000000 0.0000000000 0.0000000000 0.0000000000\n2   0.2 0.9989827 0.0007225594 0.0002947603 0.0005788817 0.0004507062\n3   0.4 0.9962659 0.0029936629 0.0007404068 0.0015611405 0.0013245713\n4   0.6 0.9920129 0.0066923148 0.0012948163 0.0029717598 0.0026237478\n5   0.8 0.9864149 0.0116402211 0.0019448765 0.0048133088 0.0043553360\n6   1.0 0.9796493 0.0176678790 0.0026827947 0.0070472048 0.0064795258\n7   1.2 0.9718739 0.0246231727 0.0035029566 0.0096172188 0.0089382595\n8   1.4 0.9632277 0.0323715556 0.0044007784 0.0124670287 0.0116738538\n9   1.6 0.9538291 0.0407997549 0.0053711394 0.0155495805 0.0146386036\n10  1.8 0.9437652 0.0498262734 0.0064085648 0.0188329559 0.0178008924\n11  2.0 0.9331065 0.0593855509 0.0075079458 0.0222941408 0.0211383054\n12  2.2 0.9219141 0.0694214545 0.0086644824 0.0259150737 0.0246334892\n13  2.4 0.9102413 0.0798850398 0.0098736354 0.0296806507 0.0282721247\n14  2.6 0.8981359 0.0907329712 0.0111310913 0.0335774285 0.0320416120\n15  2.8 0.8856409 0.1019263779 0.0124327379 0.0375928039 0.0359302352\n16  3.0 0.8727953 0.1134300102 0.0137746447 0.0417145101 0.0399266481\n17  3.2 0.8596353 0.1252116050 0.0151530488 0.0459303246 0.0440195721\n18  3.4 0.8461943 0.1372414016 0.0165643433 0.0502279147 0.0481976322\n19  3.6 0.8325032 0.1494917668 0.0180050688 0.0545947732 0.0524492843\n20  3.8 0.8185912 0.1619369011 0.0194719056 0.0590182108 0.0567627997\n21  4.0 0.8044857 0.1745526055 0.0209616680 0.0634853849 0.0611262872\n22  4.2 0.7902126 0.1873160951 0.0224712993 0.0679833493 0.0655277353\n23  4.4 0.7757963 0.2002058492 0.0239978674 0.0724991154 0.0699550684\n24  4.6 0.7612600 0.2132014877 0.0255385612 0.0770197185 0.0743962075\n25  4.8 0.7466256 0.2262836715 0.0270906872 0.0815322851 0.0788391330\n26  5.0 0.7319143 0.2394340184 0.0286516710 0.0860241001 0.0832719463\n            se3\n1  0.0000000000\n2  0.0003532753\n3  0.0008141183\n4  0.0013894524\n5  0.0020573435\n6  0.0028035820\n7  0.0036186253\n8  0.0044958862\n9  0.0054302131\n10 0.0064172362\n11 0.0074532184\n12 0.0085347814\n13 0.0096587450\n14 0.0108220347\n15 0.0120216297\n16 0.0132545336\n17 0.0145177608\n18 0.0158083320\n19 0.0171232754\n20 0.0184596323\n21 0.0198144640\n22 0.0211848606\n23 0.0225679498\n24 0.0239609065\n25 0.0253609616\n26 0.0267654156\n\n\nShow R code\n#Probabilities in state - cvd comorbidity\npr1 &lt;- probtrans(cum_haz1, predt = 0)\npr1[[1]]\n\n\n   time   pstate1     pstate2      pstate3         se1         se2          se3\n1   0.0 1.0000000 0.000000000 0.000000e+00 0.000000000 0.000000000 0.0000000000\n2   0.2 0.9962276 0.003680665 9.168684e-05 0.002114212 0.002109180 0.0001025110\n3   0.4 0.9845525 0.015217597 2.299254e-04 0.005894640 0.005883694 0.0002264598\n4   0.6 0.9657629 0.033836747 4.003500e-04 0.011274357 0.011257828 0.0003781690\n5   0.8 0.9410287 0.058374085 5.972042e-04 0.018158114 0.018136751 0.0005498925\n6   1.0 0.9115180 0.087665788 8.161767e-04 0.026195239 0.026169854 0.0007357062\n7   1.2 0.8783149 0.120631532 1.053550e-03 0.034953670 0.034925250 0.0009310167\n8   1.4 0.8423924 0.156301622 1.305938e-03 0.044028724 0.043998543 0.0011321921\n9   1.6 0.8045817 0.193848436 1.569909e-03 0.053093420 0.053063097 0.0013362119\n10  1.8 0.7655237 0.232634222 1.842113e-03 0.061918185 0.061889715 0.0015404994\n11  2.0 0.7257485 0.272131988 2.119497e-03 0.070335597 0.070311305 0.0017428744\n12  2.2 0.6857071 0.311893620 2.399300e-03 0.078219718 0.078202190 0.0019414868\n13  2.4 0.6457830 0.351537987 2.679048e-03 0.085475335 0.085467348 0.0021347773\n14  2.6 0.6063015 0.390741930 2.956547e-03 0.092030987 0.092035432 0.0023214509\n15  2.8 0.5675370 0.429233147 3.229871e-03 0.097834479 0.097854292 0.0025004572\n16  3.0 0.5297183 0.466784387 3.497354e-03 0.102849969 0.102888062 0.0026709735\n17  3.2 0.4930339 0.503208533 3.757578e-03 0.107056007 0.107115206 0.0028323876\n18  3.4 0.4576363 0.538354344 4.009356e-03 0.110444101 0.110527092 0.0029842807\n19  3.6 0.4236456 0.572102668 4.251721e-03 0.113017567 0.113126845 0.0031264103\n20  3.8 0.3911531 0.604363026 4.483907e-03 0.114790469 0.114928300 0.0032586913\n21  4.0 0.3602242 0.635070490 4.705337e-03 0.115786582 0.115954968 0.0033811773\n22  4.2 0.3309016 0.664182804 4.915600e-03 0.116038324 0.116238977 0.0034940419\n23  4.4 0.3032078 0.691677715 5.114442e-03 0.115585627 0.115819958 0.0035975597\n24  4.6 0.2771478 0.717550497 5.301746e-03 0.114474787 0.114743891 0.0036920880\n25  4.8 0.2527108 0.741811649 5.477516e-03 0.112757267 0.113061928 0.0037780492\n26  5.0 0.2298734 0.764484751 5.641861e-03 0.110488511 0.110829208 0.0038559145\n\n\nShow R code\n#Store data into one\npr_none &lt;- pr0[[1]] %&gt;% mutate(model = \"No cvd comorbid\")\npr_cvd &lt;- pr1[[1]] %&gt;% mutate(model = \"Cvd comorbid\")\n\n#Plot of probabilities in state\n#| fig-width: 2\n#| fig-height: 3\nmatplot(pr_none$time,\n        pr_none[, grep(\"^pstate\", names(pr_none))],\n        type = \"l\",\n        lwd  = 2,\n        lty  = 1,\n        xlab = \"Years from enrolment\",\n        ylab = \"Probability in state\",\n        col  = mycolor[c(2,4, 1)])\n\nmatlines(pr_cvd$time,\n         pr_cvd[, grep(\"^pstate\", names(pr_cvd))],\n         type = \"l\",\n         lwd  = 2,\n         lty  = 2,\n         col  = mycolor[c(2,4, 1)])\n\n# legend for states (colours)\nlegend(0, 0.8,\n       legend = c(\"Alive\", \"CVD death\", \"Other death\"),\n       col    = mycolor[c(2,4, 1)],\n       lty    = 1,\n       lwd    = 2,\n       bty    = \"n\")\n\n# legend for models (linetypes)\nlegend(0,0.6,\n       legend = c(\"No cvd comorbid\", \"Cvd comorbid\"),\n       lty    = c(1, 2),\n       lwd    = 2,\n       col    = \"black\",\n       bty    = \"n\")",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "2 Flexible parametric survival"
    ]
  },
  {
    "objectID": "intro_R.html",
    "href": "intro_R.html",
    "title": "Introduction to R",
    "section": "",
    "text": "If you have no experience in R, or your programming skills have become rusty, then we strongly recommend that you complete the below self-guided tutorial.\nYou can carry out an interactive R Learnr self-guided tutorial that specifically prepares you for the assumed R skills for this short course. The R Learnr tutorial has four parts. You will need to install R and RStudio on your computer.\nOnce you have RStudio on your computer, you can download the interactive R Learnr tutorial here. You can open it in RStudio and run it by clicking the Run Document button above the tutorial which will turn it into an interactive tutorial which opens up in a new window.\nAlternatively, you can access the interactive R Learnr tutorial completely online here or a static version of the tutorial is available here.\nOther useful resources included:\nUCLA R learning modules\nBasic basics from RLadies",
    "crumbs": [
      "Introduction to R"
    ]
  },
  {
    "objectID": "intro_R.html#getting-started-with-r",
    "href": "intro_R.html#getting-started-with-r",
    "title": "Introduction to R",
    "section": "",
    "text": "If you have no experience in R, or your programming skills have become rusty, then we strongly recommend that you complete the below self-guided tutorial.\nYou can carry out an interactive R Learnr self-guided tutorial that specifically prepares you for the assumed R skills for this short course. The R Learnr tutorial has four parts. You will need to install R and RStudio on your computer.\nOnce you have RStudio on your computer, you can download the interactive R Learnr tutorial here. You can open it in RStudio and run it by clicking the Run Document button above the tutorial which will turn it into an interactive tutorial which opens up in a new window.\nAlternatively, you can access the interactive R Learnr tutorial completely online here or a static version of the tutorial is available here.\nOther useful resources included:\nUCLA R learning modules\nBasic basics from RLadies",
    "crumbs": [
      "Introduction to R"
    ]
  },
  {
    "objectID": "Joint_model.html",
    "href": "Joint_model.html",
    "title": "2 Joint modelling",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand why joint models are needed when time-dependent covariates are internal\n\nDistinguish between extended Cox models and joint models\n\nDescribe the two components of a joint model:\n\na longitudinal submodel (e.g. eGFR over time)\na time-to-event submodel (e.g. graft failure)\n\nExplain how the longitudinal process is linked to the survival process\n\nInterpret key parameters from a joint model\nRecognise situations where joint models provide less biased and more realistic inference",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#learning-objectives",
    "href": "Joint_model.html#learning-objectives",
    "title": "2 Joint modelling",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand why joint models are needed when time-dependent covariates are internal\n\nDistinguish between extended Cox models and joint models\n\nDescribe the two components of a joint model:\n\na longitudinal submodel (e.g. eGFR over time)\na time-to-event submodel (e.g. graft failure)\n\nExplain how the longitudinal process is linked to the survival process\n\nInterpret key parameters from a joint model\nRecognise situations where joint models provide less biased and more realistic inference",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#why-do-we-need-joint-models",
    "href": "Joint_model.html#why-do-we-need-joint-models",
    "title": "2 Joint modelling",
    "section": "2 Why Do We Need Joint Models?",
    "text": "2 Why Do We Need Joint Models?\nIn the extended Cox model, we allowed covariates to change over time. However, this approach relies on a key assumption:\n\nThe time-varying covariate is external\nIts evolution is not influenced by the underlying event process\n\nThis assumption is often unrealistic in medical and public health studies.\n\n\n\n\n\n\nNoteThe Problem of Internal Time-Dependent Covariates\n\n\n\nA time-dependent covariate is internal if:\n\nIt is affected by the same disease process that leads to the event\nIt both predicts the event and is influenced by the event process\n\nA common example in transplantation studies is eGFR:\n\nDeclining eGFR increases the risk of graft failure\nAt the same time, eGFR declines because the graft is failing\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nWhen a time-dependent covariate is internal,\nthe extended Cox model may produce biased estimates.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#why-the-extended-cox-model-is-not-enough",
    "href": "Joint_model.html#why-the-extended-cox-model-is-not-enough",
    "title": "2 Joint modelling",
    "section": "3 Why the Extended Cox Model Is Not Enough",
    "text": "3 Why the Extended Cox Model Is Not Enough\nIn the extended Cox model:\n\nThe longitudinal process (e.g. eGFR) is treated as error-free\nMeasurement error in repeated biomarker values is ignored\nThe feedback between the biomarker and the event is not modelled\n\nAs a result:\n\nThe estimated effect of the biomarker may be biased\nStandard errors may be underestimated\nInterpretation can be misleading\n\n🫘 Graft function declines\n⬇️\n🧪 More clinical tests\n⬇️\n🧫 Lower eGFR measurements\n⬇️\n⚠️ Patient appears riskier\n⬇️\n📈 Effect is exaggerated",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#joint-models",
    "href": "Joint_model.html#joint-models",
    "title": "2 Joint modelling",
    "section": "4 Joint Models",
    "text": "4 Joint Models\nJoint models address these limitations by:\n\nModelling the longitudinal trajectory (e.g. eGFR over time)\nModelling the time-to-event outcome (e.g. graft failure)\nExplicitly linking the two processes\n\nThis allows us to:\n\nAccount for measurement error in the biomarker\nHandle internal time-dependent covariates\nObtain more realistic estimates of risk",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#visual-demonestraion-of-longitudinal-process-egfr-and-survival-process-time-to-graft-lost",
    "href": "Joint_model.html#visual-demonestraion-of-longitudinal-process-egfr-and-survival-process-time-to-graft-lost",
    "title": "2 Joint modelling",
    "section": "5 Visual demonestraion of longitudinal process (eGFR) and survival process (time to graft lost)",
    "text": "5 Visual demonestraion of longitudinal process (eGFR) and survival process (time to graft lost)\nFigure 1: Individual and average eGFR trajectories after kidney transplantation\nThe left panel shows individual longitudinal eGFR trajectories for a subset of transplant recipients, illustrating substantial between-patient heterogeneity in both baseline kidney function and the rate of decline over time. Some patients experience relatively stable eGFR, while others show rapid deterioration, highlighting that kidney function evolves differently across individuals.\nThe right panel displays the average eGFR trajectory by donor type. On average, recipients of living-donor kidneys start with higher eGFR and maintain better kidney function over follow-up compared with recipients of deceased-donor kidneys. However, both groups show a general declining trend over time.\n\n\nShow R code\nlibrary(ggplot2)\nlibrary(dplyr)\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\n\nShow R code\nlibrary(gridExtra)\n\n\n\nAttaching package: 'gridExtra'\n\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\n\nShow R code\ndat_long&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_joint_data.csv\")\n# sample 25 patients for visual clarity\nset.seed(20251113)\nids_sample &lt;- sample(unique(dat_long$id), 25)\n\np_traj &lt;- dat_long %&gt;%\n  filter(id %in% ids_sample) %&gt;%\n  ggplot(aes(x = time, y = egfr, group = id, colour = factor(id))) +\n  geom_line(size = 1.2, alpha = 0.85) +\n  geom_point(size = 2.2, alpha = 0.9) +\n  scale_colour_discrete(guide = \"none\") +  \n  labs(\n    x = \"Time since transplant (years)\",\n    y = \"eGFR (mL/min/1.73m²)\",\n    title = \"Individual eGFR Trajectories (only for 25 ids)\"\n  ) +\n  theme_minimal(base_size = 10) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 8),\n    axis.title = element_text(face = \"bold\")\n  )\n\n\n\n\np_traj_by_donor &lt;- dat_long %&gt;%\n  group_by(donor_type, time) %&gt;%\n  summarise(mean_egfr = mean(egfr), .groups = \"drop\") %&gt;%\n  ggplot(aes(x = time, y = mean_egfr,\n             colour = factor(donor_type),\n             group = donor_type)) +\n  geom_line(size = 1.8) +\n  geom_point(size = 3) +\n  scale_colour_manual(\n    values = c(\"0\" = \"#0072B2\",    # deceased = blue\n               \"1\" = \"#D55E00\"),   # living = red\n    labels = c(\"0\" = \"Deceased donor\",\n               \"1\" = \"Living donor\")\n  ) +\n  labs(\n    x = \"Time since transplant (years)\",\n    y = \"Mean eGFR\",\n    colour = \"Donor type\",\n    title = \"Mean eGFR Trajectory by Donor Type\"\n  ) +\n  theme_minimal(base_size = 8) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 8),\n    axis.title = element_text(face = \"bold\")\n  )\n\n\n\n\n# Arrange side by side\ngrid.arrange(\n  p_traj,\n  p_traj_by_donor,\n  ncol = 2\n)\n\n\n\n\n\n\n\n\n\nFigure 2: Kaplan–Meier curves for time to graft failure\nThe left panel shows the overall Kaplan–Meier curve for time to graft failure, summarising graft survival for all transplant recipients combined. The stepwise nature of the curve reflects the occurrence of graft failure events over follow-up, while the shaded area represents the 95% confidence interval.\nThe right panel presents Kaplan–Meier curves stratified by donor type. A clear separation between the curves is observed over time, indicating differences in graft survival between groups. Recipients of living-donor kidneys consistently show higher graft survival probabilities compared with recipients of deceased-donor kidneys throughout follow-up.\n\n\nShow R code\nlibrary(survival)\nlibrary(broom)\n\ndat_baseline&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_wide_data.csv\")\n\n\n# overall KM\nsurv_obj &lt;- Surv(time = dat_baseline$time, event = dat_baseline$status)\n\nfit_km &lt;- survfit(surv_obj ~ 1)\n\nkm_df &lt;- data.frame(\n  time  = fit_km$time,\n  surv  = fit_km$surv,\n  lower = fit_km$lower,\n  upper = fit_km$upper\n)\n\nKM1&lt;-ggplot(km_df, aes(x = time, y = surv)) +\n  geom_step(linewidth = 1.2, colour = \"#365abd\") +\n  geom_ribbon(aes(ymin = lower, ymax = upper),\n              alpha = 0.2,\n              fill = \"#365abd\") +\n  labs(\n    title = \"Kaplan–Meier Curve for Time to Graft Failure\",\n    x = \"Time since transplant (years)\",\n    y = \"Graft survival probability\"\n  ) +\n  coord_cartesian(ylim = c(0, 1)) +\n  theme_grey(base_size = 8) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 8),\n    panel.grid.minor = element_blank()\n  )\n\n\n\n#KM curve by donor type\nfit_km_donor &lt;- survfit(Surv(time, status) ~ donor_type, data = dat_baseline)\n\nkm_df &lt;- tidy(fit_km_donor)\n\np_km &lt;- km_df %&gt;%\n  mutate(\n    donor_type = factor(strata,\n                        labels = c(\"Deceased donor\", \"Living donor\"))\n  ) %&gt;%\n  ggplot(aes(x = time, y = estimate,\n             colour = donor_type, fill = donor_type)) +\n  geom_step(size = 1.2) +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high),\n              alpha = 0.20, colour = NA) +\n  scale_colour_manual(\n    values = c(\"Deceased donor\" = \"#0072B2\",\n               \"Living donor\"   = \"#D55E00\")\n  ) +\n  scale_fill_manual(\n    values = c(\"Deceased donor\" = \"#0072B2\",\n               \"Living donor\"   = \"#D55E00\")\n  ) +\n  labs(\n    x = \"Time since transplant (years)\",\n    y = \"Graft survival probability\",\n    colour = \"Donor type\",\n    fill = \"Donor type\",\n    title = \"Kaplan–Meier Curves by Donor Type\"\n  ) +\n  theme_minimal(base_size = 8) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 8),\n    axis.title = element_text(face = \"bold\")\n  )\n\n\n\n\n\n# Arrange side by side\ngrid.arrange(\n  KM1,\n  p_km,\n  ncol = 2\n)\n\n\n\n\n\n\n\n\n\nImportantly, these plots illustrate that eGFR is a time-varying, patient-specific process that is closely linked to graft failure risk. Treating eGFR as a fixed baseline covariate or updating it naively in an extended Cox model may be inappropriate, as changes in eGFR can be driven by the underlying disease process itself. This motivates the use of joint models, which explicitly model the longitudinal eGFR process together with the time-to-event outcome.\n\n\n\n\n\n\nNote\n\n\n\nJoint models provide a unified framework for analysing\nlongitudinal measurements and time-to-event outcomes together.\n\nThey allow eGFR to be an internal time-varying covariate\n\nThey account for correlations between eGFR and risk of graft failure\n\nThey handle varying measurement times\n\nThey reduce bias caused by feedback loops\n\nThey improve prediction of graft loss",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#joint-model-specification-linear-mixed-model-cox-model",
    "href": "Joint_model.html#joint-model-specification-linear-mixed-model-cox-model",
    "title": "2 Joint modelling",
    "section": "6 Joint Model Specification (Linear Mixed Model + Cox Model)",
    "text": "6 Joint Model Specification (Linear Mixed Model + Cox Model)\nHere, we focus on a joint model combining a linear mixed-effects model and a Cox proportional hazards model.\nMore generally, the joint modelling framework is highly flexible and can be extended to:\n\na wide range of longitudinal models, including linear and non-linear mixed models, and\n\ndifferent types of survival models, including parametric and semi-parametric models.\n\nThe key idea is that the longitudinal and survival processes are modelled simultaneously and linked through shared subject-specific components.\n\n\n6.1 Longitudinal Submodel (Linear Mixed Effects Model)\nLet \\(y_i(t)\\) be the observed biomarker value (e.g. eGFR) for individual \\(i\\) at time \\(t\\).\nWe model:\n\\[\ny_i(t) = m_i(t) + \\varepsilon_i(t),\n\\qquad \\varepsilon_i(t) \\sim N(0, \\sigma^2)\n\\]\nwhere \\(m_i(t)\\) is the true underlying (latent) biomarker trajectory.\nA common linear mixed model specification is:\n\\[\nm_i(t) = \\beta_0 + \\beta_1 t + \\beta_2^\\top X_i + b_{0i} + b_{1i} t\n\\]\n\n\\(\\beta_0, \\beta_1, \\beta_2\\) are fixed effects\n\\(X_i\\) are baseline covariates (e.g. donor type, age, sex)\n\\(b_{0i}, b_{1i}\\) are random effects (subject-specific deviation)\n\nAssume the random effects follow:\n\\[\n\\begin{pmatrix}\nb_{0i}\\\\\nb_{1i}\n\\end{pmatrix}\n\\sim N\n\\left(\n\\begin{pmatrix}\n0\\\\\n0\n\\end{pmatrix},\nD\n\\right)\n\\]\n\n\n\n6.2 Survival Submodel (Cox Proportional Hazards Model)\nLet \\(T_i\\) be the event time and \\(h_i(t)\\) the hazard for individual \\(i\\) at time \\(t\\).\nThe Cox-type survival model is:\n\\[\nh_i(t \\mid \\mathcal{M}_i(t), Z_i) = h_0(t)\\exp\\left(\\gamma^\\top Z_i + \\alpha\\, f\\{m_i(t)\\}\\right)\n\\]\n\n\\(h_0(t)\\) is the baseline hazard\n\\(Z_i\\) are baseline covariates (can overlap with \\(X_i\\))\n\\(m_i(t)\\) is the latent true biomarker value from the longitudinal model\n\\(\\alpha\\) quantifies the association between the biomarker process and event risk\n\\(f\\{\\cdot\\}\\) defines how the longitudinal process enters the hazard\n\n\n\n\n6.3 The Link Between the Two Processes (Association Structures)\nThe most common choice is the current value association:\n\\[\nh_i(t) = h_0(t)\\exp\\left(\\gamma^\\top Z_i + \\alpha\\, m_i(t)\\right)\n\\]\nInterpretation of \\(\\alpha\\):\nFor a 1-unit higher true underlying biomarker value at time \\(t\\), the hazard changes by:\n\\[\nHR(t) = \\exp(\\alpha)\n\\]\n\n\n\n6.4 Alternative links\n(a) Current value + slope association\n\\[\nh_i(t) = h_0(t)\\exp\\left(\\gamma^\\top Z_i + \\alpha_1 m_i(t) + \\alpha_2 m_i'(t)\\right)\n\\]\nwhere \\(m_i'(t)\\) is the instantaneous rate of change (slope).\n(b) Cumulative (history) association\n\\[\nh_i(t) = h_0(t)\\exp\\left(\\gamma^\\top Z_i + \\alpha \\int_0^t m_i(s)\\,ds\\right)\n\\]\n\n\n\n\n\n\n\nNoteWhy this helps\n\n\n\nUnlike the extended Cox model, the joint model:\n\ntreats the biomarker as a latent process \\(m_i(t)\\) rather than a noisy observed value \\(y_i(t)\\)\naccounts for measurement error\ncorrectly handles internal time-dependent covariates whose evolution is linked to event risk",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#example",
    "href": "Joint_model.html#example",
    "title": "2 Joint modelling",
    "section": "7 Example",
    "text": "7 Example\nThis example demonstrates how to fit a joint model combining a linear mixed-effects model and a Cox proportional hazards model using the dataset we have been working with so far.\nModel components\n\nOutcome: Time to graft failure\n\nExposure: Donor type (living vs deceased)\n\nCovariates:\n\nDonor age\n\nRecipient gender\n\nLongitudinal eGFR measurements\n\n\n\n\nShow R code\nlibrary(dplyr)\nlibrary(survival)\nlibrary(lme4)\n\n\nLoading required package: Matrix\n\n\nShow R code\nlibrary(JMbayes2)\n\n\nLoading required package: nlme\n\n\n\nAttaching package: 'nlme'\n\n\nThe following object is masked from 'package:lme4':\n\n    lmList\n\n\nThe following object is masked from 'package:dplyr':\n\n    collapse\n\n\nLoading required package: GLMMadaptive\n\n\n\nAttaching package: 'GLMMadaptive'\n\n\nThe following object is masked from 'package:lme4':\n\n    negative.binomial\n\n\nLoading required package: splines\n\n\n\nAttaching package: 'JMbayes2'\n\n\nThe following object is masked from 'package:GLMMadaptive':\n\n    mixed_model\n\n\nThe following object is masked from 'package:nlme':\n\n    lme\n\n\nThe following object is masked from 'package:survival':\n\n    coxph\n\n\nShow R code\n#-- data in long format\ndat_long&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_joint_data.csv\")\n\n#--longitudinal model\n\nlme_fit &lt;- lme(\n  egfr ~ time + donor_type + recip_male + donor_age_c,\n  random = ~ time | id,\n  data   = dat_long,\n  na.action = na.omit,\n  control = lmeControl(opt = \"optim\")\n)\n\n#summary(lme_fit)\n\n#---cox model\n#data for the cox model (wide format)\ndat_surv&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_joint_baseline.csv\")\n\ncox_fit &lt;- coxph(\n  Surv(time, status) ~ donor_type + recip_male + donor_age_c,\n  data = dat_surv,\n  x    = TRUE\n)\n\n#summary(cox_fit)\n\n\n#--joint model\n\njm_fit &lt;- jm(\n  cox_fit,\n  lme_fit,\n  time_var = \"time\"   # this is the time variable in dat_long\n)\n\nsummary(jm_fit)\n\n\n\nCall:\nJMbayes2::jm(Surv_object = cox_fit, Mixed_objects = lme_fit, \n    time_var = \"time\")\n\nData Descriptives:\nNumber of Groups: 300       Number of events: 33 (11%)\nNumber of Observations:\n  egfr: 1685\n\n                 DIC     WAIC      LPML\nmarginal    11496.76 11435.38 -5721.705\nconditional 14218.91 14048.51 -7243.756\n\nRandom-effects covariance matrix:\n                    \n       StdDev   Corr\n(Intr) 9.1332 (Intr)\ntime   1.6643 0.1604\n\nSurvival Outcome:\n               Mean  StDev    2.5%   97.5%      P   Rhat\ndonor_type  -1.3961 0.6510 -2.8133 -0.2391 0.0102 1.0502\nrecip_male   0.8670 0.3975  0.1230  1.6640 0.0204 1.0041\ndonor_age_c  0.4566 0.1711  0.1099  0.7875 0.0073 1.0088\nvalue(egfr) -0.0025 0.0153 -0.0319  0.0270 0.8662 1.0039\n\nLongitudinal Outcome: egfr (family = gaussian, link = identity)\n               Mean  StDev    2.5%   97.5%     P   Rhat\n(Intercept) 56.6120 1.0341 54.6252 58.6449 0e+00 1.0023\ntime        -2.4174 0.1551 -2.7217 -2.1117 0e+00 1.0246\ndonor_type   4.0256 1.1316  1.7748  6.2110 7e-04 1.0007\nrecip_male  -3.8387 1.1179 -6.0347 -1.6406 7e-04 1.0003\ndonor_age_c -2.3460 0.4633 -3.2580 -1.4518 0e+00 1.0007\nsigma        4.7351 0.0950  4.5469  4.9236 0e+00 1.0031\n\nMCMC summary:\nchains: 3 \niterations per chain: 3500 \nburn-in per chain: 500 \nthinning: 1 \ntime: 32 sec\n\n\n\n\n\n\n\n\nTipInterpretation\n\n\n\nLongitudinal Submodel: eGFR Trajectory\nThe longitudinal component models the underlying eGFR trajectory over time using a linear mixed-effects model.\n✅ Baseline eGFR (Intercept)\nThe estimated baseline eGFR is approximately 56.6 mL/min/1.73m² (95% CrI: 54.6–58.6), representing the average kidney function at transplant for a reference patient (deceased donor, female, donor age 50).\n✅ Time effect\nThe coefficient for time is −2.42, indicating that eGFR declines by about 2.4 mL/min/1.73m² per year on average.\nThis confirms a progressive deterioration of kidney function over follow-up.\n✅ Donor type\nRecipients of kidneys from living donors start with 4.0 mL/min, higher eGFR levels over time compared with deceased-donor recipients, and maintain better function over time. after adjusting for other factors.\n✅ Recipient gender (male)\nMale recipients have, on average, lower eGFR trajectories by 3.84 units than females over follow-up.\n✅ Donor age\nHigher donor age is associated with lower longitudinal eGFR, suggesting poorer graft function when kidneys are obtained from older donors. For each 10 years older donor (relative to age 50), eGFR is ~2.4 units lower.\n✅ Random effects\nThere is substantial between-patient variability in both baseline eGFR and the rate of change over time, justifying the use of a mixed-effects model.\nSurvival Submodel: Time to Graft Failure\nThe survival component models the hazard of graft failure, linking it to the latent eGFR process from the longitudinal model.\n✅ Association with eGFR (value effect)\nThe coefficient for the current underlying eGFR is negative, indicating that lower true eGFR values are associated with a higher risk of graft failure.\nIn other words, patients with declining kidney function face an increased instantaneous hazard of graft loss. But effect is small (0.0025) and not significant.\n✅ Donor type\nHolding the underlying eGFR trajectory and other covariates constant, recipients of a living-donor kidney have approximately a 75% lower instantaneous hazard of graft failure compared with recipients of a deceased-donor kidney \\(HR = \\exp(-1.396) \\approx 0.25\\).\n✅ Recipient gender (male)\nMale recipients exhibit a 2.38-times higher hazard of graft failure compared with females after adjusting for kidney function and other covariates.\n✅ Donor age\nAfter adjusting for kidney function and other covariates, each 10-year increase in donor age above 50 years is associated with an approximately 58% higher hazard of graft failure.\nOverall - In this joint model, eGFR declines over time and is strongly influenced by donor type, donor age, and recipient sex.\n\nThe association between current eGFR and graft failure hazard is negative—as expected—but small and not strongly supported by the data.\nRandom effects reveal substantial between-patient heterogeneity in baseline eGFR and rate of decline.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "Joint_model.html#prediction-plots",
    "href": "Joint_model.html#prediction-plots",
    "title": "2 Joint modelling",
    "section": "8 Prediction plots",
    "text": "8 Prediction plots\nFigure A presents predicted trajectories for four randomly selected patient IDs, illustrating subject-specific model predictions.\n\nObserved eGFR values (black points)\n\nFitted eGFR trajectory from the longitudinal mixed model (blue line)\n\n95% posterior credible interval for the predicted trajectory (light blue shading)\n\n\n\nShow R code\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(JMbayes2)\n\n# pick 4 ids as examples\nset.seed(123)\nids_example &lt;- sample(unique(dat_long$id), 4)\n\n# restrict to those patients\ndat_long_sub &lt;- dat_long %&gt;%\n  filter(id %in% ids_example) %&gt;%\n  mutate(status = 0L)   \n\n# get subject-specific fitted eGFR at the observed times\npred_long &lt;- predict(\n  jm_fit,\n  newdata        = dat_long_sub,\n  process        = \"longitudinal\",\n  type           = \"subject_specific\",\n  type_pred      = \"response\",\n  control        = list(return_newdata = TRUE)\n)\n\nggplot(pred_long, aes(x = time)) +\n  geom_point(aes(y = egfr, colour = \"Observed\"), alpha = 0.7) +\n  geom_line(aes(y = pred_egfr, colour = \"Fitted\"), linewidth = 1) +\n  geom_ribbon(aes(ymin = low_egfr, ymax = upp_egfr, fill = \"95% CI\"),\n              alpha = 0.15, colour = NA) +\n  facet_wrap(~ id, ncol = 2) +\n  scale_colour_manual(values = c(\"Observed\" = \"black\",\n                                 \"Fitted\"   = \"#1f78b4\")) +\n  scale_fill_manual(values = c(\"95% CI\" = \"#1f78b4\")) +\n  labs(\n    x = \"Time since transplant (years)\",\n    y = \"eGFR (mL/min/1.73m²)\",\n    colour = \"\",\n    fill   = \"\",\n    title  = \"Observed vs fitted eGFR trajectories for ID= 14, 118, 179, 195\"\n  ) +\n  theme_minimal(base_size = 13) +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\nFigure B shows Dynamic joint-model predictions for a randomly selected transplant recipient. The left panel shows the observed longitudinal eGFR measurements (solid points and lines) together with the subject-specific fitted trajectory from the linear mixed model (dashed line). The right panel displays the corresponding dynamic predicted graft survival probability, updated sequentially as new eGFR measurements become available. Shaded areas represent 95% credible intervals.\n\n\nShow R code\nlibrary(nlme)\nlibrary(survival)\nlibrary(JM)\n\n\nLoading required package: MASS\n\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:JMbayes2':\n\n    area\n\n\nThe following object is masked from 'package:GLMMadaptive':\n\n    negative.binomial\n\n\nThe following object is masked from 'package:dplyr':\n\n    select\n\n\nShow R code\nlibrary(animation)\n\n# data\ndat_long &lt;- read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_joint_data.csv\")          # long data with repeated eGFR\ndat_surv &lt;- read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_joint_baseline.csv\")      # wide / baseline survival data\n\n#Make sure factors are factors (important for JM)\ndat_long$donor_type &lt;- factor(dat_long$donor_type)\ndat_surv$donor_type &lt;- factor(dat_surv$donor_type, levels = levels(dat_long$donor_type))\n\n\n\n# Fit longitudinal model (LME)\nlmeFit &lt;- lme(\n  egfr ~ time + donor_type + recip_male + donor_age_c,\n  random   = ~ time | id,\n  data     = dat_long,\n  na.action = na.omit,\n  control  = lmeControl(opt = \"optim\")\n)\n\n#Fit survival model (Cox) \nsurvFit &lt;- coxph(\n  Surv(time, status) ~ donor_type + recip_male + donor_age_c,\n  data = dat_surv,\n  x = TRUE\n)\n\n#Fit joint model (JM) \n## method options include: \"weibull-PH-aGH\", \"piecewise-PH-aGH\", etc.\njointFit &lt;- jointModel(\n  lmeFit, survFit,\n  timeVar = \"time\",\n  method  = \"piecewise-PH-aGH\"\n)\n\n#Choose a patient ID\nset.seed(1)\nid_show &lt;- sample(unique(dat_long$id), 1) #randomly select an ID\n\nid_show&lt;-118 # i selected the ID =118\n\ndataP &lt;- dat_long[dat_long$id == 14, ]\ndataP &lt;- dataP[order(dataP$time), ]\nlen_id &lt;- nrow(dataP)\n\n## A helper time grid for plotting survival curves\ntmax &lt;- max(dat_surv$time, na.rm = TRUE)\n\n\nsaveGIF({\n  for (i in 1:len_id) {\n    \n    ## longitudinal history up to visit i\n    newdat_i &lt;- dataP[1:i, ]\n    \n    ## dynamic survival prediction conditional on history up to i\n    sfit_i &lt;- survfitJM(jointFit, newdata = newdat_i)\n    \n    ## ---- two-panel layout\n    par(mfrow = c(1, 2), mar = c(4.5, 4.5, 3.5, 1))\n    \n    \n    #Panel A: longitudinal data\n    plot(\n      x = newdat_i$time,\n      y = newdat_i$egfr,\n      pch = 16,\n      xlim = range(dataP$time, na.rm = TRUE),\n      ylim = range(dataP$egfr, na.rm = TRUE),\n      xlab = \"Time since transplant (years)\",\n      ylab = \"eGFR (mL/min/1.73m²)\",\n      main = paste0(\"Longitudinal eGFR (ID = \", id_show, \")\\nUp to visit \", i)\n    )\n    lines(newdat_i$time, newdat_i$egfr, lwd = 2)\n    \n    #(Optional) add subject-specific fitted mean from the LME\n    tt &lt;- seq(min(dataP$time), max(dataP$time), length.out = 100)\n    pred_df &lt;- data.frame(\n      id = id_show,\n      time = tt,\n      donor_type  = newdat_i$donor_type[1],\n      recip_male  = newdat_i$recip_male[1],\n      donor_age_c = newdat_i$donor_age_c[1]\n    )\n    yhat &lt;- predict(lmeFit, newdata = pred_df, level = 1)  # subject-specific\n    lines(tt, yhat, lwd = 2, lty = 2)\n    \n    \n    #Panel B: survival prediction\n    plot(\n      sfit_i,\n      estimator = \"mean\",\n      conf.int  = 0.95,\n      fill.area = TRUE,\n      col.area  = \"lightblue\",\n      include.y = FALSE,\n      xlim      = c(0, tmax),\n      xlab      = \"Time since transplant (years)\",\n      ylab      = \"Predicted survival probability\",\n      main      = \"Dynamic survival prediction\"\n    )\n  }\n}, ani.width = 900, ani.height = 420)\n\n\nOutput at: animation.gif\n\n\n[1] TRUE\n\n\nShow R code\n#for showing the gif file in the output no need to run \n#dir.create(\"images\", showWarnings = FALSE)\n#file.rename(\"animation.gif\", \"images/animation.gif\")",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "2 Joint modelling"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html",
    "href": "nonlinear_Cox.html",
    "title": "5 Non-linear Cox",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand the linearity assumption for continuous covariates in the Cox model\nDiagnose violations of linearity using martingale residuals\nFit a nonlinear Cox model using smooth functions\nInterpret nonlinear hazard ratios relative to a reference value\nRecognise when nonlinear Cox models are preferable to standard Cox models",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#learning-objectives",
    "href": "nonlinear_Cox.html#learning-objectives",
    "title": "5 Non-linear Cox",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nUnderstand the linearity assumption for continuous covariates in the Cox model\nDiagnose violations of linearity using martingale residuals\nFit a nonlinear Cox model using smooth functions\nInterpret nonlinear hazard ratios relative to a reference value\nRecognise when nonlinear Cox models are preferable to standard Cox models",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#linearity-assumption-in-the-cox-model",
    "href": "nonlinear_Cox.html#linearity-assumption-in-the-cox-model",
    "title": "5 Non-linear Cox",
    "section": "2 Linearity assumption in the Cox model",
    "text": "2 Linearity assumption in the Cox model\nIn the standard Cox proportional hazards model, continuous covariates are assumed to have a linear effect on the log hazard.\nFor a continuous covariate ( X ), the model assumes:\n\\[\n\\log h(t \\mid X) = \\beta X\n\\]\nThis implies that:\n\nA 1-unit increase in \\(X\\) leads to a constant multiplicative change in the hazard\nThe hazard ratio associated with \\(X\\) is the same across its entire range\n\n\n\n\n\n\n\nWarning\n\n\n\nThe proportional hazards assumption concerns how effects change over time,\nwhereas the linearity assumption concerns how effects change across values of a covariate.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#why-the-linearity-assumption-may-be-unrealistic",
    "href": "nonlinear_Cox.html#why-the-linearity-assumption-may-be-unrealistic",
    "title": "5 Non-linear Cox",
    "section": "3 Why the linearity assumption may be unrealistic",
    "text": "3 Why the linearity assumption may be unrealistic\nIn many biomedical applications, the effect of a continuous variable on risk is not linear.\nExamples include:\n\nKidney function (eGFR)\nBlood pressure\nBiomarker concentrations\nAge\n\nFor example, a decrease in eGFR from 90 to 60 may have a very different impact on risk than a decrease from 60 to 30.\n\n\n\n\n\n\nWarning\n\n\n\nIf the true relationship is nonlinear but we assume linearity,\nthe Cox model can produce biased effect estimates and misleading interpretations.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#diagnosing-nonlinearity-using-martingale-residuals",
    "href": "nonlinear_Cox.html#diagnosing-nonlinearity-using-martingale-residuals",
    "title": "5 Non-linear Cox",
    "section": "4 Diagnosing nonlinearity using martingale residuals",
    "text": "4 Diagnosing nonlinearity using martingale residuals\nOne way to assess the linearity assumption is to examine martingale residuals from a Cox model.\nThe idea is to:\n\nFit a Cox model assuming linear effects\nPlot martingale residuals against the continuous covariate\nLook for systematic patterns\n\n\nA random cloud around zero suggests linearity\nA curved or structured pattern suggests nonlinearity",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#martingale-residuals",
    "href": "nonlinear_Cox.html#martingale-residuals",
    "title": "5 Non-linear Cox",
    "section": "5 Martingale residuals",
    "text": "5 Martingale residuals\nMartingale residuals are defined for each individual and are used to assess the functional form of covariates, particularly the linearity assumption for continuous predictors.\nFor subject \\(i\\), the martingale residual is defined as:\n\\[\nM_i = \\delta_i - \\hat{H}_0(T_i)\\exp(\\hat{\\beta}^\\top X_i)\n\\]\nwhere:\n\n\\(\\delta_i\\) is the event indicator (1 = event, 0 = censored)\n\\(T_i\\) is the observed event or censoring time\n\\(\\hat{H}_0(T_i)\\) is the estimated baseline cumulative hazard\n\\(X_i\\) is the vector of covariates\n\\(\\hat{\\beta}\\) are the estimated regression coefficients\n\nIntuitively:\n\n\\(\\delta_i\\) is what we observed\n\\(\\hat{H}_0(T_i)\\exp(\\hat{\\beta}^\\top X_i)\\) is what the model expected\n\nSo the martingale residual measures the difference between observed and expected number of events.\n\n\n\n\n\n\nNote\n\n\n\nMartingale residuals take values in the range \\((-\\infty, 1]\\) and tend to be highly skewed.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#schoenfeld-residuals-for-comparison",
    "href": "nonlinear_Cox.html#schoenfeld-residuals-for-comparison",
    "title": "5 Non-linear Cox",
    "section": "6 Schoenfeld residuals (for comparison)",
    "text": "6 Schoenfeld residuals (for comparison)\nSchoenfeld residuals are defined only at event times and are used to assess the proportional hazards (PH) assumption, not linearity.\nFor subject \\(i\\) who experiences an event at time \\(t_i\\), the Schoenfeld residual for covariate \\(X_k\\) is:\n\\[\nr_{ik} = X_{ik} - \\mathbb{E}(X_k \\mid t_i)\n\\]\nwhere the expectation is taken over the risk set at time \\(t_i\\).\nSchoenfeld residuals represent the difference between:\n\nThe observed covariate value at the event time\nThe expected covariate value under the fitted Cox model",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#martingale-vs-schoenfeld-residuals",
    "href": "nonlinear_Cox.html#martingale-vs-schoenfeld-residuals",
    "title": "5 Non-linear Cox",
    "section": "7 Martingale vs Schoenfeld residuals",
    "text": "7 Martingale vs Schoenfeld residuals\nThe key differences are:\n\nMartingale residuals\n\nDefined for all individuals\nUsed to assess functional form and linearity\nPlotted against covariate values\n\nSchoenfeld residuals\n\nDefined only at event times\nUsed to assess proportional hazards\nPlotted against time\n\n\n\n\n\n\n\n\nTip\n\n\n\nUse Schoenfeld residuals to check whether effects change over time,\nand martingale residuals to check whether effects are linear in covariate space.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "nonlinear_Cox.html#example-evidence-of-nonlinearity-in-a-cox-model",
    "href": "nonlinear_Cox.html#example-evidence-of-nonlinearity-in-a-cox-model",
    "title": "5 Non-linear Cox",
    "section": "8 Example: Evidence of nonlinearity in a Cox model",
    "text": "8 Example: Evidence of nonlinearity in a Cox model\nWe illustrate the issue of nonlinearity using a continuous predictor (e.g. eGFR).\nWe begin by fitting a standard Cox proportional hazards model that assumes a linear effect of eGFR on the log hazard. Next, look at the Martingale residuals of this fitted model.\n\n\nShow R code\nlibrary(survival)\nlibrary(ggplot2)\n\nnonlinear_data &lt;- read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/nonlinear_cox_data.csv\")\n\ncox_linear &lt;- coxph(\n  Surv(time, status) ~ donor_type + \n                        recipient_sex \n                      + age_rec + egfr0,\n                        data = nonlinear_data\n                        )\n\nmart &lt;- residuals(cox_linear, type = \"martingale\")\n\n#age\nggplot(nonlinear_data, aes(age_rec, mart)) +\n  geom_point(alpha = 0.3) +\n  geom_smooth(se = FALSE, col = \"red\") +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(\n    x = \"Recipient age\",\n    y = \"Martingale residuals\",\n    title = \"Linearity check for age\"\n  )\n\n\n\n\n\n\n\n\n\nShow R code\n#egfr\n\nggplot(nonlinear_data, aes(egfr0, mart)) +\n  geom_point(alpha = 0.3) +\n  geom_smooth(se = FALSE, col = \"blue\") +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(\n    x = \"Baseline eGFR\",\n    y = \"Martingale residuals\",\n    title = \"Linearity check for eGFR\"\n  )\n\n\n\n\n\n\n\n\n\nInterpretation of the martingale residual plot\nIn this plot:\n\nThe points represent martingale residuals\nThe red curve is a smoothed trend (loess/lowess) for age and the blue curve is smoothed trend for eGFR at baseline.\n\n\n\n\n\n\n\nWarning\n\n\n\nIf the effect of eGFR at baseline and age were truly linear on the log hazard scale, we would expect the smooth curve to be approximately flat around zero.\n\n\nInstead, we observe a systematic curved pattern, indicating that the effect of eGFR at baseline and age on graft failure risk is not linear.\nThis suggests that:\n\nThe linearity assumption for eGFR at baseline and age is violated.\nA standard Cox model with a linear eGFR term may be misspecified.\n\n✅ Moving beyond linear effects\nTo accommodate nonlinear relationships between a continuous covariate and the hazard, we can extend the Cox model using smooth functions, such as:\n\nRegression splines\nNatural splines\nPenalised splines\n\nIn the next section, we fit a nonlinear Cox model that allows the effect of eGFR at baseline and age to vary smoothly across its range.\n\n\nShow R code\n#---------nonlinear cox\nlibrary(mgcv)\n\ngam_cox &lt;- gam(\n  time ~ \n    donor_type + recipient_sex +\n    s(age_rec, k = 5, bs = \"tp\") +\n    s(egfr0,   k = 5, bs = \"tp\"),\n  family  = cox.ph(),\n  data    = nonlinear_data,\n  weights = status   # 1 = event, 0 = censored\n)\n\nsummary(gam_cox)\n\n\n\nFamily: Cox PH \nLink function: identity \n\nFormula:\ntime ~ donor_type + recipient_sex + s(age_rec, k = 5, bs = \"tp\") + \n    s(egfr0, k = 5, bs = \"tp\")\n\nParametric coefficients:\n                  Estimate Std. Error z value Pr(&gt;|z|)    \ndonor_typeLiving  -0.46728    0.06765  -6.907 4.96e-12 ***\nrecipient_sexMale -0.06784    0.06529  -1.039    0.299    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n             edf Ref.df Chi.sq p-value    \ns(age_rec) 3.330  3.767  156.9  &lt;2e-16 ***\ns(egfr0)   3.555  3.893  205.5  &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nDeviance explained =  8.5%\n-REML = 5994.9  Scale est. = 1         n = 1500\n\n\nShow R code\nplot(gam_cox)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nwe also could get the prediction plot using ggplot2 as follows:\n✅ eGFR at baseline\nThe effect of baseline eGFR on graft failure is clearly non-linear.\u000bCompared with eGFR = 40 (HR = 1):\n\nVery low eGFR (&lt;30) is associated with a substantially higher hazard, indicating worse kidney function strongly increases risk.\n\neGFR between ~30 and 50 shows risk decreasing, reaching its lowest point around ~50.\n\nHigh eGFR (&gt;50) shows a gradual increase in hazard, suggesting a U-shaped or curved relationship.\n\nThese predictions are for a male recipient receiving a kidney from a deceased donor, at median age.\n\n\nShow R code\nlibrary(ggplot2)\n\n\n\ndf&lt;-nonlinear_data\n\n#age\nage_seq &lt;- seq(min(df$age_rec), max(df$age_rec), length.out = 200)\nnew_age &lt;- data.frame(\n  age_rec       = age_seq,\n  egfr0         = median(df$egfr0),\n  donor_type    = \"Deceased\",\n  recipient_sex = \"Male\"\n)\n\npred &lt;- predict(gam_cox, newdata = new_age, type = \"link\", se.fit = TRUE)\n\n# Reference at age 50\nref_index &lt;- which.min(abs(age_seq - 50))\nref       &lt;- pred$fit[ref_index]\nlogHR     &lt;- pred$fit - ref\n\nplot_age &lt;- data.frame(\n  age_rec = age_seq,\n  HR      = exp(logHR),\n  lo      = exp(logHR - 1.96 * pred$se.fit),\n  hi      = exp(logHR + 1.96 * pred$se.fit)\n)\n\nref_point &lt;- plot_age[ref_index, ]\n\n\n\nggplot(plot_age, aes(x = age_rec, y = HR)) +\n  # CI ribbon\n  geom_ribbon(aes(ymin = lo, ymax = hi),\n              fill = \"#cfe8ff\", alpha = 0.5) +\n  # HR curve\n  geom_line(colour = \"#0072B2\", linewidth = 1.1) +\n  # Horizontal HR=1\n  geom_hline(yintercept = 1, linetype = \"dashed\", colour = \"grey40\") +\n  # Vertical reference at age 50\n  geom_vline(xintercept = 50, linetype = \"dotted\", colour = \"#D55E00\") +\n  # Highlight reference point\n  geom_point(data = ref_point,\n             aes(x = age_rec, y = HR),\n             colour = \"#D55E00\", size = 3) +\n  # Annotation for age 50\n  annotate(\"text\",\n           x = 50, y = max(plot_age$HR, na.rm = TRUE),\n           label = \"Reference age = 50\",\n           colour = \"#D55E00\", angle = 90,\n           vjust = -0.5, hjust = 1.9, size = 3.5) +\n  # New annotation for scenario (male recipient + deceased donor)\n  annotate(\"text\",\n           x = max(plot_age$age_rec),\n           y = min(plot_age$HR),\n           label = \"Predictions for:\\nMale recipient\\nDeceased donor\\neGFR = median \",\n           hjust = 1, vjust = 0,\n           colour = \"grey20\", size = 3.8,\n           fontface = \"italic\") +\n  labs(\n    title = \"Non-linear hazard ratio for recipient age (vs age = 50)\",\n    x     = \"Recipient age (years)\",\n    y     = \"Hazard ratio\"\n  ) +\n  theme_minimal(base_size = 13) +\n  theme(\n    plot.title   = element_text(face = \"bold\", hjust = 0.5),\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\n✅ Age\nThe effect of recipient age on graft failure is strongly non-linear. Compared with a 50-year-old recipient (HR = 1):\n\nYounger adults (&lt;40) have a slightly lower hazard, but the protective effect is modest.\n\nAges 50–60 show a gradual increase in hazard.\n\nOlder ages (&gt;60) display a rapid, accelerating increase in hazard, with much higher risk by age 75–80.\n\nThese predictions are for a male recipient receiving a kidney from a deceased donor, at median of eGFR.\n\n\nShow R code\n#egfr\negfr_seq &lt;- seq(min(df$egfr0), max(df$egfr0), length.out = 200)\n\nnew_egfr &lt;- data.frame(\n  age_rec       = median(df$age_rec),\n  egfr0         = egfr_seq,\n  donor_type    = \"Deceased\",\n  recipient_sex = \"Male\"\n)\n\npred2 &lt;- predict(gam_cox, newdata = new_egfr, type = \"link\", se.fit = TRUE)\n\n# Reference at eGFR = 40\nref_index2 &lt;- which.min(abs(egfr_seq - 40))\nref2       &lt;- pred2$fit[ref_index2]\nlogHR2     &lt;- pred2$fit - ref2\n\nplot_egfr &lt;- data.frame(\n  egfr0 = egfr_seq,\n  HR    = exp(logHR2),\n  lo    = exp(logHR2 - 1.96 * pred2$se.fit),\n  hi    = exp(logHR2 + 1.96 * pred2$se.fit)\n)\n\nref_point2 &lt;- plot_egfr[ref_index2, ]\n\nlibrary(ggplot2)\n\nggplot(plot_egfr, aes(x = egfr0, y = HR)) +\n  # CI ribbon\n  geom_ribbon(aes(ymin = lo, ymax = hi),\n              fill = \"#fde0dd\", alpha = 0.5) +\n  # HR curve\n  geom_line(colour = \"#D81B60\", linewidth = 1.1) +\n  # Horizontal HR=1 line\n  geom_hline(yintercept = 1, linetype = \"dashed\", colour = \"grey40\") +\n  # Vertical line at eGFR=40\n  geom_vline(xintercept = 40, linetype = \"dotted\", colour = \"#1B9E77\") +\n  # Highlight reference point\n  geom_point(data = ref_point2,\n             aes(x = egfr0, y = HR),\n             colour = \"#1B9E77\", size = 3) +\n  # Annotation for reference\n  annotate(\"text\",\n           x = 40, y = max(plot_egfr$HR, na.rm = TRUE),\n           label = \"Reference eGFR = 40\",\n           colour = \"#1B9E77\", angle = 90,\n           vjust = 0.001, hjust = 0.5, size = 3.5) +\n  # Scenario annotation\n  annotate(\"text\",\n           x = max(plot_egfr$egfr0),\n           y = min(plot_egfr$HR),\n           label = \"Predictions for:\\nMale recipient\\nDeceased donor\\nAge = median\",\n           hjust = 1, vjust = 0,\n           colour = \"grey20\", size = 3.8,\n           fontface = \"italic\") +\n  labs(\n    title = \"Non-linear hazard ratio for baseline eGFR (vs eGFR = 40)\",\n    x     = \"Baseline eGFR (mL/min/1.73m²)\",\n    y     = \"Hazard ratio\"\n  ) +\n  theme_minimal(base_size = 13) +\n  theme(\n    plot.title   = element_text(face = \"bold\", hjust = 0.5),\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTipInterpretation of covariate effects (linear components)\n\n\n\n✅ Donor type (living vs deceased)\nHR = 0.63, P &lt; 0.001, Statistically significant.\nRecipients of a living donor kidney have approximately a 37% lower hazard of graft failure compared with recipients of deceased-donor kidneys, indicating a strong protective effect.\n✅ Recipient sex (female vs male)\nHR = 1.07, P = 0.299, Not statistically significant.\nFemale recipients show a slightly higher estimated hazard compared with males, but this difference is not statistically significant, and there is no strong evidence of a sex effect on graft failure risk.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "5 Non-linear Cox"
    ]
  },
  {
    "objectID": "OverviewD2.html",
    "href": "OverviewD2.html",
    "title": "Day 2",
    "section": "",
    "text": "Welcome to Day 2 of the Advanced Survival Concepts and Analysis short course for 2026.\nIn today’s topics we will learn about:\n- Competing risks models\n- Flexible parametric survival modelling (second lecture)\n- Multi-state modelling\nWe will cover the theorectical concepts and practical applications. You will also have take-home exercises to practise the concepts on data in your own time and at your own pace.\nWe are building upon the advanced survival concepts and analysis we have covered in Day 1.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state"
    ]
  },
  {
    "objectID": "OverviewD2.html#todays-topics",
    "href": "OverviewD2.html#todays-topics",
    "title": "Day 2",
    "section": "",
    "text": "Welcome to Day 2 of the Advanced Survival Concepts and Analysis short course for 2026.\nIn today’s topics we will learn about:\n- Competing risks models\n- Flexible parametric survival modelling (second lecture)\n- Multi-state modelling\nWe will cover the theorectical concepts and practical applications. You will also have take-home exercises to practise the concepts on data in your own time and at your own pace.\nWe are building upon the advanced survival concepts and analysis we have covered in Day 1.",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state"
    ]
  },
  {
    "objectID": "OverviewD2.html#by-the-end-of-today",
    "href": "OverviewD2.html#by-the-end-of-today",
    "title": "Day 2",
    "section": "2 By the end of today",
    "text": "2 By the end of today\nHave a read of Day 2 wrap-up. We would expect you to have a working understanding of:\n\nCompeting risks scenarios and modelling approaches\nFlexible parametric approaches to competing risks and other scenarios\nConstructing multi-state models and interpretation for more than two states and recurrent events",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state"
    ]
  },
  {
    "objectID": "OverviewD2.html#extended-concepts",
    "href": "OverviewD2.html#extended-concepts",
    "title": "Day 2",
    "section": "3 Extended concepts",
    "text": "3 Extended concepts\nThere are many further advanced survival concepts that are related or go beyond what we are able to cover in our short course. We encourage you to look at further resources or expand your knowledge these other concepts:\n\nFrailty survival models\nHierarchical and mixture models\nBayesian survival models\nMarkov models\nRelative survival\nCausal techniques in survival",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state"
    ]
  },
  {
    "objectID": "PH_assump.html",
    "href": "PH_assump.html",
    "title": "1 PH assumption violated",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nRecognise when the proportional hazards (PH) assumption is violated\nUnderstand different strategies to handle non-PH:\n\nStratified Cox model\nTime-varying effects\nExtended Cox with time-varying covariates\n\nUnderstand when a joint model is needed",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#learning-objectives",
    "href": "PH_assump.html#learning-objectives",
    "title": "1 PH assumption violated",
    "section": "",
    "text": "Note\n\n\n\nBy the end of this lecture, you should be able to:\n\nRecognise when the proportional hazards (PH) assumption is violated\nUnderstand different strategies to handle non-PH:\n\nStratified Cox model\nTime-varying effects\nExtended Cox with time-varying covariates\n\nUnderstand when a joint model is needed",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#reminder-proportional-hazards-assumption",
    "href": "PH_assump.html#reminder-proportional-hazards-assumption",
    "title": "1 PH assumption violated",
    "section": "2 Reminder: Proportional Hazards Assumption",
    "text": "2 Reminder: Proportional Hazards Assumption\nThe Cox model assumes that hazard ratios are constant over time.\nThis means that if one group has higher risk than another at the beginning, it has the same relative risk later in follow-up.\n\n\n\n\n\n\nNote\n\n\n\nIf this assumption does not hold, the estimated hazard ratio from a standard Cox model may be misleading.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#what-if-proportional-hazards-does-not-hold",
    "href": "PH_assump.html#what-if-proportional-hazards-does-not-hold",
    "title": "1 PH assumption violated",
    "section": "3 What If Proportional Hazards Does Not Hold?",
    "text": "3 What If Proportional Hazards Does Not Hold?\nThere are several approaches when PH is violated:\n\nStratified Cox model: allow baseline hazards to differ by group.\nInclude time-varying effect: model changing effects over time, include interaction between covariate and time (e.g. \\(𝑥×𝑡\\)).\nUse extended Cox model: allow a covariate’s value itself to change over time.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#stratified-cox-model",
    "href": "PH_assump.html#stratified-cox-model",
    "title": "1 PH assumption violated",
    "section": "4 Stratified Cox model",
    "text": "4 Stratified Cox model\nWhen the proportional hazards (PH) assumption is violated for a categorical variable, one option is a stratified Cox model.\nA stratified Cox model can be written as:\n\\[\nh_s(t \\mid X) = h_{0s}(t)\\,\\exp(\\beta_1 X_1 + \\beta_2 X_2 + \\cdots)\n\\]\nwhere:\n\n\\(s\\) is the stratum (e.g. donor type)\n\\(h_{0s}(t)\\) is the baseline hazard for stratum \\(s\\)\n\\(X_1, X_2, \\ldots\\) are other covariates\n\nWhat does stratification mean?\nIf we stratify on a variable (e.g. donor type):\n\nWe do not estimate a single hazard ratio for the stratifying variable anymore\n(we are not saying “living vs deceased = HR 0.7”)\nThe stratifying variable is used only to define strata\nEach stratum is allowed to have a different baseline risk trajectory over time\n\nIn words:\n\nPatients with living donors and patients with deceased donors are allowed to have completely different baseline hazards over time.\n\nWhat is still estimated?\nWe still estimate the effects of other covariates (e.g. donor age, recipient sex, eGFR at transplant), assuming those effects are proportional within each stratum.\n\n\n\n\n\n\nNote\n\n\n\nStratification is useful when a variable strongly affects baseline risk but does not satisfy the PH assumption.\n\n\nStratification can be thought of as:\n\n“Parallel Cox models with different baseline hazards, but the same slopes for the other covariates.”\n\nThat is, each group has its own baseline risk over time, but covariate effects are assumed to be the same across groups.\n\n\n\n\n\n\nTipWhen to Use It\n\n\n\n✅ When to use stratification Use stratification when:\n\nThe proportional hazards (PH) violation is mainly driven by one categorical variable (e.g. donor type)\nYou still want to adjust for this variable\nBut you do not need its hazard ratio as a main result\n\nIn this case, the variable is used to define strata rather than being estimated as a coefficient.\n❌ When not to use stratification Do not use stratification when:\n\nThe stratifying variable is your primary exposure of interest\nYou need to report a hazard ratio comparing groups\n\nBecause once you stratify on a variable (e.g. donor type), you no longer obtain a single hazard ratio comparing those groups.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#example-handling-non-proportional-hazards-using-stratified-cox-model",
    "href": "PH_assump.html#example-handling-non-proportional-hazards-using-stratified-cox-model",
    "title": "1 PH assumption violated",
    "section": "5 Example: Handling Non-Proportional Hazards Using Stratified Cox Model",
    "text": "5 Example: Handling Non-Proportional Hazards Using Stratified Cox Model\nWe are interested in whether time to graft failure after kidney transplantation differs by donor type (living vs deceased), after adjusting for important clinical factors.\nWe begin by fitting a standard Cox proportional hazards model, then check the PH assumption. If the PH assumption is violated for any categorical covariate in the model, we refit the model using stratification by that covariate.\n\n\nShow R code\nlibrary(survival)\n\nstratified_kidney_data&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/stratified_kidney_data.csv\")\n\ncox_standard &lt;- coxph(\n  Surv(time, status) ~ donor_type +\n    donor_age +\n    recipient_gender +\n    egfr_baseline,\n  data = stratified_kidney_data\n)\n\n#summary(cox_standard)\n\n#check the PH assumption first \nph_test &lt;- cox.zph(cox_standard)\nph_test\n\n\n                  chisq df       p\ndonor_type       28.127  1 1.1e-07\ndonor_age         0.118  1    0.73\nrecipient_gender  1.156  1    0.28\negfr_baseline     1.498  1    0.22\nGLOBAL           30.955  4 3.1e-06\n\n\nShow R code\nplot(ph_test)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nA small p-value indicates evidence against the proportional hazards assumption.\n\n\nInterpretation of PH diagnostics\nThe proportional hazards assumption is violated for donor type.\nOther covariates do not show strong evidence of violation.\nThe global test is significant, indicating overall non-proportionality.\nThis suggests that the effect of donor type on graft failure risk changes over time, making the standard Cox model inappropriate.\nStratified Cox model\nTo address this violation, we fit a stratified Cox model, stratifying on donor type.\n\n\nShow R code\nlibrary(survival)\ncox_strat &lt;- coxph(\nSurv(time, status) ~ donor_age + recipient_gender + egfr_baseline +\nstrata(donor_type),\ndata = stratified_kidney_data\n)\n\nsummary(cox_strat)\n\n\nCall:\ncoxph(formula = Surv(time, status) ~ donor_age + recipient_gender + \n    egfr_baseline + strata(donor_type), data = stratified_kidney_data)\n\n  n= 400, number of events= 171 \n\n                          coef exp(coef)  se(coef)      z Pr(&gt;|z|)   \ndonor_age             0.011126  1.011188  0.007488  1.486  0.13735   \nrecipient_gendermale  0.454309  1.575084  0.154436  2.942  0.00326 **\negfr_baseline        -0.014757  0.985351  0.006905 -2.137  0.03258 * \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                     exp(coef) exp(-coef) lower .95 upper .95\ndonor_age               1.0112     0.9889    0.9965    1.0261\nrecipient_gendermale    1.5751     0.6349    1.1637    2.1319\negfr_baseline           0.9854     1.0149    0.9721    0.9988\n\nConcordance= 0.574  (se = 0.023 )\nLikelihood ratio test= 14.83  on 3 df,   p=0.002\nWald test            = 14.66  on 3 df,   p=0.002\nScore (logrank) test = 14.83  on 3 df,   p=0.002\n\n\n\n\n\n\n\n\nNote\n\n\n\n\nWe no longer estimate a hazard ratio for donor type.\nDonor type is now used only to define separate baseline hazards.\nEffects of other covariates are assumed proportional within each stratum.\n\n\n\n\n\n\n\n\n\nTipInterpretation\n\n\n\nWithin each donor type (living and deceased), we interpret covariate effects as follows:\n✅ Donor age\nHR ≈ 1.01 (95% CI: 0.997–1.03, P-value=0.14), Not statistically significant.\nWithin each donor type, donor age shows no strong association with graft failure.\n✅ Recipient gender (male)\nHR ≈ 1.58 (95% CI: 1.16–2.13, P-value=0.003), Statistically significant. Male recipients have about 58% higher hazard of graft failure compared to females This comparison is within donor type, adjusting for donor age and eGFR.\n✅ eGFR at transplant\nHR ≈ 0.99 (95% CI: 0.97–1.00, P-value=0.033), Statistically significant. Each 1-unit increase in baseline eGFR is associated with about 1–2% lower hazard of graft failure, within each donor type. To improve interpretability, we can express the effect per 10-unit increase in eGFR:\n\\[\nHR_{10\\text{-unit}} = 0.99^{10} \\approx 0.90\n\\]\nInterpretation:\nWithin each donor type, a 10-unit higher eGFR at the time of transplant is associated with approximately a 10% lower hazard of graft failure, after adjusting for donor age and recipient gender.\n\n\n\n\n\n\n\n\nTipWhat about donor type?\n\n\n\nStratifying by donor type allows each group to have its own baseline hazard curve, effectively removing the need to assume a constant hazard ratio over time.\nThe curves demonstrate that living and deceased donor grafts follow different survival trajectories — exactly what we expect when the PH assumption is violated.\n\n\n\n\nShow R code\n# cox_strat is the stratified cox model we fitted in previous chunk \nsf_strat &lt;- survfit(cox_strat)\n\n# Convert survfit to a tidy data frame for ggplot\nsf_df &lt;- data.frame(\n  time  = sf_strat$time,\n  surv  = sf_strat$surv,\n  lower = sf_strat$lower,\n  upper = sf_strat$upper,\n  strata = rep(names(sf_strat$strata), sf_strat$strata)\n)\n\n# Clean up the stratum labels from \"donor_type=deceased\" → \"deceased\"\nsf_df$strata &lt;- sub(\"donor_type=\", \"\", sf_df$strata)\n\nlibrary(ggplot2)\n\nstratified_cox_plot&lt;-ggplot(sf_df, aes(x = time, y = surv, colour = strata)) +\n  geom_step(linewidth = 1.2) +\n  geom_ribbon(aes(ymin = lower, ymax = upper, fill = strata),\n              alpha = 0.15, linewidth = 0) +\n  scale_colour_manual(values = c(\"deceased\" = \"#365abd\",  # deep blue\n                                 \"living\"   = \"#c0397e\"))+ # magenta/rose\n\n  scale_fill_manual(values = c(\"deceased\" = \"#365abd\",\n                               \"living\"   = \"#c0397e\")) +\n  labs(\n    title = \"Stratified Cox Model\\nDifferent Baseline Hazards by Donor Type\",\n    x = \"Time since transplant (years)\",\n    y = \"Predicted survival probability\",\n    colour = \"Donor type\",\n    fill   = \"Donor type\"\n  ) +\n  coord_cartesian(ylim = c(0.4, 1)) +\n  theme_grey(base_size = 14) +\n  theme(\n    plot.title       = element_text(face = \"bold\", hjust = 0.5),\n    legend.position  = \"bottom\",\n    legend.title     = element_text(face = \"bold\")\n  )\n\nstratified_cox_plot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarningWhy Ignoring PH Violations Can Be Misleading\n\n\n\nIf we ignore the violation of the proportional hazards (PH) assumption and proceed with a standard Cox model, we may obtain a single hazard ratio that does not accurately reflect how risk changes over time.\nThis can lead to misleading conclusions, as the estimated effect represents an average over follow-up rather than the true time-varying relationship.\nThis is illustrated in the plot below, where the separation between groups is clearly not constant over time.\n\n\n\n\nShow R code\n#data preparation for plot \n\nnew_deceased &lt;- data.frame(\n  donor_type = factor(\"deceased\", levels = levels(as.factor(stratified_kidney_data$donor_type))),\n  donor_age = mean(stratified_kidney_data$donor_age, na.rm = TRUE),\n  recipient_gender = factor(\"female\", levels = levels(as.factor(stratified_kidney_data$recipient_gender))),\n  egfr_baseline = mean(stratified_kidney_data$egfr_baseline, na.rm = TRUE)\n)\n\nnew_living &lt;- data.frame(\n  donor_type = factor(\"living\", levels = levels(as.factor(stratified_kidney_data$donor_type))),\n  donor_age = mean(stratified_kidney_data$donor_age, na.rm = TRUE),\n  recipient_gender = factor(\"female\", levels = levels(as.factor(stratified_kidney_data$recipient_gender))),\n  egfr_baseline = mean(stratified_kidney_data$egfr_baseline, na.rm = TRUE)\n)\n\n\n\n\n\nsf_deceased &lt;- survfit(cox_standard, newdata = new_deceased)\nsf_living   &lt;- survfit(cox_standard, newdata = new_living)\n\n\ndf_dec &lt;- data.frame(\n  time       = sf_deceased$time,\n  surv       = sf_deceased$surv,\n  lower      = sf_deceased$lower,\n  upper      = sf_deceased$upper,\n  donor_type = \"Deceased donor\"\n)\n\ndf_liv &lt;- data.frame(\n  time       = sf_living$time,\n  surv       = sf_living$surv,\n  lower      = sf_living$lower,\n  upper      = sf_living$upper,\n  donor_type = \"Living donor\"\n)\n\n\ndf_ph &lt;- rbind(df_dec, df_liv)\n\n\n\n\nstandard_cox_plot&lt;-ggplot(df_ph, aes(x = time, y = surv, colour = donor_type, fill = donor_type)) +\n  # CI ribbon\n  geom_ribbon(aes(ymin = lower, ymax = upper),\n              alpha = 0.2,\n              colour = NA,\n              show.legend = FALSE) +\n  # Step survival curve\n  geom_step(linewidth = 1.2) +\n  \n  # Manual colours for consistency across slides\n  scale_colour_manual(\n    values = c(\"Deceased donor\" = \"#365abd\",   # blue\n               \"Living donor\"   = \"#c0397e\")   # magenta/rose\n  ) +\n  scale_fill_manual(\n    values = c(\"Deceased donor\" = \"#365abd\",\n               \"Living donor\"   = \"#c0397e\")\n  ) +\n  \n  # Axis labels and title\n  labs(\n    title = \"Standard Cox PH Model\\nAssumes Constant Effect of Donor Type\",\n    x = \"Time since transplant (years)\",\n    y = \"Predicted survival probability\",\n    colour = \"Donor type\"\n  ) +\n  \n  # y-axis from 0.4 to 1.0\n  coord_cartesian(ylim = c(0.4, 1.0)) +\n  \n  # Use grey theme with gridlines\n  theme_grey(base_size = 14) +\n  theme(\n    plot.title       = element_text(face = \"bold\", hjust = 0.5),\n    legend.position  = \"bottom\",\n    legend.title     = element_text(face = \"bold\")\n  )\n\n\n\n\n \nlibrary(gridExtra)\nlibrary(ggplot2)\n\n# Reduce title size for each plot\nstandard_cox_plot_small &lt;- standard_cox_plot +\n  theme(plot.title = element_text(size = 10))\n\nstratified_cox_plot_small &lt;- stratified_cox_plot +\n  theme(plot.title = element_text(size = 10))\n\n# Arrange side by side\ngrid.arrange(\n  standard_cox_plot_small,\n  stratified_cox_plot_small,\n  ncol = 2\n)",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#including-time-varying-effects",
    "href": "PH_assump.html#including-time-varying-effects",
    "title": "1 PH assumption violated",
    "section": "6 Including Time-Varying Effects",
    "text": "6 Including Time-Varying Effects\nWhen the proportional hazards (PH) assumption is violated, stratification is not the only solution.\nIn some settings, we still want to:\n\nKeep the covariate in the model\nObtain an explicit effect estimate\nAllow the effect to change over time\n\nThis leads to a time-varying coefficient Cox model.\nWhen to Use Time-Varying Effects\nUse a time-varying effect when:\n\nThe PH assumption is violated for a variable (e.g. donor type)\nThe variable is scientifically important\nYou believe the effect itself changes over time\n\nFor example:\n\nEarly after transplant, living donors may be protective\nLater, that advantage may diminish or reverse\n\nModel Idea\nIn the standard Cox model:\n\\[\nh(t \\mid X) = h_0(t)\\exp(\\beta_1 X_1 + \\beta_2 X_2 + \\cdots)\n\\]\nthe coefficients (\\(\\beta\\)) are assumed to be constant over time, which leads to the proportional hazards (PH) assumption.\nIf a covariate’s effect changes over time, we can allow its coefficient to depend on time:\n\\[\nh(t \\mid X) = h_0(t)\\exp\\left(\\beta_1(t) X_1 + \\beta_2 X_2 + \\cdots\\right)\n\\]\nThis allows the hazard ratio for \\(X_1\\) to vary with time.\n\n\n\n\n\n\nNoteIntuition\n\n\n\nInstead of assuming the two groups keep the same relative risk forever,\nwe allow the risk difference between groups to change over time.\n\n\n\n\n\n\n\n\nTipWhen to Use It\n\n\n\n\nYou detect a proportional hazards (PH) violation for a variable (e.g. donor type) but you still want an explicit effect estimate, rather than stratifying it away.\nFor example:\n\nEarly after transplant, living donors may be protective\nLater, that advantage may diminish or reverse",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#example-time-varying-effect-of-donor-type",
    "href": "PH_assump.html#example-time-varying-effect-of-donor-type",
    "title": "1 PH assumption violated",
    "section": "7 Example: Time-Varying Effect of Donor Type",
    "text": "7 Example: Time-Varying Effect of Donor Type\nWe return to the kidney transplant example:\n\nOutcome: time to graft failure\n\nExposure: donor type (living vs deceased)\n\nCovariates: donor age, recipient gender, baseline eGFR\n\nPreviously, we showed that donor type violates the PH assumption.\nWe introduce an interaction between the covariate and time, most commonly:\n\ndonor type × log(time)\n\ndonor type × time\n\nThis allows the model to estimate how the effect changes with time.\nThe Cox model becomes:\n\\[\nh(t) = h_0(t)\\exp\\left[\\beta_1 \\,\\text{donor\\_type} + \\beta_2 \\left(\\text{donor\\_type} \\times \\log(t)\\right) + \\cdots \\right]\n\\]\nWhere:\n\n\\(\\beta_1\\) represents the baseline (early) effect of donor type\n\n\\(\\beta_2\\) represents how that effect changes over time\n\n\n\nShow R code\nlibrary(survival)\n\nkidney_violate &lt;- read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/stratified_kidney_data.csv\")\n\nkidney_violate$donor_live &lt;- ifelse(kidney_violate$donor_type == \"living\", 1, 0)\n\ncox_timevary &lt;- coxph(\n  Surv(time, status) ~ donor_live +\n    donor_age +\n    recipient_gender +\n    egfr_baseline +\n    tt(donor_live),\n  data = kidney_violate,\n  tt = function(x, t, ...) {\n    x * log(t + 0.01)\n  }\n)\n\nsummary(cox_timevary)\n\n\nCall:\ncoxph(formula = Surv(time, status) ~ donor_live + donor_age + \n    recipient_gender + egfr_baseline + tt(donor_live), data = kidney_violate, \n    tt = function(x, t, ...) {\n        x * log(t + 0.01)\n    })\n\n  n= 400, number of events= 171 \n\n                          coef exp(coef)  se(coef)      z Pr(&gt;|z|)    \ndonor_live           -0.693440  0.499853  0.360232 -1.925  0.05423 .  \ndonor_age             0.011064  1.011126  0.007485  1.478  0.13935    \nrecipient_gendermale  0.455043  1.576241  0.154407  2.947  0.00321 ** \negfr_baseline        -0.014874  0.985236  0.006917 -2.150  0.03152 *  \ntt(donor_live)        1.261201  3.529659  0.252705  4.991 6.01e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                     exp(coef) exp(-coef) lower .95 upper .95\ndonor_live              0.4999     2.0006    0.2467    1.0127\ndonor_age               1.0111     0.9890    0.9964    1.0261\nrecipient_gendermale    1.5762     0.6344    1.1646    2.1333\negfr_baseline           0.9852     1.0150    0.9720    0.9987\ntt(donor_live)          3.5297     0.2833    2.1509    5.7921\n\nConcordance= 0.681  (se = 0.02 )\nLikelihood ratio test= 77.42  on 5 df,   p=3e-15\nWald test            = 64.54  on 5 df,   p=1e-12\nScore (logrank) test = 75.7  on 5 df,   p=7e-15\n\n\n\n\n\n\n\n\nNote\n\n\n\n\ndonor_live represents the baseline effect\ntt(donor_live) allows the effect to change with time\n\\(\\log(t)\\) captures gradual, nonlinear change\n\n\n\n\nVisualising the Time-Varying Hazard Ratio\n\n\nShow R code\nlibrary(ggplot2)\n\nb &lt;- coef(cox_timevary)\nv &lt;- vcov(cox_timevary)\n\nbeta1 &lt;- b[\"donor_live\"]\nbeta2 &lt;- b[\"tt(donor_live)\"]\n\nvar_beta1 &lt;- v[\"donor_live\", \"donor_live\"]\nvar_beta2 &lt;- v[\"tt(donor_live)\", \"tt(donor_live)\"]\ncov_b1b2  &lt;- v[\"donor_live\", \"tt(donor_live)\"]\n\nt_seq &lt;- seq(0.5, 8, by = 0.1)\nlog_t &lt;- log(t_seq + 0.01)\n\nlp &lt;- beta1 + beta2 * log_t\nvar_lp &lt;- var_beta1 + (log_t^2) * var_beta2 + 2 * log_t * cov_b1b2\nse_lp &lt;- sqrt(var_lp)\n\nhr_df &lt;- data.frame(\n  time  = t_seq,\n  HR    = exp(lp),\n  lower = exp(lp - 1.96 * se_lp),\n  upper = exp(lp + 1.96 * se_lp)\n)\n\nggplot(hr_df, aes(x = time, y = HR)) +\n  geom_ribbon(aes(ymin = lower, ymax = upper),\n              alpha = 0.2, fill = \"#c75b87\") +\n  geom_line(linewidth = 1.2, colour = \"#c75b87\") +\n  geom_hline(yintercept = 1,\n             linetype = \"dashed\",\n             colour = \"grey50\") +\n  labs(\n    title = \"Time-varying effect of donor type\",\n    subtitle = \"Hazard ratio: living vs deceased donor\",\n    x = \"Time since transplant (years)\",\n    y = \"Hazard ratio\"\n  ) +\n  theme_grey(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5),\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTipInterpretation\n\n\n\nWe interpret the results of the time-varying coefficient Cox model as follows:\n✅ Donor type (living vs deceased) — baseline effect\nHR ≈ 0.50 (95% CI: 0.25–1.01, P-value ≈ 0.05).\nAt the start of follow-up (when \\(\\log(t) \\approx 0\\)), recipients of a living donor kidney have about a 50% lower hazard of graft failure compared to recipients of deceased-donor kidneys.\nThis represents the early effect of donor type.\n\n✅ Time-varying effect of donor type (tt(donor_live))\nHR ≈ 3.53 (95% CI: 2.15–5.79, P-value &lt; 0.001), Statistically significant.\nThe effect of living donor changes significantly over time.\nFor each one-unit increase in \\(\\log(t)\\), the hazard ratio increases by a factor of about 3.5.\nInterpretation:\nThe early protective effect of living donation diminishes as time goes on, explaining why a single constant hazard ratio would be misleading.\n\n✅ Donor age\nHR ≈ 1.01 (95% CI: 1.00–1.03, P-value = 0.14), Not statistically significant.\nDonor age shows a small, non-significant trend toward higher hazard of graft failure.\n\n✅ Recipient gender (male vs female)\nHR ≈ 1.58 (95% CI: 1.16–2.13, P-value = 0.003), Statistically significant.\nMale recipients have about a 58% higher hazard of graft failure compared to females, adjusting for donor age, donor type, and baseline eGFR.\n\n✅ Baseline eGFR\nHR ≈ 0.99 (95% CI: 0.97–1.00, P-value = 0.032), Statistically significant.\nEach 1-unit increase in baseline eGFR is associated with about a 1–2% lower hazard of graft failure.\nTo improve interpretability, we can express the effect per 10-unit increase in eGFR:\n\\[\nHR_{10\\text{-unit}} = 0.99^{10} \\approx 0.90\n\\]\nInterpretation:\nWithin donor type, a 10-unit higher baseline eGFR at transplant is associated with approximately a 10% lower hazard of graft failure, after adjusting for other covariates.\n\nOverall interpretation:\nThe time-varying Cox model shows that the effect of donor type is strongest early after transplant and weakens over time, while recipient gender and baseline kidney function remain important predictors of graft failure.\nEarly follow-up: HR &lt; 1 → protective effect of living donors\nLater follow-up: HR increases and may exceed 1\nUncertainty increases at longer follow-up due to fewer events\nThe HR steadily increases and crosses 1 after roughly 1–2 years, indicating the early survival advantage of living donors diminishes.\nBy 5–8 years, the HR &gt; 2–3, suggesting higher hazard among living-donor grafts in the later period.\nThe confidence band widens with time because there are fewer events and greater uncertainty at longer follow-up.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#extended-cox-model",
    "href": "PH_assump.html#extended-cox-model",
    "title": "1 PH assumption violated",
    "section": "8 Extended Cox Model",
    "text": "8 Extended Cox Model\nBefore introducing the extended Cox model, it is important to distinguish between time-fixed covariates and time-varying covariates.\n\n\n\n\n\n\nNoteTime-Fixed vs Time-Varying Covariates\n\n\n\nTime-Fixed Covariates:\nA time-fixed covariate is measured once (usually at baseline) and assumed to remain constant throughout follow-up.\nExamples:\n\nDonor type\nSex\nAge at transplant\nBaseline eGFR\n\nTime-Varying Covariates:\nA time-varying covariate is a variable whose value itself changes over time.\nExamples:\n\neGFR measured repeatedly after transplant\nBlood pressure\nMedication use\nBiomarkers measured at follow-up visits\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nTime-varying covariates are different from time-varying effects.\n\nTime-varying effect: the coefficient changes with time\n\nTime-varying covariate: the value of the covariate changes with time\n\n\n\nWhy Time-Varying Covariates Can Cause PH Violation\nIf we treat a changing covariate as fixed at baseline:\n\nWe ignore important changes in a patient’s risk profile\nThe model may show non-proportional hazards\nEarly and late risks are incorrectly averaged\n\nFor example:\n\neGFR at transplant may be similar between patients\nOver time, eGFR may decline at different rates\nCurrent kidney function is more relevant than baseline eGFR\n\nExtended Cox Model (Time-Varying Covariates)\nThe extended Cox model explicitly allows covariate values to change over time.\n\n\n\n\n\n\nNoteIntuition\n\n\n\n\nSplit each subject’s follow-up into time intervals\nUpdate the covariate value within each interval\nModel the hazard using the current covariate value\n\nWhy this addresses PH violation:\n\nPH was violated partly because “risk profile changes over time.”\n\nThe extended Cox model explicitly updates the covariates over time instead of pretending they’re frozen at baseline.\n\nThis is different from stratification and different from adding x × time: here the value itself is time-dependent.\n\n\n\n\nThe model is written as:\n\\[\nh(t \\mid X(t)) = h_0(t)\\exp\\left(\\beta_1 X_1(t) + \\beta_2 X_2 + \\cdots\\right)\n\\]\n\n\n\n\n\n\nTipWhen to Use It\n\n\n\n\nA predictor changes over time\nThe current value of the predictor matters for risk right now\nTreating the variable as baseline-only is unrealistic\n\nExamples:\n\n“eGFR at year 2 predicts risk between year 2 and 3”\n“If eGFR worsens, the risk of graft failure increases after that”",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "PH_assump.html#example-extended-cox-model-time-varying-covariates",
    "href": "PH_assump.html#example-extended-cox-model-time-varying-covariates",
    "title": "1 PH assumption violated",
    "section": "9 Example: Extended Cox Model (Time-Varying Covariates)",
    "text": "9 Example: Extended Cox Model (Time-Varying Covariates)\nThis example demonstrates how to fit an extended Cox model when a covariate (e.g. eGFR) changes over time.\nWe create a dataset in start–stop format, where each individual contributes multiple time intervals.\nFor each interval we record:\n\nstart: beginning of the time interval\n\nstop: end of the time interval\n\nstatus: did graft failure occur at stop\n\negfr_current: eGFR measured at the start of that interval\n\nThe extended Cox model uses the current value of the covariate:\n\\[\nh(t) = h_0(t)\\exp\\left(\\beta_1 \\,\\text{egfr\\_current}(t)\n+ \\beta_2 \\,\\text{donor\\_type}\n+ \\cdots \\right)\n\\]\nHere:\n\negfr_current(t) is updated over time\n\nThe hazard reflects the patient’s current kidney function, not baseline values\n\n\n\n\n\n\n\nWarningData Structure: Wide vs Long Format\n\n\n\nWide (Baseline-Only) Format\nEach subject has one row, with multiple eGFR measurements stored in columns.\n\negfr0, egfr2, egfr4, egfr6 represent measurements at fixed times\n\nThis format is not suitable for extended Cox models\n\nLong (Start–Stop) Format\nEach subject contributes multiple rows, one per interval.\nKey columns:\n\nid\nstart\nstop\nstatus\negfr_current\nbaseline covariates (donor type, age, sex)\n\nThis format allows the model to use the current eGFR at each time interval.\n\n\nChange of eGFR over time by donor type\n\n\nShow R code\n#-----plot egfr change over time \nlibrary(ggplot2)\nlibrary(dplyr)\n\nlong_data&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_long_data.csv\")\n\n# Compute mean ± SE by donor type and start time\negfr_summary &lt;- long_data %&gt;%\n  group_by(donor_type, start) %&gt;%\n  summarise(\n    mean_egfr = mean(egfr_current, na.rm = TRUE),\n    se_egfr   = sd(egfr_current, na.rm = TRUE) / sqrt(n())\n  )\n\nggplot(egfr_summary, aes(x = start, y = mean_egfr,\n                         colour = donor_type, group = donor_type)) +\n  geom_line(linewidth = 1.2) +     # changed from size → linewidth\n  geom_point(size = 2) +\n  geom_ribbon(aes(ymin = mean_egfr - se_egfr,\n                  ymax = mean_egfr + se_egfr,\n                  fill = donor_type),\n              alpha = 0.2, colour = NA) +\n  scale_colour_manual(values = c(\"deceased\" = \"#377eb8\",\n                                 \"living\"   = \"#e41a1c\")) +\n  scale_fill_manual(values = c(\"deceased\" = \"#377eb8\",\n                               \"living\"   = \"#e41a1c\")) +\n  labs(\n    title  = \"Average eGFR trajectory over time by donor type\",\n    x      = \"Years since transplant\",\n    y      = \"Mean eGFR (mL/min/1.73m²)\",\n    colour = \"Donor type\",\n    fill   = \"Donor type\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.major = element_line(colour = \"grey90\"),\n    panel.grid.minor = element_blank(),\n    plot.title       = element_text(face = \"bold\", hjust = 0.5)\n  )\n\n\n\n\n\n\n\n\n\nFitting the Extended Cox Model\n\n\nShow R code\nlibrary(survival)\n\nlong_data&lt;-read.csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/egfr_long_data.csv\")\n\ncox_extended &lt;- coxph(\n  Surv(start, stop, status) ~\n    egfr_current +\n    donor_type +\n    donor_age +\n    recipient_gender,\n  data = long_data\n)\n\nsummary(cox_extended)\n\n\nCall:\ncoxph(formula = Surv(start, stop, status) ~ egfr_current + donor_type + \n    donor_age + recipient_gender, data = long_data)\n\n  n= 984, number of events= 13 \n\n                         coef exp(coef) se(coef)      z Pr(&gt;|z|)   \negfr_current         -0.08300   0.92035  0.03222 -2.576    0.010 **\ndonor_typeliving      0.24888   1.28259  0.85365  0.292    0.771   \ndonor_age             0.02599   1.02633  0.03043  0.854    0.393   \nrecipient_gendermale  0.31097   1.36475  0.56113  0.554    0.579   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                     exp(coef) exp(-coef) lower .95 upper .95\negfr_current            0.9204     1.0865    0.8640    0.9803\ndonor_typeliving        1.2826     0.7797    0.2407    6.8346\ndonor_age               1.0263     0.9743    0.9669    1.0894\nrecipient_gendermale    1.3648     0.7327    0.4544    4.0991\n\nConcordance= 0.756  (se = 0.074 )\nLikelihood ratio test= 12.1  on 4 df,   p=0.02\nWald test            = 9.91  on 4 df,   p=0.04\nScore (logrank) test = 10.88  on 4 df,   p=0.03\n\n\n\n\n\n\n\n\nTipInterpretation\n\n\n\nWe interpret the results of the extended Cox model (time-varying covariates) as follows:\n✅ Current eGFR\nHR ≈ 0.92 (95% CI: 0.86–0.98, P-value = 0.01), Statistically significant.\nEach 1 mL/min/1.73 m² higher current eGFR is associated with about an 8% lower instantaneous hazard of graft failure, holding donor type, donor age, and recipient gender constant.\nThis means that the patient’s current kidney function, rather than baseline eGFR, is strongly predictive of graft failure risk.\n\n✅ Donor type (living vs deceased)\nHR ≈ 1.28 (95% CI: 0.24–6.83, P-value = 0.77), Not statistically significant.\nOnce time-updated eGFR is included in the model, there is no evidence of a direct effect of donor type on graft failure.\nInterpretation:\nThe apparent advantage of living donors observed earlier appears to operate through better kidney function over time, rather than through an independent direct effect.\n\n✅ Donor age\nHR ≈ 1.03 (95% CI: 0.97–1.09, P-value = 0.39), Not statistically significant.\nThere is no strong evidence that donor age is associated with graft failure once current eGFR and other covariates are accounted for.\n\n✅ Recipient gender (male vs female)\nHR ≈ 1.36 (95% CI: 0.45–4.10, P-value = 0.58), Not statistically significant.\nAfter adjusting for time-updated eGFR and other covariates, there is no clear evidence of a gender difference in graft failure risk.\n\nOverall interpretation:\nThe extended Cox model highlights that time-updated eGFR is the dominant predictor of graft failure.\nAccounting for changes in kidney function over time substantially alters the interpretation of other covariate effects and provides a more realistic representation of evolving risk.\n\n\n\n\nShow R code\nlibrary(survival)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Choose fixed values (you can edit if you prefer):\nref_donor_type      &lt;- factor(\"deceased\", levels = levels(as.factor(long_data$donor_type)))\nref_donor_age       &lt;- 50\nref_recipient_sex   &lt;- factor(\"female\", levels = levels(as.factor(long_data$recipient_gender)))\n\nnew_e30 &lt;- data.frame(\n  start = 0,\n  stop = 1,  # dummy, survfit won't use start/stop here\n  status = 0,\n  egfr_current = 30,\n  donor_type = ref_donor_type,\n  donor_age = ref_donor_age,\n  recipient_gender = ref_recipient_sex\n)\n\nnew_e60 &lt;- new_e30; new_e60$egfr_current &lt;- 60\nnew_e90 &lt;- new_e30; new_e90$egfr_current &lt;- 90\n\n\nsf_e30 &lt;- survfit(cox_extended, newdata = new_e30)\nsf_e60 &lt;- survfit(cox_extended, newdata = new_e60)\nsf_e90 &lt;- survfit(cox_extended, newdata = new_e90)\n\n\ndf_e30 &lt;- data.frame(\n  time  = sf_e30$time,\n  surv  = sf_e30$surv,\n  lower = sf_e30$lower,\n  upper = sf_e30$upper,\n  egfr_label = \"eGFR = 30\"\n)\n\ndf_e60 &lt;- data.frame(\n  time  = sf_e60$time,\n  surv  = sf_e60$surv,\n  lower = sf_e60$lower,\n  upper = sf_e60$upper,\n  egfr_label = \"eGFR = 60\"\n)\n\ndf_e90 &lt;- data.frame(\n  time  = sf_e90$time,\n  surv  = sf_e90$surv,\n  lower = sf_e90$lower,\n  upper = sf_e90$upper,\n  egfr_label = \"eGFR = 90\"\n)\n\nsurv_plot_df &lt;- bind_rows(df_e30, df_e60, df_e90)\n\n\nggplot(surv_plot_df,\n       aes(x = time,\n           y = surv,\n           colour = egfr_label,\n           fill   = egfr_label)) +\n  \n  # confidence band\n  geom_ribbon(aes(ymin = lower, ymax = upper),\n              alpha = 0.18,\n              linewidth = 0,\n              show.legend = FALSE) +\n  \n  # survival curve (step)\n  geom_step(linewidth = 1.2) +\n  \n  scale_colour_manual(\n    values = c(\n      \"eGFR = 30\" = \"#d7301f\",  # dark-ish red / high risk\n      \"eGFR = 60\" = \"#fc8d59\",  # orange\n      \"eGFR = 90\" = \"#1a9850\"   # green / low risk\n    )\n  ) +\n  scale_fill_manual(\n    values = c(\n      \"eGFR = 30\" = \"#d7301f\",\n      \"eGFR = 60\" = \"#fc8d59\",\n      \"eGFR = 90\" = \"#1a9850\"\n    )\n  ) +\n  \n  labs(\n    title = \"Predicted graft survival under different kidney function levels\",\n    subtitle = \"Extended Cox model with time-updated eGFR\",\n    x = \"Time since transplant (years)\",\n    y = \"Survival probability\",\n    colour = \"Assumed current eGFR\"\n  ) +\n  coord_cartesian(ylim = c(0.72, 1)) +\n  theme_grey(base_size = 14) +\n  theme(\n    plot.title    = element_text(face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5),\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )+ theme(\n    plot.title = element_text(\n      face = \"bold\",\n      size = 12,\n      hjust = 0.5,\n      margin = margin(b = 6)   # space below title\n    ),\n    plot.subtitle = element_text(\n      size = 11,\n      hjust = 0.5,\n      margin = margin(b = 8)\n    ),\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTipInterpretation of Predicted Survival by Current eGFR Level\n\n\n\nThe extended Cox model allows us to interpret graft survival conditional on the current level of kidney function, updated over time.\n\n✅ eGFR = 90 (green)\nPredicted graft survival is very stable over time.\nThe survival curve remains close to 1.0, indicating that patients maintaining this level of kidney function have a very low risk of graft failure throughout follow-up.\n\n✅ eGFR = 60 (orange)\nGraft survival remains high, although slightly lower than at eGFR = 90.\nThe probability of graft survival stays above 95% over 8 years, suggesting a modest increase in risk, but overall good long-term outcomes.\n\n✅ eGFR = 30 (red)\nGraft survival is markedly reduced.\nThe survival curve declines more steeply, showing a pronounced increase in the risk of graft loss over time.\nThis highlights low current eGFR as a strong indicator of poor prognosis.\n\nOverall interpretation:\nIn the extended Cox model, current eGFR is a powerful, time-updated predictor of graft survival.\nLower eGFR values are associated with substantially worse survival trajectories, reinforcing the importance of modelling kidney function as a time-varying covariate rather than a baseline-only measure.\n\n\n\n\n\n\n\n\nWarning\n\n\n\nThe extended Cox model treats time-varying covariates as external.\nIf the covariate is influenced by the underlying disease process (e.g. declining eGFR because the graft is failing), this assumption may be violated.\n\n\n\n🧠 Think about the following before moving on:\nWhat if the decline in eGFR over time reflects underlying changes in other clinical factors, rather than acting as an isolated predictor?\nAnd those same variables may also affect the risk of graft failure.\nIf a time-dependent covariate both predicts the event and is affected by the underlying disease process, is an extended Cox model still appropriate?",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "1 PH assumption violated"
    ]
  },
  {
    "objectID": "WrapupD1.html",
    "href": "WrapupD1.html",
    "title": "Wrap-up",
    "section": "",
    "text": "Today’s sessions explored the options available when the standard semi-parametric assumptions are no longer sufficient for our research goals. We addressed four primary questions:\n\nWhat are our options if Cox Proportional Hazards (PH) assumption is violated?\nHow can joint modelling improve upon standard Cox modelling for time-varying covariates?\nHow can parametric survival models complement Cox modelling (estimating the baseline hazard)?\nHow can flexible parametric survival models bridge the gap between standard parametric models and semi-parametric Cox model?",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#beyond-the-standard-cox-model",
    "href": "WrapupD1.html#beyond-the-standard-cox-model",
    "title": "Wrap-up",
    "section": "",
    "text": "Today’s sessions explored the options available when the standard semi-parametric assumptions are no longer sufficient for our research goals. We addressed four primary questions:\n\nWhat are our options if Cox Proportional Hazards (PH) assumption is violated?\nHow can joint modelling improve upon standard Cox modelling for time-varying covariates?\nHow can parametric survival models complement Cox modelling (estimating the baseline hazard)?\nHow can flexible parametric survival models bridge the gap between standard parametric models and semi-parametric Cox model?",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#when-the-standard-cox-model-is-not-enough",
    "href": "WrapupD1.html#when-the-standard-cox-model-is-not-enough",
    "title": "Wrap-up",
    "section": "2 1. When the ‘Standard’ Cox Model is Not Enough",
    "text": "2 1. When the ‘Standard’ Cox Model is Not Enough\nWhile the Cox model is robust because it does not require specifying the baseline hazard, its validity relies heavily on the proportional hazards (PH) assumption — the requirement that hazards remain constant over time.\n\n2.1 Strategies for PH Violation\nWhen proportionality fails, we have several structural alternatives:\n\nStratification: Useful when a categorical variable (e.g., donor type) strongly affects risk, but you do not need to report its explicit hazard ratio\nTime-Varying Effects: Essential when the impact of a covariate (e.g., treatment) changes over follow-up.\nExtended Cox Model: Necessary when a covariate’s actual value changes over time",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#beyond-external-predictors-with-joint-modelling",
    "href": "WrapupD1.html#beyond-external-predictors-with-joint-modelling",
    "title": "Wrap-up",
    "section": "3 2. Beyond External Predictors with Joint Modelling",
    "text": "3 2. Beyond External Predictors with Joint Modelling\nStandard survival models assume that time-varying covariates are “external”. However, in clinical research, many biomarkers (like eGFR) are internal — they predict the event (graft failure) while simultaneously being affected by the disease process itself.\n\n3.1 Benefits of Joint Models\nJoint models reduce bias by simultaneously modelling the longitudinal trajectory (e.g., linear mixed-effects model for eGFR) and the time-to-event outcome (e.g., Cox model for graft failure)\n\nAddresses bias from internal time-dependent covariates: Explicitly accounts for the feedback loop between the biomarker and the event.\nMeasurement Error: Accounts for the inherent noise in repeated measurements\nPrecision: Leads to improved statistical precision and more efficient inference",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#beyond-the-hazard-ratio-with-parametric-models",
    "href": "WrapupD1.html#beyond-the-hazard-ratio-with-parametric-models",
    "title": "Wrap-up",
    "section": "4 3. Beyond the Hazard Ratio with parametric Models",
    "text": "4 3. Beyond the Hazard Ratio with parametric Models\n\nThe unspecified baseline hazard in a Cox model is a “double-edged sword”. It avoids wrong assumptions about the shape of risk, but it prevents us from calculating absolute risks.\nParametric models fully specify the hazard and survival functions, including the baseline hazard, and therefore they allow for the estimation of absolute risks and the ability to extrapolate survival beyond the observed data\nIt is very important to make sure that the distributional assumptions hold — if they do, parametric models offer improved precision compared to semi-parametric models.",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#flexible-parametric-models-the-best-of-both-worlds",
    "href": "WrapupD1.html#flexible-parametric-models-the-best-of-both-worlds",
    "title": "Wrap-up",
    "section": "5 4. Flexible Parametric Models: The Best of Both Worlds",
    "text": "5 4. Flexible Parametric Models: The Best of Both Worlds\n\nFlexible parametric models (such as the Royston-Parmar model) provide the flexibility of a Cox model combined with the analytical power of parametric models\n\nThey provide hazard ratios while also allowing for absolute risk measures and extrapolation\n\nBy using (restricted cubic) splines, these models can capture complex, non-monotonic hazard functions\nIf the PH assumption is violated, time-dependent effects can be easily integrated into the spline framework",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#summary-comparison",
    "href": "WrapupD1.html#summary-comparison",
    "title": "Wrap-up",
    "section": "6 Summary Comparison",
    "text": "6 Summary Comparison\n\n\n\n\n\n\n\n\nModel Type\nBest Used When…\nKey Advantage\n\n\n\n\nStratified Cox\nPH is violated for a non-primary covariate\nNo baseline assumption needed\n\n\nJoint Model\nDealing with internal biomarkers like eGFR\nAccounts for measurement error and feedback\n\n\nParametric\nAbsolute risks or extrapolation are required\nContinuous, smooth hazard functions\n\n\nFlexible Parametric\nHazards are complex or PH assumption fails\nBridges the gap between Cox and Parametric",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "WrapupD1.html#tomorrow-beyond-binary-outcomes",
    "href": "WrapupD1.html#tomorrow-beyond-binary-outcomes",
    "title": "Wrap-up",
    "section": "7 Tomorrow: Beyond binary outcomes",
    "text": "7 Tomorrow: Beyond binary outcomes\n\nWhat if people are removed from the risk set due to reasons other than the event of interest or uninformative censoring (competing risks)?\nHow can flexible parametric approaches improve standard modelling of competing risks?\nWhat if people experience semi-competing risks or intermediate events that do not preclude the primary event but may change the risk of the primary event (multi-state modelling)?",
    "crumbs": [
      "Day 1: Joint & parametric modelling",
      "Wrap-up"
    ]
  },
  {
    "objectID": "Flexible2.html#data-exercise",
    "href": "Flexible2.html#data-exercise",
    "title": "2 Flexible parametric survival",
    "section": "4 Data exercise",
    "text": "4 Data exercise\nYou have been provided with a new dataset including the following variables. Use the coding template to undertake similar datasteps and analysis above to produce:\n\nFlexible parametric survival model with 1 internal knot for two causes of death (cardiovascular vs other deaths)\nCumulative hazards plot\nProbability of each cause of death plot\n\nPlease refer to the solutions here and R coding here (uploaded following workshop).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "2 Flexible parametric survival"
    ]
  },
  {
    "objectID": "Multistate.html#transition-specific-covariates",
    "href": "Multistate.html#transition-specific-covariates",
    "title": "3 Multi-state modelling",
    "section": "12 Transition specific covariates",
    "text": "12 Transition specific covariates\nWe have shown above how to run transition specific models, either using strata(trans) or subset(trans==x). It’s important to understand that fitting with strata() does model the joint likelihood, which sometimes can be computationally difficult. However, there is still functionality to allow for transition-specific covariates.\nFitting with subset(trans==x) partitions the likelihood, so it will usually fit faster and more easily. This also allows for transition-specific covariates and it is more accessible to make specific changes to each transition model.\nNow let’s demonstrate how we can fit different covariates for each transition.\nFor the Cox model, we are able to run the below:\n\n\nShow R code\n#Cox model with transition specific covariates\nsummary(cfit_tspec_strata)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + \n    trt.3 + age10.1 + age10.2 + age10.3 + male.1 + male.2 + male.3 + \n    extent.1 + extent.2 + extent.3 + node4.1 + node4.2 + node4.3 + \n    strata(trans), data = cdata_long_exp, id = id)\n\n  n= 2326, number of events= 920 \n\n             coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)    \ntrt.1    -0.50755   0.60197  0.10645   0.10792 -4.703 2.57e-06 ***\ntrt.2     0.02025   1.02046  0.33595   0.33520  0.060   0.9518    \ntrt.3     0.28848   1.33440  0.11431   0.11873  2.430   0.0151 *  \nage10.1  -0.03166   0.96883  0.03902   0.04202 -0.754   0.4511    \nage10.2   0.87475   2.39829  0.19574   0.19049  4.592 4.39e-06 ***\nage10.3   0.10489   1.11059  0.03995   0.04358  2.407   0.0161 *  \nmale.1   -0.08880   0.91503  0.09270   0.09459 -0.939   0.3478    \nmale.2    0.45226   1.57186  0.33650   0.34432  1.313   0.1890    \nmale.3    0.19556   1.21599  0.10079   0.09401  2.080   0.0375 *  \nextent.1  0.53260   1.70336  0.11332   0.12229  4.355 1.33e-05 ***\nextent.2  0.46911   1.59858  0.38750   0.50819  0.923   0.3559    \nextent.3  0.08427   1.08793  0.10602   0.11158  0.755   0.4501    \nnode4.1   0.83555   2.30607  0.09614   0.09983  8.370  &lt; 2e-16 ***\nnode4.2   0.64311   1.90238  0.37459   0.39068  1.646   0.0997 .  \nnode4.3   0.43511   1.54513  0.10423   0.10102  4.307 1.65e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntrt.1       0.6020     1.6612    0.4872    0.7438\ntrt.2       1.0205     0.9799    0.5290    1.9684\ntrt.3       1.3344     0.7494    1.0574    1.6840\nage10.1     0.9688     1.0322    0.8922    1.0520\nage10.2     2.3983     0.4170    1.6510    3.4837\nage10.3     1.1106     0.9004    1.0197    1.2096\nmale.1      0.9150     1.0929    0.7602    1.1014\nmale.2      1.5719     0.6362    0.8004    3.0867\nmale.3      1.2160     0.8224    1.0114    1.4620\nextent.1    1.7034     0.5871    1.3403    2.1647\nextent.2    1.5986     0.6256    0.5904    4.3282\nextent.3    1.0879     0.9192    0.8742    1.3539\nnode4.1     2.3061     0.4336    1.8963    2.8044\nnode4.2     1.9024     0.5257    0.8846    4.0911\nnode4.3     1.5451     0.6472    1.2676    1.8835\n\nConcordance= 0.647  (se = 0.011 )\nLikelihood ratio test= 188.7  on 15 df,   p=&lt;2e-16\nWald test            = 173.8  on 15 df,   p=&lt;2e-16\nScore (logrank) test = 191.8  on 15 df,   p=&lt;2e-16,   Robust = 154.5  p=&lt;2e-16\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\n\nShow R code\n#Remove extent from 1:3 and 2:3\ncfit_tspec_strata_remove &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + trt.3 + age10.1 + age10.2 + age10.3 + male.1 + male.2 + male.3 + extent.1 + node4.1 + node4.2 + node4.3 + strata(trans),\ndata=cdata_long_exp, id=id)\nsummary(cfit_tspec_strata_remove)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt.1 + trt.2 + \n    trt.3 + age10.1 + age10.2 + age10.3 + male.1 + male.2 + male.3 + \n    extent.1 + node4.1 + node4.2 + node4.3 + strata(trans), data = cdata_long_exp, \n    id = id)\n\n  n= 2326, number of events= 920 \n\n             coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)    \ntrt.1    -0.50755   0.60197  0.10645   0.10792 -4.703 2.57e-06 ***\ntrt.2     0.02536   1.02569  0.33502   0.33216  0.076   0.9391    \ntrt.3     0.28726   1.33277  0.11427   0.11741  2.447   0.0144 *  \nage10.1  -0.03166   0.96883  0.03902   0.04202 -0.754   0.4511    \nage10.2   0.87071   2.38860  0.19486   0.18965  4.591 4.41e-06 ***\nage10.3   0.10590   1.11171  0.03991   0.04330  2.446   0.0145 *  \nmale.1   -0.08880   0.91503  0.09270   0.09459 -0.939   0.3478    \nmale.2    0.44414   1.55915  0.33562   0.34713  1.279   0.2007    \nmale.3    0.20209   1.22396  0.10039   0.09251  2.184   0.0289 *  \nextent.1  0.53260   1.70336  0.11332   0.12229  4.355 1.33e-05 ***\nnode4.1   0.83555   2.30607  0.09614   0.09983  8.370  &lt; 2e-16 ***\nnode4.2   0.68894   1.99160  0.37345   0.38588  1.785   0.0742 .  \nnode4.3   0.43516   1.54521  0.10429   0.09992  4.355 1.33e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntrt.1       0.6020     1.6612    0.4872    0.7438\ntrt.2       1.0257     0.9750    0.5349    1.9668\ntrt.3       1.3328     0.7503    1.0588    1.6776\nage10.1     0.9688     1.0322    0.8922    1.0520\nage10.2     2.3886     0.4187    1.6471    3.4639\nage10.3     1.1117     0.8995    1.0213    1.2102\nmale.1      0.9150     1.0929    0.7602    1.1014\nmale.2      1.5592     0.6414    0.7896    3.0787\nmale.3      1.2240     0.8170    1.0210    1.4673\nextent.1    1.7034     0.5871    1.3403    2.1647\nnode4.1     2.3061     0.4336    1.8963    2.8044\nnode4.2     1.9916     0.5021    0.9349    4.2429\nnode4.3     1.5452     0.6472    1.2704    1.8795\n\nConcordance= 0.647  (se = 0.011 )\nLikelihood ratio test= 186.5  on 13 df,   p=&lt;2e-16\nWald test            = 168.4  on 13 df,   p=&lt;2e-16\nScore (logrank) test = 190  on 13 df,   p=&lt;2e-16,   Robust = 150.9  p=&lt;2e-16\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\n\nShow R code\n#Same results when fitting using subset\ncox_alive_recur &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt+age10+male+extent+node4, data=cdata_long, subset=(trans==1), id=id)\nsummary(cox_alive_recur)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + male + \n    extent + node4, data = cdata_long, subset = (trans == 1), \n    id = id)\n\n  n= 929, number of events= 468 \n\n           coef exp(coef) se(coef)      z Pr(&gt;|z|)    \ntrt    -0.50755   0.60197  0.10645 -4.768 1.86e-06 ***\nage10  -0.03166   0.96883  0.03902 -0.812    0.417    \nmale   -0.08880   0.91503  0.09270 -0.958    0.338    \nextent  0.53260   1.70336  0.11332  4.700 2.60e-06 ***\nnode4   0.83555   2.30607  0.09614  8.691  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       exp(coef) exp(-coef) lower .95 upper .95\ntrt       0.6020     1.6612    0.4886    0.7416\nage10     0.9688     1.0322    0.8975    1.0458\nmale      0.9150     1.0929    0.7630    1.0973\nextent    1.7034     0.5871    1.3641    2.1270\nnode4     2.3061     0.4336    1.9100    2.7842\n\nConcordance= 0.652  (se = 0.013 )\nLikelihood ratio test= 128.8  on 5 df,   p=&lt;2e-16\nWald test            = 129.6  on 5 df,   p=&lt;2e-16\nScore (logrank) test = 135.9  on 5 df,   p=&lt;2e-16\n\n\nShow R code\ncox_alive_death &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt+age10+male+node4, data=cdata_long, subset=(trans==2), id=id)\nsummary(cox_alive_death)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + male + \n    node4, data = cdata_long, subset = (trans == 2), id = id)\n\n  n= 929, number of events= 38 \n\n         coef exp(coef) se(coef)     z Pr(&gt;|z|)    \ntrt   0.02536   1.02569  0.33502 0.076   0.9397    \nage10 0.87071   2.38860  0.19486 4.468 7.88e-06 ***\nmale  0.44414   1.55915  0.33562 1.323   0.1857    \nnode4 0.68894   1.99160  0.37345 1.845   0.0651 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntrt       1.026     0.9750    0.5319     1.978\nage10     2.389     0.4187    1.6303     3.500\nmale      1.559     0.6414    0.8076     3.010\nnode4     1.992     0.5021    0.9579     4.141\n\nConcordance= 0.753  (se = 0.044 )\nLikelihood ratio test= 27.7  on 4 df,   p=1e-05\nWald test            = 22.79  on 4 df,   p=1e-04\nScore (logrank) test = 23.48  on 4 df,   p=1e-04\n\n\nShow R code\ncox_recur_death &lt;- coxph(Surv(Tstart, Tstop, status) ~ trt+age10+male+node4, data=cdata_long, subset=(trans==3), id=id)\nsummary(cox_recur_death)\n\n\nCall:\ncoxph(formula = Surv(Tstart, Tstop, status) ~ trt + age10 + male + \n    node4, data = cdata_long, subset = (trans == 3), id = id)\n\n  n= 468, number of events= 414 \n\n         coef exp(coef) se(coef)     z Pr(&gt;|z|)    \ntrt   0.28726   1.33277  0.11427 2.514  0.01194 *  \nage10 0.10590   1.11171  0.03991 2.653  0.00797 ** \nmale  0.20209   1.22396  0.10039 2.013  0.04412 *  \nnode4 0.43516   1.54521  0.10429 4.173 3.01e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntrt       1.333     0.7503     1.065     1.667\nage10     1.112     0.8995     1.028     1.202\nmale      1.224     0.8170     1.005     1.490\nnode4     1.545     0.6472     1.260     1.896\n\nConcordance= 0.57  (se = 0.014 )\nLikelihood ratio test= 29.97  on 4 df,   p=5e-06\nWald test            = 30.37  on 4 df,   p=4e-06\nScore (logrank) test = 30.58  on 4 df,   p=4e-06\n\n\nFor the flexible parametric survival model, we are able to run the below:\n\n\nShow R code\n#Fit separate models for each transition - as given by msprep\nmsm_alive_recur_cov &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + extent + node4, data=cdata_long, subset=(trans==1), k=1, scale=\"hazard\")\nmsm_alive_recur_cov\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0        NA   -0.82768  -1.71303   0.05767   0.45172        NA        NA\ngamma1        NA    2.53880   2.22200   2.85560   0.16164        NA        NA\ngamma2        NA    0.10153   0.08571   0.11734   0.00807        NA        NA\ntrt      0.32723   -0.50849  -0.71716  -0.29983   0.10646   0.60140   0.48814\nage10    5.97546   -0.02998  -0.10644   0.04649   0.03901   0.97047   0.89903\nmale     0.52099   -0.08630  -0.26799   0.09538   0.09270   0.91731   0.76491\nextent   2.88698    0.52915   0.30772   0.75058   0.11297   1.69749   1.36032\nnode4    0.27449    0.83298   0.64459   1.02138   0.09612   2.30017   1.90520\n        U95%    \ngamma0        NA\ngamma1        NA\ngamma2        NA\ntrt      0.74095\nage10    1.04758\nmale     1.10008\nextent   2.11822\nnode4    2.77704\n\nN = 929,  Events: 468,  Censored: 461\nTotal time at risk: 3573.892\nLog-likelihood = -1199.725, df = 8\nAIC = 2415.45\n\n\nShow R code\nmsm_alive_death_cov &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + node4, data=cdata_long, subset=(trans==2), k=1, scale=\"hazard\")\nmsm_alive_death_cov\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + node4, data = cdata_long, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%    \ngamma0        NA   -10.9443  -13.7686   -8.1200    1.4410        NA        NA\ngamma1        NA     0.7080    0.1034    1.3126    0.3085        NA        NA\ngamma2        NA    -0.0509   -0.1279    0.0260    0.0393        NA        NA\ntrt       0.3272     0.0348   -0.6203    0.6899    0.3342    1.0354    0.5378\nage10     5.9755     0.8592    0.4806    1.2378    0.1932    2.3614    1.6171\nmale      0.5210     0.4228   -0.2324    1.0779    0.3343    1.5262    0.7927\nnode4     0.2745     0.6881   -0.0429    1.4190    0.3729    1.9899    0.9580\n        U95%    \ngamma0        NA\ngamma1        NA\ngamma2        NA\ntrt       1.9935\nage10     3.4482\nmale      2.9386\nnode4     4.1330\n\nN = 929,  Events: 38,  Censored: 891\nTotal time at risk: 3573.892\nLog-likelihood = -196.3676, df = 7\nAIC = 406.7351\n\n\nShow R code\nmsm_recur_death_cov &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt +age10 + male + node4, data=cdata_long, subset=(trans==3), k=1, scale=\"hazard\")\nmsm_recur_death_cov\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + node4, data = cdata_long, subset = (trans == \n    3), k = 1, scale = \"hazard\")\n\nEstimates: \n        data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0       NA    -0.9016  -1.4833  -0.3199   0.2968       NA        NA\ngamma1       NA     1.0113   0.3764   1.6462   0.3239       NA        NA\ngamma2       NA     0.0271  -0.0250   0.0792   0.0266       NA        NA\ntrt      0.2543     0.3002   0.0771   0.5234   0.1138   1.3502    1.0802\nage10    5.9036     0.1073   0.0292   0.1854   0.0399   1.1133    1.0296\nmale     0.5107     0.2109   0.0147   0.4071   0.1001   1.2348    1.0148\nnode4    0.3846     0.4271   0.2230   0.6312   0.1041   1.5328    1.2499\n        U95%   \ngamma0       NA\ngamma1       NA\ngamma2       NA\ntrt      1.6877\nage10    1.2038\nmale     1.5025\nnode4    1.8798\n\nN = 468,  Events: 414,  Censored: 54\nTotal time at risk: 673.5797\nLog-likelihood = -582.4494, df = 7\nAIC = 1178.899\n\n\nShow R code\n#Define transition matrix\ntmat_flexsurv &lt;- rbind(c(NA,1,2), c(NA, NA, 3), c(NA, NA, NA))\ntmat_flexsurv\n\n\n     [,1] [,2] [,3]\n[1,]   NA    1    2\n[2,]   NA   NA    3\n[3,]   NA   NA   NA\n\n\nShow R code\n#Group transitions together\nmsm_alltrans_cov &lt;- fmsm(msm_alive_recur_cov, msm_alive_death_cov, msm_recur_death_cov, trans=tmat_flexsurv)\nmsm_alltrans_cov\n\n\nState 1 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + extent + node4, data = cdata_long, subset = (trans == \n    1), k = 1, scale = \"hazard\")\n\nState 1 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + node4, data = cdata_long, subset = (trans == \n    2), k = 1, scale = \"hazard\")\n\nState 2 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    age10 + male + node4, data = cdata_long, subset = (trans == \n    3), k = 1, scale = \"hazard\")",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#recurrent-events",
    "href": "Multistate.html#recurrent-events",
    "title": "3 Multi-state modelling",
    "section": "13 Recurrent events",
    "text": "13 Recurrent events\nMulti-state models are also applicable to recurrent events. There are two alternate ways to fit the model with recurrent events. You can define a new transition for each recurrence, or you can include a time-varying covariate to capture this information.\n\n\n\n\n\n\nNote\n\n\n\nWhen should you fit with transition-specific models for each recurrence compared to time-varying covariate with cumulative count of recurrence?\nIt really depends on the scenario.\n\nFew cases with multiple recurrence ➡️ Likely better fit with time-varying covariate\nCovariate effects vary for each recurrence ➡️ Consider transition-specific or interaction terms with time-varying covariate\nFocus on model fit and assumptions to guide decision\n\n\n\nWe will load in synthetic data that captures relapses and remission in opiod users, from entry into study. The published paper is accessible here.\n\n13.1 Transition specific to each recurrence\nWe have provided two forms of the data. The below provides a transition for each recurrence:\n\n\n\nShow R code\n#Load in transition based recurrence\nopiod_msm &lt;- read_csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/opiod_msm.csv\")\n\n#Set to factor\nopiod_msm$homeless &lt;- factor(opiod_msm$homeless, levels = c(\"No\", \"Yes\"))\n\n#Number of transitions\ntable(opiod_msm$trans)\n\n\n\n  1   2   3   4   5   6 \n344 292 235 185 138  96 \n\n\nShow R code\n#Transition types\ntable(opiod_msm$transition, opiod_msm$trans)\n\n\n                      \n                         1   2   3   4   5   6\n  &gt;=3rd Rel-&gt;&gt;=3rd Rem   0   0   0   0   0  96\n  1st Rel-&gt;1st Rem       0 292   0   0   0   0\n  1st Rem-&gt;2nd Rel       0   0 235   0   0   0\n  2nd Rel-&gt;2nd Rem       0   0   0 185   0   0\n  2nd Rem-&gt;&gt;=3rd Rel     0   0   0   0 138   0\n  Init Rem-&gt;1st Rel    218   0   0   0   0   0\n  Init Rem-&gt;Init Rem   126   0   0   0   0   0\n\n\nShow R code\n#Fit separate models for each transition\nop_relap_1 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod_msm, subset=(trans==1), k=1, scale=\"hazard\")\nop_relap_1\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 1), k = 1, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -3.4030  -3.8849  -2.9211   0.2459       NA        NA\ngamma1            NA     1.4337   1.1338   1.7336   0.1530       NA        NA\ngamma2            NA     0.1172   0.0507   0.1837   0.0339       NA        NA\ntrt           0.4041    -0.0274  -0.3003   0.2454   0.1392   0.9729    0.7406\nhomelessYes   0.2529     0.2206  -0.0774   0.5187   0.1521   1.2469    0.9255\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.2781\nhomelessYes   1.6799\n\nN = 344,  Events: 218,  Censored: 126\nTotal time at risk: 4175\nLog-likelihood = -853.9607, df = 5\nAIC = 1717.921\n\n\nShow R code\nop_remiss_1 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod_msm, subset=(trans==2), k=1, scale=\"hazard\")\nop_remiss_1\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 2), k = 1, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -1.0609  -1.3748  -0.7471   0.1601       NA        NA\ngamma1            NA     1.4863   1.2679   1.7046   0.1114       NA        NA\ngamma2            NA     0.0894   0.0426   0.1362   0.0239       NA        NA\ntrt           0.4212    -0.1370  -0.3701   0.0961   0.1190   0.8720    0.6906\nhomelessYes   0.2808     0.2029  -0.0535   0.4592   0.1308   1.2249    0.9479\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.1009\nhomelessYes   1.5829\n\nN = 292,  Events: 292,  Censored: 0\nTotal time at risk: 508\nLog-likelihood = -440.2347, df = 5\nAIC = 890.4694\n\n\nShow R code\nop_relap_2 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod_msm, subset=(trans==3), k=1, scale=\"hazard\")\nop_relap_2\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 3), k = 1, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -2.1650  -3.1099  -1.2201   0.4821       NA        NA\ngamma1            NA     1.5354   1.0267   2.0441   0.2595       NA        NA\ngamma2            NA     0.1110  -0.0424   0.2644   0.0783       NA        NA\ntrt           0.4170    -0.1972  -0.4577   0.0633   0.1329   0.8210    0.6327\nhomelessYes   0.2979    -0.0435  -0.3246   0.2377   0.1434   0.9575    0.7228\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.0654\nhomelessYes   1.2683\n\nN = 235,  Events: 235,  Censored: 0\nTotal time at risk: 740\nLog-likelihood = -500.2961, df = 5\nAIC = 1010.592\n\n\nShow R code\nop_remiss_2 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod_msm, subset=(trans==4), k=1, scale=\"hazard\")\nop_remiss_2\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 4), k = 1, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -1.3420  -3.0892   0.4052   0.8914       NA        NA\ngamma1            NA     1.0971   0.3757   1.8185   0.3680       NA        NA\ngamma2            NA    -0.0373  -0.3075   0.2329   0.1379       NA        NA\ntrt           0.4216    -0.0353  -0.3320   0.2613   0.1514   0.9653    0.7175\nhomelessYes   0.2973     0.0106  -0.3098   0.3310   0.1635   1.0106    0.7336\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.2987\nhomelessYes   1.3924\n\nN = 185,  Events: 185,  Censored: 0\nTotal time at risk: 487\nLog-likelihood = -363.0881, df = 5\nAIC = 736.1762\n\n\nShow R code\nop_relap_3 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod_msm, subset=(trans==5), k=1, scale=\"hazard\")\nop_relap_3\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 5), k = 1, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -1.3411  -4.3709   1.6886   1.5458       NA        NA\ngamma1            NA     1.0385  -0.0958   2.1727   0.5787       NA        NA\ngamma2            NA    -0.2852  -0.8246   0.2541   0.2752       NA        NA\ntrt           0.4203    -0.1331  -0.4790   0.2127   0.1765   0.8753    0.6194\nhomelessYes   0.2826    -0.1429  -0.5224   0.2366   0.1936   0.8669    0.5931\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.2371\nhomelessYes   1.2669\n\nN = 138,  Events: 138,  Censored: 0\nTotal time at risk: 364\nLog-likelihood = -267.1885, df = 5\nAIC = 544.3769\n\n\nBy the last transition, we encounter issues with model fit. You can check out the issues by running this code.\n```{r}\n#Note by this transition, model is having difficulty fitting\nop_remiss_3 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless , data=opiod_msm, subset=(trans==6), k=1, scale=\"hazard\")\nop_remiss_3\n\n```\nFor teaching purposes, let’s continue with fitting this transition without any internal knots.\n\n\nShow R code\n#Note by this transition, model is having difficulty fitting\nop_remiss_3 &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless , data=opiod_msm, subset=(trans==6), k=0, scale=\"hazard\")\nop_remiss_3\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 6), k = 0, \n    scale = \"hazard\")\n\nEstimates: \n             data mean  est       L95%      U95%      se        exp(est)\ngamma0             NA   -12.2252  -15.2594   -9.1910    1.5481        NA\ngamma1             NA     4.4874    3.4628    5.5121    0.5228        NA\ntrt            0.4688    -0.1606   -0.5642    0.2430    0.2059    0.8517\nhomelessYes    0.2708     0.0539   -0.3987    0.5066    0.2310    1.0554\n             L95%      U95%    \ngamma0             NA        NA\ngamma1             NA        NA\ntrt            0.5688    1.2751\nhomelessYes    0.6712    1.6596\n\nN = 96,  Events: 96,  Censored: 0\nTotal time at risk: 465\nLog-likelihood = -216.8018, df = 4\nAIC = 441.6036\n\n\nLooking at the results, we can see that neither trt or homeless had any effect on any transition.\nWe will now join the models together and demonstrate calculation of cumulative hazards.\n\n\nShow R code\n#Define transition matrix\nop_trans &lt;- rbind(c(NA,1,NA,NA,NA,NA,NA), c(NA,NA,2,NA,NA,NA,NA), c(NA,NA,NA,3,NA,NA,NA),\n                  c(NA,NA,NA,NA,4,NA,NA), c(NA,NA,NA,NA,NA,5,NA), c(NA,NA,NA,NA,NA,NA,6),\n                  c(NA,NA,NA,NA,NA,NA,NA))\nop_trans\n\n\n     [,1] [,2] [,3] [,4] [,5] [,6] [,7]\n[1,]   NA    1   NA   NA   NA   NA   NA\n[2,]   NA   NA    2   NA   NA   NA   NA\n[3,]   NA   NA   NA    3   NA   NA   NA\n[4,]   NA   NA   NA   NA    4   NA   NA\n[5,]   NA   NA   NA   NA   NA    5   NA\n[6,]   NA   NA   NA   NA   NA   NA    6\n[7,]   NA   NA   NA   NA   NA   NA   NA\n\n\nShow R code\n#Group transitions together\nop_msm_all &lt;- fmsm(op_relap_1, op_remiss_1, op_relap_2, op_remiss_2, op_relap_3, op_remiss_3, trans=op_trans)\nop_msm_all\n\n\nState 1 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 1), k = 1, \n    scale = \"hazard\")\n\nState 2 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 2), k = 1, \n    scale = \"hazard\")\n\nState 3 - State 4 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 3), k = 1, \n    scale = \"hazard\")\n\nState 4 - State 5 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 4), k = 1, \n    scale = \"hazard\")\n\nState 5 - State 6 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 5), k = 1, \n    scale = \"hazard\")\n\nState 6 - State 7 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod_msm, subset = (trans == 6), k = 0, \n    scale = \"hazard\")\n\n\nShow R code\n#Newdata to predict on - control\nnewdata_op &lt;- data.frame(\n  trt = c(0),\n  homeless=as.factor(c(\"No\")))  \n\n#Cumulative transition specific hazard function - control\nchaz_op &lt;- msfit.flexsurvreg(op_msm_all, t=c(1), newdata=newdata_op, trans=op_trans)\n\n#Probability in state - control\nprob_op &lt;- probtrans(chaz_op, predt=0, direction=\"forward\")\n\n#Expected time in states by 1 years\nELOS(prob_op, t=1)\n\n\n      in1 in2 in3 in4 in5 in6 in7\nfrom1   1   0   0   0   0   0   0\nfrom2   0   1   0   0   0   0   0\nfrom3   0   0   1   0   0   0   0\nfrom4   0   0   0   1   0   0   0\nfrom5   0   0   0   0   1   0   0\nfrom6   0   0   0   0   0   1   0\nfrom7   0   0   0   0   0   0   1\n\n\n\n\n13.2 Time-varying covariate for recurrence\nThe data for time-varying covariate for recurrence number is provided below.\n\n\n\nShow R code\n#Load in recurrence with covariate\nopiod &lt;- read_csv(\"https://raw.githubusercontent.com/NicoleDeLaMata/AdvancedSurvival/refs/heads/Data/opiod.csv\")\n\n#Set to factor\nopiod$homeless &lt;- factor(opiod$homeless, levels = c(\"No\", \"Yes\"))\n\n#Number of transitions\ntable(opiod$trans)\n\n\n\n  1   2   3 \n344 573 373 \n\n\nShow R code\n#Transition types\ntable(opiod$transition, opiod$trans)\n\n\n                      \n                         1   2   3\n  &gt;=3rd Rel-&gt;&gt;=3rd Rem   0  96   0\n  1st Rel-&gt;1st Rem       0 292   0\n  1st Rem-&gt;2nd Rel       0   0 235\n  2nd Rel-&gt;2nd Rem       0 185   0\n  2nd Rem-&gt;&gt;=3rd Rel     0   0 138\n  Init Rem-&gt;1st Rel    218   0   0\n  Init Rem-&gt;Init Rem   126   0   0\n\n\nNow let’s fit the model with relapse giving the time-varying cumulative number of relapses.\n\n\nShow R code\n#Fit separate models for each transition\nop_to_1recur &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless, data=opiod, subset=(trans==1), k=1, scale=\"hazard\")\nop_to_1recur\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod, subset = (trans == 1), k = 1, scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -3.4030  -3.8849  -2.9211   0.2459       NA        NA\ngamma1            NA     1.4337   1.1338   1.7336   0.1530       NA        NA\ngamma2            NA     0.1172   0.0507   0.1837   0.0339       NA        NA\ntrt           0.4041    -0.0274  -0.3003   0.2454   0.1392   0.9729    0.7406\nhomelessYes   0.2529     0.2206  -0.0774   0.5187   0.1521   1.2469    0.9255\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.2781\nhomelessYes   1.6799\n\nN = 344,  Events: 218,  Censored: 126\nTotal time at risk: 4175\nLog-likelihood = -853.9607, df = 5\nAIC = 1717.921\n\n\nShow R code\nop_to_allremiss &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless + relapse, data=opiod, subset=(trans==2), k=1, scale=\"hazard\")\nop_to_allremiss\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless + relapse, data = opiod, subset = (trans == 2), \n    k = 1, scale = \"hazard\")\n\nEstimates: \n             data mean  est      L95%     U95%     se       exp(est)  L95%   \ngamma0            NA    -0.3690  -0.6740  -0.0641   0.1556       NA        NA\ngamma1            NA     1.2252   1.0613   1.3890   0.0836       NA        NA\ngamma2            NA     0.0150  -0.0323   0.0622   0.0241       NA        NA\ntrt           0.4293    -0.0976  -0.2631   0.0679   0.0844   0.9070    0.7686\nhomelessYes   0.2845     0.1168  -0.0650   0.2986   0.0928   1.1239    0.9370\nrelapse       1.6579    -0.6086  -0.7319  -0.4852   0.0629   0.5441    0.4810\n             U95%   \ngamma0            NA\ngamma1            NA\ngamma2            NA\ntrt           1.0702\nhomelessYes   1.3479\nrelapse       0.6156\n\nN = 573,  Events: 573,  Censored: 0\nTotal time at risk: 1460\nLog-likelihood = -1055.46, df = 6\nAIC = 2122.92\n\n\nShow R code\nop_to_allrecur &lt;- flexsurvspline(Surv(Tstart, Tstop, status) ~ trt + homeless + relapse, data=opiod, subset=(trans==3), k=1, scale=\"hazard\")\nop_to_allrecur\n\n\nCall:\nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless + relapse, data = opiod, subset = (trans == 3), \n    k = 1, scale = \"hazard\")\n\nEstimates: \n             data mean  est       L95%      U95%      se        exp(est)\ngamma0             NA   -1.87329  -2.77316  -0.97342   0.45913        NA\ngamma1             NA    1.27590   0.83779   1.71400   0.22353        NA\ngamma2             NA    0.00924  -0.12675   0.14522   0.06938        NA\ntrt           0.41823   -0.16630  -0.37379   0.04118   0.10586   0.84679\nhomelessYes   0.29223   -0.07995  -0.30535   0.14546   0.11500   0.92317\nrelapse       1.36997    0.07545  -0.14363   0.29452   0.11178   1.07836\n             L95%      U95%    \ngamma0             NA        NA\ngamma1             NA        NA\ngamma2             NA        NA\ntrt           0.68812   1.04204\nhomelessYes   0.73687   1.15657\nrelapse       0.86620   1.34249\n\nN = 373,  Events: 373,  Censored: 0\nTotal time at risk: 1104\nLog-likelihood = -770.3233, df = 6\nAIC = 1552.647\n\n\nSimilar to above, trt and homeless did not have any effect on the transitions. We do see that relapse is associated with the transition from relapse to remission, where those with more relapses were less likely to transition to remission.\nWe will now join the models together and demonstrate calculation of cumulative hazards.\n\n\nShow R code\n#Define transition matrix\nop_trans_sim &lt;- rbind(c(NA,1,NA), c(NA,NA,2), c(NA,3,NA))\nop_trans_sim\n\n\n     [,1] [,2] [,3]\n[1,]   NA    1   NA\n[2,]   NA   NA    2\n[3,]   NA    3   NA\n\n\nShow R code\n#Group transitions together\nop_simp &lt;- fmsm(op_to_1recur, op_to_allremiss, op_to_allrecur, trans=op_trans_sim)\nop_simp\n\n\nState 1 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless, data = opiod, subset = (trans == 1), k = 1, scale = \"hazard\")\n\nState 2 - State 3 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless + relapse, data = opiod, subset = (trans == 2), \n    k = 1, scale = \"hazard\")\n\nState 3 - State 2 \nflexsurvspline(formula = Surv(Tstart, Tstop, status) ~ trt + \n    homeless + relapse, data = opiod, subset = (trans == 3), \n    k = 1, scale = \"hazard\")\n\n\nShow R code\n#Newdata to predict on - control\nnewdata_op_simp &lt;- data.frame(\n  trt = c(0),\n  homeless=as.factor(c(\"No\")),\n  relapse=c(1))  \n\n#Cumulative transition specific hazard function - control\nchaz_op_simp &lt;- msfit.flexsurvreg(op_simp, t=seq(0,5,by=0.5), newdata=newdata_op_simp, trans=op_trans_sim)\n\n#Probability in state - control\nprob_op_simp &lt;- probtrans(chaz_op_simp, predt=0, direction=\"forward\")\nprob_op_simp[[1]]\n\n\n   time   pstate1    pstate2     pstate3        se1         se2          se3\n1   0.0 1.0000000 0.00000000 0.000000000 0.00000000 0.000000000 0.0000000000\n2   0.5 0.9876828 0.01231722 0.000000000 0.00467170 0.004687966 0.0004020405\n3   1.0 0.9669849 0.03036342 0.002651697 0.00856075 0.008188188 0.0017434959\n4   1.5 0.9417713 0.04853027 0.009698389 0.01167755 0.010458248 0.0036953127\n5   2.0 0.9141275 0.06473974 0.021132748 0.01426898 0.012086304 0.0060467672\n6   2.5 0.8854779 0.07843315 0.036088963 0.01654830 0.013528509 0.0085584538\n7   3.0 0.8567458 0.08982816 0.053426072 0.01864123 0.014985224 0.0110598285\n8   3.5 0.8285288 0.09939470 0.072076495 0.02059895 0.016481864 0.0134645382\n9   4.0 0.8012066 0.10760624 0.091187176 0.02242841 0.017985775 0.0157502073\n10  4.5 0.7750105 0.11484670 0.110142795 0.02411777 0.019472975 0.0179322786\n11  5.0 0.7500707 0.12139440 0.128534876 0.02565201 0.020942658 0.0200397343\n\n\nShow R code\n#Expected time in states by 5 years\nELOS(prob_op_simp, t=5)\n\n\n           in1       in2       in3\nfrom1 4.478768 0.3230298 0.1982022\nfrom2 0.000000 2.6707146 2.3292854\nfrom3 0.000000 1.1081758 3.8918242",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  },
  {
    "objectID": "Multistate.html#data-exercise",
    "href": "Multistate.html#data-exercise",
    "title": "3 Multi-state modelling",
    "section": "14 Data exercise",
    "text": "14 Data exercise\nYou have been provided with a new dataset. The state space for this is below.\n\nUse the coding template, which includes the variable list, to undertake similar datasteps and analysis above. Produce the:\n\nTransition-specific Cox model\nTransition-specific flexible parametric survival model with 1 internal knot\nCumulative hazards plot\nProbability of each cause of death plot\n\nPlease refer to the solutions here and R coding here (uploaded following workshop).",
    "crumbs": [
      "Day 2: Flexible parametric & multi-state",
      "3 Multi-state modelling"
    ]
  }
]